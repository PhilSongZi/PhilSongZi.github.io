<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>VueCoreLanguage</title>
    <url>/post/2eb6dd78.html</url>
    <content><![CDATA[<h2 id="1-ä»‹ç»-å…¥é—¨">1. ä»‹ç»&amp;å…¥é—¨</h2>
<h3 id="æ˜¯ä»€ä¹ˆ">æ˜¯ä»€ä¹ˆ</h3>
<p>Vue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼æ¡†æ¶ã€‚ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨æä¾›é©±åŠ¨ã€‚</p>
<h2 id="2-æ ¸å¿ƒè¯­æ³•">2. æ ¸å¿ƒè¯­æ³•</h2>
<h3 id="æ —å­">æ —å­</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=, chrome&quot;&gt;</span><br><span class="line">  &lt;meta name=&quot;viewport&quot; content=&quot;width=, initial-scale=1.0&quot;&gt;</span><br><span class="line">  &lt;title&gt;VueLearning Time&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;!-- 1.2 æ’å€¼è¡¨è¾¾å¼ --&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123; title &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;!-- &lt;p&gt;&#123;&#123; content &#125;&#125;&lt;/p&gt; --&gt;</span><br><span class="line">    &lt;!-- &lt;p&gt;&#123;&#123; 1+2+3&#125;&#125;&lt;/p&gt; --&gt;</span><br><span class="line">    &lt;!-- &lt;p&gt;&#123;&#123; 1 &gt; 2 ? &#x27;å¯¹&#x27; : &#x27;é”™&#x27;&#125;&#125;&lt;/p&gt; --&gt;</span><br><span class="line">    &lt;!-- å¯ä»¥çœ‹åˆ° method æ–¹æ³•ï¼ˆoutput()ï¼‰æ‰§è¡Œäº†ä¸‰æ¬¡ï¼Œcomputed è®¡ç®—å±æ€§ï¼ˆoutputContentï¼‰æ‰§è¡Œäº†ä¸€æ¬¡ --&gt;</span><br><span class="line">    &lt;!-- &lt;p&gt;&#123;&#123; output() &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123; output() &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123; output() &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123; outputContent &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123; outputContent &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123; outputContent &#125;&#125;&lt;/p&gt;  --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 4.æŒ‡ä»¤ï¼šå†…å®¹æŒ‡ä»¤ï¼Œæ¸²æŸ“æŒ‡ä»¤ï¼Œå±æ€§æŒ‡ä»¤ --&gt;</span><br><span class="line">    &lt;!-- å†…å®¹æŒ‡ä»¤ --&gt;</span><br><span class="line">    &lt;!-- &lt;p v-text=&quot;htmlContent&quot;&gt;123&lt;/p&gt; --&gt;</span><br><span class="line">    &lt;!-- &lt;p v-html=&quot;htmlContent&quot;&gt;123&lt;/p&gt; --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- æ¸²æŸ“æŒ‡ä»¤ --&gt;</span><br><span class="line">    &lt;!-- &lt;p v-for=&quot;item in 5&quot;&gt;è¿™æ˜¯å†…å®¹&lt;/p&gt; --&gt;</span><br><span class="line">    &lt;!-- &lt;p v-for=&quot;(item, key, index) in obj&quot;&gt;è¿™æ˜¯å†…å®¹ï¼š&#123;&#123; item &#125;&#125;&#123;&#123; key &#125;&#125;&#123;&#123; index &#125;&#125;&lt;/p&gt;  åœ¨å¾ªç¯ä¸­ä¼šäº§ç”Ÿç´¢å¼•&gt; --&gt;</span><br><span class="line">    &lt;!-- &lt;p v-for=&quot;(item, key, index) in arr&quot;&gt;è¿™æ˜¯å†…å®¹ï¼š&#123;&#123; item &#125;&#125;&lt;/p&gt; --&gt;</span><br><span class="line">    &lt;!-- &lt;p v-if=&quot;bool&quot;&gt;æ ‡ç­¾å†…å®¹&lt;/p&gt; --&gt;</span><br><span class="line">    &lt;!-- &lt;p v-show=&quot;bool&quot;&gt;æ ‡ç­¾å†…å®¹&lt;/p&gt; --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- å±æ€§æŒ‡ä»¤ --&gt;</span><br><span class="line">    &lt;!-- &lt;p v-bind:title=&quot;title&quot;&gt;è¿™æ˜¯å†…å®¹&lt;/p&gt; --&gt;</span><br><span class="line">    &lt;!-- &lt;p :title=&quot;title&quot;&gt;è¿™æ˜¯å†…å®¹&lt;/p&gt; --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- äº‹ä»¶æŒ‡ä»¤ --&gt;</span><br><span class="line">    &lt;!-- &lt;button v-on:click=&quot;output&quot;&gt;ç‚¹å‡»&lt;/button&gt; --&gt;</span><br><span class="line">    &lt;!-- &lt;button @click=&quot;output&quot;&gt;ç‚¹å‡»&lt;/button&gt; --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- è¡¨å•æŒ‡ä»¤ : v-model å¯ä»¥å®ç°åŒå‘æ•°æ®ç»‘å®š--&gt;</span><br><span class="line">    &lt;input v-model=&quot;inputValue&quot; type=&quot;text&quot;&gt;</span><br><span class="line">    &lt;p v-text=&quot;inputValue&quot;&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 5.ä¿®é¥°ç¬¦ --&gt;</span><br><span class="line">    &lt;input v-model.trim=&quot;inputValue&quot; type=&quot;text&quot;&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;script src=&quot;./vue.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    const app = new Vue(&#123;</span><br><span class="line">      // 1.å“åº”å¼æ•°æ®ä¸æ’å€¼è¡¨è¾¾å¼</span><br><span class="line">      el: &#x27;#app&#x27;, // æŒ‚è½½ç‚¹</span><br><span class="line">      data () &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          title: &#x27;è¿™æ˜¯æ ‡é¢˜æ–‡æœ¬&#x27;,</span><br><span class="line">          content: &#x27;è¿™æ˜¯å†…å®¹æ–‡æœ¬&#x27;,</span><br><span class="line">          htmlContent: &#x27;è¿™æ˜¯ä¸€ä¸ª&lt;span&gt;span&lt;/span&gt;æ ‡ç­¾&#x27;,</span><br><span class="line">          arr: [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;],</span><br><span class="line">          obj: &#123;a:10, b:20, c:30, d:40&#125;,</span><br><span class="line">          bool: true,</span><br><span class="line">          inputValue: &#x27;é»˜è®¤è¾“å…¥å†…å®¹&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      // 1.3 methods å±æ€§</span><br><span class="line">      methods: &#123;</span><br><span class="line">        output () &#123;</span><br><span class="line">          console.log(&#x27;methodæ–¹æ³•æ‰§è¡Œäº†&#x27;)</span><br><span class="line">          return &#x27;æ ‡é¢˜ä¸ºï¼š&#x27; + this.title + &#x27;ï¼›&#x27; + &#x27;å†…å®¹ä¸ºï¼š&#x27; + this.content</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      // 2.è®¡ç®—å±æ€§ï¼šå…·æœ‰ç¼“å­˜æ€§ï¼Œåªæœ‰å½“ä¾èµ–çš„æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰ä¼šé‡æ–°æ‰§è¡Œ</span><br><span class="line">      computed: &#123;</span><br><span class="line">        outputContent () &#123;</span><br><span class="line">          console.log(&#x27;computedæ–¹æ³•æ‰§è¡Œäº†&#x27;)</span><br><span class="line">          return &#x27;æ ‡é¢˜ä¸ºï¼š&#x27; + this.title + &#x27;ï¼›&#x27; + &#x27;å†…å®¹ä¸ºï¼š&#x27; + this.content</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      // 3.ä¾¦å¬å™¨ï¼šå½“ä¾èµ–çš„æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰§è¡Œå›è°ƒå‡½æ•°</span><br><span class="line">      watch: &#123;</span><br><span class="line">        title (newVal, oldVal) &#123;</span><br><span class="line">          console.log(newVal, oldVal)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="å“åº”å¼æ•°æ®ä¸æ’å€¼è¡¨è¾¾å¼">å“åº”å¼æ•°æ®ä¸æ’å€¼è¡¨è¾¾å¼</h3>
<h4 id="å“åº”å¼æ•°æ®">å“åº”å¼æ•°æ®</h4>
<p>å½“ä¸€ä¸ª Vue å®ä¾‹è¢«åˆ›å»ºæ—¶ï¼Œå®ƒå°† data å¯¹è±¡ä¸­çš„æ‰€æœ‰çš„ property åŠ å…¥åˆ° Vue çš„<strong>å“åº”å¼ç³»ç»Ÿ</strong>ä¸­ã€‚å½“è¿™äº› property çš„å€¼å‘ç”Ÿæ”¹å˜æ—¶ï¼Œè§†å›¾å°†ä¼šäº§ç”Ÿâ€œå“åº”â€ï¼Œå³åŒ¹é…æ›´æ–°ä¸ºæ–°çš„å€¼ã€‚</p>
<p>æ•°æ®æ”¹å˜æ—¶ï¼Œè§†å›¾æ‰ä¼šè¿›è¡Œé‡æ–°æ¸²æŸ“ï¼Œæ³¨æ„ï¼Œå½“å®ä¾‹åˆ›å»ºæ—¶å°±å·²ç»å­˜åœ¨äº<code>data</code>ä¸­çš„ property æ‰æ˜¯<strong>å“åº”å¼</strong>çš„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// æ–°å»ºå®ä¾‹: vm ViewModel</span><br><span class="line">var vm = new Vue (&#123;</span><br><span class="line">  el: &#x27;#example&#x27;,</span><br><span class="line">  data: data</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>æ¯ä¸ª Vue å®ä¾‹åœ¨è¢«åˆ›å»ºæ—¶éƒ½è¦ç»è¿‡ä¸€ç³»åˆ—çš„åˆå§‹åŒ–è¿‡ç¨‹â€”â€”ä¾‹å¦‚ï¼Œéœ€è¦è®¾ç½®æ•°æ®ç›‘å¬ã€ç¼–è¯‘æ¨¡æ¿ã€å°†å®ä¾‹æŒ‚è½½åˆ° DOM å¹¶åœ¨æ•°æ®å˜åŒ–æ—¶æ›´æ–° DOM ç­‰ã€‚åŒæ—¶åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¹Ÿä¼šè¿è¡Œä¸€äº›å«åš<strong>ç”Ÿå‘½å‘¨æœŸé’©å­</strong>çš„å‡½æ•°ï¼Œè¿™ç»™äº†ç”¨æˆ·åœ¨ä¸åŒé˜¶æ®µæ·»åŠ è‡ªå·±çš„ä»£ç çš„æœºä¼šã€‚</p>
<p>æ¯”å¦‚ <a href="https://v2.cn.vuejs.org/v2/api/#created">created</a> é’©å­å¯ä»¥ç”¨æ¥åœ¨ä¸€ä¸ªå®ä¾‹è¢«åˆ›å»ºä¹‹åæ‰§è¡Œä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">new Vue(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    a: 1</span><br><span class="line">  &#125;,</span><br><span class="line">  created: function () &#123;</span><br><span class="line">    // `this` æŒ‡å‘ vm å®ä¾‹</span><br><span class="line">    console.log(&#x27;a is: &#x27; + this.a)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">// =&gt; &quot;a is: 1&quot;</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿæœ‰ä¸€äº›å…¶å®ƒçš„é’©å­ï¼Œåœ¨å®ä¾‹ç”Ÿå‘½å‘¨æœŸçš„ä¸åŒé˜¶æ®µè¢«è°ƒç”¨ï¼Œå¦‚ <a href="https://v2.cn.vuejs.org/v2/api/#mounted">mounted</a>ã€<a href="https://v2.cn.vuejs.org/v2/api/#updated">updated</a> å’Œ <a href="https://v2.cn.vuejs.org/v2/api/#destroyed">destroyed</a>ã€‚ç”Ÿå‘½å‘¨æœŸé’©å­çš„ this ä¸Šä¸‹æ–‡æŒ‡å‘è°ƒç”¨å®ƒçš„ Vue å®ä¾‹ã€‚</p>
<p>å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸï¼š</p>
<p><img src="/post/2eb6dd78/lifecycle.png" alt="lifecycle"></p>
<h4 id="æ’å€¼è¡¨è¾¾å¼ï¼š"><strong>æ’å€¼è¡¨è¾¾å¼ï¼š</strong></h4>
<p><strong>æ–‡æœ¬</strong>ï¼š</p>
<p>â€œMustacheâ€è¯­æ³•ï¼ˆåŒå¤§æ‹¬å·ï¼‰çš„æ–‡æœ¬æ’å€¼ï¼š<code>&lt;span&gt;Message:&#123;&#123; msg &#125;&#125;&lt;/span&gt;</code>ã€‚Mustache æ ‡ç­¾å°†ä¼šè¢«æ›¿ä»£ä¸ºå¯¹åº”æ•°æ®å¯¹è±¡ä¸Š msg property çš„å€¼ã€‚æ— è®ºä½•æ—¶ï¼Œç»‘å®šçš„æ•°æ®å¯¹è±¡ä¸Š msg property å‘ç”Ÿäº†æ”¹å˜ï¼Œæ’å€¼å¤„çš„å†…å®¹éƒ½ä¼šæ›´æ–°ã€‚å¯ä»¥ä½¿ç”¨<code>v-once</code>æŒ‡ä»¤æ‰§è¡Œä¸€æ¬¡æ€§æ’å€¼ã€‚</p>
<p><strong>HTML</strong>ï¼š</p>
<p>åŒå¤§æ‹¬å·ä¼šå°†æ•°æ®è§£é‡Šä¸ºæ™®é€šæ–‡æœ¬ï¼Œè€Œé HTML ä»£ç ã€‚ä¸ºäº†è¾“å‡ºçœŸæ­£çš„ HTMLï¼Œéœ€è¦ä½¿ç”¨ <a href="https://v2.cn.vuejs.org/v2/api/#v-html">v-htmlæŒ‡ä»¤</a>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;p&gt;Using mustaches: &#123;&#123; rawHtml &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;Using v-html directive: &lt;span v-html=&quot;rawHtml&quot;&gt;&lt;/span&gt;&lt;/p&gt;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ª span çš„å†…å®¹å°†ä¼šè¢«æ›¿æ¢æˆä¸º property å€¼ rawHtmlï¼Œç›´æ¥ä½œä¸º HTMLâ€”â€”ä¼šå¿½ç•¥è§£æ property å€¼ä¸­çš„æ•°æ®ç»‘å®šã€‚æ³¨æ„ï¼Œä½ ä¸èƒ½ä½¿ç”¨ v-html æ¥å¤åˆå±€éƒ¨æ¨¡æ¿ï¼Œå› ä¸º Vue ä¸æ˜¯åŸºäºå­—ç¬¦ä¸²çš„æ¨¡æ¿å¼•æ“ã€‚åä¹‹ï¼Œå¯¹äºç”¨æˆ·ç•Œé¢ (UI)ï¼Œç»„ä»¶æ›´é€‚åˆä½œä¸ºå¯é‡ç”¨å’Œå¯ç»„åˆçš„åŸºæœ¬å•ä½ã€‚</p>
<p><strong>Attribute</strong>ï¼š</p>
<p>Mustache è¯­æ³•ä¸èƒ½ä½œç”¨åœ¨ HTML attribute ä¸Šï¼Œé‡åˆ°è¿™ç§æƒ…å†µåº”è¯¥ä½¿ç”¨ <a href="https://v2.cn.vuejs.org/v2/api/#v-bind">v-bindæŒ‡ä»¤</a>ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-bind:id</span>=<span class="string">&quot;dynamicId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¯¹äºå¸ƒå°” attribute ï¼Œv-bind ï¼š</p>
<p>å¦‚æœ isButtonDisabled çš„å€¼æ˜¯ nullã€undefined æˆ– falseï¼Œåˆ™ disabled attribute ç”šè‡³ä¸ä¼šè¢«åŒ…å«åœ¨æ¸²æŸ“å‡ºæ¥çš„ <button> å…ƒç´ ä¸­ã€‚</button></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">v-bind:disabled</span>=<span class="string">&quot;isButtonDisabled&quot;</span>&gt;</span>Button<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>JavaScriptè¡¨è¾¾å¼</strong>ï¼š</p>
<p>è¡¨è¾¾å¼ä¼šåœ¨æ‰€å±å®ä¾‹çš„æ•°æ®ä½œç”¨åŸŸä¸‹é¢ä½œä¸ºJavaScriptè¢«è§£æã€‚ï¼ˆæ¯ä¸ªç»‘å®šåªèƒ½åŒ…å«å•ä¸ªè¡¨è¾¾å¼ã€‚ï¼‰</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;&#123; number + <span class="number">1</span> &#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123; ok ? <span class="string">&#x27;YES&#x27;</span> : <span class="string">&#x27;NO&#x27;</span> &#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123; message.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">reverse</span>().<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>) &#125;&#125;</span><br><span class="line"></span><br><span class="line">&lt;div v-<span class="attr">bind</span>:id=<span class="string">&quot;&#x27;list-&#x27; + id&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- è¿™æ˜¯è¯­å¥ï¼Œä¸æ˜¯è¡¨è¾¾å¼ --&gt;</span><br><span class="line">&#123;&#123; <span class="keyword">var</span> a = <span class="number">1</span> &#125;&#125;</span><br><span class="line"></span><br><span class="line">&lt;!-- æµæ§åˆ¶ä¹Ÿä¸ä¼šç”Ÿæ•ˆï¼Œè¯·ä½¿ç”¨ä¸‰å…ƒè¡¨è¾¾å¼ --&gt;</span><br><span class="line">&#123;&#123; <span class="keyword">if</span> (ok) &#123; <span class="keyword">return</span> message &#125; &#125;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ —å­-2">æ —å­</h4>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=, chrome&quot;&gt;</span><br><span class="line">  &lt;meta name=&quot;viewport&quot; content=&quot;width=, initial-scale=1.0&quot;&gt;</span><br><span class="line">  &lt;title&gt;VueLearning Time&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;!-- 1.2 æ’å€¼è¡¨è¾¾å¼ --&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123; title &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;!-- &lt;p&gt;&#123;&#123; content &#125;&#125;&lt;/p&gt; --&gt;</span><br><span class="line">    &lt;!-- &lt;p&gt;&#123;&#123; 1+2+3&#125;&#125;&lt;/p&gt; --&gt;</span><br><span class="line">    &lt;!-- &lt;p&gt;&#123;&#123; 1 &gt; 2 ? &#x27;å¯¹&#x27; : &#x27;é”™&#x27;&#125;&#125;&lt;/p&gt; --&gt;</span><br><span class="line">    &lt;!-- å¯ä»¥çœ‹åˆ° method æ–¹æ³•ï¼ˆoutput()ï¼‰æ‰§è¡Œäº†ä¸‰æ¬¡ï¼Œcomputed è®¡ç®—å±æ€§ï¼ˆoutputContentï¼‰æ‰§è¡Œäº†ä¸€æ¬¡ --&gt;</span><br><span class="line">    &lt;!-- &lt;p&gt;&#123;&#123; output() &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123; output() &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123; output() &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123; outputContent &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123; outputContent &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123; outputContent &#125;&#125;&lt;/p&gt;  --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;script src=&quot;./vue.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    const app = new Vue(&#123;</span><br><span class="line">      // 1.å“åº”å¼æ•°æ®ä¸æ’å€¼è¡¨è¾¾å¼</span><br><span class="line">      el: &#x27;#app&#x27;, // æŒ‚è½½ç‚¹</span><br><span class="line">      data () &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          title: &#x27;è¿™æ˜¯æ ‡é¢˜æ–‡æœ¬&#x27;,</span><br><span class="line">          content: &#x27;è¿™æ˜¯å†…å®¹æ–‡æœ¬&#x27;,</span><br><span class="line">          htmlContent: &#x27;è¿™æ˜¯ä¸€ä¸ª&lt;span&gt;span&lt;/span&gt;æ ‡ç­¾&#x27;,</span><br><span class="line">          arr: [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;],</span><br><span class="line">          obj: &#123;a:10, b:20, c:30, d:40&#125;,</span><br><span class="line">          bool: true,</span><br><span class="line">          inputValue: &#x27;é»˜è®¤è¾“å…¥å†…å®¹&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="è®¡ç®—å±æ€§">è®¡ç®—å±æ€§</h3>
<p>å¯¹å¤æ‚é€»è¾‘çš„å¤„ç†ï¼Œæ”¾åœ¨è®¡ç®—å±æ€§ä¸­ã€‚</p>
<p>æ —å­ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;example&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Original message: &quot;&#123;&#123; message &#125;&#125;&quot;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Computed reversed message: &quot;&#123;&#123; reversedMessage &#125;&#125;&quot;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">var vm = new Vue(&#123;</span><br><span class="line">  el: &#x27;#example&#x27;,</span><br><span class="line">  data: &#123;</span><br><span class="line">    message: &#x27;Hello&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    // è®¡ç®—å±æ€§çš„ getter</span><br><span class="line">    reversedMessage: function () &#123;</span><br><span class="line">      // `this` æŒ‡å‘ vm å®ä¾‹</span><br><span class="line">      return this.message.split(&#x27;&#x27;).reverse().join(&#x27;&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥å°†åŒä¸€å‡½æ•°å®šä¹‰ä¸ºä¸€ä¸ªæ–¹æ³•è€Œéè®¡ç®—å±æ€§ï¼Œä¸¤è€…ç»“æœä¸€è‡´ï¼Œä½†æ˜¯<strong>è®¡ç®—å±æ€§æ˜¯åŸºäºå®ƒä»¬çš„å“åº”å¼ä¾èµ–è¿›è¡Œç¼“å­˜</strong>çš„ï¼Œåªæœ‰åœ¨ç›¸å…³å“åº”å¼ä¾èµ–å‘ç”Ÿæ”¹å˜æ—¶æ‰ä¼šé‡æ–°æ±‚å€¼ã€‚</p>
<p>è®¡ç®—å±æ€§çš„<code>setter</code>ï¼š(é»˜è®¤åªæœ‰ getter å¯è‡ªå®šä¹‰ setter)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// ...</span><br><span class="line">computed: &#123;</span><br><span class="line">  fullName: &#123;</span><br><span class="line">    // getter</span><br><span class="line">    get: function () &#123;</span><br><span class="line">      return this.firstName + &#x27; &#x27; + this.lastName</span><br><span class="line">    &#125;,</span><br><span class="line">    // setter</span><br><span class="line">    set: function (newValue) &#123;</span><br><span class="line">      var names = newValue.split(&#x27; &#x27;)</span><br><span class="line">      this.firstName = names[0]</span><br><span class="line">      this.lastName = names[names.length - 1]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// ...</span><br></pre></td></tr></table></figure>
<h3 id="ä¾¦å¬å™¨">ä¾¦å¬å™¨</h3>
<p>å½“ä¾èµ–çš„æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰§è¡Œå›è°ƒå‡½æ•°ã€‚</p>
<p>ä½¿ç”¨åœºæ™¯ï¼šéœ€è¦åœ¨æ•°æ®å˜åŒ–æ—¶æ‰§è¡Œå¼‚æ­¥æˆ–å¼€é”€è¾ƒå¤§çš„æ“ä½œæ—¶ï¼Œååˆ†ä¼˜è¶Šã€‚</p>
<p>æ —å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div id=&quot;demo&quot;&gt;&#123;&#123; fullName &#125;&#125;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">                                     </span><br><span class="line">var vm = new Vue(&#123;</span><br><span class="line">  el: &#x27;#demo&#x27;,</span><br><span class="line">  data: &#123;</span><br><span class="line">    firstName: &#x27;Foo&#x27;,</span><br><span class="line">    lastName: &#x27;Bar&#x27;,</span><br><span class="line">    fullName: &#x27;Foo Bar&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    firstName: function (val) &#123;</span><br><span class="line">      this.fullName = val + &#x27; &#x27; + this.lastName</span><br><span class="line">    &#125;,</span><br><span class="line">    lastName: function (val) &#123;</span><br><span class="line">      this.fullName = this.firstName + &#x27; &#x27; + val</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>æ —å­2ï¼šä½¿ç”¨ watch é€‰é¡¹å…è®¸æˆ‘ä»¬æ‰§è¡Œå¼‚æ­¥æ“ä½œ (è®¿é—®ä¸€ä¸ª API)ï¼Œé™åˆ¶æˆ‘ä»¬æ‰§è¡Œè¯¥æ“ä½œçš„é¢‘ç‡ï¼Œå¹¶åœ¨æˆ‘ä»¬å¾—åˆ°æœ€ç»ˆç»“æœå‰ï¼Œè®¾ç½®ä¸­é—´çŠ¶æ€ã€‚è¿™äº›éƒ½æ˜¯è®¡ç®—å±æ€§æ— æ³•åšåˆ°çš„ã€‚</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;watch-example&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    Ask a yes/no question:</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;question&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; answer &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å› ä¸º AJAX åº“å’Œé€šç”¨å·¥å…·çš„ç”Ÿæ€å·²ç»ç›¸å½“ä¸°å¯Œï¼ŒVue æ ¸å¿ƒä»£ç æ²¡æœ‰é‡å¤ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- æä¾›è¿™äº›åŠŸèƒ½ä»¥ä¿æŒç²¾ç®€ã€‚è¿™ä¹Ÿå¯ä»¥è®©ä½ è‡ªç”±é€‰æ‹©è‡ªå·±æ›´ç†Ÿæ‚‰çš„å·¥å…·ã€‚ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/axios@0.12.0/dist/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/lodash@4.13.1/lodash.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> watchExampleVM = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">el</span>: <span class="string">&#x27;#watch-example&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">question</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">answer</span>: <span class="string">&#x27;I cannot give you an answer until you ask a question!&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">watch</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// å¦‚æœ `question` å‘ç”Ÿæ”¹å˜ï¼Œè¿™ä¸ªå‡½æ•°å°±ä¼šè¿è¡Œ</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">question</span>: <span class="keyword">function</span> (<span class="params">newQuestion, oldQuestion</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">answer</span> = <span class="string">&#x27;Waiting for you to stop typing...&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">debouncedGetAnswer</span>()</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">created</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// `_.debounce` æ˜¯ä¸€ä¸ªé€šè¿‡ Lodash é™åˆ¶æ“ä½œé¢‘ç‡çš„å‡½æ•°ã€‚</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›é™åˆ¶è®¿é—® yesno.wtf/api çš„é¢‘ç‡</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// AJAX è¯·æ±‚ç›´åˆ°ç”¨æˆ·è¾“å…¥å®Œæ¯•æ‰ä¼šå‘å‡ºã€‚æƒ³è¦äº†è§£æ›´å¤šå…³äº</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// `_.debounce` å‡½æ•° (åŠå…¶è¿‘äº² `_.throttle`) çš„çŸ¥è¯†ï¼Œ</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// è¯·å‚è€ƒï¼šhttps://lodash.com/docs#debounce</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">debouncedGetAnswer</span> = _.<span class="title function_">debounce</span>(<span class="variable language_">this</span>.<span class="property">getAnswer</span>, <span class="number">500</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">getAnswer</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">question</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;?&#x27;</span>) === -<span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">answer</span> = <span class="string">&#x27;Questions usually contain a question mark. ;-)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">return</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">answer</span> = <span class="string">&#x27;Thinking...&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> vm = <span class="variable language_">this</span></span></span><br><span class="line"><span class="language-javascript">        axios.<span class="title function_">get</span>(<span class="string">&#x27;https://yesno.wtf/api&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">          .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            vm.<span class="property">answer</span> = _.<span class="title function_">capitalize</span>(response.<span class="property">data</span>.<span class="property">answer</span>)</span></span><br><span class="line"><span class="language-javascript">          &#125;)</span></span><br><span class="line"><span class="language-javascript">          .<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">error</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            vm.<span class="property">answer</span> = <span class="string">&#x27;Error! Could not reach the API. &#x27;</span> + error</span></span><br><span class="line"><span class="language-javascript">          &#125;)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="æŒ‡ä»¤">æŒ‡ä»¤</h3>
<p>æŒ‡ä»¤ (Directives) æ˜¯å¸¦æœ‰ v- å‰ç¼€çš„ç‰¹æ®Š attributeã€‚æŒ‡ä»¤ attribute çš„å€¼é¢„æœŸæ˜¯<strong>å•ä¸ª JavaScript è¡¨è¾¾å¼</strong> (v-for ä¾‹å¤–)ã€‚å½“è¡¨è¾¾å¼çš„å€¼æ”¹å˜æ—¶ï¼ŒæŒ‡ä»¤å°†å…¶äº§ç”Ÿçš„è¿å¸¦å½±å“ï¼Œå“åº”å¼åœ°ä½œç”¨äº DOMã€‚</p>
<p>å¦‚ä¸‹ï¼Œ<code>v-if</code>æ ¹æ®è¡¨è¾¾å¼<code>seen</code>å€¼çš„çœŸå‡æ¥æ’å…¥orç§»é™¤<code>&lt;p&gt;</code>å…ƒç´ ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-if</span>=<span class="string">&quot;seen&quot;</span>&gt;</span>ç°åœ¨ä½ çœ‹åˆ°æˆ‘äº†<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æŒ‡ä»¤åˆ†ç±»andæ —å­ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 4.æŒ‡ä»¤ï¼šå†…å®¹æŒ‡ä»¤ï¼Œæ¸²æŸ“æŒ‡ä»¤ï¼Œå±æ€§æŒ‡ä»¤ --&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- å†…å®¹æŒ‡ä»¤ --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-text</span>=<span class="string">&quot;htmlContent&quot;</span>&gt;</span>123<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-html</span>=<span class="string">&quot;htmlContent&quot;</span>&gt;</span>123<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!-- æ¸²æŸ“æŒ‡ä»¤ --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-for</span>=<span class="string">&quot;item in 5&quot;</span>&gt;</span>è¿™æ˜¯å†…å®¹<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, key, index) in obj&quot;</span>&gt;</span>è¿™æ˜¯å†…å®¹ï¼š&#123;&#123; item &#125;&#125;&#123;&#123; key &#125;&#125;&#123;&#123; index &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>  åœ¨å¾ªç¯ä¸­ä¼šäº§ç”Ÿç´¢å¼•&gt;</span><br><span class="line"> <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, key, index) in arr&quot;</span>&gt;</span>è¿™æ˜¯å†…å®¹ï¼š&#123;&#123; item &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-if</span>=<span class="string">&quot;bool&quot;</span>&gt;</span>æ ‡ç­¾å†…å®¹<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-show</span>=<span class="string">&quot;bool&quot;</span>&gt;</span>æ ‡ç­¾å†…å®¹<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!-- å±æ€§æŒ‡ä»¤ --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-bind:title</span>=<span class="string">&quot;title&quot;</span>&gt;</span>è¿™æ˜¯å†…å®¹<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">p</span> <span class="attr">:title</span>=<span class="string">&quot;title&quot;</span>&gt;</span>è¿™æ˜¯å†…å®¹<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!-- äº‹ä»¶æŒ‡ä»¤ --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;output&quot;</span>&gt;</span>ç‚¹å‡»<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;output&quot;</span>&gt;</span>ç‚¹å‡»<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!-- è¡¨å•æŒ‡ä»¤ : v-model å¯ä»¥å®ç°åŒå‘æ•°æ®ç»‘å®š--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;inputValue&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-text</span>=<span class="string">&quot;inputValue&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="ä¿®é¥°ç¬¦">ä¿®é¥°ç¬¦</h3>
<p>ä¿®é¥°ç¬¦ (modifier) æ˜¯ä»¥åŠè§’å¥å· . æŒ‡æ˜çš„ç‰¹æ®Šåç¼€ï¼Œç”¨äºæŒ‡å‡ºä¸€ä¸ªæŒ‡ä»¤åº”è¯¥ä»¥ç‰¹æ®Šæ–¹å¼ç»‘å®šã€‚ä¾‹å¦‚ï¼Œ.prevent ä¿®é¥°ç¬¦å‘Šè¯‰ v-on æŒ‡ä»¤å¯¹äºè§¦å‘çš„äº‹ä»¶è°ƒç”¨ event.preventDefault()ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;form v-on:submit.prevent=&quot;onSubmit&quot;&gt;...&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<p><strong>ç¼©å†™</strong>ï¼š</p>
<p>Vue ä¸º v-bind å’Œ v-on è¿™ä¸¤ä¸ªæœ€å¸¸ç”¨çš„æŒ‡ä»¤ï¼Œæä¾›äº†ç‰¹å®šç®€å†™ï¼š</p>
<p>v-bindï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å®Œæ•´è¯­æ³• --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-bind:href</span>=<span class="string">&quot;url&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ç¼©å†™ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">:href</span>=<span class="string">&quot;url&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- åŠ¨æ€å‚æ•°çš„ç¼©å†™ (2.6.0+) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">:</span>[<span class="attr">key</span>]=<span class="string">&quot;url&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>v-onï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å®Œæ•´è¯­æ³• --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-on:click</span>=<span class="string">&quot;doSomething&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ç¼©å†™ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> @<span class="attr">click</span>=<span class="string">&quot;doSomething&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- åŠ¨æ€å‚æ•°çš„ç¼©å†™ (2.6.0+) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> @[<span class="attr">event</span>]=<span class="string">&quot;doSomething&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="3-ç»„ä»¶">3. ç»„ä»¶</h2>
<p>æ‰€æœ‰çš„ Vue ç»„ä»¶éƒ½æ˜¯ Vue å®ä¾‹ï¼Œå¹¶ä¸”æ¥å—ç›¸åŒçš„é€‰é¡¹å¯¹è±¡ (ä¸€äº›æ ¹å®ä¾‹ç‰¹æœ‰çš„é€‰é¡¹é™¤å¤–)ã€‚</p>
]]></content>
      <categories>
        <category>Coding</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu(wsl)å®‰è£…Rediså¹¶æ­å»ºé›†ç¾¤</title>
    <url>/post/ac35e331.html</url>
    <content><![CDATA[<h2 id="Ubuntuï¼ˆwslï¼‰å®‰è£…Rediså¹¶æ­å»ºé›†ç¾¤">Ubuntuï¼ˆwslï¼‰å®‰è£…Rediså¹¶æ­å»ºé›†ç¾¤</h2>
<h3 id="èµ·å› ">èµ·å› </h3>
<p>é…ç½®Redisé›†ç¾¤ï¼ŒWindowsæœ¬æœºå·²ç»æœ‰äº†Redisï¼Œå°±æƒ³åœ¨wslä¸­è£…Redisé›†ç¾¤ã€‚</p>
<h3 id="è¸©å‘å†ç¨‹">è¸©å‘å†ç¨‹</h3>
<ol>
<li>è¿˜å°±é‚£ä¸ªç»å…¸çš„ï¼š</li>
</ol>
<p>å¯åŠ¨wslæ—¶æŠ¥é”™ <code>å ä½ç¨‹åºæ¥æ”¶åˆ°é”™è¯¯æ•°æ®ã€‚ Error code: Wsl/Service/0x800706f7</code>ã€‚è¡Œå§ï¼Œä¸è¿æ¢¯å­ä¸Šä¸å»ç½‘ç«™ï¼Œè¿ä¸Šæ¢¯å­å°±æ€»æœ‰å¹ºè›¾å­ã€‚è§£å†³åŠæ³•ï¼šç»ˆç«¯ç®¡ç†å‘˜æƒé™è¿è¡Œ<code>netsh winsock reset</code>ï¼Œæˆ–è€…ä½¿ç”¨<code>NoLSP.exe</code>å¯åŠ¨wslã€‚</p>
<ol start="2">
<li>Redis å®‰è£…ï¼š</li>
</ol>
<p>ä»<a href="http://download.redis.io/releases/">rediså‘è¡Œç½‘ç«™</a>ä¸Šä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„<code>redis-7.2.0.tar.gz</code>ï¼Œè§£å‹ï¼Œcdåˆ°ç›®å½•ä¸‹ï¼Œ<code>make</code>æ„å»ºã€‚</p>
<p>æ¥åŠ›ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(.<span class="property">venv</span>) vagrant@<span class="attr">vagrant</span>:<span class="regexp">/vagrant/</span>redis-<span class="number">6.0</span><span class="number">.6</span>$ make</span><br><span class="line">cd src &amp;&amp; make all</span><br><span class="line">make[<span class="number">1</span>]: <span class="title class_">Entering</span> directory <span class="string">&#x27;/vagrant/redis-6.0.6/src&#x27;</span></span><br><span class="line">/bin/<span class="attr">sh</span>: <span class="number">1</span>: pkg-<span class="attr">config</span>: not found</span><br><span class="line">    <span class="variable constant_">CC</span> <span class="title class_">Makefile</span>.<span class="property">dep</span></span><br><span class="line">/bin/<span class="attr">sh</span>: <span class="number">1</span>: pkg-<span class="attr">config</span>: not found</span><br><span class="line">make[<span class="number">1</span>]: <span class="title class_">Warning</span>: <span class="title class_">File</span> <span class="string">&#x27;Makefile.dep&#x27;</span> has modification time <span class="number">1.3</span> s <span class="keyword">in</span> the future</span><br><span class="line">    <span class="variable constant_">CC</span> adlist.<span class="property">o</span></span><br><span class="line">/bin/<span class="attr">sh</span>: <span class="number">1</span>: <span class="attr">cc</span>: not found</span><br><span class="line"><span class="title class_">Makefile</span>:<span class="number">315</span>: recipe <span class="keyword">for</span> target <span class="string">&#x27;adlist.o&#x27;</span> failed</span><br><span class="line">make[<span class="number">1</span>]: *** [adlist.<span class="property">o</span>] <span class="title class_">Error</span> <span class="number">127</span></span><br><span class="line">make[<span class="number">1</span>]: <span class="title class_">Leaving</span> directory <span class="string">&#x27;/vagrant/redis-6.0.6/src&#x27;</span></span><br><span class="line"><span class="title class_">Makefile</span>:<span class="number">6</span>: recipe <span class="keyword">for</span> target <span class="string">&#x27;all&#x27;</span> failed</span><br><span class="line"><span class="attr">make</span>: *** [all] <span class="title class_">Error</span> <span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>è§£å†³åŠæ³•ï¼š</p>
<ul>
<li>å°‘äº†<code>pkg-config</code>ï¼Œå®‰è£…ä¹‹ï¼Œé¡ºä¾¿å®‰è£…äº†<code>gcc</code>å’Œ<code>tcl</code>ï¼ˆæ²¡æœ‰<code>tcl</code>åœ¨ <code>make test</code>æ—¶ä¼šæŠ¥é”™ï¼‰ã€‚</li>
<li>å®‰è£…<code>gcc</code>å’Œ<code>tcl</code>æ—¶ä¼šå‡ºç°ï¼š<code>/sbin/ldconfig.real: /usr/lib/wsl/lib/libcuda.so.1 is not a symbolic link</code>è¿™ä¸ªé—®é¢˜ï¼Œå¯<a href="https://github.com/microsoft/WSL/issues/5663">å‚è€ƒé“¾æ¥</a>ï¼ˆç›®å‰æœªæ·±ç©¶â€¦â€¦ï¼‰ã€‚</li>
<li>ç„¶ååˆ é™¤è§£å‹å‡ºæ¥çš„ redis æ–‡ä»¶å¤¹ï¼Œé‡æ–°è§£å‹å†é‡æ–° make ã€‚å¤§æˆåŠŸã€‚å‚è€ƒï¼š<a href="https://stackoverflow.com/questions/63611270/redis-make-failing-ubuntu-18-04">ubuntu(wsl)å®‰è£…redisæ—¶makeæŠ¥é”™</a></li>
</ul>
<p><img src="/post/ac35e331/Redis%E5%AE%89%E8%A3%85.jpg" alt="img"></p>
<ol start="3">
<li>Redisé›†ç¾¤è®¾ç½®</li>
</ol>
<p>æ­å»ºä¸‰ä¸ªèŠ‚ç‚¹ï¼Œå¯¹åº”ç«¯å£åˆ†åˆ«æ˜¯7000,7001,7002ã€‚é…ç½®å¦‚ä¸‹ï¼š<a href="https://blog.hhui.top/hexblog/2019/09/25/190925-Redis%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E6%89%8B%E5%86%8C/">Redisé›†ç¾¤æ­å»ºæ‰‹å†Œ</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p data/7000 data/7001 data/7002 log/7000 log/7001 log/7002 </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸‹é¢çš„é…ç½®ï¼Œä¸€æ¬¡æ“ä½œä¸‰éï¼Œåˆ†åˆ«è·å¾—r7000.conf r7001.conf r7002.conf</span></span><br><span class="line">cp redis.conf r7000.conf</span><br><span class="line">vim r7000.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># ä¸‹é¢æ˜¯æˆ‘ä»¬éœ€è¦ä¿®æ”¹çš„åœ°æ–¹</span></span></span><br><span class="line">port 7000 # ç«¯å£å·</span><br><span class="line">pidfile /var/run/redis_7000.pid # pidè¿›ç¨‹æ–‡ä»¶</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ—¥å¿—å’Œæ•°æ®å­˜å‚¨è·¯å¾„</span></span><br><span class="line">logfile &quot;/home/yihui/redis/log/7000/redis.log&quot;</span><br><span class="line">dir &quot;/home/yihui/redis/data/7000/&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åå°å¯åŠ¨</span></span><br><span class="line">daemonize yes</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¼€å¯é›†ç¾¤</span></span><br><span class="line">cluster-enabled yes</span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨Redisï¼Œè®¾ç½®é›†ç¾¤ï¼Œé›†ç¾¤è‡³å°‘éœ€è¦ä¸‰ä¸»èŠ‚ç‚¹ï¼Œè®¾ç½®ä¸»ä»æ—¶æœ€å°‘è¦å…­ä¸ªèŠ‚ç‚¹ï¼Œä¸æ˜¯å¾ˆæœ‰å¿…è¦å•Šï¼Œç›´æ¥ä¸è¦ä»èŠ‚ç‚¹äº†ï¼š</p>
<p><img src="/post/ac35e331/Redis%E9%9B%86%E7%BE%A4%E8%AE%BE%E7%BD%AE.jpg" alt="img"></p>
<p>æœ€åç”¨<code>redis-cli</code>æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<p><img src="/post/ac35e331/Redis%E9%9B%86%E7%BE%A4%E6%B5%8B%E8%AF%95.jpg" alt="img"></p>
<h3 id="ç•ªå¤–">ç•ªå¤–</h3>
<p>å…³äº<code>hexo</code>ä¸­å›¾ç‰‡æ˜¾ç¤ºé—®é¢˜ï¼Œ<a href="https://blog.csdn.net/m0_43401436/article/details/107191688">è¿™é‡Œ</a>è®²å¾—å¾ˆæ¸…æ¥šï¼Œcsdn ä¸­éš¾å¾—çš„å¥½æ–‡äº†ã€‚</p>
]]></content>
      <categories>
        <category>Coding</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>wsl</tag>
      </tags>
  </entry>
  <entry>
    <title>Wetab</title>
    <url>/post/32e2265d.html</url>
    <content><![CDATA[<blockquote>
<p>Wetabç¬”è®°ï¼Œç»™ä½ æ›´å¥½çš„ç¬”è®°ä½“éªŒ</p>
<p>è¿™é‡Œæ˜¯<a href="https://www.wetab.link">Wetabæ–°æ ‡ç­¾å®˜ç½‘</a> (å³é”®ç‚¹å‡»æ‰“å¼€é“¾æ¥)</p>
</blockquote>
<p>ä»¥ä¸‹ç‰¹æ€§å¯ä»¥ä¸ºä½ çš„ç¬”è®°å¸¦æ¥éå¸¸æ£’çš„ä½“éªŒï¼š</p>
<ul>
<li>
<p>[x] ğŸ“ <strong>æ‰€è§å³æ‰€å¾—çš„ Markdown</strong> - ä»¥ä¸€ç§ä¼˜é›…çš„æ–¹å¼ç¼–å†™ markdown</p>
</li>
<li>
<p>[x] ğŸ‘ <strong>Emoji</strong> - æ”¯æŒ emoji å¿«æ·æŒ‡ä»¤å’Œé€‰æ‹©å™¨</p>
</li>
<li>
<p>[x] ğŸ’¾ <strong>å‰ªè´´æ¿</strong> - æ”¯æŒ markdown æ ¼å¼çš„å¤åˆ¶ç²˜è´´</p>
</li>
<li>
<p>[x] âŒ¨ï¸ <strong>æ¢è¡Œæ¨¡å¼</strong> - ä½ å¯ä»¥ä½¿ç”¨â€œEnterâ€å’Œâ€œShift + Enterâ€ä¸¤ç§æ–¹å¼è¿›è¡Œæ¢è¡Œ</p>
</li>
<li>
<p>[x] âš¡ <strong>æ–œçº¿æŒ‡ä»¤</strong> - åœ¨ç©ºç™½å¤„è¾“å…¥çŠ¶æ€ä¸‹é€šè¿‡â€œ/â€å¯ä»¥å®Œæˆä¸°å¯Œçš„è¾“å…¥æŒ‡ä»¤</p>
</li>
<li>
<p>[x] ğŸ§® <strong>æ•°å­¦æ”¯æŒ</strong> - ä½ å¯ä»¥å®Œæˆæ•°å­¦å…¬å¼çš„æå†™</p>
</li>
<li>
<p>[x] ğŸ“Š <strong>è¡¨æ ¼æ”¯æŒ</strong> - æ‹¥æœ‰æµç•…çš„ ui çš„è¡¨æ ¼æ”¯æŒ</p>
</li>
<li>
<p>[x] ğŸ“° <strong>å›¾è¡¨æ”¯æŒ</strong> - åŸºäº<a href="https://mermaid-js.github.io/mermaid/#/">mermaid</a>çš„å›¾è¡¨æ”¯æŒ</p>
</li>
</ul>
<hr>
<p>ä½ å¯ä»¥æ·»åŠ è¡Œå†…ä»£ç ä¾‹å¦‚ <code>inline code</code> å’Œä»£ç å—ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&quot;Hello world!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Tips: ä½¿ç”¨<code>Mod-Enter</code>æ¥é€€å‡ºå—çº§å…ƒç´ ï¼Œä¾‹å¦‚ä»£ç å—ã€‚</p>
</blockquote>
<hr>
<p>ä½ å¯ä»¥è¾“å…¥<code>||</code>å’Œä¸€ä¸ªç©ºæ ¼æ¥åˆ›å»ºè¡¨æ ¼ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">è¡¨å¤´ 1</th>
<th style="text-align:center">è¡¨å¤´ 2</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">å†…å®¹ 1</td>
<td style="text-align:center"><s>å†…å®¹ 1</s></td>
</tr>
<tr>
<td style="text-align:left">å†…å®¹ 2</td>
<td style="text-align:center"><strong>å†…å®¹</strong> 2</td>
</tr>
</tbody>
</table>
<hr>
<p>æ•°å­¦å…¬å¼é€šè¿‡ <a href="https://en.wikipedia.org/wiki/TeX">TeX è¡¨è¾¾å¼</a>æ”¯æŒã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬æœ‰è¡Œå†…å…¬å¼ï¼š $E = mc^2$ï¼Œä½ å¯ä»¥ç‚¹å‡»å¹¶ç¼–è¾‘å®ƒã€‚</p>
<p>æ•°å­¦å…¬å¼å—ä¹Ÿæ˜¯æ”¯æŒçš„ã€‚</p>
<p>$$<br>
\begin{aligned}<br>
T( (v_1 + v_2) \otimes w) &amp;= T(v_1 \otimes w) + T(v_2 \otimes w) \<br>
T( v \otimes (w_1 + w_2)) &amp;= T(v \otimes w_1) + T(v \otimes w_2) \<br>
T( (\alpha v) \otimes w ) &amp;= T( \alpha ( v \otimes w) ) \<br>
T( v \otimes (\alpha w) ) &amp;= T( \alpha ( v \otimes w) ) \<br>
\end{aligned}<br>
$$</p>
<p>ä½ å¯ä»¥è¾“å…¥<code>$$</code>å’Œä¸€ä¸ªç©ºæ ¼æ¥åˆ›å»ºæ•°å­¦å…¬å¼å—ã€‚</p>
<hr>
<p>ä½¿ç”¨ <a href="https://www.webfx.com/tools/emoji-cheat-sheet/">emoji å¿«æ·æŒ‡ä»¤</a> ä¾‹å¦‚ <code>:+1:</code> æ¥æ·»åŠ  emoji.</p>
<p>åœ¨è¾“å…¥æ—¶ï¼Œä½ ä¹Ÿè®¸æ³¨æ„åˆ°äº† emoji è¿‡æ»¤å™¨ï¼Œå°è¯•è¾“å…¥<code>:baby</code>æ¥æŸ¥çœ‹å®ƒã€‚</p>
<hr>
<p>ä½ å¯ä»¥è¾“å…¥ <code>```mermaid</code> æ¥æ·»åŠ å›¾è¡¨ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">graph TD;</span><br><span class="line">    EditorState--&gt;EditorView;</span><br><span class="line">    EditorView--&gt;DOMEvent;</span><br><span class="line">    DOMEvent--&gt;Transaction;</span><br><span class="line">    Transaction--&gt;EditorState;</span><br></pre></td></tr></table></figure>
<hr>
<p>Wetabç¬”è®°åŸºäº <a href="https://milkdown.dev/">Milkdown</a> å®Œæˆ</p>
]]></content>
      <tags>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>MYDBè®°å½•</title>
    <url>/post/7e29e8fb.html</url>
    <content><![CDATA[<h2 id="1-clone-æœ¬åœ°è¿è¡Œ">1. clone&amp;æœ¬åœ°è¿è¡Œ</h2>
<h3 id="1-1-ç¯å¢ƒ">1.1. ç¯å¢ƒ</h3>
<ul>
<li>jdkï¼š17.07</li>
<li>mavenï¼š3.9.2</li>
<li>osï¼šwindows 11</li>
</ul>
<h3 id="1-2-è¿è¡Œå‰è®¾ç½®">1.2. è¿è¡Œå‰è®¾ç½®</h3>
<ul>
<li>æ‰‹åŠ¨åˆ›å»ºæ•°æ®åº“æ–‡ä»¶å¤¹ tmp/mydbã€‚ï¼ˆåœ¨é¡¹ç›®ç›®å½•ä¸‹ã€‚ï¼‰</li>
</ul>
<h3 id="1-3-é—®é¢˜">1.3. é—®é¢˜</h3>
<ol>
<li>java.lang.ClassNotFoundException: â€œtop.guoziyang.mydb.backend.Launcherâ€</li>
</ol>
<p>è§£å†³ï¼šIDEAä¸­è®¾ç½®è¿è¡Œæ—¶å‚æ•°ã€‚<a href="https://github.com/CN-GuoZiyang/MYDB/issues/3">å‚è€ƒ</a></p>
<p><img src="/post/7e29e8fb/IDEA%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE.png" alt="IDEAå‚æ•°è®¾ç½®"></p>
<h3 id="1-4-æ•ˆæœ">1.4 æ•ˆæœ</h3>
<p><img src="/post/7e29e8fb/MYDB%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C.png" alt="MYDBè¿è¡Œæ•ˆæœ"></p>
<h2 id="2-æ–‡æ¡£å…ˆè¡Œï¼šæ•´ä½“æ¶æ„">2. æ–‡æ¡£å…ˆè¡Œï¼šæ•´ä½“æ¶æ„</h2>
<h3 id="æ•´ä½“æ¶æ„">æ•´ä½“æ¶æ„</h3>
<h4 id="å‰ç«¯ï¼ˆå®¢æˆ·ç«¯ï¼‰">å‰ç«¯ï¼ˆå®¢æˆ·ç«¯ï¼‰</h4>
<p>è¯»å–ç”¨æˆ·è¾“å…¥ï¼Œå‘é€åˆ°åç«¯æ‰§è¡Œï¼Œè¾“å‡ºè¿”å›ç»“æœã€‚ç­‰å¾…ä¸‹ä¸€æ¬¡è¾“å…¥ã€‚</p>
<h4 id="SQLè§£æå™¨ï¼ˆåé¢è¡¥å……ï¼‰">SQLè§£æå™¨ï¼ˆåé¢è¡¥å……ï¼‰</h4>
<p>è§£æSQLï¼ŒåŒ…è£…æˆå¯¹åº”çš„å¯¹è±¡ã€‚</p>
<h4 id="åç«¯">åç«¯</h4>
<p>è§£æSQLï¼Œè‹¥åˆæ³•ï¼Œå°è¯•æ‰§è¡Œå¹¶è¿”å›ç»“æœã€‚</p>
<p>æ¨¡å—åˆ’åˆ†ï¼šå„ä¸ªæ¨¡å—é€šè¿‡æ¥å£å‘å…¶ä¾èµ–çš„æ¨¡å—æä¾›æ–¹æ³•</p>
<ol>
<li>Transaction Managerï¼ˆTMï¼‰</li>
<li>Data Managerï¼ˆDMï¼‰</li>
<li>Version Managerï¼ˆVMï¼‰</li>
<li>Index Managerï¼ˆIMï¼‰</li>
<li>Table Managerï¼ˆTBMï¼‰</li>
</ol>
<p>äº”ä¸ªæ¨¡å—çš„ä¾èµ–å›¾å¦‚ä¸‹ï¼Œæ‹“è¡¥æ’åºå¾—å‡ºå®ç°é¡ºåºä¸ºï¼šTM -&gt; DM -&gt; VM -&gt; IM -&gt; TBM</p>
<p><img src="/post/7e29e8fb/%E6%A8%A1%E5%9D%97%E4%BE%9D%E8%B5%96%E5%9B%BE.png" alt="æ¨¡å—ä¾èµ–å›¾"></p>
<p>å„ä¸ªæ¨¡å—çš„èŒè´£ï¼š</p>
<ol>
<li>TM é€šè¿‡ç»´æŠ¤ XID æ–‡ä»¶æ¥ç»´æŠ¤äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶æä¾›æ¥å£ä¾›å…¶ä»–æ¨¡å—æ¥æŸ¥è¯¢æŸä¸ªäº‹åŠ¡çš„çŠ¶æ€ã€‚</li>
<li>DM ç›´æ¥ç®¡ç†æ•°æ®åº“ DB æ–‡ä»¶å’Œæ—¥å¿—æ–‡ä»¶ã€‚DM çš„ä¸»è¦èŒè´£æœ‰ï¼š1) åˆ†é¡µç®¡ç† DB æ–‡ä»¶ï¼Œå¹¶è¿›è¡Œç¼“å­˜ï¼›2) ç®¡ç†æ—¥å¿—æ–‡ä»¶ï¼Œä¿è¯åœ¨å‘ç”Ÿé”™è¯¯æ—¶å¯ä»¥æ ¹æ®æ—¥å¿—è¿›è¡Œæ¢å¤ï¼›3) æŠ½è±¡ DB æ–‡ä»¶ä¸º DataItem ä¾›ä¸Šå±‚æ¨¡å—ä½¿ç”¨ï¼Œå¹¶æä¾›ç¼“å­˜ã€‚</li>
<li>VM åŸºäºä¸¤æ®µé”åè®®å®ç°äº†è°ƒåº¦åºåˆ—çš„å¯ä¸²è¡ŒåŒ–ï¼Œå¹¶å®ç°äº† MVCC ä»¥æ¶ˆé™¤è¯»å†™é˜»å¡ã€‚åŒæ—¶å®ç°äº†ä¸¤ç§éš”ç¦»çº§åˆ«ã€‚</li>
<li>IM å®ç°äº†åŸºäº B+ æ ‘çš„ç´¢å¼•ï¼Œç›®å‰ where åªæ”¯æŒå·²ç´¢å¼•å­—æ®µã€‚</li>
<li>TBM å®ç°äº†å¯¹å­—æ®µå’Œè¡¨çš„ç®¡ç†ã€‚åŒæ—¶ï¼Œè§£æ SQL è¯­å¥ï¼Œå¹¶æ ¹æ®è¯­å¥æ“ä½œè¡¨ã€‚</li>
</ol>
<h2 id="3-Transaction-Managerï¼ˆTMï¼‰">3. Transaction Managerï¼ˆTMï¼‰</h2>
<p>TM é€šè¿‡ç»´æŠ¤ XID æ–‡ä»¶æ¥ç»´æŠ¤äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶æä¾›æ¥å£ä¾›å…¶ä»–æ¨¡å—æ¥æŸ¥è¯¢æŸä¸ªäº‹åŠ¡çš„çŠ¶æ€ã€‚</p>
<h3 id="XID-æ–‡ä»¶">XID  æ–‡ä»¶</h3>
<p>XID æ–‡ä»¶è§„åˆ™ï¼š</p>
<p>æ¯ä¸ªäº‹ç‰©éƒ½æœ‰ä¸€ä¸ª xidï¼Œè¿™ä¸ª ID æ˜¯ä¸€ä¸ªäº‹åŠ¡çš„<strong>å”¯ä¸€æ ‡è¯†</strong>ã€‚äº‹åŠ¡çš„ xid ä» <strong>1</strong> å¼€å§‹ç¼–å·ï¼Œè‡ªå¢ï¼Œä¸å¯é‡å¤ã€‚è§„å®š xid ä¸º 0 çš„äº‹åŠ¡æ˜¯è¶…çº§äº‹åŠ¡ï¼ˆsuper transactionï¼‰ï¼Œæƒ³åœ¨æ²¡æœ‰ç”³è¯·äº‹åŠ¡çš„æƒ…å†µä¸‹è¿›è¡Œä¸€äº›æ“ä½œæ—¶ï¼Œå¯å°†æ“ä½œçš„ xid è®¾ç½®ä¸º 0ï¼Œè¶…çº§äº‹åŠ¡çš„çŠ¶æ€ä¸€ç›´æ˜¯ committedã€‚</p>
<p>MYDB ä¸­äº‹åŠ¡çš„çŠ¶æ€ï¼š</p>
<ol>
<li>activeï¼Œè¿›è¡Œä¸­</li>
<li>committedï¼Œå·²æäº¤</li>
<li>abortedï¼Œå·²æ’¤é”€ï¼ˆå›æ»šï¼‰</li>
</ol>
<p>XID æ–‡ä»¶å†…å®¹çš„ç»“æ„ï¼š</p>
<ol>
<li>ç»™æ¯ä¸ªäº‹åŠ¡åˆ†é…<strong>ä¸€ä¸ªå­—èŠ‚</strong>çš„ç©ºé—´æ¥ä¿å­˜å…¶<strong>çŠ¶æ€</strong>ã€‚</li>
<li>XID æ–‡ä»¶å¤´éƒ¨ä¿å­˜ä¸€ä¸ª <strong>8 å­—èŠ‚æ•°å­—</strong>ï¼Œè®°å½•æ­¤ XID æ–‡ä»¶ç®¡ç†<strong>äº‹åŠ¡çš„ä¸ªæ•°</strong>ã€‚</li>
<li>äº‹åŠ¡ xid åœ¨æ–‡ä»¶ä¸­çš„çŠ¶æ€å­˜å‚¨ä½ç½®åœ¨ <strong>(xid-1)+8 å­—èŠ‚å¤„</strong>ã€‚ï¼ˆxid-1 æ˜¯å› ä¸º xid ä¸º 0 çš„çŠ¶æ€ä¸éœ€è¦è®°å½•ã€‚ï¼‰</li>
</ol>
<h3 id="TransactionManager">TransactionManager</h3>
<p>æä¾›çš„æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TransactionManager</span> &#123;</span><br><span class="line">    <span class="type">long</span> <span class="title function_">begin</span><span class="params">()</span>;                       <span class="comment">// å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">commit</span><span class="params">(<span class="type">long</span> xid)</span>;              <span class="comment">// æäº¤ä¸€ä¸ªäº‹åŠ¡</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">abort</span><span class="params">(<span class="type">long</span> xid)</span>;               <span class="comment">// å–æ¶ˆä¸€ä¸ªäº‹åŠ¡</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isActive</span><span class="params">(<span class="type">long</span> xid)</span>;         <span class="comment">// æŸ¥è¯¢ä¸€ä¸ªäº‹åŠ¡çš„çŠ¶æ€æ˜¯å¦æ˜¯æ­£åœ¨è¿›è¡Œçš„çŠ¶æ€</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isCommitted</span><span class="params">(<span class="type">long</span> xid)</span>;      <span class="comment">// æŸ¥è¯¢ä¸€ä¸ªäº‹åŠ¡çš„çŠ¶æ€æ˜¯å¦æ˜¯å·²æäº¤</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isAborted</span><span class="params">(<span class="type">long</span> xid)</span>;        <span class="comment">// æŸ¥è¯¢ä¸€ä¸ªäº‹åŠ¡çš„çŠ¶æ€æ˜¯å¦æ˜¯å·²å–æ¶ˆ</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span>;                       <span class="comment">// å…³é—­TM</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®å®šä¹‰çš„ XID æ–‡ä»¶ç»“æ„ï¼Œå¾—åˆ°éœ€è¦å®šä¹‰çš„ä¸€äº›å¸¸é‡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// XIDæ–‡ä»¶å¤´é•¿åº¦</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">LEN_XID_HEADER_LENGTH</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line"><span class="comment">// æ¯ä¸ªäº‹åŠ¡çš„å ç”¨é•¿åº¦</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">XID_FIELD_SIZE</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">// äº‹åŠ¡çš„ä¸‰ç§çŠ¶æ€</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">byte</span> <span class="variable">FIELD_TRAN_ACTIVE</span>   <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">byte</span> <span class="variable">FIELD_TRAN_COMMITTED</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">byte</span> <span class="variable">FIELD_TRAN_ABORTED</span>  <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="comment">// è¶…çº§äº‹åŠ¡ï¼Œæ°¸è¿œä¸ºcommitedçŠ¶æ€</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">SUPER_XID</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">// XID æ–‡ä»¶åç¼€</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">XID_SUFFIX</span> <span class="operator">=</span> <span class="string">&quot;.xid&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ„é€ å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ª TransactionManager ä¹‹åï¼Œé¦–å…ˆè¦å¯¹ XID æ–‡ä»¶è¿›è¡Œæ ¡éªŒï¼Œä»¥ä¿è¯è¿™æ˜¯ä¸€ä¸ªåˆæ³•çš„ XID æ–‡ä»¶ã€‚æ ¡éªŒçš„æ–¹å¼æ˜¯é€šè¿‡æ–‡ä»¶å¤´çš„ 8 å­—èŠ‚æ•°å­—åæ¨æ–‡ä»¶çš„ç†è®ºé•¿åº¦ï¼Œä¸æ–‡ä»¶çš„å®é™…é•¿åº¦åšå¯¹æ¯”ã€‚å¦‚æœä¸åŒåˆ™è®¤ä¸º XID æ–‡ä»¶ä¸åˆæ³•ã€‚å½“æ ¡éªŒä¸é€šè¿‡æ—¶ï¼Œè°ƒç”¨è‡ªå®šä¹‰æ–¹æ³•å¼ºåˆ¶åœæœºã€‚</p>
<p><code>begin()</code>æ–¹æ³•ï¼šå¼€å¯ä¸€ä¸ªäº‹åŠ¡â€”â€”</p>
<ul>
<li>é¦–å…ˆè®¾ç½® xidCounter+1 äº‹åŠ¡çš„çŠ¶æ€ä¸º committedï¼Œ</li>
<li>ç„¶å xidCounter è‡ªå¢</li>
<li>åŒæ—¶ï¼Œäº‹åŠ¡æ•°é‡å¢åŠ äº†ä¸€ä¸ªï¼Œåˆ«å¿˜è®°æ›´æ–°æ–‡ä»¶å¤´ã€‚</li>
</ul>
<p><strong>æ³¨æ„ç‚¹</strong>ï¼šæ‰€æœ‰æ–‡ä»¶æ“ä½œåœ¨æ‰§è¡Œåéƒ½éœ€è¦ç«‹åˆ»åˆ·å…¥æ–‡ä»¶ä¸­ï¼Œé˜²æ­¢å´©æºƒåæ–‡ä»¶ä¸¢å¤±æ•°æ®ã€‚</p>
<p>ä»æŸ¥è¯¢äº‹åŠ¡çŠ¶æ€çš„æ–¹æ³•ä¸­æŠ½è±¡å‡ºä¸€ç§å…¬å…±çš„æ–¹æ³•ï¼Œä½¿å¾—å®ç°äº‹åŠ¡çŠ¶æ€æŸ¥è¯¢æ—¶åªéœ€æ ¹æ®æ¡ä»¶è°ƒç”¨æ­¤æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ£€æµ‹XIDäº‹åŠ¡æ˜¯å¦å¤„äºstatusçŠ¶æ€</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">checkXID</span><span class="params">(<span class="type">long</span> xid, <span class="type">byte</span> status)</span> &#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">offset</span> <span class="operator">=</span> getXidPosition(xid);</span><br><span class="line">    <span class="type">ByteBuffer</span> <span class="variable">buf</span> <span class="operator">=</span> ByteBuffer.wrap(<span class="keyword">new</span> <span class="title class_">byte</span>[XID_FIELD_SIZE]);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        fc.position(offset);</span><br><span class="line">        fc.read(buf);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        Panic.panic(e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> buf.array()[<span class="number">0</span>] == status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ¥å£ TransactionManager ä¸­ï¼Œä½¿ç”¨<strong>å•ä¾‹æ¨¡å¼</strong> åˆ›å»º TMï¼Œå…¶æœ‰ä¸¤ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ï¼šå…ˆæ–°å»º XID æ–‡ä»¶å†åˆ›å»º TMå®ä¾‹ï¼ˆcreate æ–¹æ³•ï¼‰ï¼Œæˆ–è€…ä»ä¸€ä¸ªå·²æœ‰çš„ XID æ–‡ä»¶ä¸­åˆ›å»º TM å®ä¾‹ï¼ˆopen æ–¹æ³•ï¼‰ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œä»é›¶åˆ›å»º XID æ–‡ä»¶æ—¶éœ€è¦å†™ä¸€ä¸ª<strong>ç©ºçš„ XID æ–‡ä»¶å¤´</strong>ï¼Œå³è®¾ç½® xidCounter ä¸º 0ï¼Œå¦åˆ™åç»­åœ¨æ ¡éªŒæ—¶ä¼šä¸åˆæ³•</p>
<h2 id="4-Data-Managerï¼ˆDMï¼‰">4. Data Managerï¼ˆDMï¼‰</h2>
<p>DataManagerï¼ˆDMï¼‰åŠŸèƒ½å½’çº³ï¼š</p>
<ul>
<li>ä¸Šå±‚æ¨¡å—å’Œæ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ªæŠ½è±¡å±‚ã€‚å‘ä¸Šï¼Œæä¾›æ•°æ®åŒ…è£…ï¼›å‘ä¸‹ï¼Œç›´æ¥è¯»å†™æ–‡ä»¶ã€‚</li>
<li>æä¾›æ—¥å¿—åŠŸèƒ½ã€‚</li>
</ul>
<h3 id="1ã€å¼•ç”¨è®¡æ•°ç¼“å­˜æ¡†æ¶">1ã€å¼•ç”¨è®¡æ•°ç¼“å­˜æ¡†æ¶</h3>
<p>åˆ†é¡µç®¡ç†å’Œæ•°æ®é¡¹ï¼ˆDataItemï¼‰ç®¡ç†æ¶‰åŠç¼“å­˜ï¼Œæ•…æŠ½è±¡å‡ºä¸€ä¸ªé€šç”¨ç¼“å­˜æ¡†æ¶ã€‚</p>
<h4 id="å¼•ç”¨è®¡æ•°æ³•">å¼•ç”¨è®¡æ•°æ³•</h4>
<p>å¼•ç”¨è®¡æ•°æ³•ï¼ˆReference countingï¼‰æ˜¯ä¸€ç§å†…å­˜ç®¡ç†æŠ€æœ¯ï¼Œå®ƒé€šè¿‡è®¡ç®—æ¯ä¸ªå¯¹è±¡è¢«å¼•ç”¨çš„æ¬¡æ•°æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦å›æ”¶è¯¥å¯¹è±¡ã€‚å½“å¯¹è±¡è¢«åˆ›å»ºæ—¶ï¼Œå¼•ç”¨è®¡æ•°ä¸º1ï¼Œæ¯å½“æœ‰ä¸€ä¸ªæ–°çš„å¼•ç”¨æŒ‡å‘è¯¥å¯¹è±¡æ—¶ï¼Œè®¡æ•°åŠ 1ï¼Œå½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œè®¡æ•°å‡1ã€‚å½“è®¡æ•°ä¸º0æ—¶ï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«å›æ”¶ã€‚</p>
<p>åœ¨MYDBçš„å®è·µä¸­ï¼Œéœ€è¦çš„æ•ˆæœæ˜¯ï¼Œåªæœ‰ä¸Šå±‚æ¨¡å—ä¸»åŠ¨é‡Šæ”¾å¼•ç”¨ï¼Œç¼“å­˜åœ¨ç¡®ä¿æ²¡æœ‰æ¨¡å—åœ¨ä½¿ç”¨è¿™ä¸ªèµ„æºäº†ï¼Œæ‰ä¼šå»é©±é€èµ„æºã€‚</p>
<p>äºæ˜¯ï¼Œé€‰æ‹©å¼•ç”¨è®¡æ•°æ³•ã€‚å¢åŠ äº†ä¸€ä¸ªæ–¹æ³• release(key)ï¼Œç”¨äºåœ¨ä¸Šå†Œæ¨¡å—ä¸ä½¿ç”¨æŸä¸ªèµ„æºæ—¶ï¼Œé‡Šæ”¾å¯¹èµ„æºçš„å¼•ç”¨ã€‚å½“å¼•ç”¨å½’é›¶æ—¶ï¼Œç¼“å­˜å°±ä¼šé©±é€è¿™ä¸ªèµ„æºã€‚</p>
<p>åŒæ ·ï¼Œåœ¨ç¼“å­˜æ»¡äº†ä¹‹åï¼Œå¼•ç”¨è®¡æ•°æ³•æ— æ³•è‡ªåŠ¨é‡Šæ”¾ç¼“å­˜ï¼Œæ­¤æ—¶åº”è¯¥ç›´æ¥æŠ¥é”™ï¼ˆå’Œ JVM ä¼¼çš„ï¼Œç›´æ¥ OOMï¼‰ã€‚</p>
<h4 id="LRU">LRU</h4>
<p>LRUï¼ˆleast recently usedï¼‰æ˜¯ä¸€ç§ç¼“å­˜æ·˜æ±°ç®—æ³•ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯æ ¹æ®æ•°æ®æœ€è¿‘è¢«è®¿é—®çš„æ—¶é—´æ¥å†³å®šå“ªäº›æ•°æ®åº”è¯¥è¢«ä¿ç•™ï¼Œå“ªäº›æ•°æ®åº”è¯¥è¢«æ·˜æ±°ã€‚å½“ç¼“å­˜è¾¾åˆ°ä¸€å®šå®¹é‡æ—¶ï¼Œä¼šæ·˜æ±°æ‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®ã€‚</p>
<p>å¦‚æœä½¿ç”¨ LRU ç¼“å­˜ï¼Œé‚£ä¹ˆåªéœ€è¦è®¾è®¡ä¸€ä¸ª get(key) æ¥å£å³å¯ï¼Œé‡Šæ”¾ç¼“å­˜å¯ä»¥åœ¨ç¼“å­˜æ»¡äº†ä¹‹åè‡ªåŠ¨å®Œæˆã€‚</p>
<p>howeverï¼Œå½“æŸæ—¶åˆ»ç¼“å­˜æ»¡äº†ï¼Œç¼“å­˜é©±é€ä¸€ä¸ªèµ„æºï¼Œæ­¤æ—¶ä¸Šå±‚æ¨¡å—æƒ³å°†æŸä¸ªèµ„æºå¼ºåˆ¶åˆ·å›3æ•°æ®æºï¼Œè¿™ä¸ªèµ„æºæ°æ°æ˜¯åˆšè¢«é©±é€çš„èµ„æºã€‚æ­¤æ—¶çš„ä¸Šå±‚æ¨¡å—ä¼šå‘ç°ï¼Œèµ„æºåœ¨ç¼“å­˜ä¸­æ¶ˆå¤±äº†ï¼Œé‚£ä¹ˆï¼Œæ˜¯å¦æœ‰å¿…è¦åšå›æºæ“ä½œï¼Ÿ</p>
<ul>
<li>ä¸å›æºã€‚ç”±äºæ²¡æ³•ç¡®å®šç¼“å­˜è¢«é©±é€çš„æ—¶é—´ï¼Œæ›´æ²¡æ³•ç¡®å®šè¢«é©±é€ä¹‹åæ•°æ®é¡¹æ˜¯å¦è¢«ä¿®æ”¹ï¼Œè¿™æ ·æ˜¯æå…¶ä¸å®‰å…¨çš„</li>
<li>å›æºã€‚å¦‚æœæ•°æ®é¡¹è¢«é©±é€æ—¶çš„æ•°æ®å’Œç°åœ¨åˆæ˜¯ç›¸åŒçš„ï¼Œé‚£å°±æ˜¯ä¸€æ¬¡æ— æ•ˆå›æº</li>
<li>æ”¾å›ç¼“å­˜é‡Œï¼Œç­‰ä¸‹æ¬¡è¢«é©±é€æ—¶å›æºã€‚çœ‹èµ·æ¥è§£å†³äº†é—®é¢˜ï¼Œä½†æ˜¯æ­¤æ—¶ç¼“å­˜å·²ç»æ»¡äº†ï¼Œè¿™æ„å‘³ç€ä½ è¿˜éœ€è¦é©±é€ä¸€ä¸ªèµ„æºæ‰èƒ½æ”¾è¿›å»ã€‚è¿™æœ‰å¯èƒ½ä¼šå¯¼è‡´ç¼“å­˜æŠ–åŠ¨é—®é¢˜ã€‚</li>
</ul>
<h4 id="å®ç°">å®ç°</h4>
<p><code>AbstractCache</code>ç±»ä½œä¸ºæŠ½è±¡ç¼“å­˜ç±»ï¼Œå®šä¹‰ä¸¤ä¸ªæ–¹æ³•äº¤ç”±å­ç±»å®ç°ã€‚</p>
<p>å®ç°å¼•ç”¨è®¡æ•°ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªèµ„æºå¼•ç”¨ä¸ªæ•°çš„HashMapï¼Œä¸ºäº†å¤šçº¿ç¨‹è®¿é—®ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªè®°å½•èµ„æºè®¿é—®æƒ…å†µçš„HashMapã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å½“èµ„æºä¸åœ¨ç¼“å­˜æ—¶çš„è·å–è¡Œä¸º</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">abstract</span> T <span class="title function_">getForCache</span><span class="params">(<span class="type">long</span> key)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å½“èµ„æºè¢«é©±é€æ—¶çš„å†™å›è¡Œä¸º</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">releaseForCache</span><span class="params">(T obj)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> HashMap&lt;Long, T&gt; cache;                     <span class="comment">// å®é™…ç¼“å­˜çš„æ•°æ®</span></span><br><span class="line"><span class="keyword">private</span> HashMap&lt;Long, Integer&gt; references;          <span class="comment">// èµ„æºçš„å¼•ç”¨ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">private</span> HashMap&lt;Long, Boolean&gt; getting;             <span class="comment">// æ­£åœ¨è¢«è·å–çš„èµ„æº</span></span><br></pre></td></tr></table></figure>
<p>è·å–èµ„æºçš„<code>get()</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> T <span class="title function_">get</span><span class="params">(<span class="type">long</span> key)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 1.åœ¨é€šè¿‡ get() æ–¹æ³•è·å–èµ„æºæ—¶ï¼Œé¦–å…ˆè¿›å…¥ä¸€ä¸ªæ­»å¾ªç¯ï¼Œæ¥æ— é™å°è¯•ä»ç¼“å­˜é‡Œè·å–ã€‚</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="comment">// 1.1.é¦–å…ˆå°±éœ€è¦æ£€æŸ¥è¿™ä¸ªæ—¶å€™æ˜¯å¦æœ‰å…¶ä»–çº¿ç¨‹æ­£åœ¨ä»æ•°æ®æºè·å–è¿™ä¸ªèµ„æºï¼Œå¦‚æœæœ‰ï¼Œå°±è¿‡ä¼šå†æ¥çœ‹çœ‹</span></span><br><span class="line">            <span class="keyword">if</span>(getting.containsKey(key)) &#123;</span><br><span class="line">                <span class="comment">// è¯·æ±‚çš„èµ„æºæ­£åœ¨è¢«å…¶ä»–çº¿ç¨‹è·å–</span></span><br><span class="line">                lock.unlock();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 1.2.å¦‚æœæ²¡æœ‰å…¶ä»–çº¿ç¨‹åœ¨è·å–è¿™ä¸ªèµ„æºï¼Œé‚£ä¹ˆå°±å¯ä»¥å°è¯•ä»ç¼“å­˜ä¸­è·å–äº†</span></span><br><span class="line">            <span class="keyword">if</span>(cache.containsKey(key)) &#123;</span><br><span class="line">                <span class="comment">// èµ„æºåœ¨ç¼“å­˜ä¸­ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">                <span class="type">T</span> <span class="variable">obj</span> <span class="operator">=</span> cache.get(key);</span><br><span class="line">                <span class="comment">// è®°å¾—ç»™èµ„æºçš„å¼•ç”¨è®¡æ•°åŠ ä¸€</span></span><br><span class="line">                references.put(key, references.get(key) + <span class="number">1</span>);</span><br><span class="line">                lock.unlock();</span><br><span class="line">                <span class="keyword">return</span> obj;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 1.3.å°è¯•è·å–è¯¥èµ„æº</span></span><br><span class="line">            <span class="comment">// a.åˆ¤æ–­ç¼“å­˜æ˜¯å¦å·²æ»¡ï¼Œå¦‚æœå·²æ»¡ï¼Œå°±æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">if</span>(maxResource &gt; <span class="number">0</span> &amp;&amp; count == maxResource) &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">                <span class="keyword">throw</span> Error.CacheFullException;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// b.å¦‚æœç¼“å­˜æœªæ»¡ï¼Œå°±åœ¨ getting ä¸­æ³¨å†Œä¸€ä¸‹ï¼Œè¯¥çº¿ç¨‹å‡†å¤‡ä»æ•°æ®æºè·å–èµ„æºäº†</span></span><br><span class="line">            count ++;</span><br><span class="line">            getting.put(key, <span class="literal">true</span>);</span><br><span class="line">            lock.unlock();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.ä»æ•°æ®æºè·å–èµ„æº</span></span><br><span class="line">        <span class="type">T</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            obj = getForCache(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœè·å–å¤±è´¥ï¼Œå°±æŠŠ getting ä¸­çš„æ³¨å†Œä¿¡æ¯æ¸…é™¤æ‰</span></span><br><span class="line">            lock.lock();</span><br><span class="line">            count --;</span><br><span class="line">            getting.remove(key);</span><br><span class="line">            lock.unlock();</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        lock.lock();</span><br><span class="line">        getting.remove(key);       <span class="comment">// è·å–å®Œæˆè¦ä» getting ä¸­æ¸…é™¤æ³¨å†Œä¿¡æ¯</span></span><br><span class="line">        cache.put(key, obj);</span><br><span class="line">        references.put(key, <span class="number">1</span>);</span><br><span class="line">        lock.unlock();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>é‡Šæ”¾èµ„æºçš„<code>release</code>æ–¹æ³•ï¼šå½“å¼•ç”¨è®¡æ•°references é€æ¸ -1 å‡åˆ° 0 åï¼Œå°±å¯ä»¥å›æºå¹¶åˆ é™¤ç¼“å­˜ä¸­ç›¸å…³çš„ç»“æ„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 3.é‡Šæ”¾èµ„æº</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">release</span><span class="params">(<span class="type">long</span> key)</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// é‡Šæ”¾ä¸€ä¸ªç¼“å­˜æ—¶ï¼Œç›´æ¥ä» references ä¸­å‡ 1ï¼Œå¦‚æœå·²ç»å‡åˆ° 0 äº†ï¼Œå°±å¯ä»¥å›æºï¼Œå¹¶ä¸”åˆ é™¤ç¼“å­˜ä¸­æ‰€æœ‰ç›¸å…³çš„ç»“æ„</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">ref</span> <span class="operator">=</span> references.get(key) - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(ref == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="type">T</span> <span class="variable">obj</span> <span class="operator">=</span> cache.get(key);</span><br><span class="line">                <span class="comment">// è°ƒç”¨æŠ½è±¡æ–¹æ³•é‡Šæ”¾ç¼“å­˜</span></span><br><span class="line">                releaseForCache(obj);</span><br><span class="line">                <span class="comment">// åˆ é™¤ç¼“å­˜ä¸­æ‰€æœ‰ç›¸å…³çš„ç»“æ„</span></span><br><span class="line">                references.remove(key);</span><br><span class="line">                cache.remove(key);</span><br><span class="line">                count --;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                references.put(key, ref);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="2ã€å…±äº«å†…å­˜æ•°ç»„">2ã€å…±äº«å†…å­˜æ•°ç»„</h3>
<p>åœ¨Javaä¸­ï¼Œ<strong>æ•°ç»„</strong>è¢«è§†ä¸ºä¸€ä¸ª<strong>å¯¹è±¡</strong>ï¼Œå…¶åœ¨å†…å­˜ä¸­ä¹Ÿæ˜¯ä»¥å¯¹è±¡çš„å½¢å¼å­˜å‚¨çš„ã€‚åœ¨ Java ä¸­ï¼Œå½“æ‰§è¡Œç±»ä¼¼ subArray çš„æ“ä½œæ—¶ï¼Œåªä¼šåœ¨åº•å±‚è¿›è¡Œä¸€ä¸ªå¤åˆ¶ï¼Œ<strong>æ— æ³•åŒä¸€ç‰‡å†…å­˜</strong>ã€‚æ‰€ä»¥ï¼Œè¦å®ç°å…±äº«å†…å­˜æ•°ç»„ï¼Œå®šä¹‰ä¸€ä¸ª<code>SubArray</code>ç±»ï¼Œè§„å®šè¿™ä¸ªæ•°ç»„çš„å¯ä½¿ç”¨èŒƒå›´ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SubArray</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] raw;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> start;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> end;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SubArray</span><span class="params">(<span class="type">byte</span>[] raw, <span class="type">int</span> start, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.raw = raw;</span><br><span class="line">        <span class="built_in">this</span>.start = start;</span><br><span class="line">        <span class="built_in">this</span>.end = end;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3ã€æ•°æ®é¡µçš„ç¼“å­˜ä¸ç®¡ç†">3ã€æ•°æ®é¡µçš„ç¼“å­˜ä¸ç®¡ç†</h3>
<h4 id="é¡µé¢ç¼“å­˜">é¡µé¢ç¼“å­˜</h4>
<p>é»˜è®¤æ•°æ®é¡µå¤§å°å®šä¸º 8Kï¼Œé¦–å…ˆï¼Œéœ€è¦å®šä¹‰å‡ºé¡µé¢çš„ç»“æ„ã€‚æ³¨æ„è¿™ä¸ªé¡µé¢æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œä¸å·²ç»æŒä¹…åŒ–åˆ°ç£ç›˜çš„æŠ½è±¡é¡µé¢æœ‰åŒºåˆ«ã€‚</p>
<p>å®šä¹‰ä¸€ä¸ªé¡µé¢å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageImpl</span> <span class="keyword">implements</span> <span class="title class_">Page</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> pageNumber;  <span class="comment">// é¡µå·ï¼Œä»1å¼€å§‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] data;  <span class="comment">// æ­¤é¡µé¢å®é™…åŒ…å«çš„å­—èŠ‚æ•°æ®</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> dirty;  <span class="comment">// æ ‡è¯†æ˜¯å¦æ˜¯è„é¡µé¢ã€‚ç¼“å­˜é©±é€æ—¶ï¼Œè„é¡µé¢éœ€è¦è¢«å†™å›ç£ç›˜</span></span><br><span class="line">    <span class="keyword">private</span> Lock lock;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// ä¿å­˜äº†ä¸€ä¸ª PageCache çš„å¼•ç”¨ï¼Œæ–¹ä¾¿åœ¨æ‹¿åˆ° Page çš„å¼•ç”¨æ—¶å¯ä»¥å¿«é€Ÿå¯¹è¿™ä¸ªé¡µé¢çš„ç¼“å­˜è¿›è¡Œé‡Šæ”¾æ“ä½œã€‚</span></span><br><span class="line">    <span class="keyword">private</span> PageCache pc;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é¡µé¢ç¼“å­˜æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PageCache</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">newPage</span><span class="params">(<span class="type">byte</span>[] initData)</span>;</span><br><span class="line">    Page <span class="title function_">getPage</span><span class="params">(<span class="type">int</span> pgno)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">release</span><span class="params">(Page page)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">truncateByBgno</span><span class="params">(<span class="type">int</span> maxPgno)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">getPageNumber</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">flushPage</span><span class="params">(Page pg)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é¡µé¢ç¼“å­˜çš„å…·ä½“å®ç°ç±»ï¼Œéœ€è¦ç»§æ‰¿æŠ½è±¡ç¼“å­˜æ¡†æ¶ï¼Œå¹¶ä¸”å®ç° <code>getForCache() </code>å’Œ <code>releaseForCache() </code>ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•ã€‚ç”±äºæ•°æ®æºå°±æ˜¯æ–‡ä»¶ç³»ç»Ÿï¼Œ<code>getForCache() </code>ç›´æ¥ä»æ–‡ä»¶ä¸­è¯»å–ï¼Œå¹¶åŒ…è£¹æˆ Page å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> Page <span class="title function_">getForCache</span><span class="params">(<span class="type">long</span> key)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">pgno</span> <span class="operator">=</span> (<span class="type">int</span>)key;</span><br><span class="line">    <span class="type">long</span> <span class="variable">offset</span> <span class="operator">=</span> PageCacheImpl.pageOffset(pgno);</span><br><span class="line"></span><br><span class="line">    <span class="type">ByteBuffer</span> <span class="variable">buf</span> <span class="operator">=</span> ByteBuffer.allocate(PAGE_SIZE);</span><br><span class="line">    fileLock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        fc.position(offset);</span><br><span class="line">        fc.read(buf);</span><br><span class="line">    &#125; <span class="keyword">catch</span>(IOException e) &#123;</span><br><span class="line">        Panic.panic(e);</span><br><span class="line">    &#125;</span><br><span class="line">    fileLock.unlock();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageImpl</span>(pgno, buf.array(), <span class="built_in">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">pageOffset</span><span class="params">(<span class="type">int</span> pgno)</span> &#123;</span><br><span class="line">    <span class="comment">// é¡µå·ä» 1 å¼€å§‹</span></span><br><span class="line">    <span class="keyword">return</span> (pgno-<span class="number">1</span>) * PAGE_SIZE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è€Œ releaseForCache() é©±é€é¡µé¢æ—¶ï¼Œä¹Ÿåªéœ€è¦æ ¹æ®é¡µé¢æ˜¯å¦æ˜¯è„é¡µé¢ï¼Œæ¥å†³å®šæ˜¯å¦éœ€è¦å†™å›æ–‡ä»¶ç³»ç»Ÿï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">releaseForCache</span><span class="params">(Page pg)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(pg.isDirty()) &#123;</span><br><span class="line">        flush(pg);</span><br><span class="line">        pg.setDirty(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">flush</span><span class="params">(Page pg)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">pgno</span> <span class="operator">=</span> pg.getPageNumber();</span><br><span class="line">    <span class="type">long</span> <span class="variable">offset</span> <span class="operator">=</span> pageOffset(pgno);</span><br><span class="line"></span><br><span class="line">    fileLock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">buf</span> <span class="operator">=</span> ByteBuffer.wrap(pg.getData());</span><br><span class="line">        fc.position(offset);</span><br><span class="line">        fc.write(buf);</span><br><span class="line">        fc.force(<span class="literal">false</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span>(IOException e) &#123;</span><br><span class="line">        Panic.panic(e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        fileLock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>PageCache è¿˜ä½¿ç”¨äº†ä¸€ä¸ª AtomicIntegerï¼Œæ¥è®°å½•äº†å½“å‰æ‰“å¼€çš„æ•°æ®åº“æ–‡ä»¶æœ‰å¤šå°‘é¡µã€‚è¿™ä¸ªæ•°å­—åœ¨æ•°æ®åº“æ–‡ä»¶è¢«æ‰“å¼€æ—¶å°±ä¼šè¢«è®¡ç®—ï¼Œå¹¶åœ¨æ–°å»ºé¡µé¢æ—¶è‡ªå¢ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">newPage</span><span class="params">(<span class="type">byte</span>[] initData)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">pgno</span> <span class="operator">=</span> pageNumbers.incrementAndGet();</span><br><span class="line">    <span class="type">Page</span> <span class="variable">pg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageImpl</span>(pgno, initData, <span class="literal">null</span>);</span><br><span class="line">    flush(pg);  <span class="comment">// æ–°å»ºçš„é¡µé¢éœ€è¦ç«‹åˆ»å†™å›</span></span><br><span class="line">    <span class="keyword">return</span> pgno;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ•°æ®é¡µç®¡ç†">æ•°æ®é¡µç®¡ç†</h4>
<p><strong>ç¬¬ä¸€é¡µ</strong>ï¼š</p>
<p>æ•°æ®åº“æ–‡ä»¶çš„ç¬¬ä¸€é¡µï¼Œé€šå¸¸ç”¨ä½œä¸€äº›ç‰¹æ®Šç”¨é€”ï¼Œæ¯”å¦‚å­˜å‚¨ä¸€äº›å…ƒæ•°æ®ï¼Œç”¨æ¥å¯åŠ¨æ£€æŸ¥ä»€ä¹ˆçš„ã€‚MYDB çš„ç¬¬ä¸€é¡µï¼Œåªæ˜¯ç”¨æ¥åšå¯åŠ¨æ£€æŸ¥ã€‚å…·ä½“çš„åŸç†æ˜¯ï¼Œåœ¨æ¯æ¬¡æ•°æ®åº“å¯åŠ¨æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸²éšæœºå­—èŠ‚ï¼Œå­˜å‚¨åœ¨ 100 ~ 107 å­—èŠ‚ã€‚åœ¨æ•°æ®åº“æ­£å¸¸å…³é—­æ—¶ï¼Œä¼šå°†è¿™ä¸²å­—èŠ‚ï¼Œæ‹·è´åˆ°ç¬¬ä¸€é¡µçš„ 108 ~ 115 å­—èŠ‚ã€‚</p>
<p>è¿™æ ·æ•°æ®åº“åœ¨æ¯æ¬¡å¯åŠ¨æ—¶ï¼Œå°±ä¼šæ£€æŸ¥ç¬¬ä¸€é¡µä¸¤å¤„çš„å­—èŠ‚æ˜¯å¦ç›¸åŒï¼Œä»¥æ­¤æ¥åˆ¤æ–­ä¸Šä¸€æ¬¡æ˜¯å¦æ­£å¸¸å…³é—­ã€‚å¦‚æœæ˜¯å¼‚å¸¸å…³é—­ï¼Œå°±éœ€è¦æ‰§è¡Œæ•°æ®çš„æ¢å¤æµç¨‹ã€‚</p>
<p>å¯åŠ¨æ—¶è®¾ç½®åˆå§‹å­—èŠ‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setVcOpen</span><span class="params">(Page pg)</span> &#123;</span><br><span class="line">    pg.setDirty(<span class="literal">true</span>);</span><br><span class="line">    setVcOpen(pg.getData());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setVcOpen</span><span class="params">(<span class="type">byte</span>[] raw)</span> &#123;</span><br><span class="line">    System.arraycopy(RandomUtil.randomBytes(LEN_VC), <span class="number">0</span>, raw, OF_VC, LEN_VC);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…³é—­æ—¶æ‹·è´å­—èŠ‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setVcClose</span><span class="params">(Page pg)</span> &#123;</span><br><span class="line">    pg.setDirty(<span class="literal">true</span>);</span><br><span class="line">    setVcClose(pg.getData());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setVcClose</span><span class="params">(<span class="type">byte</span>[] raw)</span> &#123;</span><br><span class="line">    System.arraycopy(raw, OF_VC, raw, OF_VC+LEN_VC, LEN_VC);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ ¡éªŒå­—èŠ‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">checkVc</span><span class="params">(Page pg)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> checkVc(pg.getData());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">checkVc</span><span class="params">(<span class="type">byte</span>[] raw)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Arrays.equals(Arrays.copyOfRange(raw, OF_VC, OF_VC+LEN_VC), Arrays.copyOfRange(raw, OF_VC+LEN_VC, OF_VC+<span class="number">2</span>*LEN_VC));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ™®é€šé¡µ</strong>ï¼š</p>
<p>ä¸€ä¸ªæ™®é€šé¡µé¢ä»¥ä¸€ä¸ª 2 å­—èŠ‚æ— ç¬¦å·æ•°èµ·å§‹ï¼Œè¡¨ç¤ºè¿™ä¸€é¡µçš„ç©ºé—²ä½ç½®çš„åç§»ã€‚å‰©ä¸‹çš„éƒ¨åˆ†éƒ½æ˜¯å®é™…å­˜å‚¨çš„æ•°æ®ã€‚</p>
<p>æ‰€ä»¥å¯¹æ™®é€šé¡µçš„ç®¡ç†ï¼ŒåŸºæœ¬éƒ½æ˜¯å›´ç»•ç€å¯¹ FSOï¼ˆFree Space Offsetï¼‰è¿›è¡Œçš„ã€‚</p>
<p>ä¾‹å¦‚å‘é¡µé¢æ’å…¥æ•°æ®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å°†rawæ’å…¥pgä¸­ï¼Œè¿”å›æ’å…¥ä½ç½®</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">short</span> <span class="title function_">insert</span><span class="params">(Page pg, <span class="type">byte</span>[] raw)</span> &#123;</span><br><span class="line">    pg.setDirty(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">short</span> <span class="variable">offset</span> <span class="operator">=</span> getFSO(pg.getData());</span><br><span class="line">    System.arraycopy(raw, <span class="number">0</span>, pg.getData(), offset, raw.length);</span><br><span class="line">    setFSO(pg.getData(), (<span class="type">short</span>)(offset + raw.length));</span><br><span class="line">    <span class="keyword">return</span> offset;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨å†™å…¥ä¹‹å‰è·å– FSOï¼Œæ¥ç¡®å®šå†™å…¥çš„ä½ç½®ï¼Œå¹¶åœ¨å†™å…¥ä¹‹åæ›´æ–° FSOã€‚FSO çš„æ“ä½œå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFSO</span><span class="params">(<span class="type">byte</span>[] raw, <span class="type">short</span> ofData)</span> &#123;</span><br><span class="line">    System.arraycopy(Parser.short2Byte(ofData), <span class="number">0</span>, raw, OF_FREE, OF_DATA);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–pgçš„FSO</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">short</span> <span class="title function_">getFSO</span><span class="params">(Page pg)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> getFSO(pg.getData());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">short</span> <span class="title function_">getFSO</span><span class="params">(<span class="type">byte</span>[] raw)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Parser.parseShort(Arrays.copyOfRange(raw, <span class="number">0</span>, <span class="number">2</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–é¡µé¢çš„ç©ºé—²ç©ºé—´å¤§å°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getFreeSpace</span><span class="params">(Page pg)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> PageCache.PAGE_SIZE - (<span class="type">int</span>)getFSO(pg.getData());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‰©ä½™ä¸¤ä¸ªå‡½æ•° recoverInsert() å’Œ recoverUpdate() ç”¨äºåœ¨æ•°æ®åº“å´©æºƒåé‡æ–°æ‰“å¼€æ—¶ï¼Œæ¢å¤ä¾‹ç¨‹ç›´æ¥æ’å…¥æ•°æ®ä»¥åŠä¿®æ”¹æ•°æ®ä½¿ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å°†rawæ’å…¥pgä¸­çš„offsetä½ç½®ï¼Œå¹¶å°†pgçš„offsetè®¾ç½®ä¸ºè¾ƒå¤§çš„offset</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">recoverInsert</span><span class="params">(Page pg, <span class="type">byte</span>[] raw, <span class="type">short</span> offset)</span> &#123;</span><br><span class="line">    pg.setDirty(<span class="literal">true</span>);</span><br><span class="line">    System.arraycopy(raw, <span class="number">0</span>, pg.getData(), offset, raw.length);</span><br><span class="line"></span><br><span class="line">    <span class="type">short</span> <span class="variable">rawFSO</span> <span class="operator">=</span> getFSO(pg.getData());</span><br><span class="line">    <span class="keyword">if</span>(rawFSO &lt; offset + raw.length) &#123;</span><br><span class="line">        setFSO(pg.getData(), (<span class="type">short</span>)(offset+raw.length));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†rawæ’å…¥pgä¸­çš„offsetä½ç½®ï¼Œä¸æ›´æ–°update</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">recoverUpdate</span><span class="params">(Page pg, <span class="type">byte</span>[] raw, <span class="type">short</span> offset)</span> &#123;</span><br><span class="line">    pg.setDirty(<span class="literal">true</span>);</span><br><span class="line">    System.arraycopy(raw, <span class="number">0</span>, pg.getData(), offset, raw.length);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5-Version-Managerï¼ˆVMï¼‰">5. Version Managerï¼ˆVMï¼‰</h2>
<blockquote>
<p>VM åŸºäºä¸¤æ®µé”åè®®å®ç°äº†è°ƒåº¦åºåˆ—çš„å¯ä¸²è¡ŒåŒ–ï¼Œå¹¶å®ç°äº† MVCC ä»¥æ¶ˆé™¤è¯»å†™é˜»å¡ã€‚åŒæ—¶å®ç°äº†ä¸¤ç§éš”ç¦»çº§åˆ«ã€‚</p>
</blockquote>
<p>ç±»ä¼¼äº Data Manager æ˜¯ MYDB çš„æ•°æ®ç®¡ç†æ ¸å¿ƒï¼ŒVersion Manager æ˜¯ MYDB çš„äº‹åŠ¡å’Œæ•°æ®ç‰ˆæœ¬çš„ç®¡ç†æ ¸å¿ƒã€‚</p>
<h3 id="2PLä¸MVCC">2PLä¸MVCC</h3>
<h4 id="å†²çªä¸-2PL">å†²çªä¸ 2PL</h4>
<p>é¦–å…ˆæ¥å®šä¹‰æ•°æ®åº“çš„å†²çªï¼Œæš‚æ—¶ä¸è€ƒè™‘æ’å…¥æ“ä½œï¼Œåªçœ‹æ›´æ–°æ“ä½œï¼ˆUï¼‰å’Œè¯»æ“ä½œï¼ˆRï¼‰ï¼Œä¸¤ä¸ªæ“ä½œåªè¦æ»¡è¶³ä¸‹é¢ä¸‰ä¸ªæ¡ä»¶ï¼Œå°±å¯ä»¥è¯´è¿™ä¸¤ä¸ªæ“ä½œç›¸äº’å†²çªï¼š</p>
<ul>
<li>è¿™ä¸¤ä¸ªæ“ä½œæ˜¯ç”±ä¸åŒçš„äº‹åŠ¡æ‰§è¡Œçš„</li>
<li>è¿™ä¸¤ä¸ªæ“ä½œæ“ä½œçš„æ˜¯åŒä¸€ä¸ªæ•°æ®é¡¹</li>
<li>è¿™ä¸¤ä¸ªæ“ä½œè‡³å°‘æœ‰ä¸€ä¸ªæ˜¯æ›´æ–°æ“ä½œ</li>
</ul>
<p>é‚£ä¹ˆè¿™æ ·ï¼Œå¯¹åŒä¸€ä¸ªæ•°æ®æ“ä½œçš„å†²çªï¼Œå…¶å®å°±åªæœ‰ä¸‹é¢è¿™ä¸¤ç§æƒ…å†µï¼š</p>
<ul>
<li>ä¸¤ä¸ªä¸åŒäº‹åŠ¡çš„ U æ“ä½œå†²çª</li>
<li>ä¸¤ä¸ªä¸åŒäº‹åŠ¡çš„ Uã€R æ“ä½œå†²çª</li>
</ul>
<p>é‚£ä¹ˆå†²çªæˆ–è€…ä¸å†²çªï¼Œæ„ä¹‰ä½•åœ¨ï¼Ÿä½œç”¨åœ¨äºï¼Œ<strong>äº¤æ¢ä¸¤ä¸ªäº’ä¸å†²çªçš„æ“ä½œçš„é¡ºåºï¼Œä¸ä¼šå¯¹æœ€ç»ˆçš„ç»“æœé€ æˆå½±å“</strong>ï¼Œè€Œäº¤æ¢ä¸¤ä¸ªå†²çªæ“ä½œçš„é¡ºåºï¼Œåˆ™æ˜¯ä¼šæœ‰å½±å“çš„ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å…ˆæŠ›å¼€å†²çªä¸è°ˆï¼Œè®°å¾—åœ¨ç¬¬å››ç« ä¸¾çš„ä¾‹å­å—ï¼Œåœ¨å¹¶å‘æƒ…å†µä¸‹ï¼Œä¸¤ä¸ªäº‹åŠ¡åŒæ—¶æ“ä½œ xã€‚å‡è®¾ x çš„åˆå€¼æ˜¯ 0ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">T1 begin</span><br><span class="line">T2 begin</span><br><span class="line">R1(x) // T1è¯»åˆ°0</span><br><span class="line">R2(x) // T2è¯»åˆ°0</span><br><span class="line">U1(0+1) // T1å°è¯•æŠŠx+1</span><br><span class="line">U2(0+1) // T2å°è¯•æŠŠx+1</span><br><span class="line">T1 commit</span><br><span class="line">T2 commit</span><br></pre></td></tr></table></figure>
<p>æœ€å x çš„ç»“æœæ˜¯ 1ï¼Œè¿™ä¸ªç»“æœæ˜¾ç„¶ä¸æœŸæœ›çš„ä¸ç¬¦ã€‚</p>
<p>VM çš„ä¸€ä¸ªå¾ˆé‡è¦çš„èŒè´£ï¼Œå°±æ˜¯å®ç°äº†è°ƒåº¦åºåˆ—çš„å¯ä¸²è¡ŒåŒ–ã€‚MYDB é‡‡ç”¨ä¸¤æ®µé”åè®®ï¼ˆ2PLï¼‰æ¥å®ç°ã€‚å½“é‡‡ç”¨ 2PL æ—¶ï¼Œå¦‚æœæŸä¸ªäº‹åŠ¡ i å·²ç»å¯¹ x åŠ é”ï¼Œä¸”å¦ä¸€ä¸ªäº‹åŠ¡ j ä¹Ÿæƒ³æ“ä½œ xï¼Œä½†æ˜¯è¿™ä¸ªæ“ä½œä¸äº‹åŠ¡ i ä¹‹å‰çš„æ“ä½œç›¸äº’å†²çªçš„è¯ï¼Œäº‹åŠ¡ j å°±ä¼šè¢«é˜»å¡ã€‚è­¬å¦‚ï¼ŒT1 å·²ç»å› ä¸º U1(x) é”å®šäº† xï¼Œé‚£ä¹ˆ T2 å¯¹ x çš„è¯»æˆ–è€…å†™æ“ä½œéƒ½ä¼šè¢«é˜»å¡ï¼ŒT2 å¿…é¡»ç­‰å¾… T1 é‡Šæ”¾æ‰å¯¹ x çš„é”ã€‚</p>
<p>ç”±æ­¤æ¥çœ‹ï¼Œ2PL ç¡®å®ä¿è¯äº†è°ƒåº¦åºåˆ—çš„å¯ä¸²è¡Œè¯ï¼Œä½†æ˜¯ä¸å¯é¿å…åœ°å¯¼è‡´äº†äº‹åŠ¡é—´çš„ç›¸äº’é˜»å¡ï¼Œç”šè‡³å¯èƒ½å¯¼è‡´æ­»é”ã€‚MYDB ä¸ºäº†æé«˜äº‹åŠ¡å¤„ç†çš„æ•ˆç‡ï¼Œé™ä½é˜»å¡æ¦‚ç‡ï¼Œå®ç°äº† MVCCã€‚</p>
<h4 id="MVCC">MVCC</h4>
<p>åœ¨ä»‹ç» MVCC ä¹‹å‰ï¼Œé¦–å…ˆæ˜ç¡®è®°å½•å’Œç‰ˆæœ¬çš„æ¦‚å¿µã€‚</p>
<p>DM å±‚å‘ä¸Šå±‚æä¾›äº†æ•°æ®é¡¹ï¼ˆData Itemï¼‰çš„æ¦‚å¿µï¼ŒVM é€šè¿‡ç®¡ç†æ‰€æœ‰çš„æ•°æ®é¡¹ï¼Œå‘ä¸Šå±‚æä¾›äº†è®°å½•ï¼ˆEntryï¼‰çš„æ¦‚å¿µã€‚ä¸Šå±‚æ¨¡å—é€šè¿‡ VM æ“ä½œæ•°æ®çš„æœ€å°å•ä½ï¼Œå°±æ˜¯è®°å½•ã€‚VM åˆ™åœ¨å…¶å†…éƒ¨ï¼Œä¸ºæ¯ä¸ªè®°å½•ï¼Œç»´æŠ¤äº†å¤šä¸ªç‰ˆæœ¬ï¼ˆVersionï¼‰ã€‚æ¯å½“ä¸Šå±‚æ¨¡å—å¯¹æŸä¸ªè®°å½•è¿›è¡Œä¿®æ”¹æ—¶ï¼ŒVM å°±ä¼šä¸ºè¿™ä¸ªè®°å½•åˆ›å»ºä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ã€‚</p>
<p>MYDB é€šè¿‡ MVCCï¼Œé™ä½äº†äº‹åŠ¡çš„é˜»å¡æ¦‚ç‡ã€‚è­¬å¦‚ï¼ŒT1 æƒ³è¦æ›´æ–°è®°å½• X çš„å€¼ï¼Œäºæ˜¯ T1 éœ€è¦é¦–å…ˆè·å– X çš„é”ï¼Œæ¥ç€æ›´æ–°ï¼Œä¹Ÿå°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ X çš„ç‰ˆæœ¬ï¼Œå‡è®¾ä¸º x3ã€‚å‡è®¾ T1 è¿˜æ²¡æœ‰é‡Šæ”¾ X çš„é”æ—¶ï¼ŒT2 æƒ³è¦è¯»å– X çš„å€¼ï¼Œè¿™æ—¶å€™å°±ä¸ä¼šé˜»å¡ï¼ŒMYDB ä¼šè¿”å›ä¸€ä¸ªè¾ƒè€ç‰ˆæœ¬çš„ Xï¼Œä¾‹å¦‚ x2ã€‚è¿™æ ·æœ€åæ‰§è¡Œçš„ç»“æœï¼Œå°±ç­‰ä»·äºï¼ŒT2 å…ˆæ‰§è¡Œï¼ŒT1 åæ‰§è¡Œï¼Œè°ƒåº¦åºåˆ—ä¾ç„¶æ˜¯å¯ä¸²è¡ŒåŒ–çš„ã€‚å¦‚æœ X æ²¡æœ‰ä¸€ä¸ªæ›´è€çš„ç‰ˆæœ¬ï¼Œé‚£åªèƒ½ç­‰å¾… T1 é‡Šæ”¾é”äº†ã€‚æ‰€ä»¥åªæ˜¯é™ä½äº†æ¦‚ç‡ã€‚</p>
<p>è¿˜è®°å¾—æˆ‘ä»¬åœ¨ç¬¬å››ç« ä¸­ï¼Œä¸ºäº†ä¿è¯æ•°æ®çš„å¯æ¢å¤ï¼ŒVM å±‚ä¼ é€’åˆ° DM çš„æ“ä½œåºåˆ—éœ€è¦æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªè§„åˆ™ï¼š</p>
<p>è§„å®š 1ï¼šæ­£åœ¨è¿›è¡Œçš„äº‹åŠ¡ï¼Œä¸ä¼šè¯»å–å…¶ä»–ä»»ä½•æœªæäº¤çš„äº‹åŠ¡äº§ç”Ÿçš„æ•°æ®ã€‚</p>
<p>è§„å®š 2ï¼šæ­£åœ¨è¿›è¡Œçš„äº‹åŠ¡ï¼Œä¸ä¼šä¿®æ”¹å…¶ä»–ä»»ä½•æœªæäº¤çš„äº‹åŠ¡ä¿®æ”¹æˆ–äº§ç”Ÿçš„æ•°æ®ã€‚</p>
<p>ç”±äº 2PL å’Œ MVCCï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸¤ä¸ªæ¡ä»¶éƒ½è¢«å¾ˆè½»æ˜“åœ°æ»¡è¶³äº†ã€‚</p>
<h3 id="è®°å½•çš„å®ç°">è®°å½•çš„å®ç°</h3>
<p>å¯¹äºä¸€æ¡è®°å½•æ¥è¯´ï¼ŒMYDB ä½¿ç”¨ Entry ç±»ç»´æŠ¤äº†å…¶ç»“æ„ã€‚è™½ç„¶ç†è®ºä¸Šï¼ŒMVCC å®ç°äº†å¤šç‰ˆæœ¬ï¼Œä½†æ˜¯åœ¨å®ç°ä¸­ï¼ŒVM å¹¶æ²¡æœ‰æä¾› Update æ“ä½œï¼Œå¯¹äºå­—æ®µçš„æ›´æ–°æ“ä½œç”±åé¢çš„è¡¨å’Œå­—æ®µç®¡ç†ï¼ˆTBMï¼‰å®ç°ã€‚æ‰€ä»¥åœ¨ VM çš„å®ç°ä¸­ï¼Œä¸€æ¡è®°å½•åªæœ‰ä¸€ä¸ªç‰ˆæœ¬ã€‚</p>
<p>ä¸€æ¡è®°å½•å­˜å‚¨åœ¨ä¸€æ¡ Data Item ä¸­ï¼Œæ‰€ä»¥ Entry ä¸­ä¿å­˜ä¸€ä¸ª DataItem çš„å¼•ç”¨å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Entry</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">OF_XMIN</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">OF_XMAX</span> <span class="operator">=</span> OF_XMIN+<span class="number">8</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">OF_DATA</span> <span class="operator">=</span> OF_XMAX+<span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> uid;</span><br><span class="line">    <span class="keyword">private</span> DataItem dataItem;</span><br><span class="line">    <span class="keyword">private</span> VersionManager vm;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Entry <span class="title function_">loadEntry</span><span class="params">(VersionManager vm, <span class="type">long</span> uid)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">DataItem</span> <span class="variable">di</span> <span class="operator">=</span> ((VersionManagerImpl)vm).dm.read(uid);</span><br><span class="line">        <span class="keyword">return</span> newEntry(vm, di, uid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">()</span> &#123;</span><br><span class="line">        dataItem.release();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è§„å®šï¼Œä¸€æ¡ Entry ä¸­å­˜å‚¨çš„æ•°æ®æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">[XMIN] [XMAX] [DATA]</span><br></pre></td></tr></table></figure>
<p>XMIN æ˜¯åˆ›å»ºè¯¥æ¡è®°å½•ï¼ˆç‰ˆæœ¬ï¼‰çš„äº‹åŠ¡ç¼–å·ï¼Œè€Œ XMAX åˆ™æ˜¯åˆ é™¤è¯¥æ¡è®°å½•ï¼ˆç‰ˆæœ¬ï¼‰çš„äº‹åŠ¡ç¼–å·ã€‚å®ƒä»¬çš„ä½œç”¨å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­è¯´æ˜ã€‚DATA å°±æ˜¯è¿™æ¡è®°å½•æŒæœ‰çš„æ•°æ®ã€‚æ ¹æ®è¿™ä¸ªç»“æ„ï¼Œåœ¨åˆ›å»ºè®°å½•æ—¶è°ƒç”¨çš„ wrapEntryRaw() æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] wrapEntryRaw(<span class="type">long</span> xid, <span class="type">byte</span>[] data) &#123;</span><br><span class="line">    <span class="type">byte</span>[] xmin = Parser.long2Byte(xid);</span><br><span class="line">    <span class="type">byte</span>[] xmax = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">8</span>];</span><br><span class="line">    <span class="keyword">return</span> Bytes.concat(xmin, xmax, data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŒæ ·ï¼Œå¦‚æœè¦è·å–è®°å½•ä¸­æŒæœ‰çš„æ•°æ®ï¼Œä¹Ÿå°±éœ€è¦æŒ‰ç…§è¿™ä¸ªç»“æ„æ¥è§£æï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä»¥æ‹·è´çš„å½¢å¼è¿”å›å†…å®¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">byte</span>[] data() &#123;</span><br><span class="line">    dataItem.rLock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">SubArray</span> <span class="variable">sa</span> <span class="operator">=</span> dataItem.data();</span><br><span class="line">        <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[sa.end - sa.start - OF_DATA];</span><br><span class="line">        System.arraycopy(sa.raw, sa.start+OF_DATA, data, <span class="number">0</span>, data.length);</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        dataItem.rUnLock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä»¥æ‹·è´çš„å½¢å¼è¿”å›æ•°æ®ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹çš„è¯ï¼Œéœ€è¦å¯¹ DataItem æ‰§è¡Œ before() æ–¹æ³•ï¼Œè¿™ä¸ªåœ¨è®¾ç½® XMAX çš„å€¼ä¸­ä½“ç°äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setXmax</span><span class="params">(<span class="type">long</span> xid)</span> &#123;</span><br><span class="line">    dataItem.before();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">SubArray</span> <span class="variable">sa</span> <span class="operator">=</span> dataItem.data();</span><br><span class="line">        System.arraycopy(Parser.long2Byte(xid), <span class="number">0</span>, sa.raw, sa.start+OF_XMAX, <span class="number">8</span>);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        dataItem.after(xid);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>before() å’Œ after() æ˜¯åœ¨ DataItem ä¸€èŠ‚ä¸­å°±å·²ç»ç¡®å®šçš„æ•°æ®é¡¹ä¿®æ”¹è§„åˆ™ã€‚</p>
<h3 id="äº‹åŠ¡çš„éš”ç¦»çº§åˆ«">äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</h3>
<h4 id="è¯»æäº¤">è¯»æäº¤</h4>
<p>ä¸Šé¢æåˆ°ï¼Œå¦‚æœä¸€ä¸ªè®°å½•çš„æœ€æ–°ç‰ˆæœ¬è¢«åŠ é”ï¼Œå½“å¦ä¸€ä¸ªäº‹åŠ¡æƒ³è¦ä¿®æ”¹æˆ–è¯»å–è¿™æ¡è®°å½•æ—¶ï¼ŒMYDB å°±ä¼šè¿”å›ä¸€ä¸ªè¾ƒæ—§çš„ç‰ˆæœ¬çš„æ•°æ®ã€‚è¿™æ—¶å°±å¯ä»¥è®¤ä¸ºï¼Œæœ€æ–°çš„è¢«åŠ é”çš„ç‰ˆæœ¬ï¼Œå¯¹äºå¦ä¸€ä¸ªäº‹åŠ¡æ¥è¯´ï¼Œæ˜¯ä¸å¯è§çš„ã€‚äºæ˜¯ç‰ˆæœ¬å¯è§æ€§çš„æ¦‚å¿µå°±è¯ç”Ÿäº†ã€‚</p>
<p>ç‰ˆæœ¬çš„å¯è§æ€§ä¸äº‹åŠ¡çš„éš”ç¦»åº¦æ˜¯ç›¸å…³çš„ã€‚MYDB æ”¯æŒçš„æœ€ä½çš„äº‹åŠ¡éš”ç¦»ç¨‹åº¦ï¼Œæ˜¯â€œè¯»æäº¤â€ï¼ˆRead Committedï¼‰ï¼Œå³äº‹åŠ¡åœ¨è¯»å–æ•°æ®æ—¶, åªèƒ½è¯»å–å·²ç»æäº¤äº‹åŠ¡äº§ç”Ÿçš„æ•°æ®ã€‚ä¿è¯æœ€ä½çš„è¯»æäº¤çš„å¥½å¤„ï¼Œç¬¬å››ç« ä¸­å·²ç»è¯´æ˜ï¼ˆé˜²æ­¢çº§è”å›æ»šä¸ commit è¯­ä¹‰å†²çªï¼‰ã€‚</p>
<p>MYDB å®ç°è¯»æäº¤ï¼Œä¸ºæ¯ä¸ªç‰ˆæœ¬ç»´æŠ¤äº†ä¸¤ä¸ªå˜é‡ï¼Œå°±æ˜¯ä¸Šé¢æåˆ°çš„ XMIN å’Œ XMAXï¼š</p>
<ul>
<li>XMINï¼šåˆ›å»ºè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡ç¼–å·</li>
<li>XMAXï¼šåˆ é™¤è¯¥ç‰ˆæœ¬çš„äº‹åŠ¡ç¼–å·</li>
</ul>
<p>XMIN åº”å½“åœ¨ç‰ˆæœ¬åˆ›å»ºæ—¶å¡«å†™ï¼Œè€Œ XMAX åˆ™åœ¨ç‰ˆæœ¬è¢«åˆ é™¤ï¼Œæˆ–è€…æœ‰æ–°ç‰ˆæœ¬å‡ºç°æ—¶å¡«å†™ã€‚</p>
<p>XMAX è¿™ä¸ªå˜é‡ï¼Œä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆ DM å±‚ä¸æä¾›åˆ é™¤æ“ä½œï¼Œå½“æƒ³åˆ é™¤ä¸€ä¸ªç‰ˆæœ¬æ—¶ï¼Œåªéœ€è¦è®¾ç½®å…¶ XMAXï¼Œè¿™æ ·ï¼Œè¿™ä¸ªç‰ˆæœ¬å¯¹æ¯ä¸€ä¸ª XMAX ä¹‹åçš„äº‹åŠ¡éƒ½æ˜¯ä¸å¯è§çš„ï¼Œä¹Ÿå°±ç­‰ä»·äºåˆ é™¤äº†ã€‚</p>
<p>å¦‚æ­¤ï¼Œåœ¨è¯»æäº¤ä¸‹ï¼Œç‰ˆæœ¬å¯¹äº‹åŠ¡çš„å¯è§æ€§é€»è¾‘å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(XMIN == Ti and                             // ç”±Tiåˆ›å»ºä¸”</span><br><span class="line">XMAX == NULL                            // è¿˜æœªè¢«åˆ é™¤</span><br><span class="line">)</span><br><span class="line">or                                          // æˆ–</span><br><span class="line">(XMIN is commited and                       // ç”±ä¸€ä¸ªå·²æäº¤çš„äº‹åŠ¡åˆ›å»ºä¸”</span><br><span class="line">(XMAX == NULL or                        // å°šæœªåˆ é™¤æˆ–</span><br><span class="line">(XMAX != Ti and XMAX is not commited)   // ç”±ä¸€ä¸ªæœªæäº¤çš„äº‹åŠ¡åˆ é™¤</span><br><span class="line">))</span><br></pre></td></tr></table></figure>
<p>è‹¥æ¡ä»¶ä¸º trueï¼Œåˆ™ç‰ˆæœ¬å¯¹ Ti å¯è§ã€‚é‚£ä¹ˆè·å– Ti é€‚åˆçš„ç‰ˆæœ¬ï¼Œåªéœ€è¦ä»æœ€æ–°ç‰ˆæœ¬å¼€å§‹ï¼Œä¾æ¬¡å‘å‰æ£€æŸ¥å¯è§æ€§ï¼Œå¦‚æœä¸º trueï¼Œå°±å¯ä»¥ç›´æ¥è¿”å›ã€‚</p>
<p>ä»¥ä¸‹æ–¹æ³•åˆ¤æ–­æŸä¸ªè®°å½•å¯¹äº‹åŠ¡ t æ˜¯å¦å¯è§ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">readCommitted</span><span class="params">(TransactionManager tm, Transaction t, Entry e)</span> &#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">xid</span> <span class="operator">=</span> t.xid;</span><br><span class="line">    <span class="type">long</span> <span class="variable">xmin</span> <span class="operator">=</span> e.getXmin();</span><br><span class="line">    <span class="type">long</span> <span class="variable">xmax</span> <span class="operator">=</span> e.getXmax();</span><br><span class="line">    <span class="keyword">if</span>(xmin == xid &amp;&amp; xmax == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(tm.isCommitted(xmin)) &#123;</span><br><span class="line">        <span class="keyword">if</span>(xmax == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(xmax != xid) &#123;</span><br><span class="line">            <span class="keyword">if</span>(!tm.isCommitted(xmax)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„ Transaction ç»“æ„åªæä¾›äº†ä¸€ä¸ª XIDã€‚</p>
<h4 id="å¯é‡å¤è¯»">å¯é‡å¤è¯»</h4>
<p>è¯»æäº¤ä¼šå¯¼è‡´çš„é—®é¢˜å¤§å®¶ä¹Ÿéƒ½å¾ˆæ¸…æ¥šï¼Œå…«è‚¡ä¹ŸèƒŒäº†ä¸å°‘ã€‚é‚£å°±æ˜¯ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚è¿™é‡Œæˆ‘ä»¬æ¥è§£å†³ä¸å¯é‡å¤è¯»çš„é—®é¢˜ã€‚</p>
<p>ä¸å¯é‡å¤åº¦ï¼Œä¼šå¯¼è‡´ä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡ŒæœŸé—´å¯¹åŒä¸€ä¸ªæ•°æ®é¡¹çš„è¯»å–å¾—åˆ°ä¸åŒç»“æœã€‚å¦‚ä¸‹é¢çš„ç»“æœï¼ŒåŠ å…¥ X åˆå§‹å€¼ä¸º 0ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">T1 begin</span><br><span class="line">R1(X) // T1 è¯»å¾— 0</span><br><span class="line">T2 begin</span><br><span class="line">U2(X) // å°† X ä¿®æ”¹ä¸º 1</span><br><span class="line">T2 commit</span><br><span class="line">R1(X) // T1 è¯»çš„ 1</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒT1 ä¸¤æ¬¡è¯» Xï¼Œè¯»åˆ°çš„ç»“æœä¸ä¸€æ ·ã€‚å¦‚æœæƒ³è¦é¿å…è¿™ä¸ªæƒ…å†µï¼Œå°±éœ€è¦å¼•å…¥æ›´ä¸¥æ ¼çš„éš”ç¦»çº§åˆ«ï¼Œå³å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰ã€‚</p>
<p>T1 åœ¨ç¬¬äºŒæ¬¡è¯»å–çš„æ—¶å€™ï¼Œè¯»åˆ°äº†å·²ç»æäº¤çš„ T2 ä¿®æ”¹çš„å€¼ï¼Œå¯¼è‡´äº†è¿™ä¸ªé—®é¢˜ã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥è§„å®šï¼š</p>
<p>äº‹åŠ¡åªèƒ½è¯»å–å®ƒå¼€å§‹æ—¶, å°±å·²ç»ç»“æŸçš„é‚£äº›äº‹åŠ¡äº§ç”Ÿçš„æ•°æ®ç‰ˆæœ¬</p>
<p>è¿™æ¡è§„å®šï¼Œå¢åŠ äºï¼Œäº‹åŠ¡éœ€è¦å¿½ç•¥ï¼š</p>
<p>åœ¨æœ¬äº‹åŠ¡åå¼€å§‹çš„äº‹åŠ¡çš„æ•°æ®;</p>
<p>æœ¬äº‹åŠ¡å¼€å§‹æ—¶è¿˜æ˜¯ active çŠ¶æ€çš„äº‹åŠ¡çš„æ•°æ®</p>
<p>å¯¹äºç¬¬ä¸€æ¡ï¼Œåªéœ€è¦æ¯”è¾ƒäº‹åŠ¡ IDï¼Œå³å¯ç¡®å®šã€‚è€Œå¯¹äºç¬¬äºŒæ¡ï¼Œåˆ™éœ€è¦åœ¨äº‹åŠ¡ Ti å¼€å§‹æ—¶ï¼Œè®°å½•ä¸‹å½“å‰æ´»è·ƒçš„æ‰€æœ‰äº‹åŠ¡ SP(Ti)ï¼Œå¦‚æœè®°å½•çš„æŸä¸ªç‰ˆæœ¬ï¼ŒXMIN åœ¨ SP(Ti) ä¸­ï¼Œä¹Ÿåº”å½“å¯¹ Ti ä¸å¯è§ã€‚</p>
<p>äºæ˜¯ï¼Œå¯é‡å¤è¯»çš„åˆ¤æ–­é€»è¾‘å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">(XMIN == Ti and                 <span class="comment">// ç”±Tiåˆ›å»ºä¸”</span></span><br><span class="line"> (XMAX == NULL or               <span class="comment">// å°šæœªè¢«åˆ é™¤</span></span><br><span class="line">))</span><br><span class="line">or                              <span class="comment">// æˆ–</span></span><br><span class="line">(XMIN is commited and           <span class="comment">// ç”±ä¸€ä¸ªå·²æäº¤çš„äº‹åŠ¡åˆ›å»ºä¸”</span></span><br><span class="line"> XMIN &lt; XID and                 <span class="comment">// è¿™ä¸ªäº‹åŠ¡å°äºTiä¸”</span></span><br><span class="line"> XMIN is not in <span class="title function_">SP</span><span class="params">(Ti)</span> and      <span class="comment">// è¿™ä¸ªäº‹åŠ¡åœ¨Tiå¼€å§‹å‰æäº¤ä¸”</span></span><br><span class="line"> (XMAX == NULL or               <span class="comment">// å°šæœªè¢«åˆ é™¤æˆ–</span></span><br><span class="line">  (XMAX != Ti and               <span class="comment">// ç”±å…¶ä»–äº‹åŠ¡åˆ é™¤ä½†æ˜¯</span></span><br><span class="line">   (XMAX is not commited or     <span class="comment">// è¿™ä¸ªäº‹åŠ¡å°šæœªæäº¤æˆ–</span></span><br><span class="line">XMAX &gt; Ti or                    <span class="comment">// è¿™ä¸ªäº‹åŠ¡åœ¨Tiå¼€å§‹ä¹‹åæ‰å¼€å§‹æˆ–</span></span><br><span class="line">XMAX is in <span class="title function_">SP</span><span class="params">(Ti)</span>               <span class="comment">// è¿™ä¸ªäº‹åŠ¡åœ¨Tiå¼€å§‹å‰è¿˜æœªæäº¤</span></span><br><span class="line">))))</span><br></pre></td></tr></table></figure>
<p>äºæ˜¯ï¼Œéœ€è¦æä¾›ä¸€ä¸ªç»“æ„ï¼Œæ¥æŠ½è±¡ä¸€ä¸ªäº‹åŠ¡ï¼Œä»¥ä¿å­˜å¿«ç…§æ•°æ®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Transaction</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> xid;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> level;</span><br><span class="line">    <span class="keyword">public</span> Map&lt;Long, Boolean&gt; snapshot;</span><br><span class="line">    <span class="keyword">public</span> Exception err;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> autoAborted;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Transaction <span class="title function_">newTransaction</span><span class="params">(<span class="type">long</span> xid, <span class="type">int</span> level, Map&lt;Long, Transaction&gt; active)</span> &#123;</span><br><span class="line">        <span class="type">Transaction</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Transaction</span>();</span><br><span class="line">        t.xid = xid;</span><br><span class="line">        t.level = level;</span><br><span class="line">        <span class="keyword">if</span>(level != <span class="number">0</span>) &#123;</span><br><span class="line">            t.snapshot = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span>(Long x : active.keySet()) &#123;</span><br><span class="line">                t.snapshot.put(x, <span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isInSnapshot</span><span class="params">(<span class="type">long</span> xid)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(xid == TransactionManagerImpl.SUPER_XID) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> snapshot.containsKey(xid);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ„é€ æ–¹æ³•ä¸­çš„ activeï¼Œä¿å­˜ç€å½“å‰æ‰€æœ‰ active çš„äº‹åŠ¡ã€‚äºæ˜¯ï¼Œå¯é‡å¤è¯»çš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸€ä¸ªç‰ˆæœ¬æ˜¯å¦å¯¹äº‹åŠ¡å¯è§çš„åˆ¤æ–­å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">repeatableRead</span><span class="params">(TransactionManager tm, Transaction t, Entry e)</span> &#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">xid</span> <span class="operator">=</span> t.xid;</span><br><span class="line">    <span class="type">long</span> <span class="variable">xmin</span> <span class="operator">=</span> e.getXmin();</span><br><span class="line">    <span class="type">long</span> <span class="variable">xmax</span> <span class="operator">=</span> e.getXmax();</span><br><span class="line">    <span class="keyword">if</span>(xmin == xid &amp;&amp; xmax == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(tm.isCommitted(xmin) &amp;&amp; xmin &lt; xid &amp;&amp; !t.isInSnapshot(xmin)) &#123;</span><br><span class="line">        <span class="keyword">if</span>(xmax == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(xmax != xid) &#123;</span><br><span class="line">            <span class="keyword">if</span>(!tm.isCommitted(xmax)  xmax &gt; xid  t.isInSnapshot(xmax)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ­»é”æ£€æµ‹">æ­»é”æ£€æµ‹</h3>
<h4 id="ç‰ˆæœ¬è·³è·ƒé—®é¢˜">ç‰ˆæœ¬è·³è·ƒé—®é¢˜</h4>
<p>è¯´åˆ°ç‰ˆæœ¬è·³è·ƒä¹‹å‰ï¼Œé¡ºä¾¿æä¸€å˜´ï¼ŒMVCC çš„å®ç°ï¼Œä½¿å¾— MYDB åœ¨æ’¤é”€æˆ–æ˜¯å›æ»šäº‹åŠ¡å¾ˆç®€å•ï¼šåªéœ€è¦å°†è¿™ä¸ªäº‹åŠ¡æ ‡è®°ä¸º aborted å³å¯ã€‚æ ¹æ®å‰ä¸€ç« æåˆ°çš„å¯è§æ€§ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½åªèƒ½çœ‹åˆ°å…¶ä»– committed çš„äº‹åŠ¡æ‰€äº§ç”Ÿçš„æ•°æ®ï¼Œä¸€ä¸ª aborted äº‹åŠ¡äº§ç”Ÿçš„æ•°æ®ï¼Œå°±ä¸ä¼šå¯¹å…¶ä»–äº‹åŠ¡äº§ç”Ÿä»»ä½•å½±å“äº†ï¼Œä¹Ÿå°±ç›¸å½“äºï¼Œè¿™ä¸ªäº‹åŠ¡ä¸æ›¾å­˜åœ¨è¿‡ã€‚</p>
<p>ç‰ˆæœ¬è·³è·ƒé—®é¢˜ï¼Œè€ƒè™‘å¦‚ä¸‹çš„æƒ…å†µï¼Œå‡è®¾ X æœ€åˆåªæœ‰ x0 ç‰ˆæœ¬ï¼ŒT1 å’Œ T2 éƒ½æ˜¯å¯é‡å¤è¯»çš„éš”ç¦»çº§åˆ«ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">T1 begin</span><br><span class="line">T2 begin</span><br><span class="line"><span class="title function_">R1</span><span class="params">(X)</span> <span class="comment">// T1è¯»å–x0</span></span><br><span class="line">R2(X) <span class="comment">// T2è¯»å–x0</span></span><br><span class="line">U1(X) <span class="comment">// T1å°†Xæ›´æ–°åˆ°x1</span></span><br><span class="line">T1 commit</span><br><span class="line"><span class="title function_">U2</span><span class="params">(X)</span> <span class="comment">// T2å°†Xæ›´æ–°åˆ°x2</span></span><br><span class="line">T2 commit</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æƒ…å†µå®é™…è¿è¡Œèµ·æ¥æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯é€»è¾‘ä¸Šä¸å¤ªæ­£ç¡®ã€‚T1 å°† X ä» x0 æ›´æ–°ä¸ºäº† x1ï¼Œè¿™æ˜¯æ²¡é”™çš„ã€‚ä½†æ˜¯ T2 åˆ™æ˜¯å°† X ä» x0 æ›´æ–°æˆäº† x2ï¼Œè·³è¿‡äº† x1 ç‰ˆæœ¬ã€‚</p>
<p>è¯»æäº¤æ˜¯å…è®¸ç‰ˆæœ¬è·³è·ƒçš„ï¼Œè€Œå¯é‡å¤è¯»åˆ™æ˜¯ä¸å…è®¸ç‰ˆæœ¬è·³è·ƒçš„ã€‚è§£å†³ç‰ˆæœ¬è·³è·ƒçš„æ€è·¯ä¹Ÿå¾ˆç®€å•ï¼šå¦‚æœ Ti éœ€è¦ä¿®æ”¹ Xï¼Œè€Œ X å·²ç»è¢« Ti ä¸å¯è§çš„äº‹åŠ¡ Tj ä¿®æ”¹äº†ï¼Œé‚£ä¹ˆè¦æ±‚ Ti å›æ»šã€‚</p>
<p>ä¸Šä¸€èŠ‚ä¸­å°±æ€»ç»“äº†ï¼ŒTi ä¸å¯è§çš„ Tjï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">XID(Tj) &gt; XID(Ti)</span><br><span class="line">Tj in <span class="title function_">SP</span><span class="params">(Ti)</span></span><br></pre></td></tr></table></figure>
<p>äºæ˜¯ç‰ˆæœ¬è·³è·ƒçš„æ£€æŸ¥ä¹Ÿå°±å¾ˆç®€å•äº†ï¼Œå–å‡ºè¦ä¿®æ”¹çš„æ•°æ® X çš„æœ€æ–°æäº¤ç‰ˆæœ¬ï¼Œå¹¶æ£€æŸ¥è¯¥æœ€æ–°ç‰ˆæœ¬çš„åˆ›å»ºè€…å¯¹å½“å‰äº‹åŠ¡æ˜¯å¦å¯è§ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isVersionSkip</span><span class="params">(TransactionManager tm, Transaction t, Entry e)</span> &#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">xmax</span> <span class="operator">=</span> e.getXmax();</span><br><span class="line">    <span class="keyword">if</span>(t.level == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tm.isCommitted(xmax) &amp;&amp; (xmax &gt; t.xid  t.isInSnapshot(xmax));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ­»é”æ£€æµ‹-2">æ­»é”æ£€æµ‹</h4>
<p>ä¸Šä¸€èŠ‚æåˆ°äº† 2PL ä¼šé˜»å¡äº‹åŠ¡ï¼Œç›´è‡³æŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾é”ã€‚å¯ä»¥å°†è¿™ç§ç­‰å¾…å…³ç³»æŠ½è±¡æˆæœ‰å‘è¾¹ï¼Œä¾‹å¦‚ Tj åœ¨ç­‰å¾… Tiï¼Œå°±å¯ä»¥è¡¨ç¤ºä¸º Tj --&gt; Tiã€‚è¿™æ ·ï¼Œæ— æ•°æœ‰å‘è¾¹å°±å¯ä»¥å½¢æˆä¸€ä¸ªå›¾ï¼ˆä¸ä¸€å®šæ˜¯è¿é€šå›¾ï¼‰ã€‚æ£€æµ‹æ­»é”ä¹Ÿå°±ç®€å•äº†ï¼Œåªéœ€è¦æŸ¥çœ‹è¿™ä¸ªå›¾ä¸­æ˜¯å¦æœ‰ç¯å³å¯ã€‚</p>
<p>MYDB ä½¿ç”¨ä¸€ä¸ª LockTable å¯¹è±¡ï¼Œåœ¨å†…å­˜ä¸­ç»´æŠ¤è¿™å¼ å›¾ã€‚ç»´æŠ¤ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LockTable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;Long, List&lt;Long&gt;&gt; x2u;  <span class="comment">// æŸä¸ªXIDå·²ç»è·å¾—çš„èµ„æºçš„UIDåˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;Long, Long&gt; u2x;        <span class="comment">// UIDè¢«æŸä¸ªXIDæŒæœ‰</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;Long, List&lt;Long&gt;&gt; wait; <span class="comment">// æ­£åœ¨ç­‰å¾…UIDçš„XIDåˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;Long, Lock&gt; waitLock;   <span class="comment">// æ­£åœ¨ç­‰å¾…èµ„æºçš„XIDçš„é”</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;Long, Long&gt; waitU;      <span class="comment">// XIDæ­£åœ¨ç­‰å¾…çš„UID</span></span><br><span class="line">    <span class="keyword">private</span> Lock lock;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ¯æ¬¡å‡ºç°ç­‰å¾…çš„æƒ…å†µæ—¶ï¼Œå°±å°è¯•å‘å›¾ä¸­å¢åŠ ä¸€æ¡è¾¹ï¼Œå¹¶è¿›è¡Œæ­»é”æ£€æµ‹ã€‚å¦‚æœæ£€æµ‹åˆ°æ­»é”ï¼Œå°±æ’¤é”€è¿™æ¡è¾¹ï¼Œä¸å…è®¸æ·»åŠ ï¼Œå¹¶æ’¤é”€è¯¥äº‹åŠ¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸éœ€è¦ç­‰å¾…åˆ™è¿”å›nullï¼Œå¦åˆ™è¿”å›é”å¯¹è±¡</span></span><br><span class="line"><span class="comment">// ä¼šé€ æˆæ­»é”åˆ™æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="keyword">public</span> Lock <span class="title function_">add</span><span class="params">(<span class="type">long</span> xid, <span class="type">long</span> uid)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(isInList(x2u, xid, uid)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!u2x.containsKey(uid)) &#123;</span><br><span class="line">            u2x.put(uid, xid);</span><br><span class="line">            putIntoList(x2u, xid, uid);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        waitU.put(xid, uid);</span><br><span class="line">        putIntoList(wait, xid, uid);</span><br><span class="line">        <span class="keyword">if</span>(hasDeadLock()) &#123;</span><br><span class="line">            waitU.remove(xid);</span><br><span class="line">            removeFromList(wait, uid, xid);</span><br><span class="line">            <span class="keyword">throw</span> Error.DeadlockException;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Lock</span> <span class="variable">l</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">        l.lock();</span><br><span class="line">        waitLock.put(xid, l);</span><br><span class="line">        <span class="keyword">return</span> l;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨ addï¼Œå¦‚æœéœ€è¦ç­‰å¾…çš„è¯ï¼Œä¼šè¿”å›ä¸€ä¸ªä¸Šäº†é”çš„ Lock å¯¹è±¡ã€‚è°ƒç”¨æ–¹åœ¨è·å–åˆ°è¯¥å¯¹è±¡æ—¶ï¼Œéœ€è¦å°è¯•è·å–è¯¥å¯¹è±¡çš„é”ï¼Œç”±æ­¤å®ç°é˜»å¡çº¿ç¨‹çš„ç›®çš„ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Lock</span> <span class="variable">l</span> <span class="operator">=</span> lt.add(xid, uid);</span><br><span class="line"><span class="keyword">if</span>(l != <span class="literal">null</span>) &#123;</span><br><span class="line">    l.lock();   <span class="comment">// é˜»å¡åœ¨è¿™ä¸€æ­¥</span></span><br><span class="line">    l.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŸ¥æ‰¾å›¾ä¸­æ˜¯å¦æœ‰ç¯çš„ç®—æ³•ä¹Ÿéå¸¸ç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªæ·±æœï¼Œåªæ˜¯éœ€è¦æ³¨æ„è¿™ä¸ªå›¾ä¸ä¸€å®šæ˜¯è¿é€šå›¾ã€‚æ€è·¯å°±æ˜¯ä¸ºæ¯ä¸ªèŠ‚ç‚¹è®¾ç½®ä¸€ä¸ªè®¿é—®æˆ³ï¼Œéƒ½åˆå§‹åŒ–ä¸º -1ï¼Œéšåéå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œä»¥æ¯ä¸ªé -1 çš„èŠ‚ç‚¹ä½œä¸ºæ ¹è¿›è¡Œæ·±æœï¼Œå¹¶å°†æ·±æœè¯¥è¿é€šå›¾ä¸­é‡åˆ°çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½è®¾ç½®ä¸ºåŒä¸€ä¸ªæ•°å­—ï¼Œä¸åŒçš„è¿é€šå›¾æ•°å­—ä¸åŒã€‚è¿™æ ·ï¼Œå¦‚æœåœ¨éå†æŸä¸ªå›¾æ—¶ï¼Œé‡åˆ°äº†ä¹‹å‰éå†è¿‡çš„èŠ‚ç‚¹ï¼Œè¯´æ˜å‡ºç°äº†ç¯ã€‚</p>
<p>å®ç°å¾ˆç®€å•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">hasDeadLock</span><span class="params">()</span> &#123;</span><br><span class="line">    xidStamp = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    stamp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">long</span> xid : x2u.keySet()) &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">s</span> <span class="operator">=</span> xidStamp.get(xid);</span><br><span class="line">        <span class="keyword">if</span>(s != <span class="literal">null</span> &amp;&amp; s &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        stamp ++;</span><br><span class="line">        <span class="keyword">if</span>(dfs(xid)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">dfs</span><span class="params">(<span class="type">long</span> xid)</span> &#123;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">stp</span> <span class="operator">=</span> xidStamp.get(xid);</span><br><span class="line">    <span class="keyword">if</span>(stp != <span class="literal">null</span> &amp;&amp; stp == stamp) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(stp != <span class="literal">null</span> &amp;&amp; stp &lt; stamp) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    xidStamp.put(xid, stamp);</span><br><span class="line"></span><br><span class="line">    <span class="type">Long</span> <span class="variable">uid</span> <span class="operator">=</span> waitU.get(xid);</span><br><span class="line">    <span class="keyword">if</span>(uid == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">x</span> <span class="operator">=</span> u2x.get(uid);</span><br><span class="line">    <span class="keyword">assert</span> x != <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> dfs(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸€ä¸ªäº‹åŠ¡ commit æˆ–è€… abort æ—¶ï¼Œå°±å¯ä»¥é‡Šæ”¾æ‰€æœ‰å®ƒæŒæœ‰çš„é”ï¼Œå¹¶å°†è‡ªèº«ä»ç­‰å¾…å›¾ä¸­åˆ é™¤ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(<span class="type">long</span> xid)</span> &#123;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        List&lt;Long&gt; l = x2u.get(xid);</span><br><span class="line">        <span class="keyword">if</span>(l != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span>(l.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="type">Long</span> <span class="variable">uid</span> <span class="operator">=</span> l.remove(<span class="number">0</span>);</span><br><span class="line">                selectNewXID(uid);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        waitU.remove(xid);</span><br><span class="line">        x2u.remove(xid);</span><br><span class="line">        waitLock.remove(xid);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>while å¾ªç¯é‡Šæ”¾æ‰äº†è¿™ä¸ªçº¿ç¨‹æ‰€æœ‰æŒæœ‰çš„èµ„æºçš„é”ï¼Œè¿™äº›èµ„æºå¯ä»¥è¢«ç­‰å¾…çš„çº¿ç¨‹æ‰€è·å–ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä»ç­‰å¾…é˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªxidæ¥å ç”¨uid</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">selectNewXID</span><span class="params">(<span class="type">long</span> uid)</span> &#123;</span><br><span class="line">    u2x.remove(uid);</span><br><span class="line">    List&lt;Long&gt; l = wait.get(uid);</span><br><span class="line">    <span class="keyword">if</span>(l == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">assert</span> l.size() &gt; <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(l.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">xid</span> <span class="operator">=</span> l.remove(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span>(!waitLock.containsKey(xid)) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            u2x.put(uid, xid);</span><br><span class="line">            <span class="type">Lock</span> <span class="variable">lo</span> <span class="operator">=</span> waitLock.remove(xid);</span><br><span class="line">            waitU.remove(xid);</span><br><span class="line">            lo.unlock();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(l.size() == <span class="number">0</span>) wait.remove(uid);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä» List å¼€å¤´å¼€å§‹å°è¯•è§£é”ï¼Œè¿˜æ˜¯ä¸ªå…¬å¹³é”ã€‚è§£é”æ—¶ï¼Œå°†è¯¥ Lock å¯¹è±¡ unlock å³å¯ï¼Œè¿™æ ·ä¸šåŠ¡çº¿ç¨‹å°±è·å–åˆ°äº†é”ï¼Œå°±å¯ä»¥ç»§ç»­æ‰§è¡Œäº†ã€‚</p>
<h3 id="VMå®ç°">VMå®ç°</h3>
<p>VM å±‚é€šè¿‡ VersionManager æ¥å£ï¼Œå‘ä¸Šå±‚æä¾›åŠŸèƒ½ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">VersionManager</span> &#123;</span><br><span class="line">    <span class="type">byte</span>[] read(<span class="type">long</span> xid, <span class="type">long</span> uid) <span class="keyword">throws</span> Exception;</span><br><span class="line">    <span class="type">long</span> <span class="title function_">insert</span><span class="params">(<span class="type">long</span> xid, <span class="type">byte</span>[] data)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">delete</span><span class="params">(<span class="type">long</span> xid, <span class="type">long</span> uid)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="title function_">begin</span><span class="params">(<span class="type">int</span> level)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">commit</span><span class="params">(<span class="type">long</span> xid)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">abort</span><span class="params">(<span class="type">long</span> xid)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŒæ—¶ï¼ŒVM çš„å®ç°ç±»è¿˜è¢«è®¾è®¡ä¸º Entry çš„ç¼“å­˜ï¼Œéœ€è¦ç»§æ‰¿ AbstractCache<Entry>ã€‚éœ€è¦å®ç°çš„è·å–åˆ°ç¼“å­˜å’Œä»ç¼“å­˜é‡Šæ”¾çš„æ–¹æ³•å¾ˆç®€å•ï¼š</Entry></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> Entry <span class="title function_">getForCache</span><span class="params">(<span class="type">long</span> uid)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Entry</span> <span class="variable">entry</span> <span class="operator">=</span> Entry.loadEntry(<span class="built_in">this</span>, uid);</span><br><span class="line">    <span class="keyword">if</span>(entry == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> Error.NullEntryException;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> entry;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">releaseForCache</span><span class="params">(Entry entry)</span> &#123;</span><br><span class="line">    entry.remove();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>begin() å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œå¹¶åˆå§‹åŒ–äº‹åŠ¡çš„ç»“æ„ï¼Œå°†å…¶å­˜æ”¾åœ¨ activeTransaction ä¸­ï¼Œç”¨äºæ£€æŸ¥å’Œå¿«ç…§ä½¿ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">begin</span><span class="params">(<span class="type">int</span> level)</span> &#123;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">xid</span> <span class="operator">=</span> tm.begin();</span><br><span class="line">        <span class="type">Transaction</span> <span class="variable">t</span> <span class="operator">=</span> Transaction.newTransaction(xid, level, activeTransaction);</span><br><span class="line">        activeTransaction.put(xid, t);</span><br><span class="line">        <span class="keyword">return</span> xid;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>commit() æ–¹æ³•æäº¤ä¸€ä¸ªäº‹åŠ¡ï¼Œä¸»è¦å°±æ˜¯ free æ‰ç›¸å…³çš„ç»“æ„ï¼Œå¹¶ä¸”é‡Šæ”¾æŒæœ‰çš„é”ï¼Œå¹¶ä¿®æ”¹ TM çŠ¶æ€ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">commit</span><span class="params">(<span class="type">long</span> xid)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="type">Transaction</span> <span class="variable">t</span> <span class="operator">=</span> activeTransaction.get(xid);</span><br><span class="line">    lock.unlock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(t.err != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> t.err;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span>(NullPointerException n) &#123;</span><br><span class="line">        System.out.println(xid);</span><br><span class="line">        System.out.println(activeTransaction.keySet());</span><br><span class="line">        Panic.panic(n);</span><br><span class="line">    &#125;</span><br><span class="line">    lock.lock();</span><br><span class="line">    activeTransaction.remove(xid);</span><br><span class="line">    lock.unlock();</span><br><span class="line">    lt.remove(xid);</span><br><span class="line">    tm.commit(xid);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>abort äº‹åŠ¡çš„æ–¹æ³•åˆ™æœ‰ä¸¤ç§ï¼Œæ‰‹åŠ¨å’Œè‡ªåŠ¨ã€‚æ‰‹åŠ¨æŒ‡çš„æ˜¯è°ƒç”¨ abort() æ–¹æ³•ï¼Œè€Œè‡ªåŠ¨ï¼Œåˆ™æ˜¯åœ¨äº‹åŠ¡è¢«æ£€æµ‹å‡ºå‡ºç°æ­»é”æ—¶ï¼Œä¼šè‡ªåŠ¨æ’¤é”€å›æ»šäº‹åŠ¡ï¼›æˆ–è€…å‡ºç°ç‰ˆæœ¬è·³è·ƒæ—¶ï¼Œä¹Ÿä¼šè‡ªåŠ¨å›æ»šï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">internAbort</span><span class="params">(<span class="type">long</span> xid, <span class="type">boolean</span> autoAborted)</span> &#123;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="type">Transaction</span> <span class="variable">t</span> <span class="operator">=</span> activeTransaction.get(xid);</span><br><span class="line">    <span class="keyword">if</span>(!autoAborted) &#123;</span><br><span class="line">        activeTransaction.remove(xid);</span><br><span class="line">    &#125;</span><br><span class="line">    lock.unlock();</span><br><span class="line">    <span class="keyword">if</span>(t.autoAborted) <span class="keyword">return</span>;</span><br><span class="line">    lt.remove(xid);</span><br><span class="line">    tm.abort(xid);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>read() æ–¹æ³•è¯»å–ä¸€ä¸ª entryï¼Œæ³¨æ„åˆ¤æ–­ä¸‹å¯è§æ€§å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">byte</span>[] read(<span class="type">long</span> xid, <span class="type">long</span> uid) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="type">Transaction</span> <span class="variable">t</span> <span class="operator">=</span> activeTransaction.get(xid);</span><br><span class="line">    lock.unlock();</span><br><span class="line">    <span class="keyword">if</span>(t.err != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> t.err;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Entry</span> <span class="variable">entry</span> <span class="operator">=</span> <span class="built_in">super</span>.get(uid);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(Visibility.isVisible(tm, t, entry)) &#123;</span><br><span class="line">            <span class="keyword">return</span> entry.data();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        entry.release();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>insert() åˆ™æ˜¯å°†æ•°æ®åŒ…è£¹æˆ Entryï¼Œæ— è„‘äº¤ç»™ DM æ’å…¥å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">insert</span><span class="params">(<span class="type">long</span> xid, <span class="type">byte</span>[] data)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="type">Transaction</span> <span class="variable">t</span> <span class="operator">=</span> activeTransaction.get(xid);</span><br><span class="line">    lock.unlock();</span><br><span class="line">    <span class="keyword">if</span>(t.err != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> t.err;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">byte</span>[] raw = Entry.wrapEntryRaw(xid, data);</span><br><span class="line">    <span class="keyword">return</span> dm.insert(xid, raw);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>delete() æ–¹æ³•çœ‹èµ·æ¥ç•¥ä¸ºå¤æ‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">delete</span><span class="params">(<span class="type">long</span> xid, <span class="type">long</span> uid)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="type">Transaction</span> <span class="variable">t</span> <span class="operator">=</span> activeTransaction.get(xid);</span><br><span class="line">    lock.unlock();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(t.err != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> t.err;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Entry</span> <span class="variable">entry</span> <span class="operator">=</span> <span class="built_in">super</span>.get(uid);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(!Visibility.isVisible(tm, t, entry)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Lock</span> <span class="variable">l</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            l = lt.add(xid, uid);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">            t.err = Error.ConcurrentUpdateException;</span><br><span class="line">            internAbort(xid, <span class="literal">true</span>);</span><br><span class="line">            t.autoAborted = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">throw</span> t.err;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(l != <span class="literal">null</span>) &#123;</span><br><span class="line">            l.lock();</span><br><span class="line">            l.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(entry.getXmax() == xid) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(Visibility.isVersionSkip(tm, t, entry)) &#123;</span><br><span class="line">            t.err = Error.ConcurrentUpdateException;</span><br><span class="line">            internAbort(xid, <span class="literal">true</span>);</span><br><span class="line">            t.autoAborted = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">throw</span> t.err;</span><br><span class="line">        &#125;</span><br><span class="line">        entry.setXmax(xid);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        entry.release();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®é™…ä¸Šä¸»è¦æ˜¯å‰ç½®çš„ä¸‰ä»¶äº‹ï¼šä¸€æ˜¯å¯è§æ€§åˆ¤æ–­ï¼ŒäºŒæ˜¯è·å–èµ„æºçš„é”ï¼Œä¸‰æ˜¯ç‰ˆæœ¬è·³è·ƒåˆ¤æ–­ã€‚åˆ é™¤çš„æ“ä½œåªæœ‰ä¸€ä¸ªè®¾ç½® XMAXã€‚</p>
<h2 id="6-Index-Manager-ï¼ˆIMï¼‰">6. Index Manager ï¼ˆIMï¼‰</h2>
<p>IMï¼Œå³ Index Managerï¼Œç´¢å¼•ç®¡ç†å™¨ï¼Œä¸º MYDB æä¾›äº†åŸºäº B+ æ ‘çš„èšç°‡ç´¢å¼•ã€‚ç›®å‰ MYDB åªæ”¯æŒåŸºäºç´¢å¼•æŸ¥æ‰¾æ•°æ®ï¼Œä¸æ”¯æŒå…¨è¡¨æ‰«æã€‚æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œå®ç°ã€‚</p>
<p>åœ¨ä¾èµ–å…³ç³»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒIM ç›´æ¥åŸºäº DMï¼Œè€Œæ²¡æœ‰åŸºäº VMã€‚ç´¢å¼•çš„æ•°æ®è¢«ç›´æ¥æ’å…¥æ•°æ®åº“æ–‡ä»¶ä¸­ï¼Œè€Œä¸éœ€è¦ç»è¿‡ç‰ˆæœ¬ç®¡ç†ã€‚</p>
<p>æœ¬èŠ‚ä¸èµ˜è¿° B+ æ ‘ç®—æ³•ï¼Œæ›´å¤šæè¿°å®ç°ã€‚</p>
<h3 id="äºŒå‰æ ‘ç´¢å¼•">äºŒå‰æ ‘ç´¢å¼•</h3>
<p>äºŒå‰æ ‘ç”±ä¸€ä¸ªä¸ª Node ç»„æˆï¼Œæ¯ä¸ª Node éƒ½å­˜å‚¨åœ¨ä¸€æ¡ DataItem ä¸­ã€‚ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">[LeafFlag][KeyNumber][SiblingUid]</span><br><span class="line">[Son0][Key0][Son1][Key1]...[SonN][KeyN]</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ LeafFlag æ ‡è®°äº†è¯¥èŠ‚ç‚¹æ˜¯å¦æ˜¯ä¸ªå¶å­èŠ‚ç‚¹ï¼›KeyNumber ä¸ºè¯¥èŠ‚ç‚¹ä¸­ key çš„ä¸ªæ•°ï¼›SiblingUid æ˜¯å…¶å…„å¼ŸèŠ‚ç‚¹å­˜å‚¨åœ¨ DM ä¸­çš„ UIDã€‚åç»­æ˜¯ç©¿æ’çš„å­èŠ‚ç‚¹ï¼ˆSonNï¼‰å’Œ KeyNã€‚æœ€åçš„ä¸€ä¸ª KeyN å§‹ç»ˆä¸º MAX_VALUEï¼Œä»¥æ­¤æ–¹ä¾¿æŸ¥æ‰¾ã€‚</p>
<p>Node ç±»æŒæœ‰äº†å…¶ B+ æ ‘ç»“æ„çš„å¼•ç”¨ï¼ŒDataItem çš„å¼•ç”¨å’Œ SubArray çš„å¼•ç”¨ï¼Œç”¨äºæ–¹ä¾¿å¿«é€Ÿä¿®æ”¹æ•°æ®å’Œé‡Šæ”¾æ•°æ®ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    BPlusTree tree;</span><br><span class="line">    DataItem dataItem;</span><br><span class="line">    SubArray raw;</span><br><span class="line">    <span class="type">long</span> uid;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>äºæ˜¯ç”Ÿæˆä¸€ä¸ªæ ¹èŠ‚ç‚¹çš„æ•°æ®å¯ä»¥å†™æˆå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">byte</span>[] newRootRaw(<span class="type">long</span> left, <span class="type">long</span> right, <span class="type">long</span> key)  &#123;</span><br><span class="line">    <span class="type">SubArray</span> <span class="variable">raw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SubArray</span>(<span class="keyword">new</span> <span class="title class_">byte</span>[NODE_SIZE], <span class="number">0</span>, NODE_SIZE);</span><br><span class="line">    setRawIsLeaf(raw, <span class="literal">false</span>);</span><br><span class="line">    setRawNoKeys(raw, <span class="number">2</span>);</span><br><span class="line">    setRawSibling(raw, <span class="number">0</span>);</span><br><span class="line">    setRawKthSon(raw, left, <span class="number">0</span>);</span><br><span class="line">    setRawKthKey(raw, key, <span class="number">0</span>);</span><br><span class="line">    setRawKthSon(raw, right, <span class="number">1</span>);</span><br><span class="line">    setRawKthKey(raw, Long.MAX_VALUE, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> raw.raw;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯¥æ ¹èŠ‚ç‚¹çš„åˆå§‹ä¸¤ä¸ªå­èŠ‚ç‚¹ä¸º left å’Œ right, åˆå§‹é”®å€¼ä¸º keyã€‚</p>
<p>ç±»ä¼¼çš„ï¼Œç”Ÿæˆä¸€ä¸ªç©ºçš„æ ¹èŠ‚ç‚¹æ•°æ®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">byte</span>[] newNilRootRaw()  &#123;</span><br><span class="line">    <span class="type">SubArray</span> <span class="variable">raw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SubArray</span>(<span class="keyword">new</span> <span class="title class_">byte</span>[NODE_SIZE], <span class="number">0</span>, NODE_SIZE);</span><br><span class="line">    setRawIsLeaf(raw, <span class="literal">true</span>);</span><br><span class="line">    setRawNoKeys(raw, <span class="number">0</span>);</span><br><span class="line">    setRawSibling(raw, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> raw.raw;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Node ç±»æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œç”¨äºè¾…åŠ© B+ æ ‘åšæ’å…¥å’Œæœç´¢æ“ä½œï¼Œåˆ†åˆ«æ˜¯ searchNext æ–¹æ³•å’Œ leafSearchRange æ–¹æ³•ã€‚</p>
<p>searchNext å¯»æ‰¾å¯¹åº” key çš„ UID, å¦‚æœæ‰¾ä¸åˆ°, åˆ™è¿”å›å…„å¼ŸèŠ‚ç‚¹çš„ UIDã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> SearchNextRes <span class="title function_">searchNext</span><span class="params">(<span class="type">long</span> key)</span> &#123;</span><br><span class="line">    dataItem.rLock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">SearchNextRes</span> <span class="variable">res</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchNextRes</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">noKeys</span> <span class="operator">=</span> getRawNoKeys(raw);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; noKeys; i ++) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">ik</span> <span class="operator">=</span> getRawKthKey(raw, i);</span><br><span class="line">            <span class="keyword">if</span>(key &lt; ik) &#123;</span><br><span class="line">                res.uid = getRawKthSon(raw, i);</span><br><span class="line">                res.siblingUid = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">return</span> res;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        res.uid = <span class="number">0</span>;</span><br><span class="line">        res.siblingUid = getRawSibling(raw);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        dataItem.rUnLock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>leafSearchRange æ–¹æ³•åœ¨å½“å‰èŠ‚ç‚¹è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾ï¼ŒèŒƒå›´æ˜¯ [leftKey, rightKey]ï¼Œè¿™é‡Œçº¦å®šå¦‚æœ rightKey å¤§äºç­‰äºè¯¥èŠ‚ç‚¹çš„æœ€å¤§çš„ key, åˆ™è¿˜åŒæ—¶è¿”å›å…„å¼ŸèŠ‚ç‚¹çš„ UIDï¼Œæ–¹ä¾¿ç»§ç»­æœç´¢ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> LeafSearchRangeRes <span class="title function_">leafSearchRange</span><span class="params">(<span class="type">long</span> leftKey, <span class="type">long</span> rightKey)</span> &#123;</span><br><span class="line">    dataItem.rLock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">noKeys</span> <span class="operator">=</span> getRawNoKeys(raw);</span><br><span class="line">        <span class="type">int</span> <span class="variable">kth</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(kth &lt; noKeys) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">ik</span> <span class="operator">=</span> getRawKthKey(raw, kth);</span><br><span class="line">            <span class="keyword">if</span>(ik &gt;= leftKey) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            kth ++;</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Long&gt; uids = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span>(kth &lt; noKeys) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">ik</span> <span class="operator">=</span> getRawKthKey(raw, kth);</span><br><span class="line">            <span class="keyword">if</span>(ik &lt;= rightKey) &#123;</span><br><span class="line">                uids.add(getRawKthSon(raw, kth));</span><br><span class="line">                kth ++;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">siblingUid</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(kth == noKeys) &#123;</span><br><span class="line">            siblingUid = getRawSibling(raw);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">LeafSearchRangeRes</span> <span class="variable">res</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LeafSearchRangeRes</span>();</span><br><span class="line">        res.uids = uids;</span><br><span class="line">        res.siblingUid = siblingUid;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        dataItem.rUnLock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±äº B+ æ ‘åœ¨æ’å…¥åˆ é™¤æ—¶ï¼Œä¼šåŠ¨æ€è°ƒæ•´ï¼Œæ ¹èŠ‚ç‚¹ä¸æ˜¯å›ºå®šèŠ‚ç‚¹ï¼Œäºæ˜¯è®¾ç½®ä¸€ä¸ª bootDataItemï¼Œè¯¥ DataItem ä¸­å­˜å‚¨äº†æ ¹èŠ‚ç‚¹çš„ UIDã€‚å¯ä»¥æ³¨æ„åˆ°ï¼ŒIM åœ¨æ“ä½œ DM æ—¶ï¼Œä½¿ç”¨çš„äº‹åŠ¡éƒ½æ˜¯ SUPER_XIDã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BPlusTree</span> &#123;</span><br><span class="line">    DataItem bootDataItem;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="title function_">rootUid</span><span class="params">()</span> &#123;</span><br><span class="line">        bootLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">SubArray</span> <span class="variable">sa</span> <span class="operator">=</span> bootDataItem.data();</span><br><span class="line">            <span class="keyword">return</span> Parser.parseLong(Arrays.copyOfRange(sa.raw, sa.start, sa.start+<span class="number">8</span>));</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            bootLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">updateRootUid</span><span class="params">(<span class="type">long</span> left, <span class="type">long</span> right, <span class="type">long</span> rightKey)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        bootLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">byte</span>[] rootRaw = Node.newRootRaw(left, right, rightKey);</span><br><span class="line">            <span class="type">long</span> <span class="variable">newRootUid</span> <span class="operator">=</span> dm.insert(TransactionManagerImpl.SUPER_XID, rootRaw);</span><br><span class="line">            bootDataItem.before();</span><br><span class="line">            <span class="type">SubArray</span> <span class="variable">diRaw</span> <span class="operator">=</span> bootDataItem.data();</span><br><span class="line">            System.arraycopy(Parser.long2Byte(newRootUid), <span class="number">0</span>, diRaw.raw, diRaw.start, <span class="number">8</span>);</span><br><span class="line">            bootDataItem.after(TransactionManagerImpl.SUPER_XID);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            bootLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>IM å¯¹ä¸Šå±‚æ¨¡å—ä¸»è¦æä¾›ä¸¤ç§èƒ½åŠ›ï¼šæ’å…¥ç´¢å¼•å’Œæœç´¢èŠ‚ç‚¹ã€‚å‘ B+ æ ‘æ’å…¥èŠ‚ç‚¹å’Œæœç´¢èŠ‚ç‚¹çš„ç®—æ³•å’Œå®ç°ï¼Œä¸å†èµ˜è¿°ã€‚</p>
<p>è¿™é‡Œå¯èƒ½ä¼šæœ‰ç–‘é—®ï¼ŒIM ä¸ºä»€ä¹ˆä¸æä¾›åˆ é™¤ç´¢å¼•çš„èƒ½åŠ›ã€‚å½“ä¸Šå±‚æ¨¡å—é€šè¿‡ VM åˆ é™¤æŸä¸ª Entryï¼Œå®é™…çš„æ“ä½œæ˜¯è®¾ç½®å…¶ XMAXã€‚å¦‚æœä¸å»åˆ é™¤å¯¹åº”ç´¢å¼•çš„è¯ï¼Œå½“åç»­å†æ¬¡å°è¯•è¯»å–è¯¥ Entry æ—¶ï¼Œæ˜¯å¯ä»¥é€šè¿‡ç´¢å¼•å¯»æ‰¾åˆ°çš„ï¼Œä½†æ˜¯ç”±äºè®¾ç½®äº† XMAXï¼Œå¯»æ‰¾ä¸åˆ°åˆé€‚çš„ç‰ˆæœ¬è€Œè¿”å›ä¸€ä¸ªæ‰¾ä¸åˆ°å†…å®¹çš„é”™è¯¯ã€‚</p>
<h3 id="å¯èƒ½çš„é”™è¯¯ä¸æ¢å¤">å¯èƒ½çš„é”™è¯¯ä¸æ¢å¤</h3>
<p>B+ æ ‘åœ¨æ“ä½œè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½å‡ºç°ä¸¤ç§é”™è¯¯ï¼Œåˆ†åˆ«æ˜¯èŠ‚ç‚¹å†…éƒ¨é”™è¯¯å’ŒèŠ‚ç‚¹é—´å…³ç³»é”™è¯¯ã€‚</p>
<p>å½“èŠ‚ç‚¹å†…éƒ¨é”™è¯¯å‘ç”Ÿæ—¶ï¼Œå³å½“ Ti åœ¨å¯¹èŠ‚ç‚¹çš„æ•°æ®è¿›è¡Œæ›´æ”¹æ—¶ï¼ŒMYDB å‘ç”Ÿäº†å´©æºƒã€‚ç”±äº IM ä¾èµ–äº DMï¼Œåœ¨æ•°æ®åº“é‡å¯åï¼ŒTi ä¼šè¢«æ’¤é”€ï¼ˆundoï¼‰ï¼Œå¯¹èŠ‚ç‚¹çš„é”™è¯¯å½±å“ä¼šè¢«æ¶ˆé™¤ã€‚</p>
<p>å¦‚æœå‡ºç°äº†èŠ‚ç‚¹é—´é”™è¯¯ï¼Œé‚£ä¹ˆä¸€å®šæ˜¯ä¸‹é¢è¿™ç§æƒ…å†µï¼šæŸæ¬¡å¯¹ u èŠ‚ç‚¹çš„æ’å…¥æ“ä½œåˆ›å»ºäº†æ–°èŠ‚ç‚¹ v, æ­¤æ—¶ sibling(u)=vï¼Œä½†æ˜¯ v å´å¹¶æ²¡æœ‰è¢«æ’å…¥åˆ°çˆ¶èŠ‚ç‚¹ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">[parent]</span><br><span class="line"></span><br><span class="line">    v</span><br><span class="line">   [u] -&gt; [v]</span><br></pre></td></tr></table></figure>
<p>æ­£ç¡®çš„çŠ¶æ€åº”å½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">[ parent ]</span><br><span class="line"></span><br><span class="line"> v      v</span><br><span class="line">[u] -&gt; [v]</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶ï¼Œå¦‚æœè¦å¯¹èŠ‚ç‚¹è¿›è¡Œæ’å…¥æˆ–è€…æœç´¢æ“ä½œï¼Œå¦‚æœå¤±è´¥ï¼Œå°±ä¼šç»§ç»­è¿­ä»£å®ƒçš„å…„å¼ŸèŠ‚ç‚¹ï¼Œæœ€ç»ˆè¿˜æ˜¯å¯ä»¥æ‰¾åˆ° v èŠ‚ç‚¹ã€‚å”¯ä¸€çš„ç¼ºç‚¹ä»…ä»…æ˜¯ï¼Œæ— æ³•ç›´æ¥é€šè¿‡çˆ¶èŠ‚ç‚¹æ‰¾åˆ° v äº†ï¼Œåªèƒ½é—´æ¥åœ°é€šè¿‡ u è·å–åˆ° vã€‚</p>
<h2 id="7-Table-Managerï¼ˆTBMï¼‰">7. Table Managerï¼ˆTBMï¼‰</h2>
<h3 id="å­—æ®µä¸è¡¨ç®¡ç†">å­—æ®µä¸è¡¨ç®¡ç†</h3>
<p>æ³¨æ„ï¼Œè¿™é‡Œçš„å­—æ®µä¸è¡¨ç®¡ç†ï¼Œä¸æ˜¯ç®¡ç†å„ä¸ªæ¡ç›®ä¸­ä¸åŒçš„å­—æ®µçš„æ•°å€¼ç­‰ä¿¡æ¯ï¼Œè€Œæ˜¯ç®¡ç†è¡¨å’Œå­—æ®µçš„ç»“æ„æ•°æ®ï¼Œä¾‹å¦‚è¡¨åã€è¡¨å­—æ®µä¿¡æ¯å’Œå­—æ®µç´¢å¼•ç­‰ã€‚</p>
<p>ç”±äº TBM åŸºäº VMï¼Œå•ä¸ªå­—æ®µä¿¡æ¯å’Œè¡¨ä¿¡æ¯éƒ½æ˜¯ç›´æ¥ä¿å­˜åœ¨ Entry ä¸­ã€‚å­—æ®µçš„äºŒè¿›åˆ¶è¡¨ç¤ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">[FieldName][TypeName][IndexUid]</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œ FieldName å’Œ TypeNameï¼Œä»¥åŠåé¢çš„è¡¨æ˜ï¼Œå­˜å‚¨çš„éƒ½æ˜¯å­—èŠ‚å½¢å¼çš„å­—ç¬¦ä¸²ã€‚è¿™é‡Œè§„å®šä¸€ä¸ªå­—ç¬¦ä¸²çš„å­˜å‚¨æ–¹å¼ï¼Œä»¥æ˜ç¡®å…¶å­˜å‚¨è¾¹ç•Œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">[StringLength][StringData]</span><br></pre></td></tr></table></figure>
<p>TypeName ä¸ºå­—æ®µçš„ç±»å‹ï¼Œé™å®šä¸º int32ã€int64 å’Œ string ç±»å‹ã€‚å¦‚æœè¿™ä¸ªå­—æ®µæœ‰ç´¢å¼•ï¼Œé‚£ä¸ª IndexUID æŒ‡å‘äº†ç´¢å¼•äºŒå‰æ ‘çš„æ ¹ï¼Œå¦åˆ™è¯¥å­—æ®µä¸º 0ã€‚</p>
<p>æ ¹æ®è¿™ä¸ªç»“æ„ï¼Œé€šè¿‡ä¸€ä¸ª UID ä» VM ä¸­è¯»å–å¹¶è§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Field <span class="title function_">loadField</span><span class="params">(Table tb, <span class="type">long</span> uid)</span> &#123;</span><br><span class="line">    <span class="type">byte</span>[] raw = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        raw = ((TableManagerImpl)tb.tbm).vm.read(TransactionManagerImpl.SUPER_XID, uid);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        Panic.panic(e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">assert</span> raw != <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Field</span>(uid, tb).parseSelf(raw);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Field <span class="title function_">parseSelf</span><span class="params">(<span class="type">byte</span>[] raw)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">ParseStringRes</span> <span class="variable">res</span> <span class="operator">=</span> Parser.parseString(raw);</span><br><span class="line">    fieldName = res.str;</span><br><span class="line">    position += res.next;</span><br><span class="line">    res = Parser.parseString(Arrays.copyOfRange(raw, position, raw.length));</span><br><span class="line">    fieldType = res.str;</span><br><span class="line">    position += res.next;</span><br><span class="line">    <span class="built_in">this</span>.index = Parser.parseLong(Arrays.copyOfRange(raw, position, position+<span class="number">8</span>));</span><br><span class="line">    <span class="keyword">if</span>(index != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            bt = BPlusTree.load(index, ((TableManagerImpl)tb.tbm).dm);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">            Panic.panic(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºä¸€ä¸ªå­—æ®µçš„æ–¹æ³•ç±»ä¼¼ï¼Œå°†ç›¸å…³çš„ä¿¡æ¯é€šè¿‡ VM æŒä¹…åŒ–å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">persistSelf</span><span class="params">(<span class="type">long</span> xid)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">byte</span>[] nameRaw = Parser.string2Byte(fieldName);</span><br><span class="line">    <span class="type">byte</span>[] typeRaw = Parser.string2Byte(fieldType);</span><br><span class="line">    <span class="type">byte</span>[] indexRaw = Parser.long2Byte(index);</span><br><span class="line">    <span class="built_in">this</span>.uid = ((TableManagerImpl)tb.tbm).vm.insert(xid, Bytes.concat(nameRaw, typeRaw, indexRaw));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸€ä¸ªæ•°æ®åº“ä¸­å­˜åœ¨å¤šå¼ è¡¨ï¼ŒTBM ä½¿ç”¨é“¾è¡¨çš„å½¢å¼å°†å…¶ç»„ç»‡èµ·æ¥ï¼Œæ¯ä¸€å¼ è¡¨éƒ½ä¿å­˜ä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€å¼ è¡¨çš„ UIDã€‚è¡¨çš„äºŒè¿›åˆ¶ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">[TableName][NextTable]</span><br><span class="line">[Field1Uid][Field2Uid]...[FieldNUid]</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œç”±äºæ¯ä¸ª Entry ä¸­çš„æ•°æ®ï¼Œå­—èŠ‚æ•°æ˜¯ç¡®å®šçš„ï¼Œäºæ˜¯æ— éœ€ä¿å­˜å­—æ®µçš„ä¸ªæ•°ã€‚æ ¹æ® UID ä» Entry ä¸­è¯»å–è¡¨æ•°æ®çš„è¿‡ç¨‹å’Œè¯»å–å­—æ®µçš„è¿‡ç¨‹ç±»ä¼¼ã€‚</p>
<p>å¯¹è¡¨å’Œå­—æ®µçš„æ“ä½œï¼Œæœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„æ­¥éª¤ï¼Œå°±æ˜¯è®¡ç®— Where æ¡ä»¶çš„èŒƒå›´ï¼Œç›®å‰ MYDB çš„ Where åªæ”¯æŒä¸¤ä¸ªæ¡ä»¶çš„ä¸å’Œæˆ–ã€‚ä¾‹å¦‚æœ‰æ¡ä»¶çš„ Deleteï¼Œè®¡ç®— Whereï¼Œæœ€ç»ˆå°±éœ€è¦è·å–åˆ°æ¡ä»¶èŒƒå›´å†…æ‰€æœ‰çš„ UIDã€‚MYDB åªæ”¯æŒå·²ç´¢å¼•å­—æ®µä½œä¸º Where çš„æ¡ä»¶ã€‚è®¡ç®— Where çš„èŒƒå›´ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹ Table çš„ parseWhere() å’Œ calWhere() æ–¹æ³•ï¼Œä»¥åŠ Field ç±»çš„ calExp() æ–¹æ³•ã€‚</p>
<p>ç”±äº TBM çš„è¡¨ç®¡ç†ï¼Œä½¿ç”¨çš„æ˜¯é“¾è¡¨ä¸²èµ·çš„ Table ç»“æ„ï¼Œæ‰€ä»¥å°±å¿…é¡»ä¿å­˜ä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ï¼Œå³ç¬¬ä¸€ä¸ªè¡¨çš„ UIDï¼Œè¿™æ ·åœ¨ MYDB å¯åŠ¨æ—¶ï¼Œæ‰èƒ½å¿«é€Ÿæ‰¾åˆ°è¡¨ä¿¡æ¯ã€‚</p>
<p>MYDB ä½¿ç”¨ Booter ç±»å’Œ bt æ–‡ä»¶ï¼Œæ¥ç®¡ç† MYDB çš„å¯åŠ¨ä¿¡æ¯ï¼Œè™½ç„¶ç°åœ¨æ‰€éœ€çš„å¯åŠ¨ä¿¡æ¯ï¼Œåªæœ‰ä¸€ä¸ªï¼šå¤´è¡¨çš„ UIDã€‚Booter ç±»å¯¹å¤–æä¾›äº†ä¸¤ä¸ªæ–¹æ³•ï¼šload å’Œ updateï¼Œå¹¶ä¿è¯äº†å…¶åŸå­æ€§ã€‚update åœ¨ä¿®æ”¹ bt æ–‡ä»¶å†…å®¹æ—¶ï¼Œæ²¡æœ‰ç›´æ¥å¯¹ bt æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œè€Œæ˜¯é¦–å…ˆå°†å†…å®¹å†™å…¥ä¸€ä¸ª bt_tmp æ–‡ä»¶ä¸­ï¼Œéšåå°†è¿™ä¸ªæ–‡ä»¶é‡å‘½åä¸º bt æ–‡ä»¶ã€‚ä»¥æœŸé€šè¿‡æ“ä½œç³»ç»Ÿé‡å‘½åæ–‡ä»¶çš„åŸå­æ€§ï¼Œæ¥ä¿è¯æ“ä½œçš„åŸå­æ€§ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="type">byte</span>[] data)</span> &#123;</span><br><span class="line">    <span class="type">File</span> <span class="variable">tmp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(path + BOOTER_TMP_SUFFIX);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        tmp.createNewFile();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        Panic.panic(e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!tmp.canRead()  !tmp.canWrite()) &#123;</span><br><span class="line">        Panic.panic(Error.FileCannotRWException);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span>(<span class="type">FileOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(tmp)) &#123;</span><br><span class="line">        out.write(data);</span><br><span class="line">        out.flush();</span><br><span class="line">    &#125; <span class="keyword">catch</span>(IOException e) &#123;</span><br><span class="line">        Panic.panic(e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Files.move(tmp.toPath(), <span class="keyword">new</span> <span class="title class_">File</span>(path+BOOTER_SUFFIX).toPath(), StandardCopyOption.REPLACE_EXISTING);</span><br><span class="line">    &#125; <span class="keyword">catch</span>(IOException e) &#123;</span><br><span class="line">        Panic.panic(e);</span><br><span class="line">    &#125;</span><br><span class="line">    file = <span class="keyword">new</span> <span class="title class_">File</span>(path+BOOTER_SUFFIX);</span><br><span class="line">    <span class="keyword">if</span>(!file.canRead()  !file.canWrite()) &#123;</span><br><span class="line">        Panic.panic(Error.FileCannotRWException);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Tabäº†Manager">Tabäº†Manager</h3>
<p>TBM å±‚å¯¹å¤–æä¾›æœåŠ¡çš„æ˜¯ TableManager æ¥å£ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">public interface TableManager &#123;</span><br><span class="line">    BeginRes <span class="keyword">begin</span>(<span class="keyword">Begin</span> <span class="keyword">begin</span>);</span><br><span class="line">    byte[] <span class="keyword">commit</span>(long xid) throws Exception;</span><br><span class="line">    byte[] abort(long xid);</span><br><span class="line"></span><br><span class="line">    byte[] <span class="keyword">show</span>(long xid);</span><br><span class="line">    byte[] <span class="keyword">create</span>(long xid, <span class="keyword">Create</span> <span class="keyword">create</span>) throws Exception;</span><br><span class="line"></span><br><span class="line">    byte[] <span class="keyword">insert</span>(long xid, <span class="keyword">Insert</span> <span class="keyword">insert</span>) throws Exception;</span><br><span class="line">    byte[] read(long xid, <span class="keyword">Select</span> <span class="keyword">select</span>) throws Exception;</span><br><span class="line">    byte[] <span class="keyword">update</span>(long xid, <span class="keyword">Update</span> <span class="keyword">update</span>) throws Exception;</span><br><span class="line">    byte[] <span class="keyword">delete</span>(long xid, <span class="keyword">Delete</span> <span class="keyword">delete</span>) throws Exception;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±äº TableManager å·²ç»æ˜¯ç›´æ¥è¢«æœ€å¤–å±‚ Server è°ƒç”¨ï¼ˆMYDB æ˜¯ C/S ç»“æ„ï¼‰ï¼Œè¿™äº›æ–¹æ³•ç›´æ¥è¿”å›æ‰§è¡Œçš„ç»“æœï¼Œä¾‹å¦‚é”™è¯¯ä¿¡æ¯æˆ–è€…ç»“æœä¿¡æ¯çš„å­—èŠ‚æ•°ç»„ï¼ˆå¯è¯»ï¼‰ã€‚</p>
<p>å„ä¸ªæ–¹æ³•çš„å…·ä½“å®ç°å¾ˆç®€å•ï¼Œä¸å†èµ˜è¿°ï¼Œæ— éæ˜¯è°ƒç”¨ VM çš„ç›¸å…³æ–¹æ³•ã€‚å”¯ä¸€å€¼å¾—æ³¨æ„çš„ä¸€ä¸ªå°ç‚¹æ˜¯ï¼Œåœ¨åˆ›å»ºæ–°è¡¨æ—¶ï¼Œé‡‡ç”¨çš„æ—¶å¤´æ’æ³•ï¼Œæ‰€ä»¥æ¯æ¬¡åˆ›å»ºè¡¨éƒ½éœ€è¦æ›´æ–° Booter æ–‡ä»¶ã€‚</p>
<h2 id="8-SQLè¯æ³•è§£æå™¨">8. SQLè¯æ³•è§£æå™¨</h2>
<p>Parser å®ç°äº†å¯¹ç±» SQL è¯­å¥çš„ç»“æ„åŒ–è§£æï¼Œå°†è¯­å¥ä¸­åŒ…å«çš„ä¿¡æ¯å°è£…ä¸ºå¯¹åº”è¯­å¥çš„ç±»ï¼Œè¿™äº›ç±»å¯è§ top.philsongzi.mydb.backend.parser.statement åŒ…ã€‚</p>
<p>MYDB å®ç°çš„ SQL è¯­å¥è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator">&lt;</span><span class="keyword">begin</span> statement<span class="operator">&gt;</span></span><br><span class="line">    <span class="keyword">begin</span> [isolation level (read committedrepeatable read)]</span><br><span class="line">        <span class="keyword">begin</span> isolation level read committed</span><br><span class="line"></span><br><span class="line"><span class="operator">&lt;</span><span class="keyword">commit</span> statement<span class="operator">&gt;</span></span><br><span class="line">    <span class="keyword">commit</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&lt;</span>abort statement<span class="operator">&gt;</span></span><br><span class="line">    abort</span><br><span class="line"></span><br><span class="line"><span class="operator">&lt;</span><span class="keyword">create</span> statement<span class="operator">&gt;</span></span><br><span class="line">    <span class="keyword">create</span> <span class="keyword">table</span> <span class="operator">&lt;</span><span class="keyword">table</span> name<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>field name<span class="operator">&gt;</span> <span class="operator">&lt;</span>field type<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>field name<span class="operator">&gt;</span> <span class="operator">&lt;</span>field type<span class="operator">&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="operator">&lt;</span>field name<span class="operator">&gt;</span> <span class="operator">&lt;</span>field type<span class="operator">&gt;</span></span><br><span class="line">    [(index <span class="operator">&lt;</span>field name list<span class="operator">&gt;</span>)]</span><br><span class="line">        <span class="keyword">create</span> <span class="keyword">table</span> students</span><br><span class="line">        id int32,</span><br><span class="line">        name string,</span><br><span class="line">        age int32,</span><br><span class="line">        (index id name)</span><br><span class="line"></span><br><span class="line"><span class="operator">&lt;</span><span class="keyword">drop</span> statement<span class="operator">&gt;</span></span><br><span class="line">    <span class="keyword">drop</span> <span class="keyword">table</span> <span class="operator">&lt;</span><span class="keyword">table</span> name<span class="operator">&gt;</span></span><br><span class="line">        <span class="keyword">drop</span> <span class="keyword">table</span> students</span><br><span class="line"></span><br><span class="line"><span class="operator">&lt;</span><span class="keyword">select</span> statement<span class="operator">&gt;</span></span><br><span class="line">    <span class="keyword">select</span> (<span class="operator">*</span><span class="operator">&lt;</span>field name list<span class="operator">&gt;</span>) <span class="keyword">from</span> <span class="operator">&lt;</span><span class="keyword">table</span> name<span class="operator">&gt;</span> [<span class="operator">&lt;</span><span class="keyword">where</span> statement<span class="operator">&gt;</span>]</span><br><span class="line">        <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">select</span> name <span class="keyword">from</span> student <span class="keyword">where</span> id <span class="operator">&gt;</span> <span class="number">1</span> <span class="keyword">and</span> id <span class="operator">&lt;</span> <span class="number">4</span></span><br><span class="line">        <span class="keyword">select</span> name, age, id <span class="keyword">from</span> student <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">12</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&lt;</span><span class="keyword">insert</span> statement<span class="operator">&gt;</span></span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span> <span class="operator">&lt;</span><span class="keyword">table</span> name<span class="operator">&gt;</span> <span class="keyword">values</span> <span class="operator">&lt;</span><span class="keyword">value</span> list<span class="operator">&gt;</span></span><br><span class="line">        <span class="keyword">insert</span> <span class="keyword">into</span> student <span class="keyword">values</span> <span class="number">5</span> &quot;Zhang Yuanjia&quot; <span class="number">22</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&lt;</span><span class="keyword">delete</span> statement<span class="operator">&gt;</span></span><br><span class="line">    <span class="keyword">delete</span> <span class="keyword">from</span> <span class="operator">&lt;</span><span class="keyword">table</span> name<span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="keyword">where</span> statement<span class="operator">&gt;</span></span><br><span class="line">        <span class="keyword">delete</span> <span class="keyword">from</span> student <span class="keyword">where</span> name <span class="operator">=</span> &quot;Zhang Yuanjia&quot;</span><br><span class="line"></span><br><span class="line"><span class="operator">&lt;</span><span class="keyword">update</span> statement<span class="operator">&gt;</span></span><br><span class="line">    <span class="keyword">update</span> <span class="operator">&lt;</span><span class="keyword">table</span> name<span class="operator">&gt;</span> <span class="keyword">set</span> <span class="operator">&lt;</span>field name<span class="operator">&gt;=</span><span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span> [<span class="operator">&lt;</span><span class="keyword">where</span> statement<span class="operator">&gt;</span>]</span><br><span class="line">        <span class="keyword">update</span> student <span class="keyword">set</span> name <span class="operator">=</span> &quot;ZYJ&quot; <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&lt;</span><span class="keyword">where</span> statement<span class="operator">&gt;</span></span><br><span class="line">    <span class="keyword">where</span> <span class="operator">&lt;</span>field name<span class="operator">&gt;</span> (<span class="operator">&gt;</span><span class="operator">&lt;=</span>) <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span> [(andor) <span class="operator">&lt;</span>field name<span class="operator">&gt;</span> (<span class="operator">&gt;</span><span class="operator">&lt;=</span>) <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span>]</span><br><span class="line">        <span class="keyword">where</span> age <span class="operator">&gt;</span> <span class="number">10</span> <span class="keyword">or</span> age <span class="operator">&lt;</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&lt;</span>field name<span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="keyword">table</span> name<span class="operator">&gt;</span></span><br><span class="line">    [a<span class="operator">-</span>zA<span class="operator">-</span>Z][a<span class="operator">-</span>zA<span class="operator">-</span>Z0<span class="number">-9</span>_]<span class="operator">*</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&lt;</span>field type<span class="operator">&gt;</span></span><br><span class="line">    int32 int64 string</span><br><span class="line"></span><br><span class="line"><span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span></span><br><span class="line">    .<span class="operator">*</span></span><br></pre></td></tr></table></figure>
<p>parser åŒ…çš„ Tokenizer ç±»ï¼Œå¯¹è¯­å¥è¿›è¡Œé€å­—èŠ‚è§£æï¼Œæ ¹æ®ç©ºç™½ç¬¦æˆ–è€…ä¸Šè¿°è¯æ³•è§„åˆ™ï¼Œå°†è¯­å¥åˆ‡å‰²æˆå¤šä¸ª tokenã€‚å¯¹å¤–æä¾›äº† peek()ã€pop() æ–¹æ³•æ–¹ä¾¿å–å‡º Token è¿›è¡Œè§£æã€‚åˆ‡å‰²çš„å®ç°ä¸èµ˜è¿°ã€‚</p>
<p>Parser ç±»åˆ™ç›´æ¥å¯¹å¤–æä¾›äº† Parse(byte[] statement) æ–¹æ³•ï¼Œæ ¸å¿ƒå°±æ˜¯ä¸€ä¸ªè°ƒç”¨ Tokenizer ç±»åˆ†å‰² Tokenï¼Œå¹¶æ ¹æ®è¯æ³•è§„åˆ™åŒ…è£…æˆå…·ä½“çš„ Statement ç±»å¹¶è¿”å›ã€‚è§£æè¿‡ç¨‹å¾ˆç®€å•ï¼Œä»…ä»…æ˜¯æ ¹æ®ç¬¬ä¸€ä¸ª Token æ¥åŒºåˆ†è¯­å¥ç±»å‹ï¼Œå¹¶åˆ†åˆ«å¤„ç†ï¼Œä¸å†èµ˜è¿°ã€‚</p>
<p>è™½ç„¶æ ¹æ®ç¼–è¯‘åŸç†ï¼Œè¯æ³•åˆ†æåº”å½“å†™ä¸€ä¸ªè‡ªåŠ¨æœºå»åšçš„ï¼Œä½†æ˜¯åˆä¸æ˜¯ä¸èƒ½ç”¨ã€‚</p>
<h2 id="9-Server-å’Œ-Client">9. Server å’Œ Client</h2>
<h3 id="C-S-é€šä¿¡">C/S é€šä¿¡</h3>
<p>MYDB ä½¿ç”¨äº†ä¸€ç§ç‰¹æ®Šçš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œç”¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é€šä¿¡ã€‚å½“ç„¶å¦‚æœå«Œéº»çƒ¦çš„è¯ï¼Œå…¶å®ç›´æ¥ç”¨æ˜æ–‡ä¹Ÿä¸æ˜¯ä¸å¯ä»¥ã€‚</p>
<p>ä¼ è¾“çš„æœ€åŸºæœ¬ç»“æ„ï¼Œæ˜¯ Packageï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Package</span> &#123;</span><br><span class="line">    <span class="type">byte</span>[] data;</span><br><span class="line">    Exception err;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¯ä¸ª Package åœ¨å‘é€å‰ï¼Œç”± Encoder ç¼–ç ä¸ºå­—èŠ‚æ•°ç»„ï¼Œåœ¨å¯¹æ–¹æ”¶åˆ°ååŒæ ·ä¼šç”± Encoder è§£ç æˆ Package å¯¹è±¡ã€‚ç¼–ç å’Œè§£ç çš„è§„åˆ™å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">[Flag][data]</span><br></pre></td></tr></table></figure>
<p>è‹¥ flag ä¸º 0ï¼Œè¡¨ç¤ºå‘é€çš„æ˜¯æ•°æ®ï¼Œé‚£ä¹ˆ data å³ä¸ºè¿™ä»½æ•°æ®æœ¬èº«ï¼›å¦‚æœ flag ä¸º 1ï¼Œè¡¨ç¤ºå‘é€çš„æ˜¯é”™è¯¯ï¼Œdata æ˜¯ Exception.getMessage() çš„é”™è¯¯æç¤ºä¿¡æ¯ã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Encoder</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] encode(Package pkg) &#123;</span><br><span class="line">        <span class="keyword">if</span>(pkg.getErr() != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">Exception</span> <span class="variable">err</span> <span class="operator">=</span> pkg.getErr();</span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;Intern server error!&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span>(err.getMessage() != <span class="literal">null</span>) &#123;</span><br><span class="line">                msg = err.getMessage();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> Bytes.concat(<span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">1</span>&#125;, msg.getBytes());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Bytes.concat(<span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">0</span>&#125;, pkg.getData());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Package <span class="title function_">decode</span><span class="params">(<span class="type">byte</span>[] data)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span>(data.length &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> Error.InvalidPkgDataException;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(data[<span class="number">0</span>] == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Package</span>(Arrays.copyOfRange(data, <span class="number">1</span>, data.length), <span class="literal">null</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(data[<span class="number">0</span>] == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Package</span>(<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="keyword">new</span> <span class="title class_">String</span>(Arrays.copyOfRange(data, <span class="number">1</span>, data.length))));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> Error.InvalidPkgDataException;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¼–ç ä¹‹åçš„ä¿¡æ¯ä¼šé€šè¿‡ Transporter ç±»ï¼Œå†™å…¥è¾“å‡ºæµå‘é€å‡ºå»ã€‚ä¸ºäº†é¿å…ç‰¹æ®Šå­—ç¬¦é€ æˆé—®é¢˜ï¼Œè¿™é‡Œä¼šå°†æ•°æ®è½¬æˆåå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆHex Stringï¼‰ï¼Œå¹¶ä¸ºä¿¡æ¯æœ«å°¾åŠ ä¸Šæ¢è¡Œç¬¦ã€‚è¿™æ ·åœ¨å‘é€å’Œæ¥æ”¶æ•°æ®æ—¶ï¼Œå°±å¯ä»¥å¾ˆç®€å•åœ°ä½¿ç”¨ BufferedReader å’Œ Writer æ¥ç›´æ¥æŒ‰è¡Œè¯»å†™äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Transporter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Socket socket;</span><br><span class="line">    <span class="keyword">private</span> BufferedReader reader;</span><br><span class="line">    <span class="keyword">private</span> BufferedWriter writer;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Transporter</span><span class="params">(Socket socket)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.socket = socket;</span><br><span class="line">        <span class="built_in">this</span>.reader = <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(socket.getInputStream()));</span><br><span class="line">        <span class="built_in">this</span>.writer = <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(socket.getOutputStream()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(<span class="type">byte</span>[] data)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">raw</span> <span class="operator">=</span> hexEncode(data);</span><br><span class="line">        writer.write(raw);</span><br><span class="line">        writer.flush();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] receive() <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> reader.readLine();</span><br><span class="line">        <span class="keyword">if</span>(line == <span class="literal">null</span>) &#123;</span><br><span class="line">            close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> hexDecode(line);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        writer.close();</span><br><span class="line">        reader.close();</span><br><span class="line">        socket.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">hexEncode</span><span class="params">(<span class="type">byte</span>[] buf)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Hex.encodeHexString(buf, <span class="literal">true</span>)+<span class="string">&quot;n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] hexDecode(String buf) <span class="keyword">throws</span> DecoderException &#123;</span><br><span class="line">        <span class="keyword">return</span> Hex.decodeHex(buf);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Packager åˆ™æ˜¯ Encoder å’Œ Transporter çš„ç»“åˆä½“ï¼Œç›´æ¥å¯¹å¤–æä¾› send å’Œ receive æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Packager</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Transporter transpoter;</span><br><span class="line">    <span class="keyword">private</span> Encoder encoder;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Packager</span><span class="params">(Transporter transpoter, Encoder encoder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.transpoter = transpoter;</span><br><span class="line">        <span class="built_in">this</span>.encoder = encoder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(Package pkg)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">byte</span>[] data = encoder.encode(pkg);</span><br><span class="line">        transpoter.send(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Package <span class="title function_">receive</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">byte</span>[] data = transpoter.receive();</span><br><span class="line">        <span class="keyword">return</span> encoder.decode(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        transpoter.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Server-å’Œ-Client-çš„å®ç°">Server å’Œ Client çš„å®ç°</h3>
<p>Server å’Œ Clientï¼Œå·æ‡’ç›´æ¥ä½¿ç”¨äº† Java çš„ socketã€‚</p>
<p>Server å¯åŠ¨ä¸€ä¸ª ServerSocket ç›‘å¬ç«¯å£ï¼Œå½“æœ‰è¯·æ±‚åˆ°æ¥æ—¶ç›´æ¥æŠŠè¯·æ±‚ä¸¢ç»™ä¸€ä¸ªæ–°çº¿ç¨‹å¤„ç†ã€‚è¿™éƒ¨åˆ†åº”è¯¥ç›´æ¥èƒŒæ¿äº†ã€‚</p>
<p>HandleSocket ç±»å®ç°äº† Runnable æ¥å£ï¼Œåœ¨å»ºç«‹è¿æ¥ååˆå§‹åŒ– Packagerï¼Œéšåå°±å¾ªç¯æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„æ•°æ®å¹¶å¤„ç†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Packager</span> <span class="variable">packager</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">Transporter</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Transporter</span>(socket);</span><br><span class="line">    <span class="type">Encoder</span> <span class="variable">e</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Encoder</span>();</span><br><span class="line">    packager = <span class="keyword">new</span> <span class="title class_">Packager</span>(t, e);</span><br><span class="line">&#125; <span class="keyword">catch</span>(IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        socket.close();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e1) &#123;</span><br><span class="line">        e1.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">Executor</span> <span class="variable">exe</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Executor</span>(tbm);</span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="type">Package</span> <span class="variable">pkg</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        pkg = packager.receive();</span><br><span class="line">    &#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">byte</span>[] sql = pkg.getData();</span><br><span class="line">    <span class="type">byte</span>[] result = <span class="literal">null</span>;</span><br><span class="line">    <span class="type">Exception</span> <span class="variable">e</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        result = exe.execute(sql);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e1) &#123;</span><br><span class="line">        e = e1;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    pkg = <span class="keyword">new</span> <span class="title class_">Package</span>(result, e);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        packager.send(pkg);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e1) &#123;</span><br><span class="line">        e1.printStackTrace();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¤„ç†çš„æ ¸å¿ƒæ˜¯ Executor ç±»ï¼ŒExecutor è°ƒç”¨ Parser è·å–åˆ°å¯¹åº”è¯­å¥çš„ç»“æ„åŒ–ä¿¡æ¯å¯¹è±¡ï¼Œå¹¶æ ¹æ®å¯¹è±¡çš„ç±»å‹ï¼Œè°ƒç”¨ TBM çš„ä¸åŒæ–¹æ³•è¿›è¡Œå¤„ç†ã€‚å…·ä½“ä¸å†èµ˜è¿°ã€‚</p>
<p>top.guoziyang.mydb.backend.Launcher ç±»ï¼Œåˆ™æ˜¯æœåŠ¡å™¨çš„å¯åŠ¨å…¥å£ã€‚è¿™ä¸ªç±»è§£æäº†å‘½ä»¤è¡Œå‚æ•°ã€‚å¾ˆé‡è¦çš„å‚æ•°å°±æ˜¯ -open æˆ–è€… -createã€‚Launcher æ ¹æ®ä¸¤ä¸ªå‚æ•°ï¼Œæ¥å†³å®šæ˜¯åˆ›å»ºæ•°æ®åº“æ–‡ä»¶ï¼Œè¿˜æ˜¯å¯åŠ¨ä¸€ä¸ªå·²æœ‰çš„æ•°æ®åº“ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">createDB</span><span class="params">(String path)</span> &#123;</span><br><span class="line">    <span class="type">TransactionManager</span> <span class="variable">tm</span> <span class="operator">=</span> TransactionManager.create(path);</span><br><span class="line">    <span class="type">DataManager</span> <span class="variable">dm</span> <span class="operator">=</span> DataManager.create(path, DEFALUT_MEM, tm);</span><br><span class="line">    <span class="type">VersionManager</span> <span class="variable">vm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VersionManagerImpl</span>(tm, dm);</span><br><span class="line">    TableManager.create(path, vm, dm);</span><br><span class="line">    tm.close();</span><br><span class="line">    dm.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">openDB</span><span class="params">(String path, <span class="type">long</span> mem)</span> &#123;</span><br><span class="line">    <span class="type">TransactionManager</span> <span class="variable">tm</span> <span class="operator">=</span> TransactionManager.open(path);</span><br><span class="line">    <span class="type">DataManager</span> <span class="variable">dm</span> <span class="operator">=</span> DataManager.open(path, mem, tm);</span><br><span class="line">    <span class="type">VersionManager</span> <span class="variable">vm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VersionManagerImpl</span>(tm, dm);</span><br><span class="line">    <span class="type">TableManager</span> <span class="variable">tbm</span> <span class="operator">=</span> TableManager.open(path, vm, dm);</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Server</span>(port, tbm).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨çš„è¿‡ç¨‹ï¼Œä¹Ÿæ˜¯èƒŒæ¿ã€‚å®¢æˆ·ç«¯æœ‰ä¸€ä¸ªç®€å•çš„ Shellï¼Œå®é™…ä¸Šåªæ˜¯è¯»å…¥ç”¨æˆ·çš„è¾“å…¥ï¼Œå¹¶è°ƒç”¨ Client.execute()ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">byte</span>[] execute(<span class="type">byte</span>[] stat) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Package</span> <span class="variable">pkg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Package</span>(stat, <span class="literal">null</span>);</span><br><span class="line">    <span class="type">Package</span> <span class="variable">resPkg</span> <span class="operator">=</span> rt.roundTrip(pkg);</span><br><span class="line">    <span class="keyword">if</span>(resPkg.getErr() != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> resPkg.getErr();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> resPkg.getData();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>RoundTripper ç±»å®é™…ä¸Šå®ç°äº†å•æ¬¡æ”¶å‘åŠ¨ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Package <span class="title function_">roundTrip</span><span class="params">(Package pkg)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    packager.send(pkg);</span><br><span class="line">    <span class="keyword">return</span> packager.receive();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åé™„ä¸Šå®¢æˆ·ç«¯çš„å¯åŠ¨å…¥å£ï¼Œå¾ˆç®€å•ï¼ŒæŠŠ Shell run èµ·æ¥å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Launcher</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> UnknownHostException, IOException &#123;</span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9999</span>);</span><br><span class="line">        <span class="type">Encoder</span> <span class="variable">e</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Encoder</span>();</span><br><span class="line">        <span class="type">Transporter</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Transporter</span>(socket);</span><br><span class="line">        <span class="type">Packager</span> <span class="variable">packager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Packager</span>(t, e);</span><br><span class="line"></span><br><span class="line">        <span class="type">Client</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Client</span>(packager);</span><br><span class="line">        <span class="type">Shell</span> <span class="variable">shell</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Shell</span>(client);</span><br><span class="line">        shell.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="10-æ€»ç»“ï¼ˆä»å®ç°åŠŸèƒ½å‡ºå‘ï¼Œç”±ç‚¹åˆ°é¢é€æ¸æ€»ç»“å¯¹åº”çš„MySQLï¼‰">10. æ€»ç»“ï¼ˆä»å®ç°åŠŸèƒ½å‡ºå‘ï¼Œç”±ç‚¹åˆ°é¢é€æ¸æ€»ç»“å¯¹åº”çš„MySQLï¼‰</h2>
<h3 id="å®ç°çš„åŠŸèƒ½">å®ç°çš„åŠŸèƒ½</h3>
<h4 id="æ•°æ®çš„å¯é æ€§å’Œæ•°æ®æ¢å¤">æ•°æ®çš„å¯é æ€§å’Œæ•°æ®æ¢å¤</h4>
<h4 id="ä¸¤æ®µé”åè®®ï¼ˆ2PLï¼‰å®ç°å¯ä¸²è¡ŒåŒ–è°ƒåº¦">ä¸¤æ®µé”åè®®ï¼ˆ2PLï¼‰å®ç°å¯ä¸²è¡ŒåŒ–è°ƒåº¦</h4>
<h4 id="MVCC-2">MVCC</h4>
<h4 id="ä¸¤ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼ˆè¯»æäº¤å’Œå¯é‡å¤è¯»ï¼‰">ä¸¤ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼ˆè¯»æäº¤å’Œå¯é‡å¤è¯»ï¼‰</h4>
<h4 id="æ­»é”å¤„ç†">æ­»é”å¤„ç†</h4>
<h4 id="ç®€å•çš„è¡¨å’Œå­—æ®µç®¡ç†">ç®€å•çš„è¡¨å’Œå­—æ®µç®¡ç†</h4>
<h4 id="ç®€å•çš„-SQL-è§£æ">ç®€å•çš„ SQL è§£æ</h4>
<h4 id="åŸºäº-socket-çš„-server-å’Œ-client">åŸºäº socket çš„ server å’Œ client</h4>
]]></content>
      <categories>
        <category>Coding</category>
      </categories>
      <tags>
        <tag>MYDB</tag>
        <tag>è½®å­</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»£ç éšæƒ³å½•ä¹‹å“ˆå¸Œè¡¨</title>
    <url>/post/89e159ee.html</url>
    <content><![CDATA[<h2 id="å“ˆå¸Œè¡¨">å“ˆå¸Œè¡¨</h2>
<h3 id="å“ˆå¸Œè¡¨-2">å“ˆå¸Œè¡¨</h3>
<p>ä»€ä¹ˆæ˜¯å“ˆå¸Œè¡¨ï¼ˆHash Tableï¼‰ï¼Ÿ</p>
<blockquote>
<p>å“ˆå¸Œè¡¨æ˜¯æ ¹æ®å…³é”®ç çš„å€¼è€Œç›´æ¥è¿›è¡Œè®¿é—®çš„æ•°æ®ç»“æ„ã€‚</p>
</blockquote>
<p>å“ˆå¸Œè¡¨èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p>
<blockquote>
<p>ä¸€èˆ¬å¯ä»¥<strong>ç”¨æ¥å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å‡ºç°åœ¨é›†åˆä¸­ã€‚</strong></p>
</blockquote>
<p>å“ˆå¸Œè¡¨å¦‚ä½•äº§ç”Ÿï¼Ÿä¾‹å¦‚æŸ¥è¯¢ä¸€ä¸ªåå­—æ˜¯å¦åœ¨è¿™æ‰€å­¦æ ¡ä¸­ï¼Ÿ</p>
<blockquote>
<p>å“ˆå¸Œå‡½æ•°è¿›è¡Œæ˜ å°„ã€‚</p>
</blockquote>
<h3 id="å“ˆå¸Œå‡½æ•°">å“ˆå¸Œå‡½æ•°</h3>
<p>å“ˆå¸Œå‡½æ•°ï¼ŒæŠŠå­¦ç”Ÿçš„å§“åç›´æ¥æ˜ å°„ä¸ºå“ˆå¸Œè¡¨ä¸Šçš„ç´¢å¼•ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡æŸ¥è¯¢ç´¢å¼•ä¸‹æ ‡å¿«é€ŸçŸ¥é“è¿™ä½åŒå­¦æ˜¯å¦åœ¨è¿™æ‰€å­¦æ ¡é‡Œäº†ã€‚</p>
<p>å“ˆå¸Œå‡½æ•°å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé€šè¿‡ hashCode æŠŠåå­—è½¬åŒ–ä¸ºæ•°å€¼ï¼Œä¸€èˆ¬ hashcode æ˜¯é€šè¿‡ç‰¹å®šç¼–ç æ–¹å¼ï¼Œå¯ä»¥å°†å…¶ä»–æ•°æ®æ ¼å¼è½¬åŒ–ä¸ºä¸åŒçš„æ•°å€¼ï¼Œè¿™æ ·å°±æŠŠå­¦ç”Ÿåå­—æ˜ å°„ä¸ºå“ˆå¸Œè¡¨ä¸Šçš„ç´¢å¼•æ•°å­—äº†ã€‚</p>
<p><img src="/post/89e159ee/%E5%93%88%E5%B8%8C%E5%87%BD%E6%95%B0.png" alt="å“ˆå¸Œå‡½æ•°"></p>
<p>å½“hashCodeå¾—åˆ°çš„æ•°å€¼å¤§äºå“ˆå¸Œè¡¨çš„å¤§å°ï¼Œå³tableSizeï¼Œå¯¹å¾—åˆ°çš„æ•°å€¼è¿›è¡Œ<strong>å–æ¨¡</strong>æ“ä½œä¹‹åï¼Œæ•°å€¼ä¸€å®šå°±èƒ½æ”¾å…¥è¡¨ä¸­ã€‚ç„¶è€Œï¼Œè¡¨çš„å¤§å°æ˜¯æœ‰é™çš„ï¼Œå½“è¦æ˜ å°„çš„æ•°é‡å¤§äºè¡¨çš„å¤§å°ï¼Œå¿…ç„¶ä¼šå‡ºç°<strong>ä¸åŒçš„æ•°æ®æ˜ å°„åˆ°åŒä¸€ä¸ªä½ç½®çš„æƒ…å†µ</strong>ï¼Œæ­¤æ—¶å³å‡ºç°äº†<strong>å“ˆå¸Œç¢°æ’</strong>ã€‚</p>
<p><img src="/post/89e159ee/%E5%93%88%E5%B8%8C%E7%A2%B0%E6%92%9E.png" alt="å“ˆå¸Œç¢°æ’"></p>
<p>å¦‚ä½•è§£å†³å“ˆå¸Œç¢°æ’ï¼Ÿ</p>
<ul>
<li>æ‹‰é“¾æ³•â€”â€”åœ¨å‘ç”Ÿå†²çªçš„ä½ç½®ä¸Šå°†å†²çªçš„å…ƒç´ æ’æˆä¸€ä¸ªé“¾è¡¨ã€‚è¦æŸ¥æ‰¾æ­¤å¤„çš„æŸä¸ªå…ƒç´ ï¼Œå…ˆæ‰¾åˆ°ä¸‹æ ‡ï¼Œå†ä»é“¾è¡¨ä¸­æŸ¥æ‰¾å…·ä½“å€¼ã€‚</li>
<li>çº¿æ€§æ¢æµ‹æ³•â€”â€”å½“è¡¨å¤§äºæ•°æ®é‡æ—¶ï¼Œå‘ç”Ÿå“ˆå¸Œç¢°æ’ï¼Œåœ¨å†²çªçš„ä½ç½®åé¢å¯»æ‰¾ä¸€ä¸ªç©ºç€çš„ä½ç½®å­˜æ”¾æ­¤å…ƒç´ ã€‚</li>
</ul>
<h3 id="ä¸‰ç§å“ˆå¸Œç»“æ„">ä¸‰ç§å“ˆå¸Œç»“æ„</h3>
<ul>
<li>æ•°ç»„</li>
<li>setï¼ˆé›†åˆï¼‰</li>
<li>mapï¼ˆæ˜ å°„ï¼‰</li>
</ul>
<h3 id="å°ç»“">å°ç»“</h3>
<p>æ€»ç»“ä¸€ä¸‹ï¼Œ<strong>å½“æˆ‘ä»¬é‡åˆ°äº†è¦å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å‡ºç°é›†åˆé‡Œçš„æ—¶å€™ï¼Œå°±è¦è€ƒè™‘å“ˆå¸Œæ³•</strong>ã€‚</p>
<p>å“ˆå¸Œæ³•æ˜¯ç‰ºç‰²ç©ºé—´æ¢å–æ—¶é—´çš„æ–¹æ³•ï¼Œå› ä¸ºä½¿ç”¨äº†é¢å¤–çš„ç©ºé—´æ¥å­˜æ”¾æ•°æ®ã€‚</p>
<h2 id="æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯">æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯</h2>
<blockquote>
<p>å³åˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯ç›¸åŒçš„å­—æ¯ç»„æˆã€‚å¦‚ï¼šabbc, bbacã€‚</p>
<p><a href="https://leetcode.cn/problems/valid-anagram/">åŠ›æ‰£é¢˜ç›®é“¾æ¥</a></p>
</blockquote>
<ol>
<li>æš´åŠ›ï¼ŒåŒå±‚å¾ªç¯æšä¸¾ï¼Œåˆ¤æ–­å­—ç¬¦æ˜¯å¦å‡ºç°çš„åŒæ—¶è¿˜è¦è®°å½•å­—ç¬¦å‡ºç°çš„æ¬¡æ•°ï¼Œæ—¶é—´å¤æ‚åº¦O(n^2)ã€‚</li>
<li>å“ˆå¸Œè¡¨</li>
</ol>
<p>ä¸Šä¸€èŠ‚ä¸­æåˆ°ä¸‰ç§å¸¸è§å“ˆå¸Œç»“æ„ï¼šæ•°ç»„ã€setã€mapã€‚å…¶ä¸­ï¼Œæ•°ç»„é€‚ç”¨äºæ•°æ®èŒƒå›´è¾ƒå°çš„æƒ…å†µï¼Œseté€‚ç”¨äºæ•°æ®èŒƒå›´å¤§çš„æƒ…å†µï¼Œmapé€‚ç”¨äºå‡ºç°key-valueå¯¹çš„æƒ…å†µã€‚</p>
<p>æœ¬é¢˜ä¸­çš„å­—ç¬¦ä¸²s, téƒ½æ˜¯å°å†™å­—ç¬¦ä¸²ï¼Œå°å†™å­—æ¯26ä¸ªï¼Œä¸”å…¶ASCIIå€¼ä¹Ÿæ˜¯è¿ç»­çš„ï¼Œå› æ­¤ï¼Œè€ƒè™‘å°†å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦æ˜ å°„åˆ°æ•°ç»„ä¸­ï¼Œè®°å½•ä¸¤ä¸ªå­—ç¬¦ä¸²ä¸­å­—ç¬¦å‡ºç°çš„æ¬¡æ•°è¿›è¡Œæ¯”è¾ƒã€‚</p>
<p>å®šä¹‰ä¸€ä¸ªæ•°ç»„ record æ¥è®°å½•å­—ç¬¦ä¸² s ä¸­å­—ç¬¦å‡ºç°æ¬¡æ•°ï¼›éå†ä¸²sï¼Œå¾—åˆ°å…¶å­—ç¬¦å‡ºç°çš„æ¬¡æ•°ï¼›éå†ä¸²tï¼Œå¯¹å…¶æ˜ å°„åˆ°æ•°ç»„ä¸­çš„æ•°å€¼-1ï¼›æ£€æŸ¥æœ€åçš„è®°å½•æ•°ç»„ï¼Œå¦‚æœæ•°ç»„ç´¢å¼•ä¸Šçš„æ•°å€¼éƒ½æ˜¯0ï¼Œè¯´æ˜ä¸¤ä¸ªä¸²ç›¸åŒã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 242. æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯ å­—å…¸è§£æ³•</span></span><br><span class="line"><span class="comment"> * æ—¶é—´å¤æ‚åº¦O(m+n) ç©ºé—´å¤æ‚åº¦O(1)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAnagram</span><span class="params">(String s, String t)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] record = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">26</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">            record[s.charAt(i) - <span class="string">&#x27;a&#x27;</span>]++;     <span class="comment">// å¹¶ä¸éœ€è¦è®°ä½å­—ç¬¦açš„ASCIIï¼Œåªè¦æ±‚å‡ºä¸€ä¸ªç›¸å¯¹æ•°å€¼å°±å¯ä»¥äº†</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; t.length(); i++) &#123;</span><br><span class="line">            record[t.charAt(i) - <span class="string">&#x27;a&#x27;</span>]--;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> count: record) &#123;</span><br><span class="line">            <span class="keyword">if</span> (count != <span class="number">0</span>) &#123;               <span class="comment">// recordæ•°ç»„å¦‚æœæœ‰çš„å…ƒç´ ä¸ä¸ºé›¶0ï¼Œè¯´æ˜å­—ç¬¦ä¸²så’Œt ä¸€å®šæ˜¯è°å¤šäº†å­—ç¬¦æˆ–è€…è°å°‘äº†å­—ç¬¦ã€‚</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;                        <span class="comment">// recordæ•°ç»„æ‰€æœ‰å…ƒç´ éƒ½ä¸ºé›¶0ï¼Œè¯´æ˜å­—ç¬¦ä¸²så’Œtæ˜¯å­—æ¯å¼‚ä½è¯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†">ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†</h2>
<blockquote>
<p>ç»™å®šä¸¤ä¸ªæ•°ç»„ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—å®ƒä»¬çš„äº¤é›†ã€‚</p>
<p><a href="https://leetcode.cn/problems/intersection-of-two-arrays/">åŠ›æ‰£é“¾æ¥</a></p>
</blockquote>
<ul>
<li>ç»™ä¸€ä¸ªå…ƒç´ åˆ¤æ–­æ˜¯å¦å‡ºç°è¿‡ï¼Œé‚£ä¹ˆç¬¬ä¸€ååº”å°±å¯ä»¥æ˜¯çœ‹èƒ½å¦ç”¨å“ˆå¸Œè¡¨ã€‚</li>
</ul>
<ol>
<li>ç”¨ set è§£å†³ï¼ˆåœ¨è¿˜æ²¡æœ‰é™åˆ¶æ•°ç»„å…ƒç´ å¤§å°æ—¶ï¼‰ï¼ˆåŒæ—¶ï¼Œå“ˆå¸Œå€¼å°‘ï¼Œåˆ†æ•£å’Œè·¨åº¦éå¸¸å¤§æ—¶ï¼Œä½¿ç”¨æ•°ç»„ä¼šé€ æˆæå¤§çš„ç©ºé—´æµªè´¹ã€‚ï¼‰</li>
</ol>
<p>æ€è·¯ï¼šå°† num1 è½¬åŒ–æˆå“ˆå¸Œè¡¨ï¼Œå°† num2 ä¸­å…ƒç´ å–å‡ºä¸å“ˆå¸Œè¡¨è¿›è¡Œæ¯”è¾ƒï¼Œè‹¥å‡ºç°ç›¸åŒå…ƒç´ ï¼Œå°†å…¶å­˜æ”¾åˆ°ç»“æœ å“ˆå¸Œè¡¨ result ä¸­ã€‚æ•°æ®ç±»å‹ï¼šHashSetã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] intersection(<span class="type">int</span>[] nums1, <span class="type">int</span>[] nums2) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums1 == <span class="literal">null</span> || nums1.length == <span class="number">0</span> || nums2 == <span class="literal">null</span> || nums2.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        Set&lt;Integer&gt; set1 = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        Set&lt;Integer&gt; resSet = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// éå†æ•°ç»„1</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i : nums1) &#123;</span><br><span class="line">            set1.add(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//éå†æ•°ç»„2çš„è¿‡ç¨‹ä¸­åˆ¤æ–­å“ˆå¸Œè¡¨ä¸­æ˜¯å¦å­˜åœ¨è¯¥å…ƒç´ </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i : nums2) &#123;</span><br><span class="line">            <span class="keyword">if</span> (set1.contains(i)) &#123;</span><br><span class="line">                resSet.add(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="comment">//æ–¹æ³•1ï¼šå°†ç»“æœé›†åˆè½¬ä¸ºæ•°ç»„</span></span><br><span class="line">        <span class="keyword">return</span> resSet.stream().mapToInt(x -&gt; x).toArray();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//æ–¹æ³•2ï¼šå¦å¤–ç”³è¯·ä¸€ä¸ªæ•°ç»„å­˜æ”¾setResä¸­çš„å…ƒç´ ,æœ€åè¿”å›æ•°ç»„</span></span><br><span class="line">        <span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[resSet.size()];</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i : resSet)&#123;</span><br><span class="line">            arr[j++] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> arr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>ä½¿ç”¨Hashæ•°ç»„ï¼Œæ€è·¯åŒä¸Šï¼Œåªä¸è¿‡é™åˆ¶äº†å…ƒç´ å¤§å°</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] intersection(<span class="type">int</span>[] nums1, <span class="type">int</span>[] nums2) &#123;</span><br><span class="line">        <span class="type">int</span>[] hash1 = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">1002</span>];</span><br><span class="line">        <span class="type">int</span>[] hash2 = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">1002</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i : nums1)</span><br><span class="line">            hash1[i]++;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i : nums2)</span><br><span class="line">            hash2[i]++;</span><br><span class="line">        List&lt;Integer&gt; resList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1002</span>; i++)</span><br><span class="line">            <span class="keyword">if</span>(hash1[i] &gt; <span class="number">0</span> &amp;&amp; hash2[i] &gt; <span class="number">0</span>)</span><br><span class="line">                resList.add(i);</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> res[] = <span class="keyword">new</span> <span class="title class_">int</span>[resList.size()];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i : resList)</span><br><span class="line">            res[index++] = i;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¿«ä¹æ•°">å¿«ä¹æ•°</h2>
<blockquote>
<p><a href="https://leetcode.cn/problems/happy-number/">åŠ›æ‰£é“¾æ¥</a></p>
<p>ç¼–å†™ä¸€ä¸ªç®—æ³•æ¥åˆ¤æ–­ä¸€ä¸ªæ•° n æ˜¯ä¸æ˜¯å¿«ä¹æ•°ã€‚</p>
<p>ã€Œå¿«ä¹æ•°ã€å®šä¹‰ä¸ºï¼šå¯¹äºä¸€ä¸ªæ­£æ•´æ•°ï¼Œæ¯ä¸€æ¬¡å°†è¯¥æ•°æ›¿æ¢ä¸ºå®ƒæ¯ä¸ªä½ç½®ä¸Šçš„æ•°å­—çš„å¹³æ–¹å’Œï¼Œç„¶åé‡å¤è¿™ä¸ªè¿‡ç¨‹ç›´åˆ°è¿™ä¸ªæ•°å˜ä¸º 1ï¼Œä¹Ÿå¯èƒ½æ˜¯ æ— é™å¾ªç¯ ä½†å§‹ç»ˆå˜ä¸åˆ° 1ã€‚å¦‚æœ å¯ä»¥å˜ä¸º  1ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°å°±æ˜¯å¿«ä¹æ•°ã€‚</p>
<p>å¦‚æœ n æ˜¯å¿«ä¹æ•°å°±è¿”å› True ï¼›ä¸æ˜¯ï¼Œåˆ™è¿”å› False ã€‚</p>
</blockquote>
<p>æ€è·¯ï¼š<strong>æ— é™å¾ªç¯</strong>ä»€ä¹ˆæ—¶å€™ä¼šå‡ºç°ï¼Ÿå½“æ±‚å’Œä¸­å‡ºç°äº†<strong>ç›¸åŒçš„ sum</strong> çš„æ—¶å€™ã€‚é‚£ä¹ˆã€‚å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å‡ºç°åœ¨é›†åˆä¸­å‘¢ï¼Ÿä½¿ç”¨å“ˆå¸Œæ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isHappy</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        Set&lt;Integer&gt; record = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span> (n != <span class="number">1</span> &amp;&amp; !record.contains(n)) &#123; <span class="comment">// è®°å½•ä¸­ä¸åŒ…å«é‡å¤çš„sum</span></span><br><span class="line">            record.add(n);</span><br><span class="line">            n = getNextNumber(n);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n == <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å–æ•°å„ä¸ªä½æ±‚å¹³æ–¹çš„å’Œ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getNextNumber</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> n % <span class="number">10</span>;</span><br><span class="line">            res += temp * temp;</span><br><span class="line">            n = n / <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ä¸¤æ•°ä¹‹å’Œ">ä¸¤æ•°ä¹‹å’Œ</h2>
<blockquote>
<p><a href="https://leetcode.cn/problems/two-sum/">åŠ›æ‰£é¢˜ç›®é“¾æ¥</a></p>
<p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªç›®æ ‡å€¼ targetï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡ºå’Œä¸ºç›®æ ‡å€¼çš„é‚£ ä¸¤ä¸ª æ•´æ•°ï¼Œå¹¶è¿”å›ä»–ä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚</p>
<p>ä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆã€‚ä½†æ˜¯ï¼Œæ•°ç»„ä¸­åŒä¸€ä¸ªå…ƒç´ ä¸èƒ½ä½¿ç”¨ä¸¤éã€‚</p>
<p>ç¤ºä¾‹:</p>
<p>ç»™å®š nums = [2, 7, 11, 15], target = 9</p>
<p>å› ä¸º nums[0] + nums[1] = 2 + 7 = 9</p>
<p>æ‰€ä»¥è¿”å› [0, 1]</p>
</blockquote>
<p>æ€è·¯ï¼šæœ¬é¢˜ä¸­ï¼Œæˆ‘ä»¬ä¸ä»…è¦çŸ¥é“å…ƒç´ æœ‰æ²¡æœ‰éå†è¿‡ï¼Œè¿˜è¦çŸ¥é“è¿™ä¸ªå…ƒç´ å¯¹åº”çš„ä¸‹æ ‡ï¼Œéœ€è¦ä½¿ç”¨ key valueç»“æ„æ¥å­˜æ”¾ï¼Œkeyæ¥å­˜å…ƒç´ ï¼Œvalueæ¥å­˜ä¸‹æ ‡ï¼Œé‚£ä¹ˆä½¿ç”¨mapæ­£åˆé€‚ã€‚</p>
<p>ä½¿ç”¨æ•°ç»„å’Œsetæ¥åšå“ˆå¸Œæ³•çš„å±€é™ã€‚</p>
<ul>
<li>æ•°ç»„çš„å¤§å°æ˜¯å—é™åˆ¶çš„ï¼Œè€Œä¸”å¦‚æœå…ƒç´ å¾ˆå°‘ï¼Œè€Œå“ˆå¸Œå€¼å¤ªå¤§ä¼šé€ æˆå†…å­˜ç©ºé—´çš„æµªè´¹ã€‚</li>
<li>setæ˜¯ä¸€ä¸ªé›†åˆï¼Œé‡Œé¢æ”¾çš„å…ƒç´ åªèƒ½æ˜¯ä¸€ä¸ªkeyï¼Œè€Œä¸¤æ•°ä¹‹å’Œè¿™é“é¢˜ç›®ï¼Œä¸ä»…è¦åˆ¤æ–­yæ˜¯å¦å­˜åœ¨è€Œä¸”è¿˜è¦è®°å½•yçš„ä¸‹æ ‡ä½ç½®ï¼Œå› ä¸ºè¦è¿”å›x å’Œ yçš„ä¸‹æ ‡ã€‚æ‰€ä»¥set ä¹Ÿä¸èƒ½ç”¨ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] twoSum(<span class="type">int</span>[] nums, <span class="type">int</span> target) &#123;</span><br><span class="line">    <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">if</span>(nums == <span class="literal">null</span> || nums.length == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    Map&lt;Integer, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++)&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> target - nums[i];   <span class="comment">// éå†å½“å‰å…ƒç´ ï¼Œå¹¶åœ¨mapä¸­å¯»æ‰¾æ˜¯å¦æœ‰åŒ¹é…çš„key</span></span><br><span class="line">        <span class="keyword">if</span>(map.containsKey(temp))&#123;</span><br><span class="line">            res[<span class="number">1</span>] = i;</span><br><span class="line">            res[<span class="number">0</span>] = map.get(temp);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        map.put(nums[i], i);    <span class="comment">// å¦‚æœæ²¡æ‰¾åˆ°åŒ¹é…å¯¹ï¼Œå°±æŠŠè®¿é—®è¿‡çš„å…ƒç´ å’Œä¸‹æ ‡åŠ å…¥åˆ°mapä¸­</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ—¶é—´å¤æ‚åº¦O(n) ç©ºé—´å¤æ‚åº¦O(n)</span></span><br></pre></td></tr></table></figure>
<p>æœ¬é¢˜å››ä¸ªé‡ç‚¹ï¼š</p>
<ul>
<li>ä¸ºä»€ä¹ˆä¼šæƒ³åˆ°ç”¨å“ˆå¸Œè¡¨â€”â€”å› ä¸ºè¦åˆ¤æ–­å…ƒç´ æ˜¯å¦ç”¨è¿‡</li>
<li>å“ˆå¸Œè¡¨ä¸ºä»€ä¹ˆç”¨mapâ€”â€”å› ä¸ºéœ€è¦ä¸€ä¸ªkey-valueç±»å‹çš„å“ˆå¸Œæ•°æ®ç»“æ„</li>
<li>æœ¬é¢˜mapæ˜¯ç”¨æ¥å­˜ä»€ä¹ˆçš„â€”â€”å­˜è®¿é—®è¿‡çš„å…ƒç´ </li>
<li>mapä¸­çš„keyå’Œvalueç”¨æ¥å­˜ä»€ä¹ˆçš„â€”â€”key-æ•°æ®å…ƒç´ ï¼Œvalue-æ•°ç»„å…ƒç´ å¯¹åº”çš„ä¸‹æ ‡ã€‚</li>
</ul>
<h2 id="å››æ•°ç›¸åŠ â…¡">å››æ•°ç›¸åŠ â…¡</h2>
<blockquote>
<p>ç»™å®šå››ä¸ªåŒ…å«æ•´æ•°çš„æ•°ç»„åˆ—è¡¨ A , B , C , D ,è®¡ç®—æœ‰å¤šå°‘ä¸ªå…ƒç»„ (i, j, k, l) ï¼Œä½¿å¾— A[i] + B[j] + C[k] + D[l] = 0ã€‚</p>
<p>ä¸ºäº†ä½¿é—®é¢˜ç®€å•åŒ–ï¼Œæ‰€æœ‰çš„ A, B, C, D å…·æœ‰ç›¸åŒçš„é•¿åº¦ Nï¼Œä¸” 0 â‰¤ N â‰¤ 500 ã€‚æ‰€æœ‰æ•´æ•°çš„èŒƒå›´åœ¨ -2^28 åˆ° 2^28 - 1 ä¹‹é—´ï¼Œæœ€ç»ˆç»“æœä¸ä¼šè¶…è¿‡ 2^31 - 1 ã€‚</p>
<p><a href="https://leetcode.cn/problems/4sum-ii/">é¢˜ç›®é“¾æ¥</a></p>
</blockquote>
<p>æ€è·¯ï¼š</p>
<p>æ­¥éª¤ï¼š</p>
<ul>
<li>é¦–å…ˆå®šä¹‰ ä¸€ä¸ªunordered_mapï¼Œkeyæ”¾aå’Œbä¸¤æ•°ä¹‹å’Œï¼Œvalue æ”¾aå’Œbä¸¤æ•°ä¹‹å’Œå‡ºç°çš„æ¬¡æ•°ã€‚</li>
<li>éå†å¤§Aå’Œå¤§Bæ•°ç»„ï¼Œç»Ÿè®¡ä¸¤ä¸ªæ•°ç»„å…ƒç´ ä¹‹å’Œï¼Œå’Œå‡ºç°çš„æ¬¡æ•°ï¼Œæ”¾åˆ°mapä¸­ã€‚</li>
<li>å®šä¹‰intå˜é‡countï¼Œç”¨æ¥ç»Ÿè®¡ a+b+c+d = 0 å‡ºç°çš„æ¬¡æ•°ã€‚</li>
<li>åœ¨éå†å¤§Cå’Œå¤§Dæ•°ç»„ï¼Œæ‰¾åˆ°å¦‚æœ 0-(c+d) åœ¨mapä¸­å‡ºç°è¿‡çš„è¯ï¼Œå°±ç”¨countæŠŠmapä¸­keyå¯¹åº”çš„valueä¹Ÿå°±æ˜¯å‡ºç°æ¬¡æ•°ç»Ÿè®¡å‡ºæ¥ã€‚</li>
<li>æœ€åè¿”å›ç»Ÿè®¡å€¼ count å°±å¯ä»¥äº†</li>
</ul>
<p>ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">fourSumCount</span><span class="params">(<span class="type">int</span>[] nums1, <span class="type">int</span>[] nums2, <span class="type">int</span>[] nums3, <span class="type">int</span>[] nums4)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        Map&lt;Integer, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Integer, Integer&gt;();</span><br><span class="line">        <span class="comment">//ç»Ÿè®¡ä¸¤ä¸ªæ•°ç»„ä¸­çš„å…ƒç´ ä¹‹å’Œï¼ŒåŒæ—¶ç»Ÿè®¡å‡ºç°çš„æ¬¡æ•°ï¼Œæ”¾å…¥map</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i : nums1) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j : nums2) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> i + j;</span><br><span class="line">                map.put(sum, map.getOrDefault(sum, <span class="number">0</span>) + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ç»Ÿè®¡å‰©ä½™çš„ä¸¤ä¸ªå…ƒç´ çš„å’Œï¼Œåœ¨mapä¸­æ‰¾æ˜¯å¦å­˜åœ¨ç›¸åŠ ä¸º0çš„æƒ…å†µï¼ŒåŒæ—¶è®°å½•æ¬¡æ•°</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i : nums3) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j : nums4) &#123;</span><br><span class="line">                res += map.getOrDefault(<span class="number">0</span> - i - j, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ—¶é—´å¤æ‚åº¦: O(n^2)</li>
<li>ç©ºé—´å¤æ‚åº¦: O(n^2)ï¼Œæœ€åæƒ…å†µä¸‹Aå’ŒBçš„å€¼å„ä¸ç›¸åŒï¼Œç›¸åŠ äº§ç”Ÿçš„æ•°å­—ä¸ªæ•°ä¸º n^2</li>
</ul>
<h2 id="èµé‡‘ä¿¡">èµé‡‘ä¿¡</h2>
<blockquote>
<p>ç»™å®šä¸€ä¸ªèµé‡‘ä¿¡ (ransom) å­—ç¬¦ä¸²å’Œä¸€ä¸ªæ‚å¿—(magazine)å­—ç¬¦ä¸²ï¼Œåˆ¤æ–­ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸² ransom èƒ½ä¸èƒ½ç”±ç¬¬äºŒä¸ªå­—ç¬¦ä¸² magazines é‡Œé¢çš„å­—ç¬¦æ„æˆã€‚å¦‚æœå¯ä»¥æ„æˆï¼Œè¿”å› true ï¼›å¦åˆ™è¿”å› falseã€‚</p>
<p>(é¢˜ç›®è¯´æ˜ï¼šä¸ºäº†ä¸æš´éœ²èµé‡‘ä¿¡å­—è¿¹ï¼Œè¦ä»æ‚å¿—ä¸Šæœç´¢å„ä¸ªéœ€è¦çš„å­—æ¯ï¼Œç»„æˆå•è¯æ¥è¡¨è¾¾æ„æ€ã€‚æ‚å¿—å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—ç¬¦åªèƒ½åœ¨èµé‡‘ä¿¡å­—ç¬¦ä¸²ä¸­ä½¿ç”¨ä¸€æ¬¡ã€‚)</p>
<p>æ³¨æ„ï¼š</p>
<p>ä½ å¯ä»¥å‡è®¾ä¸¤ä¸ªå­—ç¬¦ä¸²å‡åªå«æœ‰å°å†™å­—æ¯ã€‚</p>
<p>canConstruct(â€œaâ€, â€œbâ€) -&gt; false</p>
<p>canConstruct(â€œaaâ€, â€œabâ€) -&gt; false</p>
<p>canConstruct(â€œaaâ€, â€œaabâ€) -&gt; true</p>
<p><a href="https://leetcode.cn/problems/ransom-note/">é“¾æ¥</a></p>
</blockquote>
<p><strong>æ€è·¯</strong>ï¼š</p>
<p>è¿™é“é¢˜ç›®å’Œ242.æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯ (opens new window)å¾ˆåƒï¼Œ242.æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯ (opens new window)ç›¸å½“äºæ±‚ å­—ç¬¦ä¸²a å’Œ å­—ç¬¦ä¸²b æ˜¯å¦å¯ä»¥ç›¸äº’ç»„æˆ ï¼Œè€Œè¿™é“é¢˜ç›®æ˜¯æ±‚ å­—ç¬¦ä¸²aèƒ½å¦ç»„æˆå­—ç¬¦ä¸²bï¼Œè€Œä¸ç”¨ç®¡å­—ç¬¦ä¸²b èƒ½ä¸èƒ½ç»„æˆå­—ç¬¦ä¸²aã€‚</p>
<p>æœ¬é¢˜åˆ¤æ–­ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ransomèƒ½ä¸èƒ½ç”±ç¬¬äºŒä¸ªå­—ç¬¦ä¸²magazinesé‡Œé¢çš„å­—ç¬¦æ„æˆï¼Œä½†æ˜¯è¿™é‡Œéœ€è¦æ³¨æ„ä¸¤ç‚¹ã€‚</p>
<ul>
<li>ç¬¬ä¸€ç‚¹â€œä¸ºäº†ä¸æš´éœ²èµé‡‘ä¿¡å­—è¿¹ï¼Œè¦ä»æ‚å¿—ä¸Šæœç´¢å„ä¸ªéœ€è¦çš„å­—æ¯ï¼Œç»„æˆå•è¯æ¥è¡¨è¾¾æ„æ€â€  è¿™é‡Œè¯´æ˜æ‚å¿—é‡Œé¢çš„å­—æ¯ä¸å¯é‡å¤ä½¿ç”¨ã€‚</li>
<li>ç¬¬äºŒç‚¹ â€œä½ å¯ä»¥å‡è®¾ä¸¤ä¸ªå­—ç¬¦ä¸²å‡åªå«æœ‰å°å†™å­—æ¯ã€‚â€ è¯´æ˜åªæœ‰å°å†™å­—æ¯ï¼Œè¿™ä¸€ç‚¹å¾ˆé‡è¦</li>
</ul>
<p><strong>æš´åŠ›</strong>ï¼š</p>
<p><strong>å“ˆå¸Œ</strong>ï¼š</p>
<p>å› ä¸ºé¢˜ç›®è¯´åªæœ‰å°å†™å­—æ¯ï¼Œé‚£å¯ä»¥é‡‡ç”¨<strong>ç©ºé—´æ¢å–æ—¶é—´çš„å“ˆå¸Œç­–ç•¥</strong>ï¼Œç”¨ä¸€ä¸ªé•¿åº¦ä¸º26çš„æ•°ç»„æ¥è®°å½•magazineé‡Œå­—æ¯å‡ºç°çš„æ¬¡æ•°ã€‚</p>
<p>ç„¶åå†ç”¨ ransomNote å»éªŒè¯è¿™ä¸ªæ•°ç»„æ˜¯å¦åŒ…å«äº† ransomNote æ‰€éœ€è¦çš„æ‰€æœ‰å­—æ¯ã€‚</p>
<p>ä¾ç„¶æ˜¯æ•°ç»„åœ¨å“ˆå¸Œæ³•ä¸­çš„åº”ç”¨ã€‚</p>
<p>ä¸€äº›åŒå­¦å¯èƒ½æƒ³ï¼Œç”¨æ•°ç»„å¹²å•¥ï¼Œéƒ½ç”¨mapå®Œäº‹äº†ï¼Œå…¶å®åœ¨æœ¬é¢˜çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨mapçš„ç©ºé—´æ¶ˆè€—è¦æ¯”æ•°ç»„å¤§ä¸€äº›çš„ï¼Œå› ä¸º<strong>mapè¦ç»´æŠ¤çº¢é»‘æ ‘æˆ–è€…å“ˆå¸Œè¡¨ï¼Œè€Œä¸”è¿˜è¦åšå“ˆå¸Œå‡½æ•°</strong>ï¼Œæ˜¯è´¹æ—¶çš„ï¼æ•°æ®é‡å¤§çš„è¯å°±èƒ½ä½“ç°å‡ºæ¥å·®åˆ«äº†ã€‚ æ‰€ä»¥æ•°ç»„æ›´åŠ ç®€å•ç›´æ¥æœ‰æ•ˆï¼</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">canConstruct</span><span class="params">(String ransomNote, String magazine)</span> &#123;</span><br><span class="line">        <span class="comment">// shortcut</span></span><br><span class="line">        <span class="keyword">if</span> (ransomNote.length() &gt; magazine.length()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å®šä¹‰ä¸€ä¸ªå“ˆå¸Œæ˜ å°„æ•°ç»„</span></span><br><span class="line">        <span class="type">int</span>[] record = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">26</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éå†</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">char</span> c : magazine.toCharArray())&#123;</span><br><span class="line">            record[c - <span class="string">&#x27;a&#x27;</span>] += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">char</span> c : ransomNote.toCharArray())&#123;</span><br><span class="line">            record[c - <span class="string">&#x27;a&#x27;</span>] -= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¦‚æœæ•°ç»„ä¸­å­˜åœ¨è´Ÿæ•°ï¼Œè¯´æ˜ransomNoteå­—ç¬¦ä¸²æ€»å­˜åœ¨magazineä¸­æ²¡æœ‰çš„å­—ç¬¦</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i : record)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i &lt; <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ä¸‰æ•°ä¹‹å’Œ">ä¸‰æ•°ä¹‹å’Œ</h2>
<blockquote>
<p>ç»™ä½ ä¸€ä¸ªåŒ…å« n ä¸ªæ•´æ•°çš„æ•°ç»„ numsï¼Œåˆ¤æ–­ nums ä¸­æ˜¯å¦å­˜åœ¨ä¸‰ä¸ªå…ƒç´  aï¼Œbï¼Œc ï¼Œä½¿å¾— a + b + c = 0 ï¼Ÿè¯·ä½ æ‰¾å‡ºæ‰€æœ‰æ»¡è¶³æ¡ä»¶ä¸”ä¸é‡å¤çš„ä¸‰å…ƒç»„ã€‚</p>
<p>æ³¨æ„ï¼š ç­”æ¡ˆä¸­ä¸å¯ä»¥åŒ…å«é‡å¤çš„ä¸‰å…ƒç»„ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<p>ç»™å®šæ•°ç»„ nums = [-1, 0, 1, 2, -1, -4]ï¼Œ</p>
<p>æ»¡è¶³è¦æ±‚çš„ä¸‰å…ƒç»„é›†åˆä¸ºï¼š [ [-1, 0, 1], [-1, -1, 2] ]</p>
<p>[<a href="https://leetcode.cn/problems/3sum/">é“¾æ¥</a></p>
</blockquote>
<p><strong>æ€è·¯</strong>ï¼š</p>
<p>é¦–å…ˆå°†æ•°ç»„æ’åºï¼Œç„¶åæœ‰ä¸€å±‚forå¾ªç¯ï¼Œiä»ä¸‹æ ‡0çš„åœ°æ–¹å¼€å§‹ï¼ŒåŒæ—¶å®šä¸€ä¸ªä¸‹æ ‡left å®šä¹‰åœ¨i+1çš„ä½ç½®ä¸Šï¼Œå®šä¹‰ä¸‹æ ‡right åœ¨æ•°ç»„ç»“å°¾çš„ä½ç½®ä¸Šã€‚</p>
<p>ä¾ç„¶è¿˜æ˜¯åœ¨æ•°ç»„ä¸­æ‰¾åˆ° abc ä½¿å¾—a + b +c =0ï¼Œæˆ‘ä»¬è¿™é‡Œç›¸å½“äº a = nums[i]ï¼Œb = nums[left]ï¼Œc = nums[right]ã€‚</p>
<p>æ¥ä¸‹æ¥å¦‚ä½•ç§»åŠ¨left å’Œrightå‘¢ï¼Œ å¦‚æœnums[i] + nums[left] + nums[right] &gt; 0 å°±è¯´æ˜ æ­¤æ—¶ä¸‰æ•°ä¹‹å’Œå¤§äº†ï¼Œå› ä¸ºæ•°ç»„æ˜¯æ’åºåäº†ï¼Œæ‰€ä»¥rightä¸‹æ ‡å°±åº”è¯¥å‘å·¦ç§»åŠ¨ï¼Œè¿™æ ·æ‰èƒ½è®©ä¸‰æ•°ä¹‹å’Œå°ä¸€äº›ã€‚</p>
<p>å¦‚æœ nums[i] + nums[left] + nums[right] &lt; 0 è¯´æ˜ æ­¤æ—¶ ä¸‰æ•°ä¹‹å’Œå°äº†ï¼Œleft å°±å‘å³ç§»åŠ¨ï¼Œæ‰èƒ½è®©ä¸‰æ•°ä¹‹å’Œå¤§ä¸€äº›ï¼Œç›´åˆ°leftä¸rightç›¸é‡ä¸ºæ­¢ã€‚</p>
<p><strong>ä»£ç </strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">threeSum</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line">	<span class="comment">// æ‰¾å‡ºa + b + c = 0</span></span><br><span class="line">        <span class="comment">// a = nums[i], b = nums[left], c = nums[right]</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">	    <span class="comment">// æ’åºä¹‹åå¦‚æœç¬¬ä¸€ä¸ªå…ƒç´ å·²ç»å¤§äºé›¶ï¼Œé‚£ä¹ˆæ— è®ºå¦‚ä½•ç»„åˆéƒ½ä¸å¯èƒ½å‡‘æˆä¸‰å…ƒç»„ï¼Œç›´æ¥è¿”å›ç»“æœå°±å¯ä»¥äº†</span></span><br><span class="line">            <span class="keyword">if</span> (nums[i] &gt; <span class="number">0</span>) &#123; </span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; nums[i] == nums[i - <span class="number">1</span>]) &#123;  <span class="comment">// å»é‡a</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> i + <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> nums.length - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> (right &gt; left) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> nums[i] + nums[left] + nums[right];</span><br><span class="line">                <span class="keyword">if</span> (sum &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    right--;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sum &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                    left++;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    result.add(Arrays.asList(nums[i], nums[left], nums[right]));</span><br><span class="line">		    <span class="comment">// å»é‡é€»è¾‘åº”è¯¥æ”¾åœ¨æ‰¾åˆ°ä¸€ä¸ªä¸‰å…ƒç»„ä¹‹åï¼Œå¯¹b å’Œ cå»é‡</span></span><br><span class="line">                    <span class="keyword">while</span> (right &gt; left &amp;&amp; nums[right] == nums[right - <span class="number">1</span>]) right--;</span><br><span class="line">                    <span class="keyword">while</span> (right &gt; left &amp;&amp; nums[left] == nums[left + <span class="number">1</span>]) left++;</span><br><span class="line">                    </span><br><span class="line">                    right--; </span><br><span class="line">                    left++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å››æ•°ä¹‹å’Œ">å››æ•°ä¹‹å’Œ</h2>
<blockquote>
<p>é¢˜æ„ï¼šç»™å®šä¸€ä¸ªåŒ…å« n ä¸ªæ•´æ•°çš„æ•°ç»„ nums å’Œä¸€ä¸ªç›®æ ‡å€¼ targetï¼Œåˆ¤æ–­ nums ä¸­æ˜¯å¦å­˜åœ¨å››ä¸ªå…ƒç´  aï¼Œbï¼Œc å’Œ d ï¼Œä½¿å¾— a + b + c + d çš„å€¼ä¸ target ç›¸ç­‰ï¼Ÿæ‰¾å‡ºæ‰€æœ‰æ»¡è¶³æ¡ä»¶ä¸”ä¸é‡å¤çš„å››å…ƒç»„ã€‚</p>
<p>æ³¨æ„ï¼š</p>
<p>ç­”æ¡ˆä¸­ä¸å¯ä»¥åŒ…å«é‡å¤çš„å››å…ƒç»„ã€‚</p>
<p>ç¤ºä¾‹ï¼š ç»™å®šæ•°ç»„ nums = [1, 0, -1, 0, -2, 2]ï¼Œå’Œ target = 0ã€‚ æ»¡è¶³è¦æ±‚çš„å››å…ƒç»„é›†åˆä¸ºï¼š [ [-1, 0, 0, 1], [-2, -1, 1, 2], [-2, 0, 0, 2] ]</p>
<p>[<a href="https://leetcode.cn/problems/4sum/">é“¾æ¥</a></p>
</blockquote>
<p><strong>æ€è·¯</strong>ï¼š</p>
<p>å››æ•°ä¹‹å’Œï¼Œå’Œ ä¸‰æ•°ä¹‹å’Œ (opens new window) æ˜¯ä¸€ä¸ªæ€è·¯ï¼Œéƒ½æ˜¯ä½¿ç”¨åŒæŒ‡é’ˆæ³•,ï¼ŒåŸºæœ¬è§£æ³•å°±æ˜¯åœ¨ä¸‰æ•°ä¹‹å’Œ çš„åŸºç¡€ä¸Šå†å¥—ä¸€å±‚forå¾ªç¯ã€‚</p>
<p>ä½†æ˜¯ï¼Œæœ‰ä¸€äº›ç»†èŠ‚éœ€è¦æ³¨æ„ï¼Œä¾‹å¦‚ï¼š ä¸è¦åˆ¤æ–­<code>nums[k] &gt; target</code> å°±è¿”å›äº†ï¼Œä¸‰æ•°ä¹‹å’Œ å¯ä»¥é€šè¿‡ nums[i] &gt; 0 å°±è¿”å›äº†ï¼Œå› ä¸º 0 å·²ç»æ˜¯ç¡®å®šçš„æ•°äº†ï¼Œå››æ•°ä¹‹å’Œè¿™é“é¢˜ç›® targetæ˜¯ä»»æ„å€¼ã€‚æ¯”å¦‚ï¼šæ•°ç»„æ˜¯[-4, -3, -2, -1]ï¼Œtargetæ˜¯-10ï¼Œä¸èƒ½å› ä¸º-4 &gt; -10è€Œè·³è¿‡ã€‚ä½†æ˜¯æˆ‘ä»¬ä¾æ—§å¯ä»¥å»åšå‰ªæï¼Œé€»è¾‘å˜æˆnums[i] &gt; target &amp;&amp; (nums[i] &gt;=0 || target &gt;= 0)å°±å¯ä»¥äº†ã€‚</p>
<p>ä¸‰æ•°ä¹‹å’Œ (opens new window)çš„åŒæŒ‡é’ˆè§£æ³•æ˜¯ä¸€å±‚forå¾ªç¯num[i]ä¸ºç¡®å®šå€¼ï¼Œç„¶åå¾ªç¯å†…æœ‰leftå’Œrightä¸‹æ ‡ä½œä¸ºåŒæŒ‡é’ˆï¼Œæ‰¾åˆ°nums[i] + nums[left] + nums[right] == 0ã€‚</p>
<p>å››æ•°ä¹‹å’Œçš„åŒæŒ‡é’ˆè§£æ³•æ˜¯ä¸¤å±‚forå¾ªç¯nums[k] + nums[i]ä¸ºç¡®å®šå€¼ï¼Œä¾ç„¶æ˜¯å¾ªç¯å†…æœ‰leftå’Œrightä¸‹æ ‡ä½œä¸ºåŒæŒ‡é’ˆï¼Œæ‰¾å‡ºnums[k] + nums[i] + nums[left] + nums[right] == targetçš„æƒ…å†µï¼Œä¸‰æ•°ä¹‹å’Œçš„æ—¶é—´å¤æ‚åº¦æ˜¯O(n^2)ï¼Œå››æ•°ä¹‹å’Œçš„æ—¶é—´å¤æ‚åº¦æ˜¯O(n^3) ã€‚</p>
<p>é‚£ä¹ˆä¸€æ ·çš„é“ç†ï¼Œäº”æ•°ä¹‹å’Œã€å…­æ•°ä¹‹å’Œç­‰ç­‰éƒ½é‡‡ç”¨è¿™ç§è§£æ³•ã€‚</p>
<p>å¯¹äºä¸‰æ•°ä¹‹å’Œ (opens new window)åŒæŒ‡é’ˆæ³•å°±æ˜¯å°†åŸæœ¬æš´åŠ›O(n^3)çš„è§£æ³•ï¼Œé™ä¸ºO(n^2)çš„è§£æ³•ï¼Œå››æ•°ä¹‹å’Œçš„åŒæŒ‡é’ˆè§£æ³•å°±æ˜¯å°†åŸæœ¬æš´åŠ›O(n^4)çš„è§£æ³•ï¼Œé™ä¸ºO(n^3)çš„è§£æ³•ã€‚</p>
<p><strong>ä»£ç </strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">fourSum</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line">       </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">		</span><br><span class="line">            <span class="comment">// nums[i] &gt; target ç›´æ¥è¿”å›, å‰ªææ“ä½œ</span></span><br><span class="line">            <span class="keyword">if</span> (nums[i] &gt; <span class="number">0</span> &amp;&amp; nums[i] &gt; target) &#123;</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">		</span><br><span class="line">            <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; nums[i - <span class="number">1</span>] == nums[i]) &#123;    <span class="comment">// å¯¹nums[i]å»é‡</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i + <span class="number">1</span>; j &lt; nums.length; j++) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (j &gt; i + <span class="number">1</span> &amp;&amp; nums[j - <span class="number">1</span>] == nums[j]) &#123;  <span class="comment">// å¯¹nums[j]å»é‡</span></span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> j + <span class="number">1</span>;</span><br><span class="line">                <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> nums.length - <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">while</span> (right &gt; left) &#123;</span><br><span class="line">		    <span class="comment">// nums[k] + nums[i] + nums[left] + nums[right] &gt; target intä¼šæº¢å‡º</span></span><br><span class="line">                    <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> (<span class="type">long</span>) nums[i] + nums[j] + nums[left] + nums[right];</span><br><span class="line">                    <span class="keyword">if</span> (sum &gt; target) &#123;</span><br><span class="line">                        right--;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sum &lt; target) &#123;</span><br><span class="line">                        left++;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        result.add(Arrays.asList(nums[i], nums[j], nums[left], nums[right]));</span><br><span class="line">                        <span class="comment">// å¯¹nums[left]å’Œnums[right]å»é‡</span></span><br><span class="line">                        <span class="keyword">while</span> (right &gt; left &amp;&amp; nums[right] == nums[right - <span class="number">1</span>]) right--;</span><br><span class="line">                        <span class="keyword">while</span> (right &gt; left &amp;&amp; nums[left] == nums[left + <span class="number">1</span>]) left++;</span><br><span class="line"></span><br><span class="line">                        left++;</span><br><span class="line">                        right--;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å°ç»“-2">å°ç»“</h2>
]]></content>
      <categories>
        <category>Coding</category>
        <category>ä»£ç éšæƒ³å½•</category>
      </categories>
      <tags>
        <tag>åˆ·é¢˜ç¬”è®°</tag>
        <tag>ä»£ç éšæƒ³å½•</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»£ç éšæƒ³å½•ä¹‹å­—ç¬¦ä¸²</title>
    <url>/post/f06f8293.html</url>
    <content><![CDATA[<h1>ä»£ç éšæƒ³å½•ä¹‹å­—ç¬¦ä¸²</h1>
<blockquote>
<p><strong>æ‰“åŸºç¡€çš„æ—¶å€™ï¼Œä¸è¦å¤ªä¾èµ–åº“å‡½æ•°ï¼</strong></p>
</blockquote>
<h2 id="åè½¬å­—ç¬¦ä¸²">åè½¬å­—ç¬¦ä¸²</h2>
<blockquote>
<p><a href="https://leetcode.cn/problems/reverse-string/">åŠ›æ‰£é¢˜ç›®é“¾æ¥(opens new window)</a></p>
<p>ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä½œç”¨æ˜¯å°†è¾“å…¥çš„å­—ç¬¦ä¸²åè½¬è¿‡æ¥ã€‚è¾“å…¥å­—ç¬¦ä¸²ä»¥å­—ç¬¦æ•°ç»„ char[] çš„å½¢å¼ç»™å‡ºã€‚</p>
<p>ä¸è¦ç»™å¦å¤–çš„æ•°ç»„åˆ†é…é¢å¤–çš„ç©ºé—´ï¼Œä½ å¿…é¡»åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„ã€ä½¿ç”¨ O(1) çš„é¢å¤–ç©ºé—´è§£å†³è¿™ä¸€é—®é¢˜ã€‚</p>
<p>ä½ å¯ä»¥å‡è®¾æ•°ç»„ä¸­çš„æ‰€æœ‰å­—ç¬¦éƒ½æ˜¯ ASCII ç è¡¨ä¸­çš„å¯æ‰“å°å­—ç¬¦ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š<br>
è¾“å…¥ï¼š[â€œhâ€,â€œeâ€,â€œlâ€,â€œlâ€,â€œoâ€]<br>
è¾“å‡ºï¼š[â€œoâ€,â€œlâ€,â€œlâ€,â€œeâ€,â€œhâ€]</p>
<p>ç¤ºä¾‹ 2ï¼š<br>
è¾“å…¥ï¼š[â€œHâ€,â€œaâ€,â€œnâ€,â€œnâ€,â€œaâ€,â€œhâ€]<br>
è¾“å‡ºï¼š[â€œhâ€,â€œaâ€,â€œnâ€,â€œnâ€,â€œaâ€,â€œHâ€]</p>
</blockquote>
<p><strong>æ€è·¯</strong>ï¼š</p>
<p>åŒæŒ‡é’ˆï¼Œåˆ†åˆ«ä»å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½®<code>i</code>å’Œç»“æŸä½ç½®<code>j</code>åŒæ—¶å¼€å§‹å‘ä¸­é—´ç§»åŠ¨ï¼Œå¹¶äº¤æ¢å…ƒç´ ã€‚å¾ªç¯ç»ˆæ­¢æ¡ä»¶æ˜¯æŒ‡é’ˆä½ç½®ç›¸åŒã€‚</p>
<p><strong>ä»£ç </strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reverseString</span><span class="params">(<span class="type">char</span>[] s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> s.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (l &lt; r) &#123;</span><br><span class="line">            s[l] ^= s[r];  <span class="comment">//æ„é€  a ^ b çš„ç»“æœï¼Œå¹¶æ”¾åœ¨ a ä¸­</span></span><br><span class="line">            s[r] ^= s[l];  <span class="comment">//å°† a ^ b è¿™ä¸€ç»“æœå† ^ b ï¼Œå­˜å…¥bä¸­ï¼Œæ­¤æ—¶ b = a, a = a ^ b</span></span><br><span class="line">            s[l] ^= s[r];  <span class="comment">//a ^ b çš„ç»“æœå† ^ a ï¼Œå­˜å…¥ a ä¸­ï¼Œæ­¤æ—¶ b = a, a = b å®Œæˆäº¤æ¢</span></span><br><span class="line">            l++;</span><br><span class="line">            r--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬äºŒç§æ–¹æ³•ç”¨tempæ¥äº¤æ¢æ•°å€¼æ›´å¤šäººå®¹æ˜“ç†è§£äº›</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reverseString</span><span class="params">(<span class="type">char</span>[] s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> s.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(l &lt; r)&#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">temp</span> <span class="operator">=</span> s[l];</span><br><span class="line">            s[l] = s[r];</span><br><span class="line">            s[r] = temp;</span><br><span class="line">            l++;</span><br><span class="line">            r--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ï¼šO(n)</li>
<li>ç©ºé—´å¤æ‚åº¦ï¼šO(1)</li>
</ul>
<h2 id="åè½¬å­—ç¬¦ä¸²â…¡">åè½¬å­—ç¬¦ä¸²â…¡</h2>
<blockquote>
<p><a href="https://leetcode.cn/problems/reverse-string-ii/">åŠ›æ‰£é¢˜ç›®é“¾æ¥(opens new window)</a></p>
<p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² s å’Œä¸€ä¸ªæ•´æ•° kï¼Œä»å­—ç¬¦ä¸²å¼€å¤´ç®—èµ·, æ¯è®¡æ•°è‡³ 2k ä¸ªå­—ç¬¦ï¼Œå°±åè½¬è¿™ 2k ä¸ªå­—ç¬¦ä¸­çš„å‰ k ä¸ªå­—ç¬¦ã€‚</p>
<p>å¦‚æœå‰©ä½™å­—ç¬¦å°‘äº k ä¸ªï¼Œåˆ™å°†å‰©ä½™å­—ç¬¦å…¨éƒ¨åè½¬ã€‚</p>
<p>å¦‚æœå‰©ä½™å­—ç¬¦å°äº 2k ä½†å¤§äºæˆ–ç­‰äº k ä¸ªï¼Œåˆ™åè½¬å‰ k ä¸ªå­—ç¬¦ï¼Œå…¶ä½™å­—ç¬¦ä¿æŒåŸæ ·ã€‚</p>
<p>ç¤ºä¾‹:</p>
<p>è¾“å…¥: s = â€œabcdefgâ€, k = 2<br>
è¾“å‡º: â€œbacdfegâ€</p>
</blockquote>
<p><strong>æ€è·¯</strong>ï¼š</p>
<p>æ¨¡æ‹Ÿï¼Œå®ç°é¢˜ç›®ä¸­çš„åè½¬è§„åˆ™ã€‚</p>
<p>åœ¨éå†å­—ç¬¦ä¸²çš„è¿‡ç¨‹ä¸­ï¼Œåªè¦è®© i += (2 * k)ï¼Œi æ¯æ¬¡ç§»åŠ¨ 2 * k å°±å¯ä»¥äº†ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦éœ€è¦æœ‰åè½¬çš„åŒºé—´ã€‚</p>
<p>å› ä¸ºè¦æ‰¾çš„ä¹Ÿå°±æ˜¯æ¯2 * k åŒºé—´çš„èµ·ç‚¹ï¼Œè¿™æ ·å†™ï¼Œç¨‹åºä¼šé«˜æ•ˆå¾ˆå¤šã€‚</p>
<p><strong>æ‰€ä»¥å½“éœ€è¦å›ºå®šè§„å¾‹ä¸€æ®µä¸€æ®µå»å¤„ç†å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œè¦æƒ³æƒ³åœ¨åœ¨forå¾ªç¯çš„è¡¨è¾¾å¼ä¸Šåšåšæ–‡ç« ã€‚</strong></p>
<p><strong>ä»£ç </strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è§£æ³•ä¸€</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">reverseStr</span><span class="params">(String s, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="type">StringBuffer</span> <span class="variable">res</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (start &lt; length) &#123;</span><br><span class="line">            <span class="comment">// æ‰¾åˆ°kå¤„å’Œ2kå¤„</span></span><br><span class="line">            <span class="type">StringBuffer</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">            <span class="comment">// ä¸lengthè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœå¤§äºlengthäº†ï¼Œé‚£å°±å°†å…¶ç½®ä¸ºlength</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">firstK</span> <span class="operator">=</span> (start + k &gt; length) ? length : start + k;</span><br><span class="line">            <span class="type">int</span> <span class="variable">secondK</span> <span class="operator">=</span> (start + (<span class="number">2</span> * k) &gt; length) ? length : start + (<span class="number">2</span> * k);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æ— è®ºstartæ‰€å¤„ä½ç½®ï¼Œè‡³å°‘ä¼šåè½¬ä¸€æ¬¡</span></span><br><span class="line">            temp.append(s.substring(start, firstK));</span><br><span class="line">            res.append(temp.reverse());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¦‚æœfirstKåˆ°secondKä¹‹é—´æœ‰å…ƒç´ ï¼Œè¿™äº›å…ƒç´ ç›´æ¥æ”¾å…¥resé‡Œå³å¯ã€‚</span></span><br><span class="line">            <span class="keyword">if</span> (firstK &lt; secondK) &#123; <span class="comment">//æ­¤æ—¶å‰©ä½™é•¿åº¦ä¸€å®šå¤§äºkã€‚</span></span><br><span class="line">                res.append(s.substring(firstK, secondK));</span><br><span class="line">            &#125;</span><br><span class="line">            start += (<span class="number">2</span> * k);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è§£æ³•äºŒï¼ˆä¼¼ä¹æ›´å®¹æ˜“ç†è§£ç‚¹ï¼‰</span></span><br><span class="line"><span class="comment">//é¢˜ç›®çš„æ„æ€å…¶å®æ¦‚æ‹¬ä¸º æ¯éš”2kä¸ªåè½¬å‰kä¸ªï¼Œå°¾æ•°ä¸å¤Ÿkä¸ªæ—¶å€™å…¨éƒ¨åè½¬</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">reverseStr</span><span class="params">(String s, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="type">char</span>[] ch = s.toCharArray();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; ch.length; i += <span class="number">2</span> * k)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="comment">//è¿™é‡Œæ˜¯åˆ¤æ–­å°¾æ•°å¤Ÿä¸å¤Ÿkä¸ªæ¥å–å†³endæŒ‡é’ˆçš„ä½ç½®</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> Math.min(ch.length - <span class="number">1</span>, start + k - <span class="number">1</span>);</span><br><span class="line">            <span class="comment">//ç”¨å¼‚æˆ–è¿ç®—åè½¬ </span></span><br><span class="line">            <span class="keyword">while</span>(start &lt; end)&#123;</span><br><span class="line">                ch[start] ^= ch[end];</span><br><span class="line">                ch[end] ^= ch[start];</span><br><span class="line">                ch[start] ^= ch[end];</span><br><span class="line">                start++;</span><br><span class="line">                end--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(ch);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£æ³•äºŒè¿˜å¯ä»¥ç”¨tempæ¥äº¤æ¢æ•°å€¼ï¼Œä¼šçš„äººæ›´å¤šäº›</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">reverseStr</span><span class="params">(String s, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="type">char</span>[] ch = s.toCharArray();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i &lt; ch.length;i += <span class="number">2</span> * k)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="comment">// åˆ¤æ–­å°¾æ•°å¤Ÿä¸å¤Ÿkä¸ªæ¥å–å†³endæŒ‡é’ˆçš„ä½ç½®</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> Math.min(ch.length - <span class="number">1</span>,start + k - <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">while</span>(start &lt; end)&#123;</span><br><span class="line">                </span><br><span class="line">                <span class="type">char</span> <span class="variable">temp</span> <span class="operator">=</span> ch[start];</span><br><span class="line">                ch[start] = ch[end];</span><br><span class="line">                ch[end] = temp;</span><br><span class="line"></span><br><span class="line">                start++;</span><br><span class="line">                end--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(ch);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£æ³•3</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">reverseStr</span><span class="params">(String s, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="type">char</span>[] ch = s.toCharArray();</span><br><span class="line">        <span class="comment">// 1. æ¯éš” 2k ä¸ªå­—ç¬¦çš„å‰ k ä¸ªå­—ç¬¦è¿›è¡Œåè½¬</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i&lt; ch.length; i += <span class="number">2</span> * k) &#123;</span><br><span class="line">            <span class="comment">// 2. å‰©ä½™å­—ç¬¦å°äº 2k ä½†å¤§äºæˆ–ç­‰äº k ä¸ªï¼Œåˆ™åè½¬å‰ k ä¸ªå­—ç¬¦</span></span><br><span class="line">            <span class="keyword">if</span> (i + k &lt;= ch.length) &#123;</span><br><span class="line">                reverse(ch, i, i + k -<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 3. å‰©ä½™å­—ç¬¦å°‘äº k ä¸ªï¼Œåˆ™å°†å‰©ä½™å­—ç¬¦å…¨éƒ¨åè½¬</span></span><br><span class="line">            reverse(ch, i, ch.length - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>  <span class="keyword">new</span> <span class="title class_">String</span>(ch);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å®šä¹‰ç¿»è½¬å‡½æ•°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reverse</span><span class="params">(<span class="type">char</span>[] ch, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (; i &lt; j; i++, j--) &#123;</span><br><span class="line">        <span class="type">char</span> <span class="variable">temp</span>  <span class="operator">=</span> ch[i];</span><br><span class="line">        ch[i] = ch[j];</span><br><span class="line">        ch[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ›¿æ¢ç©ºæ ¼">æ›¿æ¢ç©ºæ ¼</h2>
<h2 id="ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯">ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯</h2>
<h2 id="å·¦æ—‹è½¬å­—ç¬¦ä¸²">å·¦æ—‹è½¬å­—ç¬¦ä¸²</h2>
<h2 id="å®ç°-strStr">å®ç° strStr()</h2>
<h2 id="é‡å¤çš„å­å­—ç¬¦ä¸²">é‡å¤çš„å­å­—ç¬¦ä¸²</h2>
<h2 id="å°ç»“">å°ç»“</h2>
]]></content>
      <categories>
        <category>Coding</category>
        <category>ä»£ç éšæƒ³å½•</category>
      </categories>
      <tags>
        <tag>åˆ·é¢˜ç¬”è®°</tag>
        <tag>ä»£ç éšæƒ³å½•</tag>
      </tags>
  </entry>
  <entry>
    <title>æºç¨‹ç¬”è¯•è®°å½•</title>
    <url>/post/6f158289.html</url>
    <content><![CDATA[<h2 id="9-21-æºç¨‹ç¬”è¯•ï¼ˆç¬¬äºŒæ‰¹ï¼‰è®°å½•">9.21 æºç¨‹ç¬”è¯•ï¼ˆç¬¬äºŒæ‰¹ï¼‰è®°å½•</h2>
<h3 id="ç¬¬ä¸€é¢˜ï¼šæ’åˆ—æ„é€ ">ç¬¬ä¸€é¢˜ï¼šæ’åˆ—æ„é€ </h3>
<p>é¢˜ç›®æè¿°ï¼š</p>
<p>é•¿åº¦ä¸º a çš„é˜Ÿåˆ—ï¼Œæ„é€ é•¿åº¦ç›¸åŒçš„æ’åˆ— bï¼Œè¦æ±‚b<sub>i</sub>â‰ a<sub>i</sub>ï¼Œä¸”bçš„å­—å…¸åºå°½å¯èƒ½å°ã€‚</p>
<p>æ’åˆ—â€”â€”é•¿ä¸º n çš„æ•°ç»„ï¼Œ1åˆ°næ¯ä¸ªæ­£æ•´æ•°éƒ½åªå‡ºç°äº†ä¸€æ¬¡ã€‚</p>
<p>å­—å…¸åºâ€”â€”ç¬¬ä¸€ä¸ªä¸ç›¸ç­‰çš„å…ƒç´ å°çš„é‚£ä¸ªæ’åˆ—çš„å­—å…¸åºæ›´å°ã€‚</p>
<p>è¾“å…¥è¾“å‡ºï¼šç¬¬ä¸€è¡Œè¾“å…¥ n ä»£è¡¨ a çš„é•¿åº¦ï¼›ç¬¬äºŒè¡Œè¾“å…¥ n ä¸ªæ•°ä»£è¡¨a<sub>i</sub>ã€‚2â‰¤nâ‰¤10^5ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<p>3</p>
<p>1 2 3</p>
<p>è¾“å‡ºï¼š3 1 2</p>
<p>é¢˜è§£ï¼š</p>
<h3 id="ç¬¬äºŒé¢˜ï¼šå­—ç¬¦ä¸²-s-è½¬å˜æˆå­—ç¬¦ä¸²-t">ç¬¬äºŒé¢˜ï¼šå­—ç¬¦ä¸² s è½¬å˜æˆå­—ç¬¦ä¸² t</h3>
<p>é¢˜ç›®æè¿°ï¼šå­—ç¬¦ä¸² s è½¬å˜æˆå­—ç¬¦ä¸² tã€‚å–å­—ç¬¦ ch1, ch2ï¼ˆch2å¯ä¸åœ¨ä¸²sä¸­ï¼‰ï¼Œå°†sä¸­çš„ch1å˜æˆch2ã€‚ç”¨æ­¤æ“ä½œå°†å­—ç¬¦ä¸² s è½¬å˜æˆå­—ç¬¦ä¸² tã€‚è‹¥ç»è¿‡qæ¬¡æ“ä½œï¼Œå¯è¡Œåˆ™è¾“å‡ºyes å¦åˆ™è¾“å‡ºnoã€‚</p>
<p>è¾“å…¥è¾“å‡ºï¼šs t å‡ä¸ºå°å†™å­—æ¯ç»„æˆçš„ä¸²ï¼Œé•¿åº¦ç›¸åŒï¼Œâ‰¤10^4ã€‚è¾“å…¥ qï¼Œä»£è¡¨æ“ä½œæ¬¡æ•°ï¼›æ¥ä¸‹æ¥ä¸¤è¡Œè¾“å…¥ä¸²så’Œä¸²tã€‚1â‰¤qâ‰¤10</p>
<p>ç¤ºä¾‹ï¼š</p>
<p>3</p>
<p>ab</p>
<p>ba</p>
<p>abc</p>
<p>aaa</p>
<p>aaaa</p>
<p>abcd</p>
<p>è¾“å‡ºï¼šyes yes noï¼ˆä¸‰è¡Œï¼Œæ¯è¡Œä¸€ä¸ªï¼‰</p>
<p>é¢˜è§£ï¼š</p>
<h3 id="ç¬¬ä¸‰é¢˜ï¼šå­—æ¯çŸ©é˜µ">ç¬¬ä¸‰é¢˜ï¼šå­—æ¯çŸ©é˜µ</h3>
<p>é¢˜ç›®æè¿°ï¼šä¸€ä¸ªnè¡Œmåˆ—çš„å…¨å°å†™å­—æ¯çŸ©é˜µï¼Œæ±‚æ‰€æœ‰æ»¡è¶³æ¯ä¸ªå­—æ¯åªå‡ºç°ä¸€æ¬¡çš„å­çŸ©é˜µä¸ªæ•°ã€‚</p>
<p>è¾“å…¥è¾“å‡ºï¼šé¦–è¡Œè¾“å…¥ä¸¤ä¸ªæ­£æ•´æ•°n mï¼›æ¥ä¸‹æ¥n è¡Œè¾“å…¥æ¯è¡Œé•¿åº¦ä¸ºmçš„ä¸²ã€‚1â‰¤n,mâ‰¤500ã€‚è¾“å‡ºï¼Œæ•°é‡numberã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<p>2 3</p>
<p>aad</p>
<p>abc</p>
<p>è¾“å‡ºï¼š13</p>
<p>é¢˜è§£ï¼š</p>
<h3 id="ç¬¬å››é¢˜ï¼šä½æ•°ä¿®æ”¹">ç¬¬å››é¢˜ï¼šä½æ•°ä¿®æ”¹</h3>
<p>é¢˜ç›®æè¿°ï¼šå¯¹ä¸€ä¸ªæ­£æ•´æ•°ï¼Œä¿®æ”¹å…¶kä½ï¼Œä½¿å…¶å˜æˆ75çš„å€æ•°ï¼Œæ±‚æ‰€æœ‰çš„ä¿®æ”¹æ–¹æ¡ˆæ•°é‡ã€‚ï¼ˆä¿®æ”¹åä¸ºæ­£æ•´æ•°ï¼Œæ— å‰å¯¼é›¶ï¼Œç­”æ¡ˆå¯¹10^9+7å–æ¨¡ã€‚ï¼‰</p>
<p>è¾“å…¥è¾“å‡ºï¼šé¦–è¡Œè¾“å…¥æ•´æ•°nï¼Œç¬¬äºŒè¡Œè¾“å…¥ä½æ•°kã€‚1â‰¤nâ‰¤10^1000, 1â‰¤kâ‰¤1000</p>
<p>ç¤ºä¾‹ï¼š</p>
<p>355</p>
<p>2</p>
<p>è¾“å‡ºï¼š9ï¼ˆåˆ†åˆ«æ˜¯150,225,300,450,525,675,750,825,975ï¼‰</p>
<p>é¢˜è§£ï¼š</p>
]]></content>
      <categories>
        <category>Coding</category>
      </categories>
      <tags>
        <tag>è®°å½•</tag>
      </tags>
  </entry>
  <entry>
    <title>ç‚¹è§¦ç§‘æŠ€ç¬”è¯•è®°å½•</title>
    <url>/post/250e7dfe.html</url>
    <content><![CDATA[<h2 id="ä¸€ï¼šç®—æ³•ï¼ŒèƒŒåŒ…é—®é¢˜">ä¸€ï¼šç®—æ³•ï¼ŒèƒŒåŒ…é—®é¢˜</h2>
<p>æè¿°ï¼šåœ¨nä¸ªç‰©å“ä¸­æŒ‘é€‰è‹¥å¹²ç‰©å“è£…å…¥èƒŒåŒ…ï¼Œæœ€å¤šèƒ½è£…å¤šæ»¡ï¼Ÿå‡è®¾èƒŒåŒ…çš„å¤§å°ä¸ºmï¼Œæ¯ä¸ªç‰©å“çš„å¤§å°ä¸ºAiï¼ˆiä¸ºnä¸ªç‰©å“çš„é¡ºåºä¸‹æ ‡ï¼‰ï¼Œæ¯ä¸ªç‰©å“åªèƒ½é€‰æ‹©ä¸€æ¬¡ä¸”ç‰©å“å¤§å°å‡ä¸ºæ­£æ•´æ•°ã€‚</p>
<p>é¢˜è§£ï¼š</p>
<p>public class Solution {<br>
/**<br>
* @param m: An integer m denotes the size of a backpack<br>
* @param A: Given n items with size A[i]<br>
* @return: The maximum size<br>
*/<br>
public int backPack(int m, int[] A) {<br>
// write your code here<br>
int num=A.length;<br>
int[][] dp=new int[num+1][m+1];<br>
for(int i=0;i&lt;=m;i++){<br>
dp[0][i]=0;<br>
}<br>
for(int j=0;j&lt;=num;j++){<br>
dp[j][0]=0;<br>
}<br>
for(int i=1;i&lt;=num;i++){<br>
for(int j=1;j&lt;=m;j++){<br>
if(A[i-1]&lt;=j){<br>
if(dp[i-1][j]&lt;dp[i-1][j-A[i-1]]+A[i-1]){<br>
dp[i][j]=dp[i-1][j-A[i-1]]+A[i-1];<br>
}else{<br>
dp[i][j]=dp[i-1][j];<br>
}<br>
}else{<br>
dp[i][j]=dp[i-1][j];<br>
}<br>
}<br>
}<br>
return dp[num][m];<br>
}<br>
}</p>
<h2 id="äºŒï¼šåœºæ™¯ï¼Œæ’è¡Œæ¦œè®¾è®¡">äºŒï¼šåœºæ™¯ï¼Œæ’è¡Œæ¦œè®¾è®¡</h2>
<p>æè¿°ï¼š</p>
<p>é¢˜è§£ï¼š</p>
<h2 id="ä¸‰ï¼šè®¾è®¡æ¨¡å¼ï¼Œå·¥å‚æ¨¡å¼">ä¸‰ï¼šè®¾è®¡æ¨¡å¼ï¼Œå·¥å‚æ¨¡å¼</h2>
<p>æè¿°ï¼šæ¯”è¨åˆ¶é€ è¿‡ç¨‹ä¸º<strong>å‡†å¤‡ã€çƒ˜çƒ¤ã€åˆ‡ç‰‡ã€è£…ç›’</strong>ï¼Œå‡è®¾æœ‰ä¸€ä¸ªæ¯”è¨åº—ï¼Œæ¯”è¨åº—èƒ½åˆ¶é€ <strong>å¦é—¨å’Œæ·±åœ³</strong>ä¸¤ç§é£æ ¼<br>
çš„æ¯”è¨ï¼Œæ¯ç§é£æ ¼æ¯”è¨åˆåˆ†<strong>èŠå£«ã€ç´ é£Ÿã€è›¤èœŠã€é¦™è‚ </strong>å››ç§ç±»å‹ï¼Œä¸åŒé£æ ¼åŒç§ç±»å‹çš„æ¯”è¨ä¹Ÿä¸ç›¸åŒï¼Œç”¨åˆé€‚çš„<strong>è®¾è®¡æ¨¡å¼</strong>å®ç°è¿™æ ·çš„æ¯”è¨åº—ç›¸å…³åŠŸèƒ½ç±»ã€‚</p>
<p>é¢˜è§£ï¼š</p>
<h2 id="å››ï¼šJSåˆ†è§£statementå‡½æ•°ï¼Œä»å‡½æ•°ä¸­åˆ†ç¦»å‡ºä¸åŒçš„å…³æ³¨ç‚¹">å››ï¼šJSåˆ†è§£statementå‡½æ•°ï¼Œä»å‡½æ•°ä¸­åˆ†ç¦»å‡ºä¸åŒçš„å…³æ³¨ç‚¹</h2>
<p>æè¿°ï¼š</p>
<p>é¢˜è§£ï¼š</p>
<h2 id="äº”ï¼šç¼–ç¨‹">äº”ï¼šç¼–ç¨‹</h2>
<p>æè¿°ï¼šæœ‰nç¯‡è‹±æ–‡æ–‡ç« ï¼Œç¼–ç¨‹å®ç°è®¡ç®—å‡ºæ¯ç¯‡æ–‡ç« çš„ä¸»é¢˜ã€‚</p>
<p>è§£ç­”ï¼š</p>
]]></content>
      <categories>
        <category>Coding</category>
      </categories>
      <tags>
        <tag>è®°å½•</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¦»äºº</title>
    <url>/post/14e24de8.html</url>
    <content><![CDATA[<h2 id="1">1</h2>
<p>ä¸æ‡‚äº‹çš„è€å°å­©ï¼Œå®¶é‡Œäººéƒ½ä¸å…³æ³¨çš„ç¬¨è›‹ï¼Œå¿˜äº†ç»™è‡ªå®¶å­™å­ä¸Šæˆ·å£çš„ç”Ÿäº§é˜Ÿé˜Ÿé•¿ï¼Œæ‹¿è‡ªå·±å„¿å­åå­—è´·æ¬¾ç»™é˜Ÿé‡Œçš„å·¥ç¨‹çš„è€ä¸ä¿®ï¼Œâ€œäººç©·æ°´éƒ½ç©·â€è¿ä¸ªå­™å¨ƒå­éƒ½æ”¶æ‹¾ä¸å¹²å‡€çš„è€å¤´â€”â€”ä»¥ä¸Šï¼Œå°±æ˜¯å¤šå¹´ä»¥åè¿˜ç•™åœ¨æˆ‘è„‘æµ·ä¸­å…³äºçˆ·çˆ·çš„å…¨éƒ¨å°è±¡äº†ã€‚</p>
<p>è¿˜è®°å¾—é‚£ä¸ªä¸‰å¹´çº§çš„åˆåï¼Œå¤–å©†æ¥å­¦æ ¡æ¥æˆ‘ï¼Œè¯´å¸¦æˆ‘å»çœ‹çˆ·çˆ·ï¼Œæˆ‘æ‡µæ‡µæ‡‚æ‡‚åœ°è·Ÿç€å»äº†ï¼Œçœ‹å®Œäº†ï¼Œæ‡µæ‡µæ‡‚æ‡‚åœ°èµ°äº†ï¼Œå“¦ï¼ŒåŸæ¥æ˜¯çˆ·çˆ·å¸®äººæ’ç§§çš„æ—¶å€™æ™•å€’äº†ï¼Œæ²¡æŠ¢æ•‘å›æ¥ï¼Œäºæ˜¯ï¼Œæˆ‘å¾ˆè‡ªç„¶çš„æ¥å—äº†è¿™æ ·ä¸€ä¸ªäº‹å®â€”â€”çˆ·çˆ·æ­»äº†ï¼Œé‚£ä¸ªç¼–äº†ä¸€å¤©çš„ç«¹ç¯¾æ‹¿å»æ¢ç‚¹é’±ç»™å°å­™å­ä¹°é¥®æ–™çš„è€å¤´æ­»äº†ã€‚</p>
<p>å› ä¸ºå®¶åº­çš„åŸå› ï¼Œæˆ‘ä»å¾ˆå°çš„æ—¶å€™å°±ä¸€ç›´æ˜¯è·Ÿç€å¤–å…¬å¤–å©†å®¶ä¸€èµ·ç”Ÿæ´»çš„ï¼Œå¯¹äºè¿™ä¸ªçˆ·çˆ·ï¼Œäº†è§£ä¹Ÿå°±ååˆ†æœ‰é™ã€‚å€’ä¸å¦‚è¯´ï¼Œå…³äºä»–çš„å¾ˆå¤šäº‹ï¼Œå¾ˆå¤šå°è±¡ï¼Œå…¨æ˜¯ä»å¤–å…¬å¤–å©†å’Œçˆ¸å¦ˆå£ä¸­å¬æ¥ï¼Œæœ€åè‡ªè¡Œæ‹¼æ¥è€Œæˆçš„ã€‚æ¯é€¢è¿‡å¹´ï¼Œéƒ½æ˜¯å¿…é¡»è¦è¦å»ä¸ŠåŸçš„ï¼Œåœ¨è¿™ä¸ªæ—¶å€™ï¼Œå¬ä¸€å¬çˆ¸å¦ˆè®²è®²ä»–è¿‡å»çš„äº‹ï¼Œå¬ä¸€å¬çˆ¸å¦ˆç»™ä»–è®²ä»–èµ°ä¹‹åä»–å„¿å­™çš„äº‹ï¼Œå†ç¥ˆæ„¿è€äººå®¶åœ¨å¤©ä¹‹çµç»™ç°ä¸–çš„äººä¿ä½‘ï¼Œåœ¨é¦™èœ¡é’±çº¸ç‡ƒçƒ§çš„ç«å…‰ä¸­ã€åœ¨å™¼é‡Œå•ªå•¦çš„é­ç‚®å£°ä¸­ï¼Œä»£é™…é—´çš„ä¼ æ‰¿å°±å°±ä»¥è¿™æ ·çš„å½¢å¼å®Œæˆäº†ã€‚</p>
<h2 id="2">2</h2>
<p>å¹´é¾„å’Œè„¾æ°”ä¹‹é—´è‚¯å®šæ˜¯æœ‰ä¸€å®šå…³ç³»çš„ï¼Œæ— ä»–ï¼Œä»æˆ‘è‡ªå·±çš„ç»éªŒæ¥çœ‹å°±æ˜¯è¿™æ ·ï¼Œä»æˆ‘èº«è¾¹çš„äººå˜åŒ–æ¥çœ‹ä¹Ÿæ˜¯è¿™æ ·ã€‚</p>
<p>å°å­¦çš„æ—¶å€™å§ï¼Œæˆ‘çš„é‚»å±…å®¶æœ‰ä¸ªå¹´é¾„å¾ˆå¤§çš„è€å¤ªå¤ªï¼Œå¥¹å®¶å…»äº†ä¸€æ¡è€æ¯ç‹—ï¼Œå¾ˆå‡¶ï¼ŒçœŸçš„å¾ˆå‡¶ï¼Œæ¯å¤©æˆ‘å»ä¸Šå­¦ä»ä»–å®¶é—¨å£ç»è¿‡éƒ½å¿ƒæƒŠè‚‰è·³ï¼Œèµ°çš„æ¬¡æ•°å¤šäº†ï¼Œæœ€åè¿˜æ˜¯æ²¡èº²è¿‡è¢«å’¬äº†ä¸€å›ï¼Œå› æ­¤ï¼Œæˆ‘å¯¹è€å¤ªå¤ªå°è±¡ä¹Ÿéå¸¸ä¸å¥½ã€‚</p>
<p>é‚£ä¸€å¹´ï¼Œè€å¤ªå¤ªå®¶çš„æ‡æ·æ ‘ç»“æœäº†ï¼Œå¾ˆå¤šå¾ˆå¤§ï¼Œæˆ‘å¾ˆé¦‹ï¼Œé¦‹ä½†æ˜¯ä¸æ•¢ã€‚åæ¥ï¼Œè€å¤ªå¤ªå«æˆ‘è‡ªå·±ä¸Šæ ‘å»æ‘˜å°±æ˜¯äº†ï¼Œå°å­©å­å“ªèƒ½å—å¾—äº†é¼“åŠ±ï¼Œååœ¨æ ‘ä¸Šå°±å¼€å§‹ä¸€é¡¿åƒã€‚å¤–å…¬åˆšå¹²å®Œæ´»å›æ¥ï¼Œè§æˆ‘ååœ¨é‚»å±…å®¶çš„æ‡æ·æ ‘ä¸Šå¤§åƒï¼Œå¾ˆç”Ÿæ°”åœ°å«æˆ‘ä¸‹æ¥ï¼Œæˆ‘æ²¡ç†ä»–ï¼Œæ²¡æƒ³åˆ°ç«Ÿç„¶æ‰”å°çŸ³å­è¿‡æ¥ï¼Œäºæ˜¯ï¼Œæˆ‘å¤§å“­ç€å›å®¶äº†ã€‚å¤–å©†å›æ¥ï¼ŒçŸ¥é“äº†æƒ…å†µï¼ŒæŠ„èµ·äºŒæŒ‡å®½çš„ç¯¾æ¡å°±æœå¤–å…¬èº«ä¸Šæ‰“å»ï¼Œä¸€è¾¹æ‰“ä¸€ééª‚ï¼Œâ€œå“ªæœ‰ä½ è¿™æ ·æ•™è‚²å¨ƒå¨ƒçš„ï¼Œé‚£æ˜¯æ‹¿çŸ³å¤´æ‰“çš„å—ï¼Œä¸æ™“å¾—è½»é‡ï¼Œä½ çœ‹æˆ‘ä»Šå¤©æ‰“ä¸æ‰“å¾—ä½ å¥½çœ‹â€ã€‚</p>
<p>æš´èºï¼Œä¸çŸ¥è½»é‡ï¼Œå¤§æ¦‚å°±æ˜¯é‚£æ—¶å€™å¤–å…¬çš„è„¾æ°”äº†ã€‚</p>
<p>ä¸Šé«˜ä¸­äº†ï¼Œæˆ‘è¿æ°”å¥½ï¼Œåœ¨åŒå­¦çš„æ¨èä¸‹å¾—åˆ°äº†å¸‚é«˜ä¸­çš„é’çï¼Œåˆ†æ•°ä¸Šçº¿å°±è¦ï¼Œå…å­¦æ‚è´¹ã€‚å½“æ—¶ä¹Ÿæ²¡æœ‰æœˆå‡ä¸€è¯´ï¼Œæ³•å®šå‡æœŸä¸­æ—¶é—´é•¿ç‚¹çš„æ‰èƒ½å›å®¶ï¼Œäºæ˜¯ï¼Œå›å®¶çš„æ¬¡æ•°å°±è¿™æ ·å˜å°‘äº†ã€‚å¥‡æ€ªçš„æ˜¯ï¼Œæˆ‘è·Ÿå¤–å…¬è¿™ä¸ªè€å¤´çš„å…³ç³»å€’æ˜¯è«åå…¶å¦™å¥½äº†å¾ˆå¤šï¼Œå¥½åƒå‡ å¤©ä¸è§è¿™ä¸ªäººå°±è¤ªå»äº†å¾€æ—¥çš„æš´èºï¼Œè½¬èº«æ‹¥æŠ±äº†ç›¸åçš„å¹³å’Œã€‚å®¶é‡Œçš„æ‰“ç±³æœºä¸å¥½ç”¨äº†ï¼Œä¸€çœ‹æ˜¯ç­›å­åäº†ï¼Œè¡Œï¼Œä½ å°å­å»è¡—ä¸Šä¹°ä¸€å¼ å›æ¥å§ï¼›ä»Šå¤©è¦æŠ½æ°´å»çŒé‚£ç‰‡èŠ±ç”Ÿåœ°ï¼Œèµ°å§ï¼Œå’±çˆ·ä¿©ä¸€å—æŠŠæ°´ç®¡å’Œæ°´æ³µæ‰›è¿‡å»ï¼›è¯»äº†å‡ å¤©ä¹¦æ‰‹è„šä¹Ÿæ²¡å˜æ…¢å˜›ï¼Œè¿˜é˜”ä»¥ï¼Œä»Šå¤©å°±æŠŠè¿™ç‰‡è°·å­æ‰“å®Œäº†ï¼›â€œäººæ°‘æ¸ å˜›ï¼Œè¿˜æ˜¯æˆ‘åˆ‡ä¿®çš„ï¼Œå½“æ—¶æ¯›è€æ±‰â€¦â€¦â€ï¼›â€œå—¯ï¼Œä¸œè¥¿æ‹¿é½æ²¡å¾—ï¼Œæ­¦æ±‰ä¹Ÿæ²¡å¾—å¥½è¿œå˜›ï¼Œå½“å¹´æˆ‘ä¹Ÿæ˜¯åˆ‡è¿‡é‚£è¾¹äº†ï¼Œä½ åˆ‡äº†å¥½ç”Ÿå­¦ä¹ å“ˆï¼Œä¸Šå¤§å­¦äº†ä¹Ÿä¸æ˜¯ç»™ä½ æ”¾æ¾çš„ï¼Œå—¯ï¼Œå±‹å¤´æˆ‘æ™“å¾—ï¼Œä½ èµ°å˜›â€â€¦â€¦</p>
<p>å¹³å’Œï¼Œå®é™ï¼Œåƒä¸€å›è€é…’ï¼Œè¿™æ˜¯é‚£æ—¶å€™å¤–å…¬çš„è„¾æ°”ã€‚</p>
<h2 id="3">3</h2>
<p>ä¸€æ™ƒåˆæ˜¯å‡ å¹´ï¼Œå¥½ä¼¼æˆ‘ä»æœªè®¤çœŸçœ‹è¿‡å¤–å…¬è¿™ä¸ªè€å¤´ä¸€æ ·ï¼Œä»–æ€ä¹ˆä¸€ä¸‹å­è¿™ä¹ˆç˜¦å¼±äº†ï¼Œå¼¯è…°é©¼èƒŒçš„äº†ï¼Œçœ¼ç¥æ²¡æœ‰å¾€æ—¥çš„çŠ€åˆ©ï¼Œå˜´è§’å´å«ç€ä¼¼æœ‰è‹¥æ— çš„ç¬‘æ„ï¼Œåƒæ‘é‡Œé‚£å£è€äº•ï¼Œè®°å½•äº†ä¸€åˆ‡ä½†æ˜¯åˆå°†å…¶æ·±æ·±åŸ‹åœ¨æ°´åº•ï¼Œå‡ æ— äººå¯è§¦è¾¾ã€‚</p>
<p>å‰ä¸ä¹…çˆ¸æ‰“ç”µè¯ç»™æˆ‘ï¼Œå‘Šè¯‰æˆ‘å¤–å…¬ç¡®è¯Šäº†èƒƒç™Œï¼Œå«æˆ‘ç»™å®¶é‡Œæ‰“ä¸ªç”µè¯å¥½æ­¹é—®ä¸€ä¸‹ï¼Œä½†æ˜¯æˆ‘ä¸€ç›´ä¸æ•¢å¾€å®¶é‡Œæ‰“ç”µè¯ï¼Œæˆ‘åœ¨å®³æ€•ï¼Œåœ¨é€ƒé¿ï¼Œå®³æ€•è‡ªå·±è¾œè´Ÿä»–ä»¬çš„æœŸå¾…ï¼Œå®³æ€•çœ‹è§ä»–ä»¬çš„çœ¼ç¥ï¼Œå®³æ€•å¬è§ä»–ä»¬çš„å£°éŸ³ï¼Œæˆ‘åœ¨é€ƒé¿è‡ªå·±çš„è´£ä»»ï¼Œä½†æ˜¯æˆ‘åˆè¿˜èƒ½å†èº²å¤šä¹…å‘¢ï¼Ÿ</p>
<p>æ›¾ç»æˆ‘å¯¹çš®åŒ…éª¨å¤´è¿™ä¸ªè¯çš„å°è±¡åªåœç•™åœ¨å­—å…¸é‡Œï¼Œç›´åˆ°æˆ‘å†è§åˆ°æˆ‘çš„å¤–å…¬ï¼Œé‚£æ˜¯æ€æ ·çš„ä¸€å‰¯å…‰æ™¯ï¼Ÿæ›¾ç»åŠ›æ‹…åƒæ–¤çš„è‚Œè‚‰å†æ²¡æœ‰ä¸€ä¸ä¸€æ¯«ç•™å­˜åœ¨è¿™ä¸ªè€äººèº«ä¸Šï¼Œè‚‹éª¨å‹¾å‹’å‡ºçš„èƒ¸è†›å°±è¿™æ ·æ¯«æ— é®æ©åœ°å±•ç°ç€ï¼ŒåŒå¼¯æ›²çš„è„Šæ¢éª¨ä¸€èµ·ç‹°ç‹åœ°å±•ç¤ºç€æ—¶é—´çš„ä¼ŸåŠ›ï¼Œå±•ç¤ºç€â€œç—…â€è¿™ä¸€äººä¸–é—´å¤§è‹¦æ¥šçš„å¨åŠ›ï¼Œçœ‰å¤´è½»è¹™çš„æ ·å­åƒæ˜¯åœ¨å¿å—ç€æ— æ—¶æ— åˆ»ä¸åœ¨çš„ç—›æ¥šï¼Œæˆ‘ç®€ç›´ä¸å¿å†çœ‹ã€‚é¢å¯¹ç€è¿™ä¸€åˆ‡ï¼Œæˆ‘æ— è¯å¯è¯´ï¼Œæˆ‘æ— èƒ½ä¸ºåŠ›ï¼Œä¸–ä¸Šéš¾é“è¿˜æœ‰ä»€ä¹ˆä¸œè¥¿èƒ½å†æ¢å›è¿™ä¸ªè€äººçš„æ—¶å…‰å—ï¼Ÿ</p>
<p>æ ‘æ¬²é™è€Œé£ä¸æ­¢ï¼Œå­æ¬²å…»è€Œäº²ä¸å¾…ã€‚åˆé—»ä¸è¯†æ›²ä¸­æ„ï¼Œå†å¬å·²æ˜¯æ›²ä¸­äººã€‚ç½¢ï¼Œçæƒœçœ¼å‰äººå§ã€‚</p>
<h2 id="end">end</h2>
<p>â€œçœŸæ²¡æƒ³åˆ°æˆ‘ä»¬åœ¨è¿™æ ·ä¸€ä¸ªåœ°æ–¹å‘Šåˆ«ï¼Œä½†æ˜¯è·Ÿäººå‘Šåˆ«çš„æ—¶å€™ï¼Œè¿˜æ˜¯è¦ç”¨åŠ›ä¸€ç‚¹ï¼Œå› ä¸ºä½ å¤šè¯´ä¸€å¥ï¼Œè¯´ä¸å®šå°±æ˜¯æœ€åä¸€å¥ï¼Œå¤šçœ‹ä¸€çœ¼ï¼Œå¼„ä¸å¥½å°±æ˜¯æœ€åä¸€çœ¼ã€‚â€â€”â€”ã€Šåä¼šæ— æœŸã€‹</p>
]]></content>
      <categories>
        <category>Life</category>
      </categories>
      <tags>
        <tag>éšæƒ³</tag>
      </tags>
  </entry>
  <entry>
    <title>è¿‡æ»¤å™¨Filter</title>
    <url>/post/31fabe4c.html</url>
    <content><![CDATA[<h3 id="Filter">Filter</h3>
<h4 id="filter-æµç¨‹">filter æµç¨‹</h4>
<p><img src="/post/31fabe4c/Filter%E6%B5%81%E7%A8%8B.jpg" alt="Filteræµç¨‹"></p>
<p>ä¸€ä¸ª http è¯·æ±‚è¿‡æ¥ä¹‹åï¼š</p>
<ul>
<li>é¦–å…ˆè¿›å…¥ filterï¼Œæ‰§è¡Œç›¸å…³ä¸šåŠ¡é€»è¾‘</li>
<li>è‹¥åˆ¤å®šé€šè¡Œï¼Œåˆ™è¿›å…¥ Servlet é€»è¾‘ï¼ŒServlet æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œåˆè¿”å› Filterï¼Œæœ€ååœ¨è¿”å›ç»™è¯·æ±‚æ–¹</li>
<li>åˆ¤å®šå¤±è´¥ï¼Œç›´æ¥è¿”å›ï¼Œä¸éœ€è¦å°†è¯·æ±‚å‘ç»™ Servlet</li>
</ul>
<h4 id="åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯</h4>
<ul>
<li>åœ¨ filter å±‚ï¼Œè·å–ç”¨æˆ·çš„èº«ä»½</li>
<li>å¯ä»¥è€ƒè™‘åœ¨ filter å±‚åšä¸€äº›å¸¸è§„çš„æ ¡éªŒ (å¦‚å‚æ•°æ ¡éªŒï¼Œreferer æ ¡éªŒã€æƒé™æ§åˆ¶ç­‰)</li>
<li>å¯ä»¥åœ¨ filter å±‚åšè¿ç»´ã€å®‰å…¨é˜²æŠ¤ç›¸å…³çš„å·¥ä½œ(å¦‚å…¨é“¾è·¯æ‰“ç‚¹ï¼Œå¯ä»¥åœ¨ flter å±‚åˆ†é…ä¸€ä¸ª traceld;ä¹Ÿå¯ä»¥åœ¨è¿™ä¸€å±‚åšé™æµç­‰)</li>
</ul>
<h4 id="ä½¿ç”¨">ä½¿ç”¨</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@WebFilter(urlPatterns = &quot;/*&quot;, filterName = &quot;reqRecordFilter&quot;, asyncSupported = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReqRecordFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Logger</span> <span class="variable">REQ_LOG</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="string">&quot;req&quot;</span>);</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›ç»™å‰ç«¯çš„traceIdï¼Œç”¨äºæ—¥å¿—è¿½è¸ª</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">GLOBAL_TRACE_ID_HEADER</span> <span class="operator">=</span> <span class="string">&quot;g-trace-id&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> GlobalInitService globalInitService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StatisticsSettingService statisticsSettingService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            request = <span class="built_in">this</span>.initReqInfo((HttpServletRequest) servletRequest, (HttpServletResponse) servletResponse);</span><br><span class="line">            CrossUtil.buildCors(request, (HttpServletResponse) servletResponse);</span><br><span class="line">            filterChain.doFilter(request, servletResponse);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            buildRequestLog(ReqInfoContext.getReqInfo(), request, System.currentTimeMillis() - start);</span><br><span class="line">            <span class="comment">// ä¸€ä¸ªé“¾è·¯è¯·æ±‚å®Œæ¯•ï¼Œæ¸…ç©ºMDCç›¸å…³çš„å˜é‡(å¦‚GlobalTraceIdï¼Œç”¨æˆ·ä¿¡æ¯)</span></span><br><span class="line">            MdcUtil.clear();</span><br><span class="line">            ReqInfoContext.clear();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  	<span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">  	# ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>initï¼šåˆå§‹åŒ–æ—¶æ‰§è¡Œ</p>
</li>
<li>
<p>destoryï¼š é”€æ¯æ—¶æ‰§è¡Œ</p>
</li>
<li>
<p>doFilterï¼šfilter è§„åˆ™å‘½ä¸­çš„è¯·æ±‚ï¼Œéƒ½ä¼šèµ°è¿›æ¥</p>
</li>
<li>
<ul>
<li>ä¸‰ä¸ªå‚æ•°ï¼Œæ³¨æ„ç¬¬ä¸‰ä¸ª FilterChainï¼Œè¿™é‡Œæ˜¯ç»å…¸çš„è´£ä»»é“¾è®¾è®¡æ¨¡å¼</li>
<li>æ‰§è¡Œ filterChain.doFilter(servletRequestï¼ŒservletResponse) è¡¨ç¤ºä¼šç»§ç»­å°†è¯·æ±‚æ‰§è¡Œä¸‹å»è‹¥ä¸æ‰§è¡Œè¿™ä¸€å¥ï¼Œè¡¨ç¤ºè¿™ä¸€æ¬¡çš„ http è¯·æ±‚åˆ°æ­¤ä¸ºæ­¢äº†ï¼Œåé¢çš„èµ°ä¸ä¸‹å»äº†</li>
</ul>
</li>
</ul>
<h4 id="æ³¨å†Œï¼ˆè¿‡æ»¤å™¨Filteræ³¨å†Œåˆ°Springå®¹å™¨ï¼‰">æ³¨å†Œï¼ˆè¿‡æ»¤å™¨Filteræ³¨å†Œåˆ°Springå®¹å™¨ï¼‰</h4>
<ol>
<li>ä½¿ç”¨ @WebFilter æ³¨è§£ï¼Œæ ‡æ³¨åˆ°è‡ªå·±å®ç°çš„è¿‡æ»¤å™¨ä¸Š</li>
</ol>
<p>WebFilter å¸¸ç”¨å±æ€§å¦‚ä¸‹ï¼Œå…¶ä¸­ urIPatterns æœ€ä¸ºå¸¸ç”¨ï¼Œè¡¨ç¤ºè¿™ä¸ª flter é€‚ç”¨äºå“ªäº› url è¯·æ±‚(é»˜è®¤åœºæ™¯ä¸‹å…¨éƒ¨è¯·æ±‚éƒ½è¢«æ‹¦æˆª)</p>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>ç±»å‹</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>fileName</td>
<td>String</td>
<td>æŒ‡å®šè¿‡æ»¤å™¨çš„ name å±æ€§ï¼Œç­‰ä»·äº <filter-name>ã€‚</filter-name></td>
</tr>
<tr>
<td>value</td>
<td>String[]</td>
<td>è¯¥å±æ€§ç­‰ä»·äº urlPatterns å±æ€§ï¼Œä½†æ˜¯ä¸¤è€…ä¸åº”åŒæ—¶ä½¿ç”¨ã€‚</td>
</tr>
<tr>
<td>urlPatterns</td>
<td>String[]</td>
<td>æŒ‡å®šä¸€ç»„è¿‡æ»¤å™¨çš„URLåŒ¹é…æ¨¡å¼ã€‚ç­‰ä»·äº<url-pattern>æ ‡ç­¾ã€‚</url-pattern></td>
</tr>
<tr>
<td>srvletNames</td>
<td>String[]</td>
<td>æŒ‡å®šè¿‡æ»¤å™¨å°†åº”ç”¨äºå“ªäº›Servletã€‚å–å€¼æ˜¯ @WebSerlvet ä¸­çš„nameå±æ€§çš„å–å€¼ï¼Œæˆ–è€…æ˜¯web.xmlä¸­çš„<servlet-name>çš„å–å€¼ã€‚</servlet-name></td>
</tr>
<tr>
<td>dispatcherTypes</td>
<td>DispatcherType</td>
<td>æŒ‡å®šè¿‡æ»¤å™¨çš„è½¬å‘æ¨¡å¼ï¼Œå…·ä½“å–å€¼åŒ…æ‹¬ï¼šASYNC/ERROR/FORWARD/INCLUDE/REQUEST.</td>
</tr>
<tr>
<td>initParams</td>
<td>WebinitParam[]</td>
<td>æŒ‡å®šä¸€ç»„è¿‡æ»¤å™¨åˆå§‹åŒ–å‚æ•°ï¼Œç­‰ä»·äº<init-param>æ ‡ç­¾ã€‚</init-param></td>
</tr>
<tr>
<td>asyncSupported</td>
<td>boolean</td>
<td>å£°æ˜è¿‡æ»¤å™¨æ˜¯å¦æ”¯æŒå¼‚æ­¥æ“ä½œæ¨¡å¼ï¼Œç­‰ä»·äº<async-supported>æ ‡ç­¾ã€‚</async-supported></td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>è¯¥è¿‡æ»¤å™¨çš„æè¿°ä¿¡æ¯ï¼Œç­‰ä»·äº<description>æ ‡ç­¾ã€‚</description></td>
</tr>
<tr>
<td>displayName</td>
<td>String</td>
<td>è¯¥è¿‡æ»¤å™¨çš„æ˜¾ç¤ºåï¼Œé€šå¸¸é…åˆå·¥å…·ä½¿ç”¨ï¼Œç­‰ä»·äº <display-name> æ ‡ç­¾</display-name></td>
</tr>
</tbody>
</table>
<p>ä½¿ç”¨è¿™ä¸ªæ³¨è§£æ—¶ï¼Œè¯·æ³¨æ„ï¼Œéœ€è¦åœ¨<strong>å¯åŠ¨ç±»/é…ç½®ç±»</strong>ä¸Šæ·»åŠ  <strong>ServletComponentScan</strong> æ³¨è§£æ¥å¯ç”¨.</p>
<p><strong>æ³¨æ„ç‚¹1</strong>ï¼š@WebFilter æ³¨è§£ç»“åˆ@Order æ¥å®šä¹‰ filter æ³¨è§£ï¼Œå¯èƒ½å¹¶ä¸ä¼šç”Ÿæ•ˆã€‚</p>
<p><strong>æ³¨æ„ç‚¹2</strong>ï¼š@WebFilter å£°æ˜çš„Filterï¼Œä¼˜å…ˆçº§ä¸º 2147483647 (æœ€ä½ä¼˜å…ˆçº§ï¼‰ã€‚</p>
<ol start="2">
<li>FilterRegistrationBean</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public FilterRegistrationBean&lt;Filter&gt; orderFilter() &#123;</span><br><span class="line">		FilterRegistrationBean&lt;Filter&gt; filter = new FilterRegistrationBean&lt;&gt;();</span><br><span class="line">		filter.setName(&quot;regRecordFilter&quot;);</span><br><span class="line">		filter.seturlPatterns(Arrays.asList(&quot;/**&quot;));</span><br><span class="line">		filter.setFilter(new RegRecordFilter());  //æŒ‡å®šä¼˜å…ˆçº§</span><br><span class="line">		filter.setorder(-1);</span><br><span class="line">		return filter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å®ä¾‹">å®ä¾‹</h4>
<p>æŠ€æœ¯æ´¾ä¸­ï¼ŒFilter åº”ç”¨åˆ°äº†ä»¥ä¸‹å‡ ä¸ªåœ°æ–¹:</p>
<ul>
<li>èº«ä»½è¯†åˆ«ï¼Œå¹¶ä¿å­˜èº«ä»½åˆ° RegInfoContext ä¸Šä¸‹æ–‡ä¸­ã€‚è¯¦æƒ…åšæ–‡: <a href="https://www.yuque.com/itwanger/az7yww/yk1x4v6wt5gz103q">https://www.yuque.com/itwanger/az7yww/yk1x4v6wt5gz103q</a></li>
<li>è®°å½•è¯·æ±‚è®°å½•ï¼Œè¯¦æƒ…åšæ–‡: <a href="https://www.yuque.com/itwanger/az7yww/wb3pz26699c86nuz">https://www.yuque.com/itwanger/az7yww/wb3pz26699c86nuz</a></li>
<li>æ·»åŠ è·¨åŸŸæ”¯æŒï¼Œè¯¦æƒ…åšæ–‡: <a href="https://www.yuque.com/itwanger/az7yww/pznv1robndgbuyhh">https://www.yuque.com/itwanger/az7yww/pznv1robndgbuyhh</a></li>
</ul>
<h4 id="filter-åœ¨æŠ€æœ¯æ´¾ä¸­çš„åº”ç”¨æ€»ç»“">filter åœ¨æŠ€æœ¯æ´¾ä¸­çš„åº”ç”¨æ€»ç»“</h4>
<p><img src="/post/31fabe4c/Filter%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93.png" alt="FilterçŸ¥è¯†ç‚¹æ€»ç»“"></p>
<h4 id="æœ€å">æœ€å</h4>
<p><a href="https://github.com/itwanger/paicoding">æŠ€æœ¯æ´¾é¡¹ç›®åœ°å€</a></p>
]]></content>
      <categories>
        <category>coding</category>
        <category>web</category>
      </categories>
      <tags>
        <tag>web</tag>
      </tags>
  </entry>
  <entry>
    <title>é‡ä¿®ä¹‹JavaåŸºç¡€</title>
    <url>/post/37c82b62.html</url>
    <content><![CDATA[<h2 id="é‡ä¿®ä¹‹JavaåŸºç¡€">é‡ä¿®ä¹‹JavaåŸºç¡€</h2>
<blockquote>
<p>å‚è€ƒï¼š<a href="https://javaguide.cn/java/basis/j">JavaGuide</a></p>
</blockquote>
<h3 id="æ¦‚å¿µæ€§çš„ä¸œè¥¿">æ¦‚å¿µæ€§çš„ä¸œè¥¿</h3>
<ol>
<li>JVM &amp; JDK &amp; JRE</li>
</ol>
<p><img src="/post/37c82b62/JVM&amp;JDK&amp;JRE.png" alt="JVM&amp;JDK&amp;JRE"></p>
<p>JVMå¤§è‡´ç»“æ„æ¨¡å‹ï¼š</p>
<p><img src="/post/37c82b62/JVMModel.png" alt="JVMModel"></p>
<ol>
<li>å­—èŠ‚ç ï¼Œå­—èŠ‚ç çš„å¥½å¤„</li>
</ol>
<p>JVM å¯ä»¥ç†è§£çš„ä»£ç å°±å«åšå­—èŠ‚ç ï¼ˆå³æ‰©å±•åä¸º .class çš„æ–‡ä»¶ï¼‰ï¼Œå®ƒä¸é¢å‘ä»»ä½•ç‰¹å®šçš„å¤„ç†å™¨ï¼Œ<strong>åªé¢å‘è™šæ‹Ÿæœº</strong>ã€‚</p>
<ol start="2">
<li>Javaç¼–è¯‘ä¸è§£é‡Šå¹¶å­˜ï¼Ÿ</li>
</ol>
<p>Java ç¨‹åºè¦ç»è¿‡å…ˆç¼–è¯‘ï¼Œåè§£é‡Šä¸¤ä¸ªæ­¥éª¤ï¼Œç”± Java ç¼–å†™çš„ç¨‹åºéœ€è¦å…ˆç»è¿‡ç¼–è¯‘æ­¥éª¤ï¼Œç”Ÿæˆå­—èŠ‚ç ï¼ˆ.class æ–‡ä»¶ï¼‰ï¼Œè¿™ç§å­—èŠ‚ç å¿…é¡»ç”± Java è§£é‡Šå™¨æ¥è§£é‡Šæ‰§è¡Œã€‚</p>
<ol start="3">
<li>JITå’ŒAOTç¼–è¯‘</li>
</ol>
<p>AOTï¼ˆAhead of Time Compilationï¼‰ï¼šé€‚åˆäº‘åŸç”Ÿã€å¾®æœåŠ¡æ¶æ„æ”¯æŒï¼Œç¼ºå°‘JavaåŠ¨æ€ç‰¹æ€§å¦‚åå°„ã€åŠ¨æ€ä»£ç†ã€åŠ¨æ€åŠ è½½ã€JNIï¼ˆJava native Interfaceï¼‰ã€‚<br>
JITï¼ˆJust In Timeï¼‰ï¼š</p>
<p>![AOT vs JIT](AOT vs JIT.png)</p>
<p>å‚è€ƒï¼š<a href="https://cn.dubbo.apache.org/zh-cn/blog/2023/06/28/%E8%B5%B0%E5%90%91-native-%E5%8C%96springdubbo-aot-%E6%8A%80%E6%9C%AF%E7%A4%BA%E4%BE%8B%E4%B8%8E%E5%8E%9F%E7%90%86%E8%AE%B2%E8%A7%A3/">èµ°å‘ Native åŒ–ï¼šSpring&amp;Dubbo AOT æŠ€æœ¯ç¤ºä¾‹ä¸åŸç†è®²è§£</a>ã€<a href="https://mp.weixin.qq.com/s/4haTyXUmh8m-dBQaEzwDJw">åŸºäºé™æ€ç¼–è¯‘æ„å»ºå¾®æœåŠ¡åº”ç”¨</a></p>
<ol start="4">
<li>Oracle JDK vs OpenJDK</li>
</ol>
<p>åŒºåˆ«ï¼š</p>
<p>è¡¥å……â€”â€”Oracle JDK vs OpenJDKå¸¦æ¥çš„å¼€æºåè®®ï¼š</p>
<ul>
<li>BCL åè®®ï¼ˆOracle Binary Code License Agreementï¼‰ï¼šå¯ä»¥ä½¿ç”¨ JDKï¼ˆæ”¯æŒå•†ç”¨ï¼‰ï¼Œä½†æ˜¯ä¸èƒ½è¿›è¡Œä¿®æ”¹ã€‚</li>
<li>OTN åè®®ï¼ˆOracle Technology Network License Agreementï¼‰ï¼š11 åŠä¹‹åæ–°å‘å¸ƒçš„ JDK ç”¨çš„éƒ½æ˜¯è¿™ä¸ªåè®®ï¼Œå¯ä»¥è‡ªå·±ç§ä¸‹ç”¨ï¼Œä½†æ˜¯å•†ç”¨éœ€è¦ä»˜è´¹ã€‚</li>
</ul>
<ol start="5">
<li>Javaå’ŒC++çš„åŒºåˆ«</li>
</ol>
<ul>
<li>Java ä¸æä¾›æŒ‡é’ˆæ¥ç›´æ¥è®¿é—®å†…å­˜ï¼Œç¨‹åºå†…å­˜æ›´åŠ å®‰å…¨</li>
<li>Java çš„ç±»æ˜¯å•ç»§æ‰¿çš„ï¼ŒC++ æ”¯æŒå¤šé‡ç»§æ‰¿ï¼›è™½ç„¶ Java çš„ç±»ä¸å¯ä»¥å¤šç»§æ‰¿ï¼Œä½†æ˜¯æ¥å£å¯ä»¥å¤šç»§æ‰¿ã€‚</li>
<li>Java æœ‰è‡ªåŠ¨å†…å­˜ç®¡ç†åƒåœ¾å›æ”¶æœºåˆ¶(GC)ï¼Œä¸éœ€è¦ç¨‹åºå‘˜æ‰‹åŠ¨é‡Šæ”¾æ— ç”¨å†…å­˜ã€‚</li>
<li>C ++åŒæ—¶æ”¯æŒæ–¹æ³•é‡è½½å’Œæ“ä½œç¬¦é‡è½½ï¼Œä½†æ˜¯ Java åªæ”¯æŒæ–¹æ³•é‡è½½ï¼ˆæ“ä½œç¬¦é‡è½½å¢åŠ äº†å¤æ‚æ€§ï¼Œè¿™ä¸ Java æœ€åˆçš„è®¾è®¡æ€æƒ³ä¸ç¬¦ï¼‰ã€‚</li>
</ul>
<h3 id="è¯­æ³•">è¯­æ³•</h3>
<ol>
<li>æ³¨é‡Šï¼ˆå•è¡Œã€å¤šè¡Œã€æ–‡æ¡£ï¼‰</li>
<li>æ ‡è¯†ç¬¦&amp;å…³é”®å­—</li>
<li>è‡ªå¢&amp;è‡ªå‡</li>
</ol>
<p>ç¬¦å·åœ¨å‰å°±å…ˆåŠ /å‡ï¼Œç¬¦å·åœ¨åå°±ååŠ /å‡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">10</span>, c = <span class="number">20</span>;</span><br><span class="line">a = b++; <span class="comment">// a: 10, b: 11</span></span><br><span class="line">a = ++c; <span class="comment">// a: 21, c:21</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>ç§»ä½è¿ç®—ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">hash</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    <span class="type">int</span> h;</span><br><span class="line">    <span class="comment">// key.hashCode()ï¼šè¿”å›æ•£åˆ—å€¼ä¹Ÿå°±æ˜¯hashcode</span></span><br><span class="line">    <span class="comment">// ^ï¼šæŒ‰ä½å¼‚æˆ–</span></span><br><span class="line">    <span class="comment">// &gt;&gt;&gt;:æ— ç¬¦å·å³ç§»ï¼Œå¿½ç•¥ç¬¦å·ä½ï¼Œç©ºä½éƒ½ä»¥0è¡¥é½</span></span><br><span class="line">    <span class="keyword">return</span> (key == <span class="literal">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>&lt;&lt;</code> :å·¦ç§»è¿ç®—ç¬¦ï¼Œå‘å·¦ç§»è‹¥å¹²ä½ï¼Œé«˜ä½ä¸¢å¼ƒï¼Œä½ä½è¡¥é›¶ã€‚x &lt;&lt; 1,ç›¸å½“äº x ä¹˜ä»¥ 2(ä¸æº¢å‡ºçš„æƒ…å†µä¸‹)ã€‚</li>
<li><code>&gt;&gt;</code> :<strong>å¸¦ç¬¦å·å³ç§»</strong>ï¼Œå‘å³ç§»è‹¥å¹²ä½ï¼Œé«˜ä½è¡¥ç¬¦å·ä½ï¼Œä½ä½ä¸¢å¼ƒã€‚æ­£æ•°é«˜ä½è¡¥ 0,è´Ÿæ•°é«˜ä½è¡¥ 1ã€‚x &gt;&gt; 1,ç›¸å½“äº x é™¤ä»¥ 2ã€‚</li>
<li><code>&gt;&gt;&gt;</code> :<strong>æ— ç¬¦å·å³ç§»</strong>ï¼Œå¿½ç•¥ç¬¦å·ä½ï¼Œç©ºä½éƒ½ä»¥ 0 è¡¥é½</li>
</ul>
<blockquote>
<p>ç§»ä½æ”¯æŒ <strong>int å’Œ long</strong> ç±»å‹ï¼Œå…¶ä»–çš„ç§»ä½è®¡ç®—éƒ½æ˜¯å…ˆè½¬å‹å†è®¡ç®—ã€‚</p>
<p>ä½æ•°è¶…è¿‡äº†å®é™…ä½æ•°ï¼Œå…ˆå–ä½™å†ç§»ä½ã€‚</p>
</blockquote>
<p>å·¦ç§»çš„ä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">System.out.println(<span class="string">&quot;åˆå§‹æ•°æ®ï¼š&quot;</span> + i);</span><br><span class="line">System.out.println(<span class="string">&quot;åˆå§‹æ•°æ®å¯¹åº”çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼š&quot;</span> + Integer.toBinaryString(i));</span><br><span class="line">i &lt;&lt;= <span class="number">10</span>;</span><br><span class="line">System.out.println(<span class="string">&quot;å·¦ç§» 10 ä½åçš„æ•°æ® &quot;</span> + i);</span><br><span class="line">System.out.println(<span class="string">&quot;å·¦ç§» 10 ä½åçš„æ•°æ®å¯¹åº”çš„äºŒè¿›åˆ¶å­—ç¬¦ &quot;</span> + Integer.toBinaryString(i));</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>continueã€breakã€return</li>
</ol>
<p>continueï¼š<strong>è·³è¿‡å½“æ¬¡</strong>å¾ªç¯ï¼ˆè¿˜åœ¨å¾ªç¯ä½“å†…æ‰§è¡Œï¼‰</p>
<p>breakï¼š<strong>è·³å‡º</strong>å¾ªç¯ï¼Œæ‰§è¡Œå¾ªç¯ä½“ä¸‹é¢çš„äº†ã€‚</p>
<p>returnï¼šè·³å‡ºæ‰€åœ¨æ–¹æ³•ï¼›æœ‰è¿”å›å€¼çš„æ–¹æ³•åˆ™returnä¸€ä¸ªç‰¹å®šå€¼ï¼ˆå¯¹è±¡ï¼‰ã€‚</p>
<h3 id="æ•°æ®ç±»å‹">æ•°æ®ç±»å‹</h3>
<ol>
<li>åŸºæœ¬ç±»å‹ï¼š</li>
</ol>
<p>Java ä¸­æœ‰ 8 ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼Œåˆ†åˆ«ä¸ºï¼š</p>
<ul>
<li>
<p>6 ç§æ•°å­—ç±»å‹ï¼š</p>
<ul>
<li>
<p>4 ç§æ•´æ•°å‹ï¼šbyteã€shortã€intã€long</p>
</li>
<li>
<p>2 ç§æµ®ç‚¹å‹ï¼šfloatã€double</p>
</li>
</ul>
</li>
<li>
<p>1 ç§å­—ç¬¦ç±»å‹ï¼šchar</p>
</li>
<li>
<p>1 ç§å¸ƒå°”å‹ï¼šbooleanã€‚</p>
</li>
</ul>
<p>è¿™ 8 ç§åŸºæœ¬æ•°æ®ç±»å‹çš„é»˜è®¤å€¼ä»¥åŠæ‰€å ç©ºé—´çš„å¤§å°å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>åŸºæœ¬ç±»å‹</th>
<th>ä½æ•°</th>
<th>å­—èŠ‚</th>
<th>é»˜è®¤å€¼</th>
<th>å–å€¼èŒƒå›´</th>
</tr>
</thead>
<tbody>
<tr>
<td>byte</td>
<td>8</td>
<td>1</td>
<td>0</td>
<td>-128 ~ 127</td>
</tr>
<tr>
<td>short</td>
<td>16</td>
<td>2</td>
<td>0</td>
<td>-32768ï¼ˆ-2^15ï¼‰ ~ 32767ï¼ˆ2^15 - 1ï¼‰</td>
</tr>
<tr>
<td>int</td>
<td>32</td>
<td>4</td>
<td>0</td>
<td>-2147483648 ~ 2147483647</td>
</tr>
<tr>
<td>long</td>
<td>64</td>
<td>8</td>
<td>0L</td>
<td>-9223372036854775808ï¼ˆ-2^63ï¼‰ ~ 9223372036854775807ï¼ˆ2^63 -1ï¼‰</td>
</tr>
<tr>
<td>char</td>
<td>16</td>
<td>2</td>
<td>â€˜u0000â€™</td>
<td>0 ~ 65535ï¼ˆ2^16 - 1ï¼‰</td>
</tr>
<tr>
<td>float</td>
<td>32</td>
<td>4</td>
<td>0f</td>
<td>1.4E-45 ~ 3.4028235E38</td>
</tr>
<tr>
<td>double</td>
<td>64</td>
<td>8</td>
<td>0d</td>
<td>4.9E-324 ~ 1.7976931348623157E308</td>
</tr>
<tr>
<td>boolean</td>
<td>1</td>
<td></td>
<td>false</td>
<td>trueã€false</td>
</tr>
</tbody>
</table>
<p>è¿™å…«ç§åŸºæœ¬ç±»å‹éƒ½æœ‰å¯¹åº”çš„åŒ…è£…ç±»åˆ†åˆ«ä¸ºï¼šByteã€Shortã€Integerã€Longã€Floatã€Doubleã€Characterã€Boolean ã€‚</p>
<blockquote>
<p>long ç±»å‹æ•°å€¼åé¢åŠ ä¸ŠLï¼ˆå¦åˆ™ä½œä¸ºæ•´å‹è§£æï¼‰ã€‚</p>
<p>char å•å¼•å·ï¼ŒString åŒå¼•å·ã€‚</p>
</blockquote>
<ol start="2">
<li>åŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»å‹:</li>
</ol>
<p><img src="/post/37c82b62/%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8BVS%E5%8C%85%E8%A3%85%E7%B1%BB%E5%9E%8B.jpeg" alt="åŸºæœ¬ç±»å‹VSåŒ…è£…ç±»å‹"></p>
<blockquote>
<p><strong>ä¸ºä»€ä¹ˆè¯´æ˜¯å‡ ä¹æ‰€æœ‰å¯¹è±¡å®ä¾‹éƒ½å­˜åœ¨äºå †ä¸­å‘¢ï¼Ÿ</strong></p>
<p>è¿™æ˜¯å› ä¸º HotSpot è™šæ‹Ÿæœºå¼•å…¥äº† JIT ä¼˜åŒ–ä¹‹åï¼Œä¼šå¯¹å¯¹è±¡è¿›è¡Œé€ƒé€¸åˆ†æï¼Œå¦‚æœå‘ç°æŸä¸€ä¸ªå¯¹è±¡å¹¶æ²¡æœ‰é€ƒé€¸åˆ°æ–¹æ³•å¤–éƒ¨ï¼Œé‚£ä¹ˆå°±å¯èƒ½é€šè¿‡æ ‡é‡æ›¿æ¢æ¥å®ç°æ ˆä¸Šåˆ†é…ï¼Œè€Œé¿å…å †ä¸Šåˆ†é…å†…å­˜ã€‚</p>
</blockquote>
<ol start="3">
<li>åŒ…è£…ç±»å‹çš„ç¼“å­˜æœºåˆ¶</li>
</ol>
<blockquote>
<p>Java åŸºæœ¬æ•°æ®ç±»å‹çš„åŒ…è£…ç±»å‹çš„å¤§éƒ¨åˆ†éƒ½ç”¨åˆ°äº†ç¼“å­˜æœºåˆ¶æ¥æå‡æ€§èƒ½ã€‚</p>
</blockquote>
<p><code>Byte, Short, Integer, Long</code> è¿™ 4 ç§åŒ…è£…ç±»é»˜è®¤åˆ›å»ºäº†æ•°å€¼ <strong>[-128ï¼Œ127]</strong> çš„ç›¸åº”ç±»å‹çš„ç¼“å­˜æ•°æ®ï¼Œ<code>Character</code> åˆ›å»ºäº†æ•°å€¼åœ¨  <strong>[0,127]</strong> èŒƒå›´çš„ç¼“å­˜æ•°æ®ï¼ŒBoolean ç›´æ¥è¿”å› True or Falseã€‚</p>
<p><code>Integer</code>ç¼“å­˜æºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title function_">valueOf</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)</span><br><span class="line">        <span class="keyword">return</span> IntegerCache.cache[i + (-IntegerCache.low)];</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">IntegerCache</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">low</span> <span class="operator">=</span> -<span class="number">128</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> high;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">// high value may be configured by property</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> <span class="number">127</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Character</code>ç¼“å­˜æºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Character <span class="title function_">valueOf</span><span class="params">(<span class="type">char</span> c)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (c &lt;= <span class="number">127</span>) &#123; <span class="comment">// must cache</span></span><br><span class="line">      <span class="keyword">return</span> CharacterCache.cache[(<span class="type">int</span>)c];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Character</span>(c);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">CharacterCache</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">CharacterCache</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> Character cache[] = <span class="keyword">new</span> <span class="title class_">Character</span>[<span class="number">127</span> + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; cache.length; i++)</span><br><span class="line">            cache[i] = <span class="keyword">new</span> <span class="title class_">Character</span>((<span class="type">char</span>)i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Boolean</code>ç¼“å­˜æºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title function_">valueOf</span><span class="params">(<span class="type">boolean</span> b)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (b ? TRUE : FALSE);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸¤ç§æµ®ç‚¹ç±»å‹çš„åŒ…è£…ç±»<code>Float</code>ã€<code>Double</code>æ²¡æœ‰å®ç°ç¼“å­˜ã€‚</p>
<p>å…³äºæ¯”è¾ƒé—®é¢˜ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">i1</span> <span class="operator">=</span> <span class="number">40</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">40</span>);</span><br><span class="line">System.out.pringln(i1 == i2);   <span class="comment">// è¾“å‡ºfalseã€‚</span></span><br></pre></td></tr></table></figure>
<p><code>Integer i1=40</code> è¿™ä¸€è¡Œä»£ç ä¼šå‘ç”Ÿè£…ç®±ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™è¡Œä»£ç ç­‰ä»·äº <code>Integer i1=Integer.valueOf(40)</code> ã€‚å› æ­¤ï¼Œ<code>i1</code> ç›´æ¥ä½¿ç”¨çš„æ˜¯ç¼“å­˜ä¸­çš„å¯¹è±¡ã€‚è€Œ<code>Integer i2 = new Integer(40)</code> ä¼šç›´æ¥åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚</p>
<p>æ‰€ä»¥ï¼Œ<strong>æ‰€æœ‰æ•´å‹åŒ…è£…ç±»å¯¹è±¡ä¹‹é—´å€¼çš„æ¯”è¾ƒï¼Œå…¨éƒ¨ä½¿ç”¨ equals æ–¹æ³•æ¯”è¾ƒã€‚</strong></p>
<ol start="4">
<li>è‡ªåŠ¨è£…ç®±ä¸æ‹†ç®±</li>
</ol>
<p>è£…ç®±ï¼šåŸºæœ¬ç±»å‹ç”¨å¯¹åº”çš„å¼•ç”¨ç±»å‹åŒ…è£…èµ·æ¥ã€‚</p>
<p>æ‹†ç®±ï¼šå°†åŒ…è£…ç±»å‹è½¬æ¢ä¸ºåŸºæœ¬æ•°æ®ç±»å‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span>;  <span class="comment">//è£…ç®±</span></span><br><span class="line"><span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> i;   <span class="comment">//æ‹†ç®±</span></span><br><span class="line">   L1</span><br><span class="line"></span><br><span class="line">    LINENUMBER <span class="number">8</span> L1</span><br><span class="line"></span><br><span class="line">    ALOAD <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    BIPUSH <span class="number">10</span></span><br><span class="line"></span><br><span class="line">    INVOKESTATIC java/lang/Integer.valueOf (I)Ljava/lang/Integer;</span><br><span class="line"></span><br><span class="line">    PUTFIELD AutoBoxTest.i : Ljava/lang/Integer;</span><br><span class="line"></span><br><span class="line">   L2</span><br><span class="line"></span><br><span class="line">    LINENUMBER <span class="number">9</span> L2</span><br><span class="line"></span><br><span class="line">    ALOAD <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    ALOAD <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    GETFIELD AutoBoxTest.i : Ljava/lang/Integer;</span><br><span class="line"></span><br><span class="line">    INVOKEVIRTUAL java/lang/Integer.intValue ()I</span><br><span class="line"></span><br><span class="line">    PUTFIELD AutoBoxTest.n : I</span><br><span class="line"></span><br><span class="line">    RETURN</span><br></pre></td></tr></table></figure>
<p>ä»å­—èŠ‚ç ä¸­ï¼Œæˆ‘ä»¬å‘ç°è£…ç®±å…¶å®å°±æ˜¯è°ƒç”¨äº† åŒ…è£…ç±»çš„<code>valueOf()</code>æ–¹æ³•ï¼Œæ‹†ç®±å…¶å®å°±æ˜¯è°ƒç”¨äº† <code>xxxValue()</code>æ–¹æ³•ã€‚</p>
<p>å› æ­¤ï¼Œ</p>
<ul>
<li><code>Integer i = 10</code> ç­‰ä»·äº <code>Integer i = Integer.valueOf(10)</code></li>
<li><code>int n = i</code> ç­‰ä»·äº <code>int n = i.intValue()</code></li>
</ul>
<p>æ³¨æ„ï¼š<strong>å¦‚æœé¢‘ç¹æ‹†è£…ç®±çš„è¯ï¼Œä¹Ÿä¼šä¸¥é‡å½±å“ç³»ç»Ÿçš„æ€§èƒ½ã€‚æˆ‘ä»¬åº”è¯¥å°½é‡é¿å…ä¸å¿…è¦çš„æ‹†è£…ç®±æ“ä½œ</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">sum</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// åº”è¯¥ä½¿ç”¨ long è€Œä¸æ˜¯ Long</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0L</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">long</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= Integer.MAX_VALUE; i++)</span><br><span class="line">        sum += i;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>æµ®ç‚¹æ•°è¿ç®—å’Œç²¾åº¦ä¸¢å¤±ã€è§£å†³ç²¾åº¦ä¸¢å¤±</li>
</ol>
<p>äºŒè¿›åˆ¶çš„è®¡ç®—æœºåœ¨è¡¨ç¤ºä¸€ä¸ªæ•°å­—æ—¶ï¼Œå®½åº¦æœ‰é™ï¼Œæ— é™å¾ªç¯å°æ•°åœ¨è¡¨ç¤ºæ—¶åªèƒ½è¢«æˆªæ–­ï¼Œå¯¼è‡´äº†ç²¾åº¦ä¸¢å¤±ã€‚<a href="http://kaito-kidd.com/2018/08/08/computer-system-float-point/">è®¡ç®—æœºç³»ç»ŸåŸºç¡€ï¼ˆå››ï¼‰æµ®ç‚¹æ•°</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">float</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">2.0f</span> - <span class="number">1.9f</span>;</span><br><span class="line"><span class="type">float</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">1.8f</span> - <span class="number">1.7f</span>;</span><br><span class="line">System.out.println(a);<span class="comment">// 0.100000024</span></span><br><span class="line">System.out.println(b);<span class="comment">// 0.099999905</span></span><br><span class="line">System.out.println(a == b);<span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨<code>BigDecimal</code>å®ç°æµ®ç‚¹æ•°è¿ç®—ä¸ä¼šé€ æˆç²¾åº¦ä¸¢å¤±ã€‚<a href="https://javaguide.cn/java/basis/bigdecimal.html">BigDecimal è¯¦è§£</a></p>
<ol start="6">
<li>è¶…è¿‡Longæ•´å½¢çš„å¤§æ•°è¡¨ç¤º</li>
</ol>
<p><code>BigInteger</code> å†…éƒ¨ä½¿ç”¨ <code>int[]</code> æ•°ç»„æ¥å­˜å‚¨ä»»æ„å¤§å°çš„æ•´å½¢æ•°æ®ã€‚</p>
<p>ç›¸å¯¹äºå¸¸è§„æ•´æ•°ç±»å‹çš„è¿ç®—æ¥è¯´ï¼ŒBigInteger è¿ç®—çš„æ•ˆç‡ä¼šç›¸å¯¹è¾ƒä½ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">long</span> <span class="variable">l</span> <span class="operator">=</span> Long.MAX_VALUE;</span><br><span class="line">System.out.println(l + <span class="number">1</span>); <span class="comment">// -9223372036854775808</span></span><br><span class="line">System.out.println(l + <span class="number">1</span> == Long.MIN_VALUE); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h3 id="å˜é‡">å˜é‡</h3>
<ol>
<li>æˆå‘˜å˜é‡ä¸å±€éƒ¨å˜é‡</li>
</ol>
<p><img src="/post/37c82b62/%E6%88%90%E5%91%98%E5%8F%98%E9%87%8Fvs%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F.jpeg" alt="æˆå‘˜å˜é‡vså±€éƒ¨å˜é‡"></p>
<p>é»˜è®¤å€¼ï¼š</p>
<ul>
<li>é¿å…è®¿é—®éšæœºåˆå§‹å€¼é€ æˆæ„å¤–</li>
<li>æˆå‘˜å˜é‡è¿è¡Œæ—¶å¯å€ŸåŠ©åå°„ç­‰æ–¹æ³•æ‰‹åŠ¨èµ‹å€¼ï¼Œå±€éƒ¨å˜é‡ä¸è¡Œã€‚</li>
<li>ç¼–è¯‘å™¨å®¹æ˜“æ£€æµ‹å±€éƒ¨å˜é‡åˆå§‹å€¼æœ‰æ— ï¼Œå¯¹äºå¯èƒ½è¿è¡Œæ—¶èµ‹å€¼çš„æˆå‘˜å˜é‡åˆ™ä¸å¥½å¤„ç†ï¼Œå› æ­¤èµ‹é»˜è®¤å€¼ä¾¿äºç¼–è¯‘ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VariableExample</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æˆå‘˜å˜é‡</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">num1</span> <span class="operator">=</span> <span class="number">10</span>; <span class="comment">// æ ˆä¸­åˆ†é…çš„å±€éƒ¨å˜é‡</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;Hello, world!&quot;</span>; <span class="comment">// æ ˆä¸­åˆ†é…çš„å±€éƒ¨å˜é‡</span></span><br><span class="line">        System.out.println(num1);</span><br><span class="line">        System.out.println(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¸¦å‚æ•°çš„æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">(<span class="type">int</span> num2)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> num2 + <span class="number">10</span>; <span class="comment">// æ ˆä¸­åˆ†é…çš„å±€éƒ¨å˜é‡</span></span><br><span class="line">        System.out.println(sum);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„é€ æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">VariableExample</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name; <span class="comment">// å¯¹æˆå‘˜å˜é‡è¿›è¡Œèµ‹å€¼</span></span><br><span class="line">        <span class="built_in">this</span>.age = age; <span class="comment">// å¯¹æˆå‘˜å˜é‡è¿›è¡Œèµ‹å€¼</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">num3</span> <span class="operator">=</span> <span class="number">20</span>; <span class="comment">// æ ˆä¸­åˆ†é…çš„å±€éƒ¨å˜é‡</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="string">&quot;Hello, &quot;</span> + <span class="built_in">this</span>.name + <span class="string">&quot;!&quot;</span>; <span class="comment">// æ ˆä¸­åˆ†é…çš„å±€éƒ¨å˜é‡</span></span><br><span class="line">        System.out.println(num3);</span><br><span class="line">        System.out.println(str2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>é™æ€å˜é‡</li>
</ol>
<ul>
<li>static ä¿®é¥°ã€‚</li>
<li>åªåˆ†é…ä¸€æ¬¡å†…å­˜ï¼Œè¢«ç±»çš„æ‰€æœ‰å®ä¾‹å…±äº«ã€‚</li>
<li>é€šè¿‡ç±»åè®¿é—®ã€‚</li>
<li>é€šå¸¸æƒ…å†µä¸‹ï¼Œé™æ€å˜é‡ä¼šè¢« final å…³é”®å­—ä¿®é¥°æˆä¸ºå¸¸é‡ã€‚</li>
</ul>
<ol start="3">
<li>å­—ç¬¦å‹å¸¸é‡å’Œå­—ç¬¦ä¸²å¸¸é‡</li>
</ol>
<ul>
<li><strong>å½¢å¼</strong> : å­—ç¬¦å¸¸é‡æ˜¯å•å¼•å·å¼•èµ·çš„ä¸€ä¸ªå­—ç¬¦ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ˜¯åŒå¼•å·å¼•èµ·çš„ 0 ä¸ªæˆ–è‹¥å¹²ä¸ªå­—ç¬¦ã€‚</li>
<li><strong>å«ä¹‰</strong> : å­—ç¬¦å¸¸é‡ç›¸å½“äºä¸€ä¸ªæ•´å‹å€¼( ASCII å€¼),å¯ä»¥å‚åŠ è¡¨è¾¾å¼è¿ç®—; å­—ç¬¦ä¸²å¸¸é‡ä»£è¡¨ä¸€ä¸ªåœ°å€å€¼(è¯¥å­—ç¬¦ä¸²åœ¨å†…å­˜ä¸­å­˜æ”¾ä½ç½®)ã€‚</li>
<li><strong>å å†…å­˜å¤§å°</strong>ï¼šå­—ç¬¦å¸¸é‡åªå  2 ä¸ªå­—èŠ‚; å­—ç¬¦ä¸²å¸¸é‡å è‹¥å¹²ä¸ªå­—èŠ‚ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringExample</span> &#123;</span><br><span class="line">    <span class="comment">// å­—ç¬¦å‹å¸¸é‡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">char</span> <span class="variable">LETTER_A</span> <span class="operator">=</span> <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å­—ç¬¦ä¸²å¸¸é‡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">GREETING_MESSAGE</span> <span class="operator">=</span> <span class="string">&quot;Hello, world!&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å­—ç¬¦å‹å¸¸é‡å ç”¨çš„å­—èŠ‚æ•°ä¸ºï¼š&quot;</span>+Character.BYTES);</span><br><span class="line">        System.out.println(<span class="string">&quot;å­—ç¬¦ä¸²å¸¸é‡å ç”¨çš„å­—èŠ‚æ•°ä¸ºï¼š&quot;</span>+GREETING_MESSAGE.getBytes().length);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•">æ–¹æ³•</h3>
<ol>
<li>æ–¹æ³•ç±»å‹å’Œæ–¹æ³•è¿”å›å€¼</li>
</ol>
<p>è¿”å›å€¼ï¼šæ¥æ”¶æ–¹æ³•è¿è¡Œç»“æœï¼Œç”¨äºè¿›è¡Œåç»­å¤„ç†ã€‚</p>
<p>æŒ‰å‚æ•°å’Œè¿”å›å€¼ç±»å‹ï¼Œå¯åˆ†ç±»ï¼šæ— å‚æ•°æ— è¿”å›å€¼çš„æ–¹æ³•ã€æœ‰å‚æ•°æ— è¿”å›å€¼çš„æ–¹æ³•ã€æœ‰è¿”å›å€¼æ— å‚æ•°çš„æ–¹æ³•ã€æœ‰è¿”å›å€¼æœ‰å‚æ•°çš„æ–¹æ³•ã€‚</p>
<ol start="2">
<li>é™æ€æ–¹æ³•ä¸ºä»€ä¹ˆä¸èƒ½è°ƒç”¨éé™æ€æˆå‘˜ï¼Ÿ</li>
</ol>
<ul>
<li>é™æ€æ–¹æ³•å±äºç±»ï¼Œç±»åŠ è½½æ—¶åˆ†é…å†…å­˜ï¼ˆåªæ­¤ä¸€æ¬¡ï¼‰ï¼Œç±»åç›´æ¥è®¿é—®ã€‚éé™æ€æˆå‘˜å±äºå¯¹è±¡å®ä¾‹ï¼Œåªæœ‰å®ä¾‹åŒ–ä¹‹åæ‰å­˜åœ¨ï¼Œå› æ­¤éœ€è¦é€šè¿‡ç±»çš„å®ä¾‹å¯¹è±¡å»è®¿é—®ã€‚</li>
<li>é™æ€æ–¹æ³•å…ˆäºéé™æ€æˆå‘˜å­˜åœ¨ï¼ˆç±»åŠ è½½ï¼‰ï¼Œè°ƒç”¨ä¸å­˜åœ¨çš„éé™æ€æˆå‘˜æ˜¯éæ³•æ“ä½œã€‚</li>
</ul>
<ol start="3">
<li>é™æ€æ–¹æ³•&amp;å®ä¾‹æ–¹æ³•</li>
</ol>
<ul>
<li>
<p>è°ƒç”¨æ–¹å¼ï¼š</p>
</li>
<li>
<p><code>ç±»å.æ–¹æ³•å</code> æˆ–è€… <code>å¯¹è±¡.æ–¹æ³•å</code>ã€‚ï¼ˆå³<strong>é™æ€æ–¹æ³•è°ƒç”¨æ— éœ€åˆ›å»ºå¯¹è±¡</strong>ã€‚ï¼‰</p>
</li>
<li>
<p><code>å¯¹è±¡.æ–¹æ³•å</code>ã€‚</p>
</li>
<li>
<p>é™æ€æ–¹æ³•åœ¨è®¿é—®æœ¬ç±»çš„æˆå‘˜æ—¶ï¼Œåªå…è®¸è®¿é—®é™æ€æˆå‘˜ï¼ˆå³é™æ€æˆå‘˜å˜é‡å’Œé™æ€æ–¹æ³•ï¼‰ï¼Œä¸å…è®¸è®¿é—®å®ä¾‹æˆå‘˜ï¼ˆå³å®ä¾‹æˆå‘˜å˜é‡å’Œå®ä¾‹æ–¹æ³•ï¼‰ï¼Œè€Œå®ä¾‹æ–¹æ³•ä¸å­˜åœ¨è¿™ä¸ªé™åˆ¶ã€‚</p>
</li>
</ul>
<ol start="4">
<li>é‡å†™&amp;é‡è½½</li>
</ol>
<blockquote>
<p>é‡è½½å°±æ˜¯åŒæ ·çš„ä¸€ä¸ªæ–¹æ³•èƒ½å¤Ÿæ ¹æ®è¾“å…¥æ•°æ®çš„ä¸åŒï¼Œåšå‡ºä¸åŒçš„å¤„ç†</p>
<p>é‡å†™å°±æ˜¯å½“å­ç±»ç»§æ‰¿è‡ªçˆ¶ç±»çš„ç›¸åŒæ–¹æ³•ï¼Œè¾“å…¥æ•°æ®ä¸€æ ·ï¼Œä½†è¦åšå‡ºæœ‰åˆ«äºçˆ¶ç±»çš„å“åº”æ—¶ï¼Œå°±è¦è¦†ç›–çˆ¶ç±»æ–¹æ³•ã€‚</p>
</blockquote>
<p><strong>é‡è½½</strong>ï¼šå‘ç”Ÿåœ¨åŒä¸€ä¸ªç±»ï¼ˆorçˆ¶ç±»å’Œå­ç±»ä¹‹é—´ï¼‰ä¸­ï¼Œ<strong>å¤šä¸ªåŒåæ–¹æ³•æ ¹æ®ä¸åŒçš„ä¼ å‚æ¥æ‰§è¡Œä¸åŒçš„é€»è¾‘å¤„ç†</strong>ã€‚æ–¹æ³•åå¿…é¡»ç›¸åŒï¼Œå‚æ•°ç±»å‹ä¸åŒã€ä¸ªæ•°ä¸åŒã€é¡ºåºä¸åŒï¼Œæ–¹æ³•è¿”å›å€¼å’Œè®¿é—®ä¿®é¥°ç¬¦å¯ä»¥ä¸åŒã€‚</p>
<p><strong>é‡å†™</strong>ï¼š<strong>å­ç±»å¯¹çˆ¶ç±»æ–¹æ³•çš„é‡æ–°æ”¹é€ ï¼Œä¸ºäº†é€‚åº”å­ç±»å†…éƒ¨çš„å¤„ç†é€»è¾‘</strong>ã€‚</p>
<blockquote>
<p>é‡å†™éµå¾ªåŸåˆ™ï¼š</p>
<ul>
<li>ä¸¤åŒâ€å³æ–¹æ³•åç›¸åŒã€å½¢å‚åˆ—è¡¨ç›¸åŒï¼›</li>
<li>â€œä¸¤å°â€æŒ‡çš„æ˜¯å­ç±»æ–¹æ³•è¿”å›å€¼ç±»å‹åº”æ¯”çˆ¶ç±»æ–¹æ³•è¿”å›å€¼ç±»å‹æ›´å°æˆ–ç›¸ç­‰ï¼Œå­ç±»æ–¹æ³•å£°æ˜æŠ›å‡ºçš„å¼‚å¸¸ç±»åº”æ¯”çˆ¶ç±»æ–¹æ³•å£°æ˜æŠ›å‡ºçš„å¼‚å¸¸ç±»æ›´å°æˆ–ç›¸ç­‰ï¼›</li>
<li>â€œä¸€å¤§â€æŒ‡çš„æ˜¯å­ç±»æ–¹æ³•çš„è®¿é—®æƒé™åº”æ¯”çˆ¶ç±»æ–¹æ³•çš„è®¿é—®æƒé™æ›´å¤§æˆ–ç›¸ç­‰ã€‚</li>
</ul>
</blockquote>
<p>é‡å†™çš„<strong>è¿”å›å€¼ç±»å‹</strong>ï¼šå¦‚æœæ–¹æ³•çš„è¿”å›ç±»å‹æ˜¯ <strong>void å’ŒåŸºæœ¬æ•°æ®ç±»å‹</strong>ï¼Œåˆ™è¿”å›å€¼é‡å†™æ—¶<strong>ä¸å¯ä¿®æ”¹</strong>ã€‚ä½†æ˜¯å¦‚æœæ–¹æ³•çš„è¿”å›å€¼æ˜¯<strong>å¼•ç”¨ç±»å‹</strong>ï¼Œé‡å†™æ—¶æ˜¯<strong>å¯</strong>ä»¥è¿”å›è¯¥<strong>å¼•ç”¨ç±»å‹çš„å­ç±»çš„</strong>ã€‚</p>
<ol start="5">
<li>å¯å˜é•¿å‚æ•°</li>
</ol>
<ul>
<li>è°ƒç”¨æ–¹æ³•æ—¶ä¼ å…¥ä¸å®šé•¿åº¦çš„å‚æ•°ã€‚</li>
<li>åªå¯ä½œä¸ºå‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°ï¼Œå…¶å‰é¢å¯ä»¥æœ‰å¤šä¸ªå‚æ•°ã€‚</li>
<li><strong>é‡åˆ°æ–¹æ³•é‡è½½ï¼Œä¼˜å…ˆåŒ¹é…å›ºå®šå‚æ•°çš„æ–¹æ³•ã€‚</strong></li>
</ul>
<h3 id="é¢å‘å¯¹è±¡">é¢å‘å¯¹è±¡</h3>
<ol>
<li>é¢å‘å¯¹è±¡ï¼ˆä¸‰å¤§ç‰¹å¾ï¼‰ vs é¢å‘è¿‡ç¨‹</li>
</ol>
<p>è§£å†³é—®é¢˜çš„æ–¹å¼ï¼šè¿‡ç¨‹æ‹†è§£æˆæ–¹æ³•ï¼Œç”¨æ–¹æ³•å»è§£å†³é—®é¢˜ï¼›æŠ½è±¡å‡ºå¯¹è±¡ï¼Œå¯¹è±¡æ‰§è¡Œæ–¹æ³•è§£å†³é—®é¢˜ã€‚</p>
<p>é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹å¾ï¼š</p>
<ul>
<li>
<p>ç»§æ‰¿ï¼š</p>
<ul>
<li>
<p>å­ç±»æ‹¥æœ‰çˆ¶ç±»å¯¹è±¡æ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼ˆåŒ…æ‹¬ç§æœ‰å±æ€§å’Œç§æœ‰æ–¹æ³•ï¼‰ï¼Œä½†æ˜¯çˆ¶ç±»ä¸­çš„ç§æœ‰å±æ€§å’Œæ–¹æ³•å­ç±»æ˜¯æ— æ³•è®¿é—®ï¼Œ<strong>åªæ˜¯æ‹¥æœ‰</strong>ã€‚</p>
</li>
<li>
<p>å­ç±»å¯ä»¥æ‹¥æœ‰è‡ªå·±å±æ€§å’Œæ–¹æ³•ï¼Œå³å­ç±»å¯ä»¥å¯¹çˆ¶ç±»è¿›è¡Œæ‰©å±•ã€‚å­</p>
</li>
<li>
<p>ç±»å¯ä»¥ç”¨è‡ªå·±çš„æ–¹å¼å®ç°çˆ¶ç±»çš„æ–¹æ³•ã€‚</p>
</li>
</ul>
</li>
<li>
<p>å°è£…ï¼šæŠŠä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯ï¼ˆä¹Ÿå°±æ˜¯å±æ€§ï¼‰éšè—åœ¨å¯¹è±¡å†…éƒ¨ï¼Œä¸å…è®¸å¤–éƒ¨å¯¹è±¡ç›´æ¥è®¿é—®å¯¹è±¡çš„å†…éƒ¨ä¿¡æ¯ã€‚ä½†æ˜¯å¯ä»¥æä¾›ä¸€äº›å¯ä»¥è¢«å¤–ç•Œè®¿é—®çš„æ–¹æ³•æ¥æ“ä½œå±æ€§ã€‚</p>
</li>
<li>
<p>å¤šæ€ï¼šè¡¨ç¤ºä¸€ä¸ªå¯¹è±¡å…·æœ‰å¤šç§çš„çŠ¶æ€ï¼Œå…·ä½“è¡¨ç°ä¸ºçˆ¶ç±»çš„å¼•ç”¨æŒ‡å‘å­ç±»çš„å®ä¾‹ã€‚</p>
<ul>
<li>
<p>å¯¹è±¡ç±»å‹å’Œå¼•ç”¨ç±»å‹ä¹‹é—´å…·æœ‰ç»§æ‰¿ï¼ˆç±»ï¼‰/å®ç°ï¼ˆæ¥å£ï¼‰çš„å…³ç³»ï¼›</p>
</li>
<li>
<p>å¼•ç”¨ç±»å‹å˜é‡å‘å‡ºçš„æ–¹æ³•è°ƒç”¨çš„åˆ°åº•æ˜¯å“ªä¸ªç±»ä¸­çš„æ–¹æ³•ï¼Œå¿…é¡»åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šï¼›</p>
</li>
<li>
<p>å¤šæ€ä¸èƒ½è°ƒç”¨â€œåªåœ¨å­ç±»å­˜åœ¨ä½†åœ¨çˆ¶ç±»ä¸å­˜åœ¨â€çš„æ–¹æ³•ï¼›</p>
</li>
<li>
<p>å¦‚æœå­ç±»é‡å†™äº†çˆ¶ç±»çš„æ–¹æ³•ï¼ŒçœŸæ­£æ‰§è¡Œçš„æ˜¯å­ç±»è¦†ç›–çš„æ–¹æ³•ï¼Œå¦‚æœå­ç±»æ²¡æœ‰è¦†ç›–çˆ¶ç±»çš„æ–¹æ³•ï¼Œæ‰§è¡Œçš„æ˜¯çˆ¶ç±»çš„æ–¹æ³•ã€‚</p>
</li>
</ul>
</li>
</ul>
<ol start="2">
<li>å¯¹è±¡å®ä½“ã€å¯¹è±¡å¼•ç”¨ï¼ˆå¼º è½¯ å¼± è™šï¼‰</li>
</ol>
<p><code>new</code>åˆ›å»ºå¯¹è±¡å®ä¾‹ï¼ˆå†…å­˜ä¸­ï¼‰ï¼Œå¯¹è±¡å¼•ç”¨æŒ‡å‘å¯¹è±¡å®ä¾‹ï¼ˆæ ˆå†…å­˜ä¸­ï¼‰ã€‚</p>
<ul>
<li>ä¸€ä¸ªå¯¹è±¡å¼•ç”¨å¯ä»¥æŒ‡å‘ 0 ä¸ªæˆ– 1 ä¸ªå¯¹è±¡ï¼›</li>
<li>ä¸€ä¸ªå¯¹è±¡å¯ä»¥æœ‰ n ä¸ªå¼•ç”¨æŒ‡å‘å®ƒã€‚</li>
</ul>
<p>å¯¹è±¡ç›¸ç­‰å’Œå¼•ç”¨ç›¸ç­‰ï¼š</p>
<ul>
<li>å¯¹è±¡çš„ç›¸ç­‰ä¸€èˆ¬æ¯”è¾ƒçš„æ˜¯å†…å­˜ä¸­<strong>å­˜æ”¾çš„å†…å®¹</strong>æ˜¯å¦ç›¸ç­‰ã€‚</li>
<li>å¼•ç”¨ç›¸ç­‰ä¸€èˆ¬æ¯”è¾ƒçš„æ˜¯ä»–ä»¬<strong>æŒ‡å‘çš„å†…å­˜åœ°å€</strong>æ˜¯å¦ç›¸ç­‰ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">str3</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"><span class="comment">// ä½¿ç”¨ == æ¯”è¾ƒå­—ç¬¦ä¸²çš„å¼•ç”¨ç›¸ç­‰</span></span><br><span class="line">System.out.println(str1 == str2);  <span class="comment">// false</span></span><br><span class="line">System.out.println(str1 == str3);  <span class="comment">// true</span></span><br><span class="line"><span class="comment">// ä½¿ç”¨ equals æ–¹æ³•æ¯”è¾ƒå­—ç¬¦ä¸²çš„ç›¸ç­‰</span></span><br><span class="line">System.out.println(str1.equals(str2));  <span class="comment">// true</span></span><br><span class="line">System.out.println(str1.equals(str3));  <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>å¼•ç”¨ç±»å‹ï¼š</p>
<ul>
<li>å¼ºï¼š<code>Object obj = new Object();</code>å¼ºå¼•ç”¨ä¿æŒå¯¹è±¡çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼Œåªæœ‰å½“å¼•ç”¨è¢«æ˜ç¡®åœ°è®¾ç½®ä¸º null æˆ–è¶…å‡ºèŒƒå›´æ—¶ï¼Œå¯¹è±¡æ‰ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚</li>
<li>è½¯ï¼š<code>SoftReference</code>ç±»è¡¨ç¤ºï¼ŒJVMå†…å­˜ä¸è¶³ï¼Œè½¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡å¯èƒ½è¢«è‡ªåŠ¨å›æ”¶ã€‚</li>
<li>å¼±ï¼š<code>WeakReference</code>ç±»ã€‚å¦‚æœåªæœ‰å¼±å¼•ç”¨æŒ‡å‘å¯¹è±¡ï¼Œé‚£ä¹ˆå¯¹è±¡åœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶ä¼šè¢«ç«‹å³å›æ”¶ã€‚</li>
<li>è™šï¼š<code>PhantomReference</code> ç±»æ¥è¡¨ç¤ºã€‚è™šå¼•ç”¨ä¸»è¦ç”¨äºè·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„æ—¶æœºï¼Œå¹¶è®©ç¨‹åºçŸ¥é“å¯¹è±¡å·²ç»è¢«å›æ”¶ã€‚è™šå¼•ç”¨æ— æ³•ç›´æ¥è®¿é—®å¯¹è±¡ï¼Œä¹Ÿæ— æ³•é˜»æ­¢å¯¹è±¡è¢«åƒåœ¾å›æ”¶ã€‚</li>
</ul>
<ol start="3">
<li>ç±»çš„æ„é€ æ–¹æ³•</li>
</ol>
<ul>
<li>ä¸ç±»åŒåã€æ²¡æœ‰è¿”å›å€¼ä½†ä¸èƒ½ç”¨ void å£°æ˜æ„é€ å‡½æ•°ã€ç”Ÿæˆç±»å¯¹è±¡è‡ªåŠ¨æ‰§è¡Œã€‚</li>
<li><strong>ä¸èƒ½è¢«é‡å†™</strong>ï¼Œå¯ä»¥è¢«<strong>é‡è½½</strong>ã€‚</li>
</ul>
<ol start="4">
<li>æ¥å£ &amp; æŠ½è±¡ç±»</li>
</ol>
<ul>
<li>
<p>åŒï¼šä¸èƒ½è¢«å®ä¾‹åŒ–ã€å¯åŒ…å«æŠ½è±¡æ–¹æ³•ã€å¯åŒ…å«é»˜è®¤å®ç°æ–¹æ³•ã€‚</p>
</li>
<li>
<p>å¼‚ï¼š</p>
<ul>
<li>
<p>æ¥å£å¯¹ç±»çš„è¡Œä¸ºè¿›è¡Œçº¦æŸï¼Œå®ç°äº†æŸä¸ªæ¥å£å°±å…·æœ‰äº†å¯¹åº”çš„è¡Œä¸ºã€‚æŠ½è±¡ç±»ä¸»è¦æ˜¯ä¸ºäº†ä»£ç å¤ç”¨ï¼Œå¼ºè°ƒæ‰€å±å…³ç³»ã€‚</p>
</li>
<li>
<p>ä¸€ä¸ªé›·åªèƒ½ç»§æ‰¿ä¸€ä¸ªç±»ï¼Œå¯ä»¥å®ç°å¤šä¸ªæ¥å£ã€‚</p>
</li>
<li>
<p>æ¥å£ä¸­çš„æˆå‘˜å˜é‡åªèƒ½æ˜¯ public static final ç±»å‹çš„ï¼Œä¸èƒ½è¢«ä¿®æ”¹ä¸”å¿…é¡»æœ‰åˆå§‹å€¼ï¼Œè€ŒæŠ½è±¡ç±»çš„æˆå‘˜å˜é‡é»˜è®¤ defaultï¼Œå¯åœ¨å­ç±»ä¸­è¢«é‡æ–°å®šä¹‰ï¼Œä¹Ÿå¯è¢«é‡æ–°èµ‹å€¼ã€‚</p>
</li>
</ul>
</li>
</ul>
<ol start="5">
<li>æ·±æ‹·è´ &amp; æµ…æ‹·è´</li>
</ol>
<ul>
<li>æµ…æ‹·è´ï¼šæµ…æ‹·è´ä¼šåœ¨å †ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼ˆåŒºåˆ«äºå¼•ç”¨æ‹·è´çš„ä¸€ç‚¹ï¼‰ï¼Œä¸è¿‡ï¼Œå¦‚æœåŸå¯¹è±¡å†…éƒ¨çš„å±æ€§æ˜¯å¼•ç”¨ç±»å‹çš„è¯ï¼Œæµ…æ‹·è´ä¼šç›´æ¥å¤åˆ¶å†…éƒ¨å¯¹è±¡çš„å¼•ç”¨åœ°å€ï¼Œä¹Ÿå°±æ˜¯è¯´æ‹·è´å¯¹è±¡å’ŒåŸå¯¹è±¡å…±ç”¨åŒä¸€ä¸ªå†…éƒ¨å¯¹è±¡ã€‚</li>
<li>æ·±æ‹·è´ï¼šæ·±æ‹·è´ä¼šå®Œå…¨å¤åˆ¶æ•´ä¸ªå¯¹è±¡ï¼ŒåŒ…æ‹¬è¿™ä¸ªå¯¹è±¡æ‰€åŒ…å«çš„å†…éƒ¨å¯¹è±¡ã€‚</li>
<li>å¼•ç”¨æ‹·è´ï¼šä¸¤ä¸ªä¸åŒçš„å¼•ç”¨æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚</li>
</ul>
<p>æµ…æ‹·è´ï¼š</p>
<p>ä»è¾“å‡ºç»“æ„å°±å¯ä»¥çœ‹å‡ºï¼Œ person1 çš„å…‹éš†å¯¹è±¡å’Œ person1 ä½¿ç”¨çš„ä»ç„¶æ˜¯åŒä¸€ä¸ª Address å¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Address</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">// çœç•¥æ„é€ å‡½æ•°ã€Getter&amp;Setteræ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Address <span class="title function_">clone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Address) <span class="built_in">super</span>.clone();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AssertionError</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line">    <span class="comment">// çœç•¥æ„é€ å‡½æ•°ã€Getter&amp;Setteræ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Person <span class="title function_">clone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> (Person) <span class="built_in">super</span>.clone();</span><br><span class="line">            <span class="keyword">return</span> person;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AssertionError</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯•</span></span><br><span class="line"><span class="type">Person</span> <span class="variable">person1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="keyword">new</span> <span class="title class_">Address</span>(<span class="string">&quot;æ­¦æ±‰&quot;</span>));</span><br><span class="line"><span class="type">Person</span> <span class="variable">person1Copy</span> <span class="operator">=</span> person1.clone();</span><br><span class="line"><span class="comment">// true</span></span><br><span class="line">System.out.println(person1.getAddress() == person1Copy.getAddress());</span><br></pre></td></tr></table></figure>
<p>æ·±æ‹·è´ï¼š</p>
<p>ä»è¾“å‡ºç»“æ„å°±å¯ä»¥çœ‹å‡ºï¼Œæ˜¾ç„¶ person1 çš„å…‹éš†å¯¹è±¡å’Œ person1 åŒ…å«çš„ Address å¯¹è±¡å·²ç»æ˜¯ä¸åŒçš„äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Person <span class="title function_">clone</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> (Person) <span class="built_in">super</span>.clone();</span><br><span class="line">        person.setAddress(person.getAddress().clone());</span><br><span class="line">        <span class="keyword">return</span> person;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AssertionError</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯•</span></span><br><span class="line"><span class="type">Person</span> <span class="variable">person1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="keyword">new</span> <span class="title class_">Address</span>(<span class="string">&quot;æ­¦æ±‰&quot;</span>));</span><br><span class="line"><span class="type">Person</span> <span class="variable">person1Copy</span> <span class="operator">=</span> person1.clone();</span><br><span class="line"><span class="comment">// false</span></span><br><span class="line">System.out.println(person1.getAddress() == person1Copy.getAddress());</span><br></pre></td></tr></table></figure>
<p><img src="/post/37c82b62/%E4%B8%89%E7%A7%8D%E6%8B%B7%E8%B4%9D%E5%AF%B9%E6%AF%94.png" alt="ä¸‰ç§æ‹·è´å¯¹æ¯”"></p>
<h3 id="Object">Object</h3>
<ol>
<li>Object ç±»å¸¸è§æ–¹æ³•</li>
</ol>
<p>Object æ˜¯æ‰€æœ‰ç±»çš„çˆ¶ç±»ï¼Œå¸¸ç”¨æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * native æ–¹æ³•ï¼Œç”¨äºè¿”å›å½“å‰è¿è¡Œæ—¶å¯¹è±¡çš„ Class å¯¹è±¡ï¼Œä½¿ç”¨äº† final å…³é”®å­—ä¿®é¥°ï¼Œæ•…ä¸å…è®¸å­ç±»é‡å†™ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> Class&lt;?&gt; getClass()</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * native æ–¹æ³•ï¼Œç”¨äºè¿”å›å¯¹è±¡çš„å“ˆå¸Œç ï¼Œä¸»è¦ä½¿ç”¨åœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œæ¯”å¦‚ JDK ä¸­çš„HashMapã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">native</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨äºæ¯”è¾ƒ 2 ä¸ªå¯¹è±¡çš„å†…å­˜åœ°å€æ˜¯å¦ç›¸ç­‰ï¼ŒString ç±»å¯¹è¯¥æ–¹æ³•è¿›è¡Œäº†é‡å†™ä»¥ç”¨äºæ¯”è¾ƒå­—ç¬¦ä¸²çš„å€¼æ˜¯å¦ç›¸ç­‰ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * native æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºå¹¶è¿”å›å½“å‰å¯¹è±¡çš„ä¸€ä»½æ‹·è´ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">native</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿”å›ç±»çš„åå­—å®ä¾‹çš„å“ˆå¸Œç çš„ 16 è¿›åˆ¶çš„å­—ç¬¦ä¸²ã€‚å»ºè®® Object æ‰€æœ‰çš„å­ç±»éƒ½é‡å†™è¿™ä¸ªæ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * native æ–¹æ³•ï¼Œå¹¶ä¸”ä¸èƒ½é‡å†™ã€‚å”¤é†’ä¸€ä¸ªåœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„çº¿ç¨‹(ç›‘è§†å™¨ç›¸å½“äºå°±æ˜¯é”çš„æ¦‚å¿µ)ã€‚å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…åªä¼šä»»æ„å”¤é†’ä¸€ä¸ªã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">()</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * native æ–¹æ³•ï¼Œå¹¶ä¸”ä¸èƒ½é‡å†™ã€‚è·Ÿ notify ä¸€æ ·ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ä¼šå”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">notifyAll</span><span class="params">()</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * nativeæ–¹æ³•ï¼Œå¹¶ä¸”ä¸èƒ½é‡å†™ã€‚æš‚åœçº¿ç¨‹çš„æ‰§è¡Œã€‚æ³¨æ„ï¼šsleep æ–¹æ³•æ²¡æœ‰é‡Šæ”¾é”ï¼Œè€Œ wait æ–¹æ³•é‡Šæ”¾äº†é” ï¼Œtimeout æ˜¯ç­‰å¾…æ—¶é—´ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">wait</span><span class="params">(<span class="type">long</span> timeout)</span> <span class="keyword">throws</span> InterruptedException</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤šäº† nanos å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°è¡¨ç¤ºé¢å¤–æ—¶é—´ï¼ˆä»¥çº³ç§’ä¸ºå•ä½ï¼ŒèŒƒå›´æ˜¯ 0-999999ï¼‰ã€‚ æ‰€ä»¥è¶…æ—¶çš„æ—¶é—´è¿˜éœ€è¦åŠ ä¸Š nanos çº³ç§’ã€‚ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">wait</span><span class="params">(<span class="type">long</span> timeout, <span class="type">int</span> nanos)</span> <span class="keyword">throws</span> InterruptedException</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·Ÿä¹‹å‰çš„2ä¸ªwaitæ–¹æ³•ä¸€æ ·ï¼Œåªä¸è¿‡è¯¥æ–¹æ³•ä¸€ç›´ç­‰å¾…ï¼Œæ²¡æœ‰è¶…æ—¶æ—¶é—´è¿™ä¸ªæ¦‚å¿µ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">wait</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®ä¾‹è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„æ—¶å€™è§¦å‘çš„æ“ä½œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable &#123; &#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>== å’Œ equals()</li>
</ol>
<p><code>== </code>å¯¹äºåŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹çš„ä½œç”¨æ•ˆæœæ˜¯ä¸åŒçš„ï¼š</p>
<ul>
<li>å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹æ¥è¯´ï¼Œ== æ¯”è¾ƒçš„æ˜¯å€¼ã€‚</li>
<li>å¯¹äºå¼•ç”¨æ•°æ®ç±»å‹æ¥è¯´ï¼Œ== æ¯”è¾ƒçš„æ˜¯å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚</li>
</ul>
<blockquote>
<p>å› ä¸º Java åªæœ‰å€¼ä¼ é€’ï¼Œæ‰€ä»¥ï¼Œå¯¹äº == æ¥è¯´ï¼Œä¸ç®¡æ˜¯æ¯”è¾ƒåŸºæœ¬æ•°æ®ç±»å‹ï¼Œè¿˜æ˜¯å¼•ç”¨æ•°æ®ç±»å‹çš„å˜é‡ï¼Œå…¶æœ¬è´¨æ¯”è¾ƒçš„éƒ½æ˜¯å€¼ï¼Œåªæ˜¯å¼•ç”¨ç±»å‹å˜é‡å­˜çš„å€¼æ˜¯å¯¹è±¡çš„åœ°å€ã€‚</p>
</blockquote>
<p>equals() ä¸èƒ½ç”¨äºåˆ¤æ–­åŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡ï¼Œåªèƒ½ç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚equals()æ–¹æ³•å­˜åœ¨äºObjectç±»ä¸­ï¼Œè€ŒObjectç±»æ˜¯æ‰€æœ‰ç±»çš„ç›´æ¥æˆ–é—´æ¥çˆ¶ç±»ï¼Œå› æ­¤æ‰€æœ‰çš„ç±»éƒ½æœ‰equals()æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Object ç±» equals() æ–¹æ³•ï¼š<span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">     <span class="keyword">return</span> (<span class="built_in">this</span> == obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>equals() æ–¹æ³•å­˜åœ¨ä¸¤ç§ä½¿ç”¨æƒ…å†µï¼š</p>
<ul>
<li><strong>ç±»æ²¡æœ‰é‡å†™ equals()æ–¹æ³•</strong>ï¼šé€šè¿‡equals()æ¯”è¾ƒè¯¥ç±»çš„ä¸¤ä¸ªå¯¹è±¡æ—¶ï¼Œç­‰ä»·äºé€šè¿‡â€œ==â€æ¯”è¾ƒè¿™ä¸¤ä¸ªå¯¹è±¡ï¼Œä½¿ç”¨çš„é»˜è®¤æ˜¯ Objectç±»equals()æ–¹æ³•ã€‚</li>
<li><strong>ç±»é‡å†™äº† equals()æ–¹æ³•</strong>ï¼šä¸€èˆ¬æˆ‘ä»¬éƒ½é‡å†™ equals()æ–¹æ³•æ¥æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡ä¸­çš„å±æ€§æ˜¯å¦ç›¸ç­‰ï¼›è‹¥å®ƒä»¬çš„å±æ€§ç›¸ç­‰ï¼Œåˆ™è¿”å› true(å³ï¼Œè®¤ä¸ºè¿™ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰)ã€‚</li>
</ul>
<p>String ä¸­çš„ equals æ–¹æ³•æ˜¯è¢«é‡å†™è¿‡çš„ï¼Œå› ä¸º Object çš„ equals æ–¹æ³•æ˜¯æ¯”è¾ƒçš„å¯¹è±¡çš„å†…å­˜åœ°å€ï¼Œè€Œ <strong>String çš„ equals æ–¹æ³•æ¯”è¾ƒçš„æ˜¯å¯¹è±¡çš„å€¼</strong>ã€‚å½“åˆ›å»º String ç±»å‹çš„å¯¹è±¡æ—¶ï¼Œè™šæ‹Ÿæœºä¼šåœ¨<strong>å¸¸é‡æ± </strong>ä¸­æŸ¥æ‰¾æœ‰æ²¡æœ‰å·²ç»å­˜åœ¨çš„å€¼å’Œè¦åˆ›å»ºçš„å€¼ç›¸åŒçš„å¯¹è±¡ï¼Œå¦‚æœæœ‰å°±æŠŠå®ƒèµ‹ç»™å½“å‰å¼•ç”¨ã€‚å¦‚æœæ²¡æœ‰å°±åœ¨å¸¸é‡æ± ä¸­é‡æ–°åˆ›å»ºä¸€ä¸ª String å¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object anObject)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span> == anObject) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (anObject <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">anotherString</span> <span class="operator">=</span> (String)anObject;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> value.length;</span><br><span class="line">        <span class="keyword">if</span> (n == anotherString.value.length) &#123;</span><br><span class="line">            <span class="type">char</span> v1[] = value;</span><br><span class="line">            <span class="type">char</span> v2[] = anotherString.value;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (n-- != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (v1[i] != v2[i])</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>hashCode()</li>
</ol>
<p>hashCode() çš„ä½œç”¨æ˜¯è·å–å“ˆå¸Œç ï¼ˆint æ•´æ•°ï¼‰ï¼Œä¹Ÿç§°ä¸ºæ•£åˆ—ç ã€‚è¿™ä¸ªå“ˆå¸Œç çš„ä½œç”¨æ˜¯ç¡®å®šè¯¥å¯¹è±¡åœ¨å“ˆå¸Œè¡¨ä¸­çš„ç´¢å¼•ä½ç½®ã€‚æ•£åˆ—è¡¨ï¼ˆç”¨åˆ°äº†æ•£åˆ—ç ï¼‰å­˜å‚¨çš„æ˜¯é”®å€¼å¯¹(key-value)ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯ï¼š<strong>èƒ½æ ¹æ®â€œé”®â€å¿«é€Ÿçš„æ£€ç´¢å‡ºå¯¹åº”çš„â€œå€¼â€</strong>ã€‚</p>
<p>ä¸ºä½•éœ€è¦<code>hashCode()</code>?</p>
<p>hashCode() å’Œ equals()éƒ½æ˜¯ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚åœ¨ä¸€äº›å®¹å™¨ä¸­ï¼ˆHashMapã€HashSetï¼‰ï¼Œå½“åŒæ ·çš„hashCode æœ‰å¤šä¸ªå¯¹è±¡ï¼Œå®ƒä¼šç»§ç»­ä½¿ç”¨ equals æ¥åˆ¤æ–­æ˜¯å¦çœŸçš„ç›¸åŒï¼Œå³ hashCode ç¼©å°äº†æŸ¥æ‰¾æˆæœ¬ã€‚hashCode å’Œ equals ç¼ºä¸€ä¸å¯ï¼Œå› ä¸º hashCode ç›¸ç­‰çš„ä¸ä»£è¡¨ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼ˆå¦‚ä¸Šä¸€å¥æ‰€ç¤ºï¼‰ã€‚</p>
<ul>
<li>å¦‚æœä¸¤ä¸ªå¯¹è±¡çš„hashCode å€¼ç›¸ç­‰ï¼Œé‚£è¿™ä¸¤ä¸ªå¯¹è±¡ä¸ä¸€å®šç›¸ç­‰ï¼ˆå“ˆå¸Œç¢°æ’ï¼‰ã€‚</li>
<li>å¦‚æœä¸¤ä¸ªå¯¹è±¡çš„hashCode å€¼ç›¸ç­‰å¹¶ä¸”equals()æ–¹æ³•ä¹Ÿè¿”å› trueï¼Œæˆ‘ä»¬æ‰è®¤ä¸ºè¿™ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ã€‚</li>
<li>å¦‚æœä¸¤ä¸ªå¯¹è±¡çš„hashCode å€¼ä¸ç›¸ç­‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è®¤ä¸ºè¿™ä¸¤ä¸ªå¯¹è±¡ä¸ç›¸ç­‰ã€‚</li>
</ul>
<ol start="4">
<li>é‡å†™ equals å¿…é¡»é‡å†™ hashCode()</li>
</ol>
<p>å› ä¸ºä¸¤ä¸ªç›¸ç­‰çš„å¯¹è±¡çš„ hashCode å€¼å¿…é¡»æ˜¯ç›¸ç­‰ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœ equals æ–¹æ³•åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯ç›¸ç­‰çš„ï¼Œé‚£è¿™ä¸¤ä¸ªå¯¹è±¡çš„ hashCode å€¼ä¹Ÿè¦ç›¸ç­‰ã€‚</p>
<p>å¦‚æœé‡å†™ equals() æ—¶æ²¡æœ‰é‡å†™ hashCode() æ–¹æ³•çš„è¯å°±å¯èƒ½ä¼šå¯¼è‡´ equals æ–¹æ³•åˆ¤æ–­æ˜¯ç›¸ç­‰çš„ä¸¤ä¸ªå¯¹è±¡ï¼ŒhashCode å€¼å´ä¸ç›¸ç­‰ã€‚</p>
<p>æ€è€ƒï¼šé‡å†™ equals() æ—¶æ²¡æœ‰é‡å†™ hashCode() æ–¹æ³•çš„è¯ï¼Œä½¿ç”¨ HashMap å¯èƒ½ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ã€‚</p>
<p>æ€»ç»“ï¼š</p>
<ul>
<li>equals æ–¹æ³•åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯ç›¸ç­‰çš„ï¼Œé‚£è¿™ä¸¤ä¸ªå¯¹è±¡çš„ hashCode å€¼ä¹Ÿè¦ç›¸ç­‰ã€‚</li>
<li>ä¸¤ä¸ªå¯¹è±¡æœ‰ç›¸åŒçš„ hashCode å€¼ï¼Œä»–ä»¬ä¹Ÿä¸ä¸€å®šæ˜¯ç›¸ç­‰çš„ï¼ˆå“ˆå¸Œç¢°æ’ï¼‰ã€‚</li>
</ul>
<h3 id="String">String</h3>
<ol>
<li><code>String</code>`StringBuffer<code>\</code>StringBuilder`</li>
</ol>
<ul>
<li>å¯å˜æ€§â€”â€”String æ˜¯ä¸å¯å˜çš„ã€‚StringBuilder ä¸ StringBuffer éƒ½ç»§æ‰¿è‡ª AbstractStringBuilder ç±»ï¼Œåœ¨ AbstractStringBuilder ä¸­ä¹Ÿæ˜¯ä½¿ç”¨å­—ç¬¦æ•°ç»„ä¿å­˜å­—ç¬¦ä¸²ï¼Œä¸è¿‡æ²¡æœ‰ä½¿ç”¨ final å’Œ private å…³é”®å­—ä¿®é¥°ï¼Œæœ€å…³é”®çš„æ˜¯è¿™ä¸ª AbstractStringBuilder ç±»è¿˜æä¾›äº†å¾ˆå¤šä¿®æ”¹å­—ç¬¦ä¸²çš„æ–¹æ³•æ¯”å¦‚ append æ–¹æ³•ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractStringBuilder</span> <span class="keyword">implements</span> <span class="title class_">Appendable</span>, CharSequence &#123;</span><br><span class="line">    <span class="type">char</span>[] value;</span><br><span class="line">    <span class="keyword">public</span> AbstractStringBuilder <span class="title function_">append</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (str == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> appendNull();</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> str.length();</span><br><span class="line">        ensureCapacityInternal(count + len);</span><br><span class="line">        str.getChars(<span class="number">0</span>, len, value, count);</span><br><span class="line">        count += len;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  	<span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>çº¿ç¨‹å®‰å…¨æ€§â€”â€”String ä¸­çš„å¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œä¹Ÿå°±å¯ä»¥ç†è§£ä¸ºå¸¸é‡ï¼Œçº¿ç¨‹å®‰å…¨ã€‚AbstractStringBuilder æ˜¯ StringBuilder ä¸ StringBuffer çš„å…¬å…±çˆ¶ç±»ï¼Œå®šä¹‰äº†ä¸€äº›å­—ç¬¦ä¸²çš„åŸºæœ¬æ“ä½œï¼Œå¦‚ expandCapacityã€appendã€insertã€indexOf ç­‰å…¬å…±æ–¹æ³•ã€‚StringBuffer å¯¹æ–¹æ³•åŠ äº†åŒæ­¥é”æˆ–è€…å¯¹è°ƒç”¨çš„æ–¹æ³•åŠ äº†åŒæ­¥é”ï¼Œæ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚StringBuilder å¹¶æ²¡æœ‰å¯¹æ–¹æ³•è¿›è¡ŒåŠ åŒæ­¥é”ï¼Œæ‰€ä»¥æ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚</li>
<li>æ€§èƒ½â€”â€”æ¯æ¬¡å¯¹ String ç±»å‹è¿›è¡Œæ”¹å˜çš„æ—¶å€™ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ String å¯¹è±¡ï¼Œç„¶åå°†æŒ‡é’ˆæŒ‡å‘æ–°çš„ String å¯¹è±¡ã€‚StringBuffer æ¯æ¬¡éƒ½ä¼šå¯¹ StringBuffer å¯¹è±¡æœ¬èº«è¿›è¡Œæ“ä½œï¼Œè€Œä¸æ˜¯ç”Ÿæˆæ–°çš„å¯¹è±¡å¹¶æ”¹å˜å¯¹è±¡å¼•ç”¨ã€‚ç›¸åŒæƒ…å†µä¸‹ä½¿ç”¨ StringBuilder ç›¸æ¯”ä½¿ç”¨ StringBuffer ä»…èƒ½è·å¾— 10%~15% å·¦å³çš„æ€§èƒ½æå‡ï¼Œä½†å´è¦å†’å¤šçº¿ç¨‹ä¸å®‰å…¨çš„é£é™©ã€‚</li>
</ul>
<blockquote>
<p>æ“ä½œå°‘é‡çš„æ•°æ®: é€‚ç”¨ String</p>
<p>å•çº¿ç¨‹æ“ä½œå­—ç¬¦ä¸²ç¼“å†²åŒºä¸‹æ“ä½œå¤§é‡æ•°æ®: é€‚ç”¨ StringBuilder</p>
<p>å¤šçº¿ç¨‹æ“ä½œå­—ç¬¦ä¸²ç¼“å†²åŒºä¸‹æ“ä½œå¤§é‡æ•°æ®: é€‚ç”¨ StringBuffer</p>
</blockquote>
<ol start="2">
<li>String ä¸å¯å˜</li>
</ol>
<blockquote>
<ol>
<li>ä¿å­˜å­—ç¬¦ä¸²çš„æ•°ç»„è¢« final ä¿®é¥°ä¸”ä¸ºç§æœ‰çš„ï¼Œå¹¶ä¸” String ç±»æ²¡æœ‰æä¾›/æš´éœ²ä¿®æ”¹è¿™ä¸ªå­—ç¬¦ä¸²çš„æ–¹æ³•ã€‚</li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li>String ç±»è¢« final ä¿®é¥°å¯¼è‡´å…¶ä¸èƒ½è¢«ç»§æ‰¿ï¼Œä»è€Œé¿å…å­ç±»ç ´å String ä¸å¯å˜æ€§ã€‚</li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">String</span> <span class="keyword">implements</span> <span class="title class_">java</span>.io.Serializable, Comparable&lt;String&gt;, CharSequence &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">char</span> value[];</span><br><span class="line">	<span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Java9 ä¹‹åï¼ŒStringã€StringBuilderã€StringBuffer çš„å®ç°æ”¹ç”¨ byte æ•°ç»„å­˜æ”¾å­—ç¬¦ä¸²ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">String</span> <span class="keyword">implements</span> <span class="title class_">java</span>.io.Serializable,Comparable&lt;String&gt;, CharSequence &#123;</span><br><span class="line">    <span class="comment">// @Stable æ³¨è§£è¡¨ç¤ºå˜é‡æœ€å¤šè¢«ä¿®æ”¹ä¸€æ¬¡ï¼Œç§°ä¸ºâ€œç¨³å®šçš„â€ã€‚</span></span><br><span class="line">    <span class="meta">@Stable</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">byte</span>[] value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractStringBuilder</span> <span class="keyword">implements</span> <span class="title class_">Appendable</span>, CharSequence &#123;</span><br><span class="line">    <span class="type">byte</span>[] value;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŸå› ï¼š<a href="https://openjdk.java.net/jeps/254">å®˜æ–¹ä»‹ç»</a></p>
<p><img src="/post/37c82b62/Java9%E6%94%B9%E7%94%A8byte%E5%AD%98%E5%82%A8String.png" alt="Java9æ”¹ç”¨byteå­˜å‚¨String"></p>
<ol start="3">
<li>å­—ç¬¦ä¸²æ‹¼æ¥ï¼šâ€œ+â€ vs StringBuilder</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="string">&quot;he&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="string">&quot;llo&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">str3</span> <span class="operator">=</span> <span class="string">&quot;world&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">str4</span> <span class="operator">=</span> str1 + str2 + str3;</span><br></pre></td></tr></table></figure>
<p>å­—èŠ‚ç ï¼š</p>
<p><img src="/post/37c82b62/+%E6%8B%BC%E6%8E%A5%E5%AD%97%E7%AC%A6%E4%B8%B2.png" alt="+æ‹¼æ¥å­—ç¬¦ä¸²"></p>
<p>Javaå­—ç¬¦ä¸²å¯¹è±¡çš„<code>+</code>æ‹¼æ¥æ–¹å¼ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡<code>StringBuilder</code>çš„<code>append()</code>æ–¹æ³•å®ç°çš„ï¼Œæ‹¼æ¥å®Œæˆä¹‹åè°ƒç”¨<code>toString()</code>å¾—åˆ°ä¸€ä¸ª String å¯¹è±¡ã€‚</p>
<p>â€”â€”å› æ­¤ï¼Œåœ¨ç¼–è¯‘å™¨ä¸ä¼šåˆ›å»ºä¸€ä¸ª<code>StringBuilder</code>ä»¥å¤ç”¨çš„æƒ…å†µä¸‹ï¼Œåœ¨å¾ªç¯ä¸­ä½¿ç”¨<code>+</code>ä¼šå¯¼è‡´åˆ›å»ºå¤§é‡<code>StringBuilder</code>å¯¹è±¡ï¼Œå½±å“æ€§èƒ½ã€‚</p>
<p>â€”â€”åœ¨JDK9ä¸­ï¼Œ<code>+</code>æ”¹ä¸º<code>makeConcatWithConstants()</code>æ¥å®ç°ï¼Œé¿å… StringBuilder ä¸´æ—¶å¯¹è±¡çš„äº§ç”Ÿï¼ˆå‚è§ï¼š<a href="https://openjdk.org/jeps/280">JEP 280</a>ï¼‰ï¼Œå³å¯ä»¥ä½¿ç”¨<code>+</code>æ‹¼æ¥å¯¹è±¡äº†ï¼Œè€Œéä¸€ç›´<code>StringBuilder</code>ã€‚</p>
<ol start="4">
<li><code>String.equals()</code> å’Œ <code>Object.equals()</code></li>
</ol>
<ul>
<li>String ä¸­çš„ equals æ–¹æ³•æ˜¯è¢«é‡å†™è¿‡çš„ï¼Œæ¯”è¾ƒçš„æ˜¯ String å­—ç¬¦ä¸²çš„å€¼æ˜¯å¦ç›¸ç­‰ã€‚</li>
<li>Object çš„ equals æ–¹æ³•æ˜¯æ¯”è¾ƒçš„å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚</li>
</ul>
<ol start="5">
<li>å­—ç¬¦ä¸²å¸¸é‡æ± </li>
</ol>
<p>å­—ç¬¦ä¸²å¸¸é‡æ±  æ˜¯ JVM ä¸ºäº†æå‡æ€§èƒ½å’Œå‡å°‘å†…å­˜æ¶ˆè€—é’ˆå¯¹å­—ç¬¦ä¸²ï¼ˆString ç±»ï¼‰ä¸“é—¨å¼€è¾Ÿçš„ä¸€å—åŒºåŸŸï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†é¿å…å­—ç¬¦ä¸²çš„é‡å¤åˆ›å»ºã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœ¨å †ä¸­åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡â€abâ€œ</span></span><br><span class="line"><span class="comment">// å°†å­—ç¬¦ä¸²å¯¹è±¡â€abâ€œçš„å¼•ç”¨ä¿å­˜åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­</span></span><br><span class="line"><span class="type">String</span> <span class="variable">aa</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>;</span><br><span class="line"><span class="comment">// ç›´æ¥è¿”å›å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å­—ç¬¦ä¸²å¯¹è±¡â€abâ€œçš„å¼•ç”¨</span></span><br><span class="line"><span class="type">String</span> <span class="variable">bb</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>;</span><br><span class="line">System.out.println(aa==bb);<span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<ol start="6">
<li><code>String s1 = new String(&quot;abc&quot;) </code>åˆ›å»ºçš„å¯¹è±¡</li>
</ol>
<p>è¿™è¡Œä»£ç åˆ›å»ºäº†ä¸€ä¸ªæˆ–ä¸¤ä¸ªå¯¹è±¡ã€‚</p>
<ul>
<li>
<ol>
<li>å¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ä¸å­˜åœ¨å­—ç¬¦ä¸²å¯¹è±¡â€œabcâ€çš„å¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå°†é¦–å…ˆåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­åˆ›å»ºï¼Œç„¶ååœ¨å †ç©ºé—´ä¸­åˆ›å»ºï¼Œå› æ­¤å°†åˆ›å»ºæ€»å…± 2 ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ã€‚</li>
</ol>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);  <span class="comment">// JDK 1.8</span></span><br></pre></td></tr></table></figure>
<p>å¯¹åº”çš„å­—èŠ‚ç ï¼š</p>
<p>![new String è¯­å¥åˆ›å»ºçš„å¯¹è±¡1](new String è¯­å¥åˆ›å»ºçš„å¯¹è±¡1.png)</p>
<p>ldc å‘½ä»¤ç”¨äºåˆ¤æ–­å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ˜¯å¦ä¿å­˜äº†å¯¹åº”çš„å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ï¼Œå¦‚æœä¿å­˜äº†çš„è¯ç›´æ¥è¿”å›ï¼Œå¦‚æœæ²¡æœ‰ä¿å­˜çš„è¯ï¼Œä¼šåœ¨å †ä¸­åˆ›å»ºå¯¹åº”çš„å­—ç¬¦ä¸²å¯¹è±¡å¹¶å°†è¯¥å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ä¿å­˜åˆ°å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ã€‚</p>
<ul>
<li>
<ol start="2">
<li>å¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å·²å­˜åœ¨å­—ç¬¦ä¸²å¯¹è±¡â€œabcâ€çš„å¼•ç”¨ï¼Œåˆ™åªä¼šåœ¨å †ä¸­åˆ›å»º 1 ä¸ªå­—ç¬¦ä¸²å¯¹è±¡â€œabcâ€ã€‚</li>
</ol>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å·²å­˜åœ¨å­—ç¬¦ä¸²å¯¹è±¡â€œabcâ€çš„å¼•ç”¨</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;abc&quot;</span>;</span><br><span class="line"><span class="comment">// ä¸‹é¢è¿™æ®µä»£ç åªä¼šåœ¨å †ä¸­åˆ›å»º 1 ä¸ªå­—ç¬¦ä¸²å¯¹è±¡â€œabcâ€</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>å­—èŠ‚ç ï¼š</p>
<p>![new String è¯­å¥åˆ›å»ºçš„å¯¹è±¡2](new String è¯­å¥åˆ›å»ºçš„å¯¹è±¡2.png)</p>
<ol start="7">
<li><code>String.itern</code></li>
</ol>
<p>String.intern() æ˜¯ä¸€ä¸ª nativeï¼ˆæœ¬åœ°ï¼‰æ–¹æ³•ï¼Œå…¶ä½œç”¨æ˜¯å°†æŒ‡å®šçš„å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ä¿å­˜åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œå¯ä»¥ç®€å•åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</p>
<ul>
<li>å¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ä¿å­˜äº†å¯¹åº”çš„å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ï¼Œå°±ç›´æ¥è¿”å›è¯¥å¼•ç”¨ã€‚</li>
<li>å¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ²¡æœ‰ä¿å­˜äº†å¯¹åº”çš„å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ï¼Œé‚£å°±åœ¨å¸¸é‡æ± ä¸­åˆ›å»ºä¸€ä¸ªæŒ‡å‘è¯¥å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨å¹¶è¿”å›ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœ¨å †ä¸­åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡â€Javaâ€œ</span></span><br><span class="line"><span class="comment">// å°†å­—ç¬¦ä¸²å¯¹è±¡â€Javaâ€œçš„å¼•ç”¨ä¿å­˜åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;Java&quot;</span>;</span><br><span class="line"><span class="comment">// ç›´æ¥è¿”å›å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å­—ç¬¦ä¸²å¯¹è±¡â€Javaâ€œå¯¹åº”çš„å¼•ç”¨</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> s1.intern();</span><br><span class="line"><span class="comment">// ä¼šåœ¨å †ä¸­åœ¨å•ç‹¬åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;Java&quot;</span>);</span><br><span class="line"><span class="comment">// ç›´æ¥è¿”å›å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å­—ç¬¦ä¸²å¯¹è±¡â€Javaâ€œå¯¹åº”çš„å¼•ç”¨</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> s3.intern();</span><br><span class="line"><span class="comment">// s1 å’Œ s2 æŒ‡å‘çš„æ˜¯å †ä¸­çš„åŒä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">System.out.println(s1 == s2); <span class="comment">// true</span></span><br><span class="line"><span class="comment">// s3 å’Œ s4 æŒ‡å‘çš„æ˜¯å †ä¸­ä¸åŒçš„å¯¹è±¡</span></span><br><span class="line">System.out.println(s3 == s4); <span class="comment">// false</span></span><br><span class="line"><span class="comment">// s1 å’Œ s4 æŒ‡å‘çš„æ˜¯å †ä¸­çš„åŒä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">System.out.println(s1 == s4); <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<ol start="8">
<li>Stringç±»å‹å˜é‡å’Œå¸¸é‡åšâ€œ+â€è¿ç®—ï¼ˆ<strong>Todo</strong>ï¼‰</li>
</ol>
<p>å­—ç¬¦ä¸²æ‹¼æ¥ã€‚ï¼ˆå­—ç¬¦ä¸²æ‹¼æ¥åœ¨ç¼–è¯‘å™¨ä¸­çš„ä¼˜åŒ–æªæ–½ï¼Œå¾…çœ‹ã€‚ï¼‰</p>
<h3 id="å¼‚å¸¸">å¼‚å¸¸</h3>
<p><img src="/post/37c82b62/%E5%BC%82%E5%B8%B8%E5%88%86%E7%B1%BB.png" alt="å¼‚å¸¸åˆ†ç±»"></p>
<ol>
<li>Exception å’Œ Error åŒºåˆ«</li>
</ol>
<ul>
<li>Exceptionï¼šç¨‹åºæœ¬èº«å¯ä»¥å¤„ç†çš„å¼‚å¸¸ï¼Œå¯ä»¥é€šè¿‡ catch æ¥è¿›è¡Œæ•è·ã€‚Exception åˆå¯ä»¥åˆ†ä¸º Checked Exception (å—æ£€æŸ¥å¼‚å¸¸ï¼Œå¿…é¡»å¤„ç†) å’Œ Unchecked Exception (ä¸å—æ£€æŸ¥å¼‚å¸¸ï¼Œå¯ä»¥ä¸å¤„ç†)ã€‚</li>
<li>Errorï¼šError å±äºç¨‹åºæ— æ³•å¤„ç†çš„é”™è¯¯ ï¼Œä¸å»ºè®®é€šè¿‡catchæ•è· ã€‚ä¾‹å¦‚ Java è™šæ‹Ÿæœºè¿è¡Œé”™è¯¯ï¼ˆVirtual MachineErrorï¼‰ã€è™šæ‹Ÿæœºå†…å­˜ä¸å¤Ÿé”™è¯¯(OutOfMemoryError)ã€ç±»å®šä¹‰é”™è¯¯ï¼ˆNoClassDefFoundErrorï¼‰ç­‰ ã€‚è¿™äº›å¼‚å¸¸å‘ç”Ÿæ—¶ï¼ŒJava è™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸€èˆ¬ä¼šé€‰æ‹©çº¿ç¨‹ç»ˆæ­¢ã€‚</li>
</ul>
<ol start="2">
<li>Checked Exception å’Œ Unchecked Exception</li>
</ol>
<ul>
<li>Checked Exceptionï¼šåœ¨ç¼–è¯‘æ—¶è‹¥æ²¡æœ‰ç»è¿‡ catch æ•è·æˆ–è€… throws å¤„ç†ï¼Œæ— æ³•ç¼–è¯‘é€šè¿‡ã€‚</li>
<li>Unchecked Exceptionï¼šä¸å¤„ç†ä¹Ÿå¯ç¼–è¯‘é€šè¿‡ã€‚</li>
</ul>
<p>RuntimeException åŠå…¶å­ç±»éƒ½ç»Ÿç§°ä¸ºéå—æ£€æŸ¥å¼‚å¸¸ï¼Œå¸¸è§çš„æœ‰ï¼š</p>
<ul>
<li>NullPointerException(ç©ºæŒ‡é’ˆé”™è¯¯)</li>
<li>IllegalArgumentException(å‚æ•°é”™è¯¯æ¯”å¦‚æ–¹æ³•å…¥å‚ç±»å‹é”™è¯¯)</li>
<li>NumberFormatExceptionï¼ˆå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—æ ¼å¼é”™è¯¯ï¼ŒIllegalArgumentExceptionçš„å­ç±»ï¼‰</li>
<li>ArrayIndexOutOfBoundsExceptionï¼ˆæ•°ç»„è¶Šç•Œé”™è¯¯ï¼‰</li>
<li>ClassCastExceptionï¼ˆç±»å‹è½¬æ¢é”™è¯¯ï¼‰</li>
<li>ArithmeticExceptionï¼ˆç®—æœ¯é”™è¯¯ï¼‰</li>
<li>SecurityException ï¼ˆå®‰å…¨é”™è¯¯æ¯”å¦‚æƒé™ä¸å¤Ÿï¼‰</li>
<li>UnsupportedOperationException(ä¸æ”¯æŒçš„æ“ä½œé”™è¯¯æ¯”å¦‚é‡å¤åˆ›å»ºåŒä¸€ç”¨æˆ·)</li>
</ul>
<ol start="3">
<li>Throwable ç±»å¸¸ç”¨æ–¹æ³•</li>
</ol>
<ul>
<li>String getMessage(): è¿”å›å¼‚å¸¸å‘ç”Ÿæ—¶çš„ç®€è¦æè¿°</li>
<li>String toString(): è¿”å›å¼‚å¸¸å‘ç”Ÿæ—¶çš„è¯¦ç»†ä¿¡æ¯</li>
<li>String getLocalizedMessage(): è¿”å›å¼‚å¸¸å¯¹è±¡çš„æœ¬åœ°åŒ–ä¿¡æ¯ã€‚ä½¿ç”¨ Throwable çš„å­ç±»è¦†ç›–è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”Ÿæˆæœ¬åœ°åŒ–ä¿¡æ¯ã€‚å¦‚æœå­ç±»æ²¡æœ‰è¦†ç›–è¯¥æ–¹æ³•ï¼Œåˆ™è¯¥æ–¹æ³•è¿”å›çš„ä¿¡æ¯ä¸ getMessage()è¿”å›çš„ç»“æœç›¸åŒ</li>
<li>void printStackTrace(): åœ¨æ§åˆ¶å°ä¸Šæ‰“å° Throwable å¯¹è±¡å°è£…çš„å¼‚å¸¸ä¿¡æ¯</li>
</ul>
<ol start="4">
<li>try-catch-finally</li>
</ol>
<ul>
<li>tryå—ï¼šç”¨äºæ•è·å¼‚å¸¸ã€‚å…¶åå¯æ¥é›¶ä¸ªæˆ–å¤šä¸ª catch å—ï¼Œå¦‚æœæ²¡æœ‰ catch å—ï¼Œåˆ™å¿…é¡»è·Ÿä¸€ä¸ª finally å—ã€‚</li>
<li>catchå—ï¼šç”¨äºå¤„ç† try æ•è·åˆ°çš„å¼‚å¸¸ã€‚</li>
<li>finally å—ï¼šæ— è®ºæ˜¯å¦æ•è·æˆ–å¤„ç†å¼‚å¸¸ï¼Œfinally å—é‡Œçš„è¯­å¥éƒ½ä¼šè¢«æ‰§è¡Œã€‚å½“åœ¨ try å—æˆ– catch å—ä¸­é‡åˆ° return è¯­å¥æ—¶ï¼Œfinally è¯­å¥å—å°†åœ¨æ–¹æ³•è¿”å›ä¹‹å‰è¢«æ‰§è¡Œã€‚</li>
</ul>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼š<strong>ä¸è¦åœ¨ finally è¯­å¥å—ä¸­ä½¿ç”¨ return!</strong> å½“ try è¯­å¥å’Œ finally è¯­å¥ä¸­éƒ½æœ‰ return è¯­å¥æ—¶ï¼Œtry è¯­å¥å—ä¸­çš„ return è¯­å¥ä¼šè¢«å¿½ç•¥ã€‚è¿™æ˜¯å› ä¸º try è¯­å¥ä¸­çš„ return è¿”å›å€¼ä¼šå…ˆè¢«æš‚å­˜åœ¨ä¸€ä¸ªæœ¬åœ°å˜é‡ä¸­ï¼Œå½“æ‰§è¡Œåˆ° finally è¯­å¥ä¸­çš„ return ä¹‹åï¼Œè¿™ä¸ªæœ¬åœ°å˜é‡çš„å€¼å°±å˜ä¸ºäº† finally è¯­å¥ä¸­çš„ return è¿”å›å€¼ã€‚</p>
</blockquote>
<p>finally å—ä»£ç ä¸ä¼šè¢«æ‰§è¡Œçš„æƒ…å†µï¼š</p>
<ul>
<li>finally ä¹‹å‰è™šæ‹Ÿæœºè¢«ç»ˆæ­¢è¿è¡Œ</li>
<li>ç¨‹åºæ‰€åœ¨çº¿ç¨‹æ­»äº¡</li>
<li>å…³é—­CPU</li>
</ul>
<p>è¡¥å……ï¼šä»å­—èŠ‚ç è§’åº¦åˆ†ætry catch finallyè¿™ä¸ªè¯­æ³•ç³–èƒŒåçš„å®ç°åŸç†ã€‚ï¼ˆTodoï¼‰</p>
<ol start="5">
<li><strong>try-with-resource</strong></li>
</ol>
<p>é€‚ç”¨èŒƒå›´ï¼ˆèµ„æºçš„å®šä¹‰ï¼‰ï¼š ä»»ä½•å®ç° java.lang.AutoCloseableæˆ–è€… java.io.Closeable çš„å¯¹è±¡ã€‚</p>
<p>å…³é—­èµ„æºå’Œ finally å—çš„æ‰§è¡Œé¡ºåºï¼š åœ¨ try-with-resources è¯­å¥ä¸­ï¼Œä»»ä½• catch æˆ– finally å—åœ¨å£°æ˜çš„èµ„æºå…³é—­åè¿è¡Œã€‚</p>
<p>Java ä¸­ç±»ä¼¼äº InputStreamã€OutputStreamã€Scannerã€PrintWriter ç­‰çš„èµ„æºéƒ½éœ€è¦æˆ‘ä»¬è°ƒç”¨close()æ–¹æ³•æ¥æ‰‹åŠ¨å…³é—­ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬éƒ½æ˜¯é€šè¿‡try-catch-finallyè¯­å¥æ¥å®ç°è¿™ä¸ªéœ€æ±‚ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¯»å–æ–‡æœ¬æ–‡ä»¶çš„å†…å®¹</span></span><br><span class="line"><span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    scanner = <span class="keyword">new</span> <span class="title class_">Scanner</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D://read.txt&quot;</span>));</span><br><span class="line">    <span class="keyword">while</span> (scanner.hasNext()) &#123;</span><br><span class="line">        System.out.println(scanner.nextLine());</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (scanner != <span class="literal">null</span>) &#123;</span><br><span class="line">        scanner.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>æ³¨æ„ç‚¹ï¼š</li>
</ol>
<ul>
<li>ä¸è¦æŠŠå¼‚å¸¸å®šä¹‰ä¸ºé™æ€å˜é‡ï¼Œå› ä¸ºè¿™æ ·ä¼šå¯¼è‡´å¼‚å¸¸æ ˆä¿¡æ¯é”™ä¹±ã€‚æ¯æ¬¡æ‰‹åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼Œæˆ‘ä»¬éƒ½éœ€è¦æ‰‹åŠ¨ new ä¸€ä¸ªå¼‚å¸¸å¯¹è±¡æŠ›å‡ºã€‚</li>
<li>æŠ›å‡ºçš„å¼‚å¸¸ä¿¡æ¯ä¸€å®šè¦æœ‰æ„ä¹‰ã€‚</li>
<li>å»ºè®®æŠ›å‡ºæ›´åŠ å…·ä½“çš„å¼‚å¸¸æ¯”å¦‚å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—æ ¼å¼é”™è¯¯çš„æ—¶å€™åº”è¯¥æŠ›å‡ºNumberFormatExceptionè€Œä¸æ˜¯å…¶çˆ¶ç±»IllegalArgumentExceptionã€‚</li>
<li>ä½¿ç”¨æ—¥å¿—æ‰“å°å¼‚å¸¸ä¹‹åå°±ä¸è¦å†æŠ›å‡ºå¼‚å¸¸äº†ï¼ˆä¸¤è€…ä¸è¦åŒæ—¶å­˜åœ¨ä¸€æ®µä»£ç é€»è¾‘ä¸­ï¼‰ã€‚</li>
</ul>
<h3 id="æ³›å‹">æ³›å‹</h3>
<ol>
<li>æ˜¯ä»€ä¹ˆã€ä½œç”¨</li>
</ol>
<p>æ³›å‹ï¼ˆGenericsï¼‰æ˜¯Javaä¸­å¼•å…¥çš„ä¸€ç§<strong>ç±»å‹å‚æ•°åŒ–çš„æœºåˆ¶</strong>ã€‚å®ƒå…è®¸åœ¨å®šä¹‰ç±»ã€æ¥å£å’Œæ–¹æ³•æ—¶ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªç±»å‹å‚æ•°ï¼Œä»¥å¢å¼ºä»£ç çš„å¯é‡ç”¨æ€§ã€ç±»å‹å®‰å…¨æ€§å’Œä»£ç çš„æ¸…æ™°åº¦ã€‚</p>
<ol start="2">
<li>ä½¿ç”¨æ–¹å¼</li>
</ol>
<p>æ³›å‹ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ­¤å¤„Tå¯ä»¥éšä¾¿å†™ä¸ºä»»æ„æ ‡è¯†ï¼Œå¸¸è§çš„å¦‚Tã€Eã€Kã€Vç­‰å½¢å¼çš„å‚æ•°å¸¸ç”¨äºè¡¨ç¤ºæ³›å‹</span></span><br><span class="line"><span class="comment">//åœ¨å®ä¾‹åŒ–æ³›å‹ç±»æ—¶ï¼Œå¿…é¡»æŒ‡å®šTçš„å…·ä½“ç±»å‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Generic</span>&lt;T&gt;&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T key;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Generic</span><span class="params">(T key)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.key = key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getKey</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> key;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ä¾‹åŒ–ï¼š</span></span><br><span class="line">Generic&lt;Integer&gt; genericInteger = <span class="keyword">new</span> <span class="title class_">Generic</span>&lt;Integer&gt;(<span class="number">123456</span>);</span><br></pre></td></tr></table></figure>
<p>æ³›å‹æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Generator</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">method</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç°æ¥å£ï¼šä¸æŒ‡å®šç±»å‹ã€æŒ‡å®šç±»å‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GeneratorImpl</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Generator</span>&lt;T&gt;&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GeneratorImpl</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Generator</span>&lt;String&gt;&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ³›å‹æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> &lt; E &gt; <span class="keyword">void</span> <span class="title function_">printArray</span><span class="params">( E[] inputArray )</span></span><br><span class="line">   &#123;</span><br><span class="line">         <span class="keyword">for</span> ( E element : inputArray )&#123;</span><br><span class="line">            System.out.printf( <span class="string">&quot;%s &quot;</span>, element );</span><br><span class="line">         &#125;</span><br><span class="line">         System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸åŒç±»å‹æ•°ç»„ï¼šInteger, Double å’Œ Character</span></span><br><span class="line">Integer[] intArray = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> &#125;;</span><br><span class="line">String[] stringArray = &#123; <span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;World&quot;</span> &#125;;</span><br><span class="line">printArray( intArray  );</span><br><span class="line">printArray( stringArray  );</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>ä½¿ç”¨åœºæ™¯ï¼ˆä¸¾ä¾‹æ¥è¯´ï¼‰</li>
</ol>
<ul>
<li>è‡ªå®šä¹‰æ¥å£é€šç”¨è¿”å›ç»“æœ CommonResult<T> é€šè¿‡å‚æ•° T å¯æ ¹æ®å…·ä½“çš„è¿”å›ç±»å‹åŠ¨æ€æŒ‡å®šç»“æœçš„æ•°æ®ç±»å‹</T></li>
<li>å®šä¹‰ Excel å¤„ç†ç±» ExcelUtil<T> ç”¨äºåŠ¨æ€æŒ‡å®š Excel å¯¼å‡ºçš„æ•°æ®ç±»å‹</T></li>
<li>æ„å»ºé›†åˆå·¥å…·ç±»ï¼ˆå‚è€ƒ Collections ä¸­çš„ sort, binarySearch æ–¹æ³•ï¼‰</li>
</ul>
<h3 id="åå°„">åå°„</h3>
<ol>
<li>æ˜¯ä»€ä¹ˆã€æ€ä¹ˆç”¨</li>
</ol>
<p>åå°„è¢«ç§°ä¸ºæ¡†æ¶çš„çµé­‚ï¼Œå› ä¸ºå®ƒèµ‹äºˆäº†æˆ‘ä»¬åœ¨<strong>è¿è¡Œæ—¶åˆ†æç±»ä»¥åŠæ‰§è¡Œç±»ä¸­æ–¹æ³•çš„èƒ½åŠ›</strong>ã€‚é€šè¿‡åå°„ä½ å¯ä»¥è·å–ä»»æ„ä¸€ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œä½ è¿˜å¯ä»¥è°ƒç”¨è¿™äº›æ–¹æ³•å’Œå±æ€§ã€‚</p>
<p>ç¼ºç‚¹ï¼šå®‰å…¨æ€§é—®é¢˜â€”â€”å¯ä»¥æ— è§†æ³›å‹å‚æ•°çš„å®‰å…¨æ£€æŸ¥ï¼ˆæ³›å‹å‚æ•°çš„å®‰å…¨æ£€æŸ¥å‘ç”Ÿåœ¨ç¼–è¯‘æ—¶ï¼‰ã€‚æ€§èƒ½ç¨å·®ç‚¹ï¼ˆ<a href="https://stackoverflow.com/questions/1392351/java-reflection-why-is-it-so-slow">Java Reflection: Why is it so slow? </a>ï¼‰ã€‚</p>
<p><strong>åº”ç”¨</strong>ï¼š</p>
<ul>
<li>æ¡†æ¶ä¸­å¤§é‡ä½¿ç”¨åŠ¨æ€ä»£ç†ï¼Œè€Œ<strong>åŠ¨æ€ä»£ç†çš„å®ç°ä¾èµ–äºåå°„</strong>ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DebugInvocationHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»£ç†ç±»ä¸­çš„çœŸå®å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DebugInvocationHandler</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> InvocationTargetException, IllegalAccessException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;before method &quot;</span> + method.getName());</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(target, args);</span><br><span class="line">        System.out.println(<span class="string">&quot;after method &quot;</span> + method.getName());</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>æ³¨è§£</strong>çš„å®ç°ä¹Ÿç”¨åˆ°äº†åå°„ã€‚ï¼ˆåŸºäºåå°„åˆ†æç±»ï¼Œè·å– ç±»/å±æ€§/æ–¹æ³•/æ–¹æ³•çš„å‚æ•° ä¸Šçš„æ³¨è§£ã€‚ï¼‰</li>
</ul>
<h3 id="æ³¨è§£">æ³¨è§£</h3>
<ol>
<li>æ˜¯ä»€ä¹ˆ</li>
</ol>
<p>Annotation ï¼ˆæ³¨è§£ï¼‰ æ˜¯ Java5 å¼€å§‹å¼•å…¥çš„æ–°ç‰¹æ€§ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ³¨é‡Šï¼Œä¸»è¦ç”¨äºä¿®é¥°ç±»ã€æ–¹æ³•æˆ–è€…å˜é‡ï¼Œæä¾›æŸäº›ä¿¡æ¯ä¾›ç¨‹åºåœ¨ç¼–è¯‘æˆ–è€…è¿è¡Œæ—¶ä½¿ç”¨ã€‚</p>
<p>æ³¨è§£æœ¬è´¨æ˜¯ä¸€ä¸ªç»§æ‰¿äº†Annotation çš„ç‰¹æ®Šæ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.SOURCE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Override &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Override</span> <span class="keyword">extends</span> <span class="title class_">Annotation</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>æ³¨è§£çš„è§£ææ–¹å¼</li>
</ol>
<ul>
<li><strong>ç¼–è¯‘æœŸç›´æ¥æ‰«æ</strong>ï¼šç¼–è¯‘å™¨åœ¨ç¼–è¯‘ Java ä»£ç çš„æ—¶å€™æ‰«æå¯¹åº”çš„æ³¨è§£å¹¶å¤„ç†ï¼Œæ¯”å¦‚æŸä¸ªæ–¹æ³•ä½¿ç”¨@Override æ³¨è§£ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘çš„æ—¶å€™å°±ä¼šæ£€æµ‹å½“å‰çš„æ–¹æ³•æ˜¯å¦é‡å†™äº†çˆ¶ç±»å¯¹åº”çš„æ–¹æ³•ã€‚</li>
<li><strong>è¿è¡ŒæœŸé€šè¿‡åå°„å¤„ç†</strong>ï¼šåƒæ¡†æ¶ä¸­è‡ªå¸¦çš„æ³¨è§£(æ¯”å¦‚ Spring æ¡†æ¶çš„ @Valueã€@Component)éƒ½æ˜¯é€šè¿‡åå°„æ¥è¿›è¡Œå¤„ç†çš„ã€‚</li>
</ul>
<h3 id="SPI">SPI</h3>
<ol>
<li>SPIæ˜¯ä»€ä¹ˆ</li>
</ol>
<p>SPI å³ Service Provider Interface ï¼Œå­—é¢æ„æ€å°±æ˜¯ï¼šâ€œæœåŠ¡æä¾›è€…çš„æ¥å£â€ï¼Œæˆ‘çš„ç†è§£æ˜¯ï¼šä¸“é—¨æä¾›ç»™æœåŠ¡æä¾›è€…æˆ–è€…æ‰©å±•æ¡†æ¶åŠŸèƒ½çš„å¼€å‘è€…å»ä½¿ç”¨çš„ä¸€ä¸ªæ¥å£ã€‚</p>
<p>SPI å°†æœåŠ¡æ¥å£å’Œå…·ä½“çš„æœåŠ¡å®ç°åˆ†ç¦»å¼€æ¥ï¼Œå°†æœåŠ¡è°ƒç”¨æ–¹å’ŒæœåŠ¡å®ç°è€…è§£è€¦ï¼Œèƒ½å¤Ÿæå‡ç¨‹åºçš„æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§ã€‚ä¿®æ”¹æˆ–è€…æ›¿æ¢æœåŠ¡å®ç°å¹¶ä¸éœ€è¦ä¿®æ”¹è°ƒç”¨æ–¹ã€‚</p>
<p>å¾ˆå¤šæ¡†æ¶éƒ½ä½¿ç”¨äº† Java çš„ SPI æœºåˆ¶ï¼Œæ¯”å¦‚ï¼šSpring æ¡†æ¶ã€æ•°æ®åº“åŠ è½½é©±åŠ¨ã€æ—¥å¿—æ¥å£ã€ä»¥åŠ Dubbo çš„æ‰©å±•å®ç°ç­‰ç­‰ã€‚</p>
<ol start="2">
<li>SPI &amp; API</li>
</ol>
<p>ä¸€èˆ¬æ¨¡å—ä¹‹é—´éƒ½æ˜¯é€šè¿‡æ¥å£è¿›è¡Œé€šè®¯ï¼Œé‚£æˆ‘ä»¬åœ¨æœåŠ¡è°ƒç”¨æ–¹å’ŒæœåŠ¡å®ç°æ–¹ï¼ˆä¹Ÿç§°æœåŠ¡æä¾›è€…ï¼‰ä¹‹é—´å¼•å…¥ä¸€ä¸ªâ€œæ¥å£â€ã€‚</p>
<p>å½“å®ç°æ–¹æä¾›äº†æ¥å£å’Œå®ç°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨å®ç°æ–¹çš„æ¥å£ä»è€Œæ‹¥æœ‰å®ç°æ–¹ç»™æˆ‘ä»¬æä¾›çš„èƒ½åŠ›ï¼Œè¿™å°±æ˜¯ API ï¼Œè¿™ç§æ¥å£å’Œå®ç°éƒ½æ˜¯æ”¾åœ¨å®ç°æ–¹çš„ã€‚</p>
<p>å½“æ¥å£å­˜åœ¨äºè°ƒç”¨æ–¹è¿™è¾¹æ—¶ï¼Œå°±æ˜¯ SPI ï¼Œç”±æ¥å£è°ƒç”¨æ–¹ç¡®å®šæ¥å£è§„åˆ™ï¼Œç„¶åç”±ä¸åŒçš„å‚å•†å»æ ¹æ®è¿™ä¸ªè§„åˆ™å¯¹è¿™ä¸ªæ¥å£è¿›è¡Œå®ç°ï¼Œä»è€Œæä¾›æœåŠ¡ã€‚</p>
<h3 id="IO">IO</h3>
<p><img src="/post/37c82b62/JavaIO.png" alt="JavaIO"></p>
<ol>
<li>IO æµ</li>
</ol>
<p>IO æµåœ¨ Java ä¸­åˆ†ä¸º<strong>è¾“å…¥æµå’Œè¾“å‡ºæµ</strong>ï¼Œè€Œæ ¹æ®æ•°æ®çš„å¤„ç†æ–¹å¼åˆåˆ†ä¸º<strong>å­—èŠ‚æµå’Œå­—ç¬¦æµ</strong>ã€‚</p>
<p>Java IO æµçš„ 40 å¤šä¸ªç±»éƒ½æ˜¯ä»å¦‚ä¸‹ 4 ä¸ªæŠ½è±¡ç±»åŸºç±»ä¸­æ´¾ç”Ÿå‡ºæ¥çš„ã€‚</p>
<ul>
<li>InputStream/Reader: æ‰€æœ‰çš„è¾“å…¥æµçš„åŸºç±»ï¼Œå‰è€…æ˜¯å­—èŠ‚è¾“å…¥æµï¼Œåè€…æ˜¯å­—ç¬¦è¾“å…¥æµã€‚</li>
<li>OutputStream/Writer: æ‰€æœ‰è¾“å‡ºæµçš„åŸºç±»ï¼Œå‰è€…æ˜¯å­—èŠ‚è¾“å‡ºæµï¼Œåè€…æ˜¯å­—ç¬¦è¾“å‡ºæµã€‚</li>
</ul>
<ol start="2">
<li>ä¸ºä½•åˆ†å­—èŠ‚æµå’Œå­—ç¬¦æµï¼Ÿ</li>
</ol>
<blockquote>
<p>ä¸ç®¡æ˜¯æ–‡ä»¶è¯»å†™è¿˜æ˜¯ç½‘ç»œå‘é€æ¥æ”¶ï¼Œä¿¡æ¯çš„æœ€å°å­˜å‚¨å•å…ƒéƒ½æ˜¯å­—èŠ‚ï¼Œé‚£ä¸ºä»€ä¹ˆ I/O æµæ“ä½œè¦åˆ†ä¸ºå­—èŠ‚æµæ“ä½œå’Œå­—ç¬¦æµæ“ä½œå‘¢ï¼Ÿ</p>
</blockquote>
<p>ä¸ªäººè®¤ä¸ºä¸»è¦æœ‰ä¸¤ç‚¹åŸå› ï¼š</p>
<ul>
<li>å­—ç¬¦æµæ˜¯ç”± Java è™šæ‹Ÿæœºå°†å­—èŠ‚è½¬æ¢å¾—åˆ°çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹è¿˜ç®—æ˜¯æ¯”è¾ƒè€—æ—¶ï¼›</li>
<li>å¦‚æœæˆ‘ä»¬ä¸çŸ¥é“ç¼–ç ç±»å‹çš„è¯ï¼Œä½¿ç”¨å­—èŠ‚æµçš„è¿‡ç¨‹ä¸­å¾ˆå®¹æ˜“å‡ºç°ä¹±ç é—®é¢˜ã€‚</li>
</ul>
<ol start="3">
<li>IOä¸­ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼</li>
</ol>
<p><a href="https://javaguide.cn/java/io/io-design-patterns.html">Java IO è®¾è®¡æ¨¡å¼æ€»ç»“</a></p>
<ol start="4">
<li>BIOã€NIOã€AIO</li>
</ol>
<p><a href="https://javaguide.cn/java/io/io-model.html">Java IO æ¨¡å‹è¯¦è§£ </a><br>
<a href="https://javabetter.cn/nio/BIONIOAIO.html">ä¸€æ–‡å½»åº•è§£é‡Šæ¸…æ¥šJava ä¸­çš„NIOã€BIOå’ŒAIO</a></p>
<h3 id="åºåˆ—åŒ–ã€ååºåˆ—åŒ–">åºåˆ—åŒ–ã€ååºåˆ—åŒ–</h3>
<ol>
<li>åºåˆ—åŒ–å’Œååºåˆ—åŒ–</li>
</ol>
<p>æ˜¯ä»€ä¹ˆï¼š</p>
<ul>
<li>åºåˆ—åŒ–ï¼šå°†æ•°æ®ç»“æ„æˆ–å¯¹è±¡è½¬æ¢æˆäºŒè¿›åˆ¶å­—èŠ‚æµçš„è¿‡ç¨‹</li>
<li>ååºåˆ—åŒ–ï¼šå°†åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­æ‰€ç”Ÿæˆçš„äºŒè¿›åˆ¶å­—èŠ‚æµè½¬æ¢æˆæ•°æ®ç»“æ„æˆ–è€…å¯¹è±¡çš„è¿‡ç¨‹</li>
</ul>
<p>åº”ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>å¯¹è±¡åœ¨è¿›è¡Œç½‘ç»œä¼ è¾“ï¼ˆæ¯”å¦‚è¿œç¨‹æ–¹æ³•è°ƒç”¨ RPC çš„æ—¶å€™ï¼‰ä¹‹å‰éœ€è¦å…ˆè¢«åºåˆ—åŒ–ï¼Œæ¥æ”¶åˆ°åºåˆ—åŒ–çš„å¯¹è±¡ä¹‹åéœ€è¦å†è¿›è¡Œååºåˆ—åŒ–ï¼›</li>
<li>å°†å¯¹è±¡å­˜å‚¨åˆ°æ–‡ä»¶ä¹‹å‰éœ€è¦è¿›è¡Œåºåˆ—åŒ–ï¼Œå°†å¯¹è±¡ä»æ–‡ä»¶ä¸­è¯»å–å‡ºæ¥éœ€è¦è¿›è¡Œååºåˆ—åŒ–ï¼›</li>
<li>å°†å¯¹è±¡å­˜å‚¨åˆ°æ•°æ®åº“ï¼ˆå¦‚ Redisï¼‰ä¹‹å‰éœ€è¦ç”¨åˆ°åºåˆ—åŒ–ï¼Œå°†å¯¹è±¡ä»ç¼“å­˜æ•°æ®åº“ä¸­è¯»å–å‡ºæ¥éœ€è¦ååºåˆ—åŒ–ï¼›</li>
<li>å°†å¯¹è±¡å­˜å‚¨åˆ°å†…å­˜ä¹‹å‰éœ€è¦è¿›è¡Œåºåˆ—åŒ–ï¼Œä»å†…å­˜ä¸­è¯»å–å‡ºæ¥ä¹‹åéœ€è¦è¿›è¡Œååºåˆ—åŒ–ã€‚</li>
</ul>
<blockquote>
<p>å³ï¼š<strong>åºåˆ—åŒ–çš„ä¸»è¦ç›®çš„æ˜¯é€šè¿‡ç½‘ç»œä¼ è¾“å¯¹è±¡æˆ–è€…è¯´æ˜¯å°†å¯¹è±¡å­˜å‚¨åˆ°æ–‡ä»¶ç³»ç»Ÿã€æ•°æ®åº“ã€å†…å­˜ä¸­ã€‚</strong></p>
</blockquote>
<ol start="2">
<li>ä¸æƒ³è¿›è¡Œåºåˆ—åŒ–çš„å­—æ®µçš„å¤„ç†æ–¹å¼</li>
</ol>
<p>å¯¹äºä¸æƒ³è¿›è¡Œåºåˆ—åŒ–çš„å˜é‡ï¼Œä½¿ç”¨ transient å…³é”®å­—ä¿®é¥°ã€‚</p>
<p>transient å…³é”®å­—çš„ä½œç”¨æ˜¯ï¼šé˜»æ­¢å®ä¾‹ä¸­é‚£äº›ç”¨æ­¤å…³é”®å­—ä¿®é¥°çš„çš„å˜é‡åºåˆ—åŒ–ï¼›å½“å¯¹è±¡è¢«ååºåˆ—åŒ–æ—¶ï¼Œè¢« transient ä¿®é¥°çš„å˜é‡å€¼ä¸ä¼šè¢«æŒä¹…åŒ–å’Œæ¢å¤ã€‚</p>
<p>å…³äº transient è¿˜æœ‰å‡ ç‚¹æ³¨æ„ï¼š</p>
<ul>
<li>transient åªèƒ½ä¿®é¥°å˜é‡ï¼Œä¸èƒ½ä¿®é¥°ç±»å’Œæ–¹æ³•</li>
<li>ã€‚transient ä¿®é¥°çš„å˜é‡ï¼Œåœ¨ååºåˆ—åŒ–åå˜é‡å€¼å°†ä¼šè¢«ç½®æˆç±»å‹çš„é»˜è®¤å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ˜¯ä¿®é¥° int ç±»å‹ï¼Œé‚£ä¹ˆååºåˆ—åç»“æœå°±æ˜¯ 0ã€‚</li>
<li>static å˜é‡å› ä¸ºä¸å±äºä»»ä½•å¯¹è±¡(Object)ï¼Œæ‰€ä»¥æ— è®ºæœ‰æ²¡æœ‰ transient å…³é”®å­—ä¿®é¥°ï¼Œå‡ä¸ä¼šè¢«åºåˆ—åŒ–ã€‚</li>
</ul>
<ol start="3">
<li>åºåˆ—åŒ–åè®®</li>
</ol>
<p>JDK è‡ªå¸¦çš„åºåˆ—åŒ–æ–¹å¼ä¸€èˆ¬ä¸ä¼šç”¨ ï¼Œå› ä¸ºåºåˆ—åŒ–æ•ˆç‡ä½å¹¶ä¸”å­˜åœ¨å®‰å…¨é—®é¢˜ã€‚</p>
<p>æ¯”è¾ƒå¸¸ç”¨çš„åºåˆ—åŒ–åè®®æœ‰ <strong>Hessianã€Kryoã€Protobufã€ProtoStuff</strong>ï¼Œè¿™äº›éƒ½æ˜¯åŸºäº<strong>äºŒè¿›åˆ¶</strong>çš„åºåˆ—åŒ–åè®®ã€‚</p>
<p>åƒ JSON å’Œ XML è¿™ç§å±äºæ–‡æœ¬ç±»åºåˆ—åŒ–æ–¹å¼ã€‚è™½ç„¶å¯è¯»æ€§æ¯”è¾ƒå¥½ï¼Œä½†æ˜¯æ€§èƒ½è¾ƒå·®ï¼Œä¸€èˆ¬ä¸ä¼šé€‰æ‹©ã€‚</p>
<ol start="4">
<li>JDKè‡ªå¸¦çš„åºåˆ—åŒ–ï¼Ÿ</li>
</ol>
<ul>
<li>ä¸æ”¯æŒè·¨è¯­è¨€è°ƒç”¨ : å¦‚æœè°ƒç”¨çš„æ˜¯å…¶ä»–è¯­è¨€å¼€å‘çš„æœåŠ¡çš„æ—¶å€™å°±ä¸æ”¯æŒäº†ã€‚</li>
<li>æ€§èƒ½å·®ï¼šç›¸æ¯”äºå…¶ä»–åºåˆ—åŒ–æ¡†æ¶æ€§èƒ½æ›´ä½ï¼Œä¸»è¦åŸå› æ˜¯åºåˆ—åŒ–ä¹‹åçš„å­—èŠ‚æ•°ç»„ä½“ç§¯è¾ƒå¤§ï¼Œå¯¼è‡´ä¼ è¾“æˆæœ¬åŠ å¤§ã€‚</li>
<li>å­˜åœ¨å®‰å…¨é—®é¢˜ï¼šåºåˆ—åŒ–å’Œååºåˆ—åŒ–æœ¬èº«å¹¶ä¸å­˜åœ¨é—®é¢˜ã€‚ä½†å½“è¾“å…¥çš„ååºåˆ—åŒ–çš„æ•°æ®å¯è¢«ç”¨æˆ·æ§åˆ¶ï¼Œé‚£ä¹ˆæ”»å‡»è€…å³å¯é€šè¿‡æ„é€ æ¶æ„è¾“å…¥ï¼Œè®©ååºåˆ—åŒ–äº§ç”Ÿéé¢„æœŸçš„å¯¹è±¡ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­æ‰§è¡Œæ„é€ çš„ä»»æ„ä»£ç ã€‚</li>
</ul>
<h3 id="è¯­æ³•ç³–">è¯­æ³•ç³–</h3>
<ol>
<li>æ˜¯ä»€ä¹ˆã€æœ‰å“ªäº›</li>
</ol>
<p><strong>è¯­æ³•ç³–ï¼ˆSyntactic sugarï¼‰</strong> ä»£æŒ‡çš„æ˜¯ç¼–ç¨‹è¯­è¨€ä¸ºäº†æ–¹ä¾¿ç¨‹åºå‘˜å¼€å‘ç¨‹åºè€Œè®¾è®¡çš„ä¸€ç§ç‰¹æ®Šè¯­æ³•ï¼Œè¿™ç§è¯­æ³•å¯¹ç¼–ç¨‹è¯­è¨€çš„åŠŸèƒ½å¹¶æ²¡æœ‰å½±å“ã€‚å®ç°ç›¸åŒçš„åŠŸèƒ½ï¼ŒåŸºäºè¯­æ³•ç³–å†™å‡ºæ¥çš„ä»£ç å¾€å¾€æ›´ç®€å•ç®€æ´ä¸”æ›´æ˜“é˜…è¯»ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼ŒJava ä¸­çš„ for-each å°±æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„è¯­æ³•ç³–ï¼Œå…¶åŸç†å…¶å®å°±æ˜¯åŸºäºæ™®é€šçš„ for å¾ªç¯å’Œè¿­ä»£å™¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String[] strs = &#123;<span class="string">&quot;JavaGuide&quot;</span>, <span class="string">&quot;å…¬ä¼—å·ï¼šJavaGuide&quot;</span>, <span class="string">&quot;åšå®¢ï¼šhttps://javaguide.cn/&quot;</span>&#125;;</span><br><span class="line"><span class="keyword">for</span> (String s : strs) &#123;</span><br><span class="line">  	System.out.println(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸è¿‡ï¼ŒJVM å…¶å®å¹¶ä¸èƒ½è¯†åˆ«è¯­æ³•ç³–ï¼ŒJava è¯­æ³•ç³–è¦æƒ³è¢«æ­£ç¡®æ‰§è¡Œï¼Œéœ€è¦å…ˆé€šè¿‡ç¼–è¯‘å™¨è¿›è¡Œè§£ç³–ï¼Œä¹Ÿå°±æ˜¯åœ¨ç¨‹åºç¼–è¯‘é˜¶æ®µå°†å…¶è½¬æ¢æˆ JVM è®¤è¯†çš„åŸºæœ¬è¯­æ³•ã€‚è¿™ä¹Ÿä¾§é¢è¯´æ˜ï¼Œ<strong>Java ä¸­çœŸæ­£æ”¯æŒè¯­æ³•ç³–çš„æ˜¯ Java ç¼–è¯‘å™¨è€Œä¸æ˜¯ JVM</strong>ã€‚å¦‚æœä½ å»çœ‹com.sun.tools.javac.main.JavaCompilerçš„æºç ï¼Œä½ ä¼šå‘ç°åœ¨compile()ä¸­æœ‰ä¸€ä¸ªæ­¥éª¤å°±æ˜¯è°ƒç”¨desugar()ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯è´Ÿè´£è§£è¯­æ³•ç³–çš„å®ç°çš„ã€‚</p>
<blockquote>
<p>Java ä¸­æœ€å¸¸ç”¨çš„è¯­æ³•ç³–ä¸»è¦æœ‰æ³›å‹ã€è‡ªåŠ¨æ‹†è£…ç®±ã€å˜é•¿å‚æ•°ã€æšä¸¾ã€å†…éƒ¨ç±»ã€å¢å¼º for å¾ªç¯ã€try-with-resources è¯­æ³•ã€lambda è¡¨è¾¾å¼ç­‰ã€‚</p>
</blockquote>
<h2 id="é‡ç‚¹">é‡ç‚¹</h2>
]]></content>
      <categories>
        <category>Coding</category>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
</search>
